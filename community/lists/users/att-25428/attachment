<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv=Content-Type content="text/html; charset=us-ascii"><meta name=Generator content="Microsoft Word 14 (filtered medium)"><style><!--
/* Font Definitions */
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"MS Mincho";
	panose-1:2 2 6 9 4 2 5 8 3 4;}
@font-face
	{font-family:"MS Mincho";
	panose-1:2 2 6 9 4 2 5 8 3 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"\@MS Mincho";
	panose-1:2 2 6 9 4 2 5 8 3 4;}
@font-face
	{font-family:Menlo;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{mso-style-priority:34;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
span.EmailStyle17
	{mso-style-type:personal-reply;
	font-family:"Calibri","sans-serif";
	color:#1F497D;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-size:10.0pt;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
/* List Definitions */
@list l0
	{mso-list-id:1181966147;
	mso-list-type:hybrid;
	mso-list-template-ids:307686310 -703306390 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l0:level1
	{mso-level-start-at:0;
	mso-level-number-format:bullet;
	mso-level-text:-;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:"Calibri","sans-serif";
	mso-fareast-font-family:"MS Mincho";
	mso-bidi-font-family:"Times New Roman";}
@list l0:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:"Courier New";}
@list l0:level3
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Wingdings;}
@list l0:level4
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Symbol;}
@list l0:level5
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:"Courier New";}
@list l0:level6
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Wingdings;}
@list l0:level7
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Symbol;}
@list l0:level8
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:"Courier New";}
@list l0:level9
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Wingdings;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
--></style><!--[if gte mso 9]><xml>
<o:shapedefaults v:ext="edit" spidmax="1026" />
</xml><![endif]--><!--[if gte mso 9]><xml>
<o:shapelayout v:ext="edit">
<o:idmap v:ext="edit" data="1" />
</o:shapelayout></xml><![endif]--></head><body lang=EN-US link=blue vlink=purple><div class=WordSection1><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>Hi Ralph,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>I&#8217;ve been troubleshooting this issue and communicating with Blue Waters support.&nbsp; It turns out that Q-Chem and OpenMPI are both trying to open sockets, and I get different error messages depending on which one fails.&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>As an aside, I don&#8217;t know why Q-Chem needs sockets of its own to communicate between ranks; shouldn&#8217;t OpenMPI be taking care of all that?&nbsp; (I&#8217;m unfamiliar with this part of the Q-Chem code base, maybe it&#8217;s trying to duplicate some functionality?)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>The Blue Waters support has indicated that there&#8217;s a problem with their realm-specific IP addressing (RSIP) for the compute nodes, which they&#8217;re working on fixing.&nbsp; I also tried running the same Q-Chem / OpenMPI job on a management node which I think has the same hardware (but not the RSIP), and the problem went away.&nbsp; So I think I&#8217;ll shelve this problem for now, until Blue Waters support gets back to me with the fix. :)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>Thanks,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'><o:p>&nbsp;</o:p></span></p><p class=MsoListParagraph style='text-indent:-.25in;mso-list:l0 level1 lfo1'><![if !supportLists]><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'><span style='mso-list:Ignore'>-<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>Lee-Ping<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'><o:p>&nbsp;</o:p></span></p><div><div style='border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-size:10.0pt;font-family:"Tahoma","sans-serif"'>From:</span></b><span style='font-size:10.0pt;font-family:"Tahoma","sans-serif"'> users [mailto:users-bounces@open-mpi.org] <b>On Behalf Of </b>Lee-Ping Wang<br><b>Sent:</b> Tuesday, September 30, 2014 1:15 PM<br><b>To:</b> Open MPI Users<br><b>Subject:</b> Re: [OMPI users] General question about running single-node jobs.<o:p></o:p></span></p></div></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>Hi Ralph,<o:p></o:p></p><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>Thanks. &nbsp;I'll add some print statements to the code and try to figure out precisely where the failure is happening.<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>- Lee-Ping<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p><div><div><p class=MsoNormal>On Sep 30, 2014, at 12:06 PM, Ralph Castain &lt;<a href="mailto:rhc@open-mpi.org">rhc@open-mpi.org</a>&gt; wrote:<o:p></o:p></p></div><p class=MsoNormal><br><br><o:p></o:p></p><div><p class=MsoNormal><o:p>&nbsp;</o:p></p><div><div><p class=MsoNormal>On Sep 30, 2014, at 11:19 AM, Lee-Ping Wang &lt;<a href="mailto:leeping@stanford.edu">leeping@stanford.edu</a>&gt; wrote:<o:p></o:p></p></div><p class=MsoNormal><br><br><o:p></o:p></p><div><p class=MsoNormal>Hi Ralph,<o:p></o:p></p><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><div><blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'><div><blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'><div><p class=MsoNormal>&nbsp;If so, then I should be able to (1) locate where the port number is defined in the code, and (2) randomize the port number every time it's called to work around the issue. &nbsp;What do you think?<o:p></o:p></p></div></blockquote><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><p class=MsoNormal>That might work, depending on the code. I'm not sure what it is trying to connect to, and if that code knows how to handle arbitrary connections<o:p></o:p></p></div></blockquote></div><div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div></div><div><p class=MsoNormal>The main reason why Q-Chem is using MPI is for executing parallel tasks on a single node. &nbsp;Thus, I think it's just the MPI ranks attempting to connect with each other on the same machine. &nbsp;This could be off the mark because I'm still a novice with respect to MPI concepts - but I am sure it is just one machine.<o:p></o:p></p></div></div></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><p class=MsoNormal>Your statement doesn't match what you sent us - you showed that it was your connection code that was failing, not ours. You wouldn't have gotten that far if our connections failed as you would have failed in MPI_Init. You are clearly much further than that as you already passed an MPI_Barrier before reaching the code in question.<o:p></o:p></p></div><div><p class=MsoNormal><br><br><o:p></o:p></p><div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'><div><p class=MsoNormal>You might check about those warnings - could be that QCLOCALSCR and QCREF need to be set for the code to work.<o:p></o:p></p></div></blockquote><div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div></div><div><p class=MsoNormal>Thanks; I don't think these environment variables are the issue but I will check again. &nbsp;The calculation runs without any problems on four different clusters (where I don't set these environment variables either), it's only broken on the Blue Waters compute node. &nbsp;Also, the calculation runs without any problems the first time it's executed on the BW compute node - it's only subsequent executions that give the error messages.<o:p></o:p></p></div></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>Thanks,<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>- Lee-Ping<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p><div><div><p class=MsoNormal>On Sep 30, 2014, at 11:05 AM, Ralph Castain &lt;<a href="mailto:rhc@open-mpi.org">rhc@open-mpi.org</a>&gt; wrote:<o:p></o:p></p></div><p class=MsoNormal><br><br><o:p></o:p></p><div><p class=MsoNormal><o:p>&nbsp;</o:p></p><div><div><p class=MsoNormal>On Sep 30, 2014, at 10:49 AM, Lee-Ping Wang &lt;<a href="mailto:leeping@stanford.edu">leeping@stanford.edu</a>&gt; wrote:<o:p></o:p></p></div><p class=MsoNormal><br><br><o:p></o:p></p><div><p class=MsoNormal>Hi Ralph,<o:p></o:p></p><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>Thank you. &nbsp;I think your diagnosis is probably correct. &nbsp;Are these sockets the same as TCP/UDP ports (though different numbers) that are used in web servers, email etc?<o:p></o:p></p></div></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><p class=MsoNormal>Yes<o:p></o:p></p></div><div><p class=MsoNormal><br><br><o:p></o:p></p><div><p class=MsoNormal>&nbsp;If so, then I should be able to (1) locate where the port number is defined in the code, and (2) randomize the port number every time it's called to work around the issue. &nbsp;What do you think?<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><p class=MsoNormal>That might work, depending on the code. I'm not sure what it is trying to connect to, and if that code knows how to handle arbitrary connections<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>You might check about those warnings - could be that QCLOCALSCR and QCREF need to be set for the code to work.<o:p></o:p></p></div><div><p class=MsoNormal><br><br><o:p></o:p></p><div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>- Lee-Ping<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p><div><div><div><p class=MsoNormal>On Sep 29, 2014, at 8:45 PM, Ralph Castain &lt;<a href="mailto:rhc@open-mpi.org">rhc@open-mpi.org</a>&gt; wrote:<o:p></o:p></p></div><p class=MsoNormal><br><br><o:p></o:p></p><div><p class=MsoNormal>I don't know anything about your application, or what the functions in your code are doing. I imagine it's possible that you are trying to open statically defined ports, which means that running the job again too soon could leave the OS thinking the socket is already busy. It takes awhile for the OS to release a socket resource.<o:p></o:p></p><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p><div><div><p class=MsoNormal>On Sep 29, 2014, at 5:49 PM, Lee-Ping Wang &lt;<a href="mailto:leeping@stanford.edu">leeping@stanford.edu</a>&gt; wrote:<o:p></o:p></p></div><p class=MsoNormal><br><br><o:p></o:p></p><div><p class=MsoNormal>Here's another data point that might be useful: The error message is much more rare if I run my application on 4 cores instead of 8.<o:p></o:p></p><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>Thanks,<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>- Lee-Ping<o:p></o:p></p><div><p class=MsoNormal><o:p>&nbsp;</o:p></p><div><div><p class=MsoNormal>On Sep 29, 2014, at 5:38 PM, Lee-Ping Wang &lt;<a href="mailto:leeping@stanford.edu">leeping@stanford.edu</a>&gt; wrote:<o:p></o:p></p></div><p class=MsoNormal><br><br><o:p></o:p></p><div><p class=MsoNormal>Sorry for my last email - I think I spoke too quick. &nbsp;I realized after reading some more documentation that OpenMPI always uses TCP sockets for out-of-band communication, so it doesn't make sense for me to set OMPI_MCA_oob=^tcp. &nbsp;That said, I am still running into a strange problem in my application when running on a specific machine (Blue Waters compute node); I don't see this problem on any other nodes.<o:p></o:p></p><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>When I run the same job (~5 seconds) in rapid succession, I see the following error message on the second execution:<o:p></o:p></p><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>/tmp/leeping/opt/qchem-4.2/bin/parallel.csh,&nbsp; , qcopt_reactants.in, 8, 0, ./qchem24825/<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>MPIRUN in parallel.csh is /tmp/leeping/opt/qchem-4.2/ext-libs/openmpi/bin/mpirun<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>P4_RSHCOMMAND in parallel.csh is ssh<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>QCOUTFILE is stdout<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>Q-Chem machineFile is /tmp/leeping/opt/qchem-4.2/bin/mpi/machines<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>[nid15081:24859] Warning: could not find environment variable &quot;QCLOCALSCR&quot;<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>[nid15081:24859] Warning: could not find environment variable &quot;QCREF&quot;<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>initial socket setup ...start<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>-------------------------------------------------------<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>Primary job&nbsp; terminated normally, but 1 process returned<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>a non-zero exit code.. Per user-direction, the job has been aborted.<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>-------------------------------------------------------<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>--------------------------------------------------------------------------<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>mpirun detected that one or more processes exited with non-zero status, thus causing<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>the job to be terminated. The first process to do so was:<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'><o:p>&nbsp;</o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; Process name: [[46773,1],0]<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; Exit code:&nbsp; &nbsp; 255<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>--------------------------------------------------------------------------<o:p></o:p></span></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>And here's the source code where the program is exiting (before &quot;initial socket setup ...done&quot;)<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:#34BD26'>int</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'> GPICommSoc::init(MPI_Comm comm0) {<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'><o:p>&nbsp;</o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; </span><span style='font-size:7.5pt;font-family:Menlo;color:#4E75FF'>/* setup basic MPI information */<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; init_comm(comm0);<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'><o:p>&nbsp;</o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; MPI_Barrier(comm);<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; </span><span style='font-size:7.5pt;font-family:Menlo;color:#4E75FF'>/*-- start inisock and set serveradd[] array --*/<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; </span><span style='font-size:7.5pt;font-family:Menlo;color:#CE7924'>if</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'> (me == </span><span style='font-size:7.5pt;font-family:Menlo;color:#C33720'>0</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>) {<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; &nbsp; &nbsp; fprintf(</span><span style='font-size:7.5pt;font-family:Menlo;color:#C33720'>stdout</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>,</span><span style='font-size:7.5pt;font-family:Menlo;color:#C33720'>&quot;initial socket setup ...start</span><span style='font-size:7.5pt;font-family:Menlo;color:#D53BD3'>\n</span><span style='font-size:7.5pt;font-family:Menlo;color:#C33720'>&quot;</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>);</span><span style='font-size:7.5pt;font-family:Menlo;color:#C33720'><o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; &nbsp; &nbsp; fflush(</span><span style='font-size:7.5pt;font-family:Menlo;color:#C33720'>stdout</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>);<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; }<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'><o:p>&nbsp;</o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; </span><span style='font-size:7.5pt;font-family:Menlo;color:#4E75FF'>// create the initial socket&nbsp;<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; inisock = new_server_socket(</span><span style='font-size:7.5pt;font-family:Menlo;color:#C33720'>NULL</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>,</span><span style='font-size:7.5pt;font-family:Menlo;color:#C33720'>0</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>);<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'><o:p>&nbsp;</o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; </span><span style='font-size:7.5pt;font-family:Menlo;color:#4E75FF'>// fill and gather the serveraddr array<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; </span><span style='font-size:7.5pt;font-family:Menlo;color:#34BD26'>int</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'> szsock = </span><span style='font-size:7.5pt;font-family:Menlo;color:#CE7924'>sizeof</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>(SOCKADDR);<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; memset(&amp;serveraddr[</span><span style='font-size:7.5pt;font-family:Menlo;color:#C33720'>0</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>],</span><span style='font-size:7.5pt;font-family:Menlo;color:#C33720'>0</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>, szsock*nproc);<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; </span><span style='font-size:7.5pt;font-family:Menlo;color:#34BD26'>int</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'> iniport=get_sockport(inisock);<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; set_sockaddr_byhname(</span><span style='font-size:7.5pt;font-family:Menlo;color:#C33720'>NULL</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>, iniport, &amp;serveraddr[me]);<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; </span><span style='font-size:7.5pt;font-family:Menlo;color:#4E75FF'>//printsockaddr( serveraddr[me] );<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'><o:p>&nbsp;</o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; SOCKADDR addrsend = serveraddr[me];<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; MPI_Allgather(&amp;addrsend,szsock,MPI_BYTE,<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;serveraddr[</span><span style='font-size:7.5pt;font-family:Menlo;color:#C33720'>0</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>], szsock,MPI_BYTE, comm);<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; </span><span style='font-size:7.5pt;font-family:Menlo;color:#CE7924'>if</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'> (me == </span><span style='font-size:7.5pt;font-family:Menlo;color:#C33720'>0</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>) {<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp;&nbsp; &nbsp; &nbsp; fprintf(</span><span style='font-size:7.5pt;font-family:Menlo;color:#C33720'>stdout</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>,</span><span style='font-size:7.5pt;font-family:Menlo;color:#C33720'>&quot;initial socket setup ...done </span><span style='font-size:7.5pt;font-family:Menlo;color:#D53BD3'>\n</span><span style='font-size:7.5pt;font-family:Menlo;color:#C33720'>&quot;<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; );<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; &nbsp; fflush(</span><span style='font-size:7.5pt;font-family:Menlo;color:#C33720'>stdout</span><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>);}<o:p></o:p></span></p></div></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>I didn't write this part of the program and I'm really a novice to MPI - but it seems like the initial execution of the program isn't freeing up some system resource as it should. &nbsp;Is there something that needs to be corrected in the code?<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>Thanks,<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>- Lee-Ping<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p><div><div><p class=MsoNormal>On Sep 29, 2014, at 5:12 PM, Lee-Ping Wang &lt;<a href="mailto:leeping@stanford.edu">leeping@stanford.edu</a>&gt; wrote:<o:p></o:p></p></div><p class=MsoNormal><br><br><o:p></o:p></p><div><p class=MsoNormal>Hi there,<o:p></o:p></p><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>My application uses MPI to run parallel jobs on a single node, so I have no need of any support for communication between nodes. &nbsp;However, when I use mpirun to launch my application I see strange errors such as:<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>--------------------------------------------------------------------------<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>No network interfaces were found for out-of-band communications. We require<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>at least one available network for out-of-band messaging.<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>--------------------------------------------------------------------------<o:p></o:p></span></p></div></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>[nid23206:10697] [[33772,1],0] ORTE_ERROR_LOG: Unable to open a TCP socket for out-of-band communications in file oob_tcp_listener.c at line 113<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>[nid23206:10697] [[33772,1],0] ORTE_ERROR_LOG: Unable to open a TCP socket for out-of-band communications in file oob_tcp_component.c at line 584<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>--------------------------------------------------------------------------<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>It looks like orte_init failed for some reason; your parallel process is<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>likely to abort.&nbsp; There are many reasons that a parallel process can<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>fail during orte_init; some of which are due to configuration or<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>environment problems.&nbsp; This failure appears to be an internal failure;<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>here's some additional information (which may only be relevant to an<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>Open MPI developer):<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'><o:p>&nbsp;</o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; orte_oob_base_select failed<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>&nbsp; --&gt; Returned value (null) (-43) instead of ORTE_SUCCESS<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>--------------------------------------------------------------------------<o:p></o:p></span></p></div></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>/home/leeping/opt/qchem-4.2/ext-libs/openmpi/lib/libmpi.so.1(+0xfeaa9)[0x2b77e9de5aa9]<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>/home/leeping/opt/qchem-4.2/ext-libs/openmpi/lib/libmpi.so.1(ompi_btl_openib_connect_base_select_for_local_port+0xd0)[0x2b77e9de13a0]<o:p></o:p></span></p></div></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>It seems like in each case, OpenMPI is trying to use some feature related to networking and crashing as a result. &nbsp;My workaround is to deduce the components that are crashing and disable them in my environment variables like this:<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>export OMPI_MCA_btl=self,sm<o:p></o:p></span></p></div><div><p class=MsoNormal style='background:black'><span style='font-size:7.5pt;font-family:Menlo;color:whitesmoke'>export OMPI_MCA_oob=^tcp<o:p></o:p></span></p></div></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>Is there a better way to do this - i.e. explicitly prohibit OpenMPI from using any network-related feature and run only on the local node?<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>Thanks,<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>- Lee-Ping<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div></div><p class=MsoNormal>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/09/25410.php">http://www.open-mpi.org/community/lists/users/2014/09/25410.php</a><o:p></o:p></p></div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div></div></div></div><p class=MsoNormal>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/09/25411.php">http://www.open-mpi.org/community/lists/users/2014/09/25411.php</a><o:p></o:p></p></div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div></div></div><p class=MsoNormal>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/09/25412.php">http://www.open-mpi.org/community/lists/users/2014/09/25412.php</a><o:p></o:p></p></div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div></div><p class=MsoNormal>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/09/25413.php">http://www.open-mpi.org/community/lists/users/2014/09/25413.php</a><o:p></o:p></p></div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div></div></div><p class=MsoNormal>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/09/25419.php">http://www.open-mpi.org/community/lists/users/2014/09/25419.php</a><o:p></o:p></p></div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><p class=MsoNormal>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/09/25420.php">http://www.open-mpi.org/community/lists/users/2014/09/25420.php</a><o:p></o:p></p></div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div></div><p class=MsoNormal>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/09/25421.php">http://www.open-mpi.org/community/lists/users/2014/09/25421.php</a><o:p></o:p></p></div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><p class=MsoNormal>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/09/25422.php">http://www.open-mpi.org/community/lists/users/2014/09/25422.php</a><o:p></o:p></p></div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div></div></body></html>
