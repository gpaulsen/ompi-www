<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<font style="font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:#1F497D"></font><br>
&nbsp;<br>
<div style="border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0in 0in 0in">
<font style="font-size:10.0pt;font-family:&quot;Tahoma&quot;,&quot;sans-serif&quot;"><b>From</b>: Clay Kirkland [mailto:clay.kirkland@versityinc.com]
<br>
<b>Sent</b>: Friday, May 02, 2014 03:24 PM<br>
<b>To</b>: users@open-mpi.org &lt;users@open-mpi.org&gt; <br>
<b>Subject</b>: [OMPI users] MPI_Barrier hangs on second attempt but only when multiple hosts used.
<br>
</font>&nbsp;<br>
</div>
<div dir="ltr">
<div id="yui_3_13_0_1_1399065114564_2844" style="" class="">I have been using MPI for many many years so I have very well debugged mpi tests.&nbsp;&nbsp; I am</div>
<div id="yui_3_13_0_1_1399065114564_2848" style="" class="">having trouble on either openmpi-1.4.5&nbsp; or&nbsp; openmpi-1.6.5 versions though with getting the
<br style="" class="">
</div>
<div id="yui_3_13_0_1_1399065114564_2853" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
MPI_Barrier calls to work.&nbsp;&nbsp; It works fine when I run all processes on one machine but when</div>
<div id="yui_3_13_0_1_1399065114564_2850" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
I run with two or more hosts the second call to MPI_Barrier always hangs.&nbsp;&nbsp; Not the first one,</div>
<div id="yui_3_13_0_1_1399065114564_2854" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
but always the second one.&nbsp;&nbsp; I looked at FAQ's and such but found nothing except for a comment</div>
<div id="yui_3_13_0_1_1399065114564_2849" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
that MPI_Barrier problems were often problems with fire walls.&nbsp; Also mentioned as a problem</div>
<div id="yui_3_13_0_1_1399065114564_2855" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
was not having the same version of mpi on both machines.&nbsp; I turned firewalls off and removed</div>
<div id="yui_3_13_0_1_1399065114564_2856" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
and reinstalled the same version on both hosts but I still see the same thing.&nbsp;&nbsp; I then installed
<br style="" class="">
</div>
<div id="yui_3_13_0_1_1399065114564_2857" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
lam mpi on two of my machines and that works fine.&nbsp;&nbsp; I can call the MPI_Barrier function when run on<br>
</div>
<div id="yui_3_13_0_1_1399065114564_2858" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
one of two machines by itself&nbsp; many times with no hangs.&nbsp; Only hangs if two or more hosts are involved.<br>
</div>
<div id="yui_3_13_0_1_1399065114564_2859" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
These runs are all being done on CentOS release 6.4.&nbsp;&nbsp; Here is test program I used.<br style="" class="">
</div>
<div id="yui_3_13_0_1_1399065114564_2860" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
<br style="" class="">
</div>
<div id="yui_3_13_0_1_1399065114564_2861" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
main (argc, argv)<br style="" class="">
int argc;<br style="" class="">
char **argv;<br style="" class="">
{<br style="" class="">
&nbsp;&nbsp;&nbsp; char message[20];<br style="" class="">
&nbsp;&nbsp;&nbsp; char hoster[256];<br style="" class="">
&nbsp;&nbsp;&nbsp; char nameis[256];<br style="" class="">
&nbsp;&nbsp;&nbsp; int fd, i, j, jnp, iret, myrank, np, ranker, recker;<br style="" class="">
&nbsp;&nbsp;&nbsp; MPI_Comm comm;<br>
<div id="yui_3_13_0_1_1399065114564_2861" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
&nbsp;&nbsp;&nbsp; MPI_Status status;<br style="" class="">
<br style="" class="">
&nbsp;&nbsp;&nbsp; MPI_Init( &amp;argc, &amp;argv );<br style="" class="">
&nbsp;&nbsp;&nbsp; MPI_Comm_rank( MPI_COMM_WORLD, &amp;myrank);<br style="" class="">
&nbsp;&nbsp;&nbsp; MPI_Comm_size( MPI_COMM_WORLD, &amp;np);<br style="" class="">
<br style="" class="">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gethostname(hoster,256);<br style="" class="">
<br style="" class="">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf(&quot; In rank %d and host= %s&nbsp; Do Barrier call 1.\n&quot;,myrank,hoster);<br style="" class="">
&nbsp;&nbsp;&nbsp; MPI_Barrier(MPI_COMM_WORLD);&nbsp; <br style="" class="">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf(&quot; In rank %d and host= %s&nbsp; Do Barrier call 2.\n&quot;,myrank,hoster);<br style="" class="">
&nbsp;&nbsp;&nbsp; MPI_Barrier(MPI_COMM_WORLD);&nbsp; <br style="" class="">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf(&quot; In rank %d and host= %s&nbsp; Do Barrier call 3.\n&quot;,myrank,hoster);<br style="" class="">
&nbsp;&nbsp;&nbsp; MPI_Barrier(MPI_COMM_WORLD);&nbsp; <br style="" class="">
&nbsp;&nbsp;&nbsp; MPI_Finalize();<br style="" class="">
&nbsp;&nbsp;&nbsp; exit(0);<br style="" class="">
}<br style="" class="">
</div>
<div id="yui_3_13_0_1_1399065114564_2875" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
<br style="" class="">
</div>
<div id="yui_3_13_0_1_1399065114564_2868" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
&nbsp; Here are three runs of test program.&nbsp; First with two processes on one host, then with</div>
<div id="yui_3_13_0_1_1399065114564_2869" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
two processes on another host, and finally with one process on each of two hosts.&nbsp; The</div>
<div id="yui_3_13_0_1_1399065114564_2870" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
first two runs are fine but the last run hangs on the second MPI_Barrier.</div>
<div id="yui_3_13_0_1_1399065114564_2871" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
<br style="" class="">
</div>
<div id="yui_3_13_0_1_1399065114564_2872" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
[root@centos MPI]# /usr/local/bin/mpirun -np 2 --host centos a.out<br style="" class="">
&nbsp;In rank 0 and host= centos&nbsp; Do Barrier call 1.<br style="" class="">
&nbsp;In rank 1 and host= centos&nbsp; Do Barrier call 1.<br style="" class="">
&nbsp;In rank 1 and host= centos&nbsp; Do Barrier call 2.<br style="" class="">
&nbsp;In rank 1 and host= centos&nbsp; Do Barrier call 3.<br style="" class="">
&nbsp;In rank 0 and host= centos&nbsp; Do Barrier call 2.<br style="" class="">
&nbsp;In rank 0 and host= centos&nbsp; Do Barrier call 3.<br style="" class="">
[root@centos MPI]# /usr/local/bin/mpirun -np 2 --host RAID a.out<br style="" class="">
/root/.bashrc: line 14: unalias: ls: not found<br style="" class="">
&nbsp;In rank 0 and host= RAID&nbsp; Do Barrier call 1.<br style="" class="">
&nbsp;In rank 0 and host= RAID&nbsp; Do Barrier call 2.<br style="" class="">
&nbsp;In rank 0 and host= RAID&nbsp; Do Barrier call 3.<br style="" class="">
&nbsp;In rank 1 and host= RAID&nbsp; Do Barrier call 1.<br style="" class="">
&nbsp;In rank 1 and host= RAID&nbsp; Do Barrier call 2.<br style="" class="">
&nbsp;In rank 1 and host= RAID&nbsp; Do Barrier call 3.<br style="" class="">
[root@centos MPI]# /usr/local/bin/mpirun -np 2 --host centos,RAID a.out<br style="" class="">
/root/.bashrc: line 14: unalias: ls: not found<br style="" class="">
&nbsp;In rank 0 and host= centos&nbsp; Do Barrier call 1.<br style="" class="">
&nbsp;In rank 0 and host= centos&nbsp; Do Barrier call 2.<br>
<div id="main">
<div id="paneshell">
<div id="shellcontent" class="">
<div id="shellinner">
<div id="yui_3_13_0_1_1399065114564_2659" style="" class="">
<div id="yui_3_13_0_1_1399065114564_2688" class="" tabindex="-1">
<div id="yui_3_13_0_1_1399065114564_2709" class="">
<div id="yui_3_13_0_1_1399065114564_2744" class="" tabindex="-1">
<div style="margin-top:0px" id="yui_3_13_0_1_1399065114564_2751" class="" tabindex="0">
<div id="yui_3_13_0_1_1399065114564_2755" class="">
<div id="yui_3_13_0_1_1399065114564_2847" class="">
<div id="yiv1440412755">
<div id="yui_3_13_0_1_1399065114564_2846">
<div id="yui_3_13_0_1_1399065114564_2845" style="color:rgb(0,0,0);background-color:rgb(255,255,255);font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;font-size:12pt">
<div id="yui_3_13_0_1_1399065114564_2872" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
In rank 1 and host= RAID&nbsp; Do Barrier call 1.<br style="" class="">
&nbsp;In rank 1 and host= RAID&nbsp; Do Barrier call 2.<br style="" class="">
</div>
<div id="yui_3_13_0_1_1399065114564_2882" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
<br style="" class="">
</div>
<div id="yui_3_13_0_1_1399065114564_2883" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
&nbsp; Since it is such a simple test and problem and such a widely used MPI function, it must obviously</div>
<div id="yui_3_13_0_1_1399065114564_2884" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
be an installation or configuration problem.&nbsp;&nbsp; A pstack for each of the hung MPI_Barrier processes
<br style="" class="">
</div>
<div id="yui_3_13_0_1_1399065114564_2885" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
on the two machines shows this:</div>
<div id="yui_3_13_0_1_1399065114564_2886" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
<br style="" class="">
</div>
<div id="yui_3_13_0_1_1399065114564_2887" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
[root@centos ~]# pstack 31666<br style="" class="">
#0&nbsp; 0x0000003baf0e8ee3 in __epoll_wait_nocancel () from /lib64/libc.so.6<br style="" class="">
#1&nbsp; 0x00007f5de06125eb in epoll_dispatch () from /usr/local/lib/libmpi.so.1<br style="" class="">
#2&nbsp; 0x00007f5de061475a in opal_event_base_loop () from /usr/local/lib/libmpi.so.1<br style="" class="">
#3&nbsp; 0x00007f5de0639229 in opal_progress () from /usr/local/lib/libmpi.so.1<br style="" class="">
#4&nbsp; 0x00007f5de0586f75 in ompi_request_default_wait_all () from /usr/local/lib/libmpi.so.1<br style="" class="">
#5&nbsp; 0x00007f5ddc59565e in ompi_coll_tuned_sendrecv_actual () from /usr/local/lib/openmpi/mca_coll_tuned.so<br style="" class="">
#6&nbsp; 0x00007f5ddc59d8ff in ompi_coll_tuned_barrier_intra_two_procs () from /usr/local/lib/openmpi/mca_coll_tuned.so<br style="" class="">
#7&nbsp; 0x00007f5de05941c2 in PMPI_Barrier () from /usr/local/lib/libmpi.so.1<br style="" class="">
#8&nbsp; 0x0000000000400a43 in main ()<br style="" class="">
</div>
<div style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
<br style="" class="">
</div>
<div id="yui_3_13_0_1_1399065114564_2924" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
[root@RAID openmpi-1.6.5]# pstack 22167<br style="" class="">
#0&nbsp; 0x00000030302e8ee3 in __epoll_wait_nocancel () from /lib64/libc.so.6<br style="" class="">
#1&nbsp; 0x00007f7ee46885eb in epoll_dispatch () from /usr/local/lib/libmpi.so.1<br style="" class="">
#2&nbsp; 0x00007f7ee468a75a in opal_event_base_loop () from /usr/local/lib/libmpi.so.1<br style="" class="">
#3&nbsp; 0x00007f7ee46af229 in opal_progress () from /usr/local/lib/libmpi.so.1<br style="" class="">
#4&nbsp; 0x00007f7ee45fcf75 in ompi_request_default_wait_all () from /usr/local/lib/libmpi.so.1<br style="" class="">
#5&nbsp; 0x00007f7ee060b65e in ompi_coll_tuned_sendrecv_actual () from /usr/local/lib/openmpi/mca_coll_tuned.so<br style="" class="">
#6&nbsp; 0x00007f7ee06138ff in ompi_coll_tuned_barrier_intra_two_procs () from /usr/local/lib/openmpi/mca_coll_tuned.so<br style="" class="">
#7&nbsp; 0x00007f7ee460a1c2 in PMPI_Barrier () from /usr/local/lib/libmpi.so.1<br style="" class="">
#8&nbsp; 0x0000000000400a43 in main ()<br>
<br>
</div>
<div id="yui_3_13_0_1_1399065114564_2924" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
&nbsp;Which looks exactly the same on each machine.&nbsp; Any thoughts or ideas would be greatly appreciated as
<br>
I am stuck.<br style="" class="">
</div>
<div style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
<br style="" class="">
</div>
<div style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
&nbsp;Clay Kirkland<br style="" class="">
</div>
<div style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
<br style="" class="">
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="yui_3_13_0_1_1399065114564_2745" class="" tabindex="0">
<div class="">
<table style="margin:0px;width:100%;border-spacing:0px;border-collapse:collapse" border="0">
<tbody>
<tr>
<td><br>
</td>
</tr>
<tr>
<td><br>
</td>
</tr>
<tr>
<td style="padding-bottom:5">
<div class="">
<div class=""></div>
<div class=""></div>
</div>
<br>
</td>
</tr>
<tr>
<td class="">
<div class="">
<div class="">
<div class="">
<div>
<form method="post" enctype="multipart/form-data" class="" target="" action=""><span class="" title="Attach File"></span></form>
</div>
</div>
<div class="">
<div class=""><span id="btn-fontnamesize" class="" title="Font"></span><span class="" title="Bold"></span><span class="" title="Italic"></span><span id="btn-forecolor" class="" title="Text Color"></span><span id="btn-insertunordered" class=""></span><span id="btn-indent" class=""></span><span id="btn-text-align" class=""></span><span class="" title="Insert Link"></span><span id="emoticon" class="" title="Emoticons"></span><span class=""></span><span id="btn-spellchk" class="" title="Check Spelling"></span><span id="btn-spell-langs" title="Language Options" class=""></span><span id="switchtext-rich" class="" title="Switch to Plain Text" target="rich-text"></span></div>
</div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
