<div class="gmail_quote">On Fri, Oct 15, 2010 at 00:38, Jeff Squyres (jsquyres) <span dir="ltr">&lt;<a href="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex;">
<div bgcolor="#FFFFFF"><div>Huh. Can you make V=1 to build libmpi and use the same kind of options to build your sample library?<br></div></div></blockquote><div><br></div><div>Make log here</div><div><br></div><div><a href="http://59A2.org/files/openmpi-1.5-clang-make.log">http://59A2.org/files/openmpi-1.5-clang-make.log</a></div>
<div><br></div><div>After some digging, this looks like a clang bug.  First, from the comments on</div><div><br></div><div><a href="http://llvm.org/bugs/show_bug.cgi?id=3679">http://llvm.org/bugs/show_bug.cgi?id=3679</a></div>
<div><br></div><div>there seems to be some resistance to the #pragma weak g2 = g3, but since these things work with clang-2.8, that isn&#39;t the whole story.  Indeed,</div><div><br></div><div>#pragma GCC visibility push(default)</div>
<div>#pragma weak fake = real</div><div>#pragma GCC visibility pop</div><div><br></div><div>does not expose the symbol &quot;fake&quot;.  This must be a bug, but an arguably better way to set up the aliasing is</div><div>
<br></div><div>int fake(int i) __attribute__((weak, alias(&quot;real&quot;)));</div><div><br></div><div>which does work.  I&#39;ll report the bug, but maybe Open MPI could use a more complete test for visibility working with weak aliasing?  Or just don&#39;t support clang-2.8.</div>
<div><br></div><div>Jed</div></div>

