William,<div><br></div><div>can you run</div><div>ldd /usr/lib64/libpmi.so.0.0.0</div><div>ldd /usr/lib64/libpmi2.so.0.0.0</div><div>ldd <span style="font-family:Menlo;font-size:11px">/share/sw/free/openmpi/1.6.5/</span><span style="font-family:Menlo;font-size:11px">intel/13sp1up1/lib/openmpi/</span><span style="font-family:Menlo;font-size:11px">mca_ess_pmi.so</span></div><div><font face="Menlo"><span style="font-size:11px"><br></span></font></div><div><font face="Menlo"><span style="font-size:11px">Cheers,</span></font></div><div><font face="Menlo"><span style="font-size:11px"><br></span></font></div><div><font face="Menlo"><span style="font-size:11px">Gilles<br></span></font><br>On Tuesday, February 2, 2016, William Law &lt;<a href="mailto:willthelaw@gmail.com">willthelaw@gmail.com</a>&gt; wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div style="word-wrap:break-word">Hi All,<div><br></div><div>Thanks for the feedback.  I guess I&#39;m a little perplexed about how we got here; I&#39;d think if it was linking against the PMI stuff that slurm version wouldn&#39;t matter?  There aren&#39;t versioned PMI libraries:</div><div><div style="margin:0px;font-size:11px;line-height:normal;font-family:Menlo">/usr/lib64/libpmi.so</div><div style="margin:0px;font-size:11px;line-height:normal;font-family:Menlo">/usr/lib64/libpmi.so.0</div><div style="margin:0px;font-size:11px;line-height:normal;font-family:Menlo">/usr/lib64/libpmi.so.0.0.0 (real file)</div><div style="margin:0px;font-size:11px;line-height:normal;font-family:Menlo">/usr/lib64/libpmi2.so</div><div style="margin:0px;font-size:11px;line-height:normal;font-family:Menlo">/usr/lib64/libpmi2.so.0</div><div style="margin:0px;font-size:11px;line-height:normal;font-family:Menlo">/usr/lib64/libpmi2.so.0.0.0 (real file)</div></div><div><br></div><div>FWIW slurm has:</div><div><div style="margin:0px;font-size:11px;line-height:normal;font-family:Menlo">/usr/lib64/libslurm.so</div><div style="margin:0px;font-size:11px;line-height:normal;font-family:Menlo">/usr/lib64/libslurm.so.29 (real file)</div></div><div><br></div><div>Any easy temporary fix is just to make a symlink from libslurm.so.29 to libslurm.so.28; things just work.  Not really a long term strategy but gets folks running again.</div><div><br></div><div>Sounds like I should follow up with the slurm list.</div><div><br></div><div>Regards,</div><div><br></div><div>Will</div><div><br><div><blockquote type="cite"><div>On Jan 29, 2016, at 3:59 AM, Gilles Gouaillardet &lt;<a href="javascript:_e(%7B%7D,&#39;cvml&#39;,&#39;gilles.gouaillardet@gmail.com&#39;);" target="_blank">gilles.gouaillardet@gmail.com</a>&gt; wrote:</div><br><div>on second thought, is there any chance your sysadmin removed the old libslurm.so.x but kept the old libpmix.so.y ?<div>in this case, the real issue would be hidden </div><div>your sysadmin &quot;broke&quot; the old libpmi, but you want to use the new one indeed.</div><div><br></div><div>Cheers,</div><div><br></div><div>Gilles<br><br>On Friday, January 29, 2016, Gilles Gouaillardet &lt;<a href="javascript:_e(%7B%7D,&#39;cvml&#39;,&#39;gilles.gouaillardet@gmail.com&#39;);" target="_blank">gilles.gouaillardet@gmail.com</a>&gt; wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">Is openmpi linked with a static libpmi.a that requires a dynamic libslurm ?<div>that can be checked with ldd mca_ess_pmi.so</div><div><br></div><div>btw, do slurm folks increase the libpmi.so version each time slurm is upgraded ?</div><div>that could be a part of the issue ...</div><div>but if they increase lib version because of abi changes, it might be a bad idea to open libxxx.so instead of libxxx.so.y</div><div>generally speaking, libxxx.so.y is provided by libxxx package, and libxxx.so is provided by libxxx-devel package, which means it might not be available on compute nodes.</div><div>we could also dlopen libxxx instead of linking with it, and have the sysadmin configure openmpi so it finds the right lib (this approach is used by a prominent vendor, and has other pros but also cons)</div><div><br></div><div>Cheers,</div><div><br></div><div>Gilles<br><br>On Friday, January 29, 2016, Ralph Castain &lt;<a>rhc@open-mpi.org</a>&gt; wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div style="word-wrap:break-word">It makes sense - but isn’t it slurm that is linking libpmi against libslurm? I don’t think we are making that connection, so it would be a slurm issue to change it.<div><br></div><div><br><div><blockquote type="cite"><div>On Jan 28, 2016, at 10:12 PM, William Law &lt;<a>willthelaw@gmail.com</a>&gt; wrote:</div><br><div><div style="word-wrap:break-word">Hi,<div><br></div><div>Our group can&#39;t find anyway to do this and it&#39;d be helpful.</div><div><br></div><div>We use slurm and keep upgrading the slurm environment.  OpenMPI bombs out against PMI each time the libslurm stuff changes, which seems to be fairly regularly.  Is there a way to compile against slurm but insulate ourselves from the libslurm chaos?  Obvious will ask the slurm folks too.</div><div><br></div><div><div style="margin:0px;font-size:11px;line-height:normal;font-family:Menlo">[<span style="color:rgb(52,189,38)"><b>wlaw</b></span>@some-node /scratch/users/wlaw/imb/src]$ mpirun -n 2 --mca grpcomm ^pmi ./IMB-MPI1 </div><div style="margin:0px;font-size:11px;line-height:normal;font-family:Menlo">[some-node.local:42584] mca: base: component_find: unable to open /share/sw/free/openmpi/1.6.5/intel/13sp1up1/lib/openmpi/mca_ess_pmi: libslurm.so.28: cannot open shared object file: No such file or directory (ignored)</div><div style="margin:0px;font-size:11px;line-height:normal;font-family:Menlo">[some-node.local:42585] mca: base: component_find: unable to open /share/sw/free/openmpi/1.6.5/intel/13sp1up1/lib/openmpi/mca_pubsub_pmi: libslurm.so.28: cannot open shared object file: No such file or directory (ignored)</div><div style="margin:0px;font-size:11px;line-height:normal;font-family:Menlo">[some-node.local:42586] mca: base: component_find: unable to open /share/sw/free/openmpi/1.6.5/intel/13sp1up1/lib/openmpi/mca_pubsub_pmi: libslurm.so.28: cannot open shared object file: No such file or directory (ignored)</div></div><div><br></div><div>(sent it via the wrong email so it bounced..... heh)</div><div><br></div><div>Upon further investigation it seems like the most appropriate thing would be to point it at compile time to libslurm.so instead of libslurm.so.xx; does that make sense?</div><div><br></div><div>Thanks,</div><div><br></div><div>Will</div></div>_______________________________________________<br>users mailing list<br><a>users@open-mpi.org</a><br>Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2016/01/28408.php" target="_blank">http://www.open-mpi.org/community/lists/users/2016/01/28408.php</a></div></blockquote></div><br></div></div></blockquote></div>
</blockquote></div>
_______________________________________________<br>users mailing list<br><a href="javascript:_e(%7B%7D,&#39;cvml&#39;,&#39;users@open-mpi.org&#39;);" target="_blank">users@open-mpi.org</a><br>Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2016/01/28415.php" target="_blank">http://www.open-mpi.org/community/lists/users/2016/01/28415.php</a></div></blockquote></div><br></div></div></blockquote></div>

