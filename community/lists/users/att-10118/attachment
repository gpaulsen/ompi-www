<html><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div>Hi George</div><div><br></div><div>Thanks for the input. This might be an OS specific problem: I'm running Mac OS X 10.5.7, and this problem appears in openmpi versions 1.3.2, 1.3.3 and&nbsp;1.4a1r21734, using Intel Ifort Compiler 11.0 and 11.1 (and also g95 + 1.3.2). I haven't tried older versions. Also, I'm running on a single machine:</div><div><br></div><div>zamb$ mpif90 inplace_test.f90</div><div>zamb$&nbsp;mpirun -np 2 ./a.out</div><div><div>&nbsp;Result:</div><div>&nbsp;&nbsp; 2.000000 &nbsp; &nbsp; &nbsp; 2.000000 &nbsp; &nbsp; &nbsp; 2.000000 &nbsp; &nbsp; &nbsp; 2.000000 &nbsp; &nbsp;</div></div><div><br></div><div>I've tryed the same code under Linux (openmpi-1.3.3 + gfortran) and it works (and also other platforms / MPIs ).</div><div><br></div><div>Can you think of some --mca options I should try? (or any other ideas...)</div><div><br></div>Cheers,<div>Ricardo</div><div><div apple-content-edited="true"> <span class="Apple-style-span" style="font-size: 12px; "><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">---<span class="Apple-converted-space">&nbsp;</span></font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">Prof. Ricardo Fonseca</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; min-height: 14px; "><br></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">GoLP - Grupo de Lasers e Plasmas</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Instituto de Plasmas e Fusão Nuclear</p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">Instituto Superior Técnico</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">Av. Rovisco Pais</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">1049-001 Lisboa</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">Portugal</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; min-height: 14px; "><br></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">tel: +351 21 8419202</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">fax: +351 21 8464455</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">web: <a href="http://cfp.ist.utl.pt/golp/">http://cfp.ist.utl.pt/golp/</a><span class="Apple-converted-space">&nbsp;</span></font></p></div></div></span> </div><br><div><div>On Jul 28, 2009, at 4:24 , <a href="mailto:users-request@open-mpi.org">users-request@open-mpi.org</a> wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><span class="Apple-style-span" style="border-collapse: separate; color: rgb(0, 0, 0); font-family: Helvetica; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; ">Message: 4<br>Date: Mon, 27 Jul 2009 17:13:23 -0400<br>From: George Bosilca &lt;<a href="mailto:bosilca@eecs.utk.edu">bosilca@eecs.utk.edu</a>&gt;<br>Subject: Re: [OMPI users] MPI_IN_PLACE in Fortran with MPI_REDUCE /<br><span class="Apple-tab-span" style="white-space: pre; ">	</span>MPI_ALLREDUCE<br>To: Open MPI Users &lt;<a href="mailto:users@open-mpi.org">users@open-mpi.org</a>&gt;<br>Message-ID: &lt;<a href="mailto:966A51C3-A15F-425B-A6B0-81221033CCF1@eecs.utk.edu">966A51C3-A15F-425B-A6B0-81221033CCF1@eecs.utk.edu</a>&gt;<br>Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes<br><br>Ricardo,<br><br>I can't reproduce your problem with the latest version (trunk r21734). &nbsp;<br>If I run the provided program on two nodes I get the following answer.<br>[***]$ mpif77 inplace.f -o inplace -g<br>[***]$ mpirun -bynode -np 2 ./inplace<br>&nbsp;Result:<br>&nbsp;&nbsp;&nbsp;3.0000000 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.0000000 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.0000000 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.0000000<br><br>This seems correct and in sync with the C answer.<br><br>&nbsp;&nbsp;george.<br><br><br>On Jul 27, 2009, at 09:42 , Ricardo Fonseca wrote:<br><br><blockquote type="cite">program inplace<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">&nbsp;use mpi<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">&nbsp;implicit none<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">&nbsp;integer :: ierr, rank, rsize, bsize<br></blockquote><blockquote type="cite">&nbsp;real, dimension( 2, 2 ) :: buffer, out<br></blockquote><blockquote type="cite">&nbsp;integer :: rc<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">&nbsp;call MPI_INIT(ierr)<br></blockquote><blockquote type="cite">&nbsp;call MPI_COMM_RANK(MPI_COMM_WORLD, rank, ierr)<br></blockquote><blockquote type="cite">&nbsp;call MPI_COMM_SIZE(MPI_COMM_WORLD, rsize, ierr)<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">&nbsp;buffer = rank + 1<br></blockquote><blockquote type="cite">&nbsp;bsize = size(buffer,1) * size(buffer,2)<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">&nbsp;if ( rank == 0 ) then<br></blockquote><blockquote type="cite">&nbsp;&nbsp;&nbsp;call mpi_reduce( MPI_IN_PLACE, buffer, bsize, MPI_REAL, MPI_SUM, &nbsp;<br></blockquote><blockquote type="cite">0, MPI_COMM_WORLD, ierr )<br></blockquote><blockquote type="cite">&nbsp;else<br></blockquote><blockquote type="cite">&nbsp;&nbsp;&nbsp;call mpi_reduce( buffer, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bsize, MPI_REAL, MPI_SUM, &nbsp;<br></blockquote><blockquote type="cite">0, MPI_COMM_WORLD, ierr )<br></blockquote><blockquote type="cite">&nbsp;endif<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">&nbsp;! use allreduce instead<br></blockquote><blockquote type="cite">&nbsp;! call mpi_allreduce( MPI_IN_PLACE, buffer, bsize, MPI_REAL, &nbsp;<br></blockquote><blockquote type="cite">MPI_SUM, MPI_COMM_WORLD, ierr )<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">&nbsp;if ( rank == 0 ) then<br></blockquote><blockquote type="cite">&nbsp;&nbsp;&nbsp;print *, 'Result:'<br></blockquote><blockquote type="cite">&nbsp;&nbsp;&nbsp;print *, buffer<br></blockquote><blockquote type="cite">&nbsp;endif<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">&nbsp;rc = 0<br></blockquote><blockquote type="cite">&nbsp;call mpi_finalize( rc )<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">end program<br></blockquote><blockquote type="cite"><br></blockquote></span><br class="Apple-interchange-newline"></blockquote></div><br></div></body></html>
