<html><head><meta http-equiv="Content-Type" content="text/html charset=windows-1252"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">Diego,<div><br></div><div>I strongly suggest a careful reading of the Datatype chapter in the MPI 3.0 standard. More precisely, the example 4.18 might be of particular interest in your case, as it explains everything that you need to do in order to obtain a portable datatype, one that works in all cases independent on the compiler or the options passed to it.</div><div><br></div><div>There are few issues with the approach you propose.</div><div><div><br></div><div>1. I’m not a Fortran expert but I think that real is not MPI_DOUBLE_RECISION but MPI_FLOAT.</div><div><br></div><div>2. The displacements are relative to the benign of your particle type. Thus the first one is not 0 but the displacement of “integer :: ip” due to the fact that the compiler is allowed to introduce gaps in order to better align.</div><div><blockquote type="cite"><div dir="ltr"><div style="font-family: arial, sans-serif; font-size: 12.7272720336914px;"><div><i>&nbsp; DISPLACEMENTS(1)=MPI_GET_ADDRESS(dummy%ip)</i></div><div><i>&nbsp; DISPLACEMENTS(2)=</i><i style="font-size: 12.7272720336914px;">MPI_GET_ADDRESS(dummy%RP[1])</i></div></div></div></blockquote><blockquote type="cite"><div dir="ltr"><div style="font-family: arial, sans-serif; font-size: 12.7272720336914px;"><i>&nbsp; DISPLACEMENTS(3)=</i><i style="font-size: 12.7272720336914px;">MPI_GET_ADDRESS(dummy%QQ[1])</i></div></div></blockquote>and then remove the MPI_GET_ADDRESS(dummy) from all of them.</div><div><br></div><div>3. After creating the structure type you need to resize it in order to correctly determine the span of the entire structure, and how an array of such structures lays in memory. Something like:</div><div>MPI_TYPE_CREATE_RESIZED(old type, DISPLACEMENT(1),</div><div>&nbsp; &nbsp;MPI_GET_ADDRESS(dummy[2]) - MPI_GET_ADDRESS(dummy[1]), newt)</div><div><div dir="ltr"><div style="font-family: arial, sans-serif; font-size: 12.7272720336914px;"><i><br></i></div><div style="font-size: 12.7272720336914px;"><i>George.</i></div><div style="font-family: arial, sans-serif; font-size: 12.7272720336914px;"><i><br></i></div></div></div><div><div>On Oct 3, 2014, at 12:57 , Diego Avesani &lt;<a href="mailto:diego.avesani@gmail.com">diego.avesani@gmail.com</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div dir="ltr">Dear Nick,<div>thanks a lot, again.</div><div>Now I will write the shift part and the send and the send and receive part.</div><div>I'll let you know</div><div><br></div><div>Thanks, thanks again</div><div><br></div></div><div class="gmail_extra"><br clear="all"><div>Diego<br><br></div>
<br><div class="gmail_quote">On 3 October 2014 18:49, Nick Papior Andersen <span dir="ltr">&lt;<a href="mailto:nickpapior@gmail.com" target="_blank">nickpapior@gmail.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">It is attached in the previous mail.<br></div><div class="gmail_extra"><br><div class="gmail_quote"><div><div class="h5">2014-10-03 16:47 GMT+00:00 Diego Avesani <span dir="ltr">&lt;<a href="mailto:diego.avesani@gmail.com" target="_blank">diego.avesani@gmail.com</a>&gt;</span>:<br></div></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div class="h5"><div dir="ltr">Dear N.,<div>thanks for the explanation.</div><div><br><div>really really sorry, but I am not able to see your example. where is it?</div><div><br></div><div>thanks again<br><div><br></div></div></div></div><div class="gmail_extra"><br clear="all"><div>Diego<br><br></div>
<br><div class="gmail_quote"><div>On 3 October 2014 18:35, Nick Papior Andersen <span dir="ltr">&lt;<a href="mailto:nickpapior@gmail.com" target="_blank">nickpapior@gmail.com</a>&gt;</span> wrote:<br></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div dir="ltr"><br><div class="gmail_extra"><br><div class="gmail_quote"><span>2014-10-03 16:27 GMT+00:00 Diego Avesani <span dir="ltr">&lt;<a href="mailto:diego.avesani@gmail.com" target="_blank">diego.avesani@gmail.com</a>&gt;</span>:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">dear N.,<div>here my results:</div><div><br></div><div><div>0.200000002980232 &nbsp; &nbsp;&nbsp;</div><div>&nbsp; 0.200000000000000 &nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;1.00000000000000 &nbsp; &nbsp;&nbsp;</div><div>&nbsp; 0.200000002980232 &nbsp; &nbsp;&nbsp;</div><div>&nbsp; 0.200000000000000 &nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;1.00000000000000 &nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;1.00000000000000 &nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;1.00000000000000</div><div><br></div><div>I suppose that in case of 0.2 we have a real that is different in double or in single precision. when I write 0.2_db I forced the program to fill with 0 the empty space in the memory.&nbsp;</div></div></div></blockquote></span><div>Correct. When doing "dp = 0.2" it casts the 0.2 to a double precision, see below.</div><span><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr"><div><br></div><div>In the second case we have and integer that the program treat as a real and as a consequence, the program fill &nbsp;automatically the empty space with 0.</div></div></blockquote></span><div>Not correct (at least not in this example), a real 1. (and whole number up to a certain integer) is perfectly represented in bytes. Hence conversion between different precisions will not loose any precision, the 0.2 case is "approximately" set to 0.2 in context of the precision. Hence conversion from 0.2 to a double precision 0.2_dp will "guess" the last digits, not exactly, but you get the point.</div><span><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr"><div><br></div><div>Am I right?</div><div>What do you suggest as next step?</div></div></blockquote></span><div>??? The example I sent you worked perfectly.&nbsp;</div><div>Good luck!</div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div dir="ltr"><div>I could create a type variable and try to send it from a processor to another with MPI_SEND and MPI_RECV?</div><div><br></div><div>Again thank&nbsp;</div></div><div class="gmail_extra"><br clear="all"><div>Diego<br><br></div>
<br><div class="gmail_quote"><div>On 3 October 2014 18:04, Nick Papior Andersen <span dir="ltr">&lt;<a href="mailto:nickpapior@gmail.com" target="_blank">nickpapior@gmail.com</a>&gt;</span> wrote:<br></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div dir="ltr"><div>Dear Diego,&nbsp;<br></div><div>Instead of instantly going about using cartesian communicators you should try and create a small test case, something like this:</div><div><br></div><div>I have successfully runned this small snippet on my machine.</div><div>As I state in the source, the culprit was the integer address size. It is inherently of type long, whereas you used integer.</div><div>Running it (with ONLY 2 processors) should print:</div><div>           1   1.0000000000000000        1.0000000000000000        11.000000000000000        11.000000000000000     <br></div><div><br></div><div>Please notice the other things I comment on, they can turn out to be important!</div><div><br></div><div>For instance, try this:</div><div><br></div><div>real(dp) :: a</div><div>a = 0.2</div><div>print *,a</div><div>a=0.2_dp</div><div>print *,a</div><div><br></div><div>Try and understand why the output is not as expected!</div><div><br></div><div>Also try and understand why this has no problems:</div><div><br></div><div><div>real(dp) :: a</div><div>a = 1.</div><div>print *,a</div><div>a=1._dp</div><div>print *,a</div><div><br></div></div><div><br></div></div><div class="gmail_extra"><br><div class="gmail_quote"><div>2014-10-03 15:41 GMT+00:00 Diego Avesani <span dir="ltr">&lt;<a href="mailto:diego.avesani@gmail.com" target="_blank">diego.avesani@gmail.com</a>&gt;</span>:<br></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div dir="ltr">Dear Nick,<div>thanks again, I am learning a lot and do not be afraid to be rude.</div><span><font color="#888888"><div><br></div><div><br></div></font></span></div><div class="gmail_extra"><span><font color="#888888"><br clear="all"><div>Diego<br><br></div></font></span><div>
<br><div class="gmail_quote">On 3 October 2014 17:38, Diego Avesani <span dir="ltr">&lt;<a href="mailto:diego.avesani@gmail.com" target="_blank">diego.avesani@gmail.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Dear Jeff, Dear Nick,<div>the question is about, inserting the FLAG for using -r8</div><div><br></div><div>Now I have written a simple code with select_kind to avoid -r8. I get the same error.</div><div>You can find the code in the attachment.</div><div><br></div><div>probably there is something wrong with ompi configuration</div><div><br></div><div>What do you think?</div><div><br></div><div>Again, thanks and thanks a lot</div><span><font color="#888888"><div><br></div><div><br></div></font></span></div><div class="gmail_extra"><span><font color="#888888"><br clear="all"><div>Diego<br><br></div></font></span><div>
<br><div class="gmail_quote">On 3 October 2014 17:18, Jeff Squyres (jsquyres) <span dir="ltr">&lt;<a href="mailto:jsquyres@cisco.com" target="_blank">jsquyres@cisco.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><span>On Oct 3, 2014, at 10:55 AM, Diego Avesani &lt;<a href="mailto:diego.avesani@gmail.com" target="_blank">diego.avesani@gmail.com</a>&gt; wrote:<br>
<br>
&gt; Dear Jeff,<br>
&gt; how can I do that?<br>
<br>
</span>Er... can you be more specific?&nbsp; I mentioned several things in my email.<br>
<br>
If you're asking about how to re-install OMPI compiled with -r8, please first read Nick's email (essentially asking "why are you using -r8, anyway?").<br>
<span><br>
--<br>
Jeff Squyres<br>
<a href="mailto:jsquyres@cisco.com" target="_blank">jsquyres@cisco.com</a><br>
For corporate legal information go to: <a href="http://www.cisco.com/web/about/doing_business/legal/cri/" target="_blank">http://www.cisco.com/web/about/doing_business/legal/cri/</a><br>
<br>
_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>
</span>Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/10/25450.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/10/25450.php</a><br>
</blockquote></div><br></div></div>
</blockquote></div><br></div></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/10/25453.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/10/25453.php</a><span><font color="#888888"><br></font></span></blockquote></div><span><font color="#888888"><br><br clear="all"><br>-- <br><div dir="ltr">Kind regards Nick</div>
</font></span></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/10/25454.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/10/25454.php</a><br></blockquote></div><br></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/10/25455.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/10/25455.php</a><span><font color="#888888"><br></font></span></blockquote></div><span><font color="#888888"><br><br clear="all"><br>-- <br><div dir="ltr">Kind regards Nick</div>
</font></span></div></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/10/25456.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/10/25456.php</a><br></blockquote></div><br></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div></div>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/10/25457.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/10/25457.php</a><span class="HOEnZb"><font color="#888888"><br></font></span></blockquote></div><span class="HOEnZb"><font color="#888888"><br><br clear="all"><br>-- <br><div dir="ltr">Kind regards Nick</div>
</font></span></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/10/25458.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/10/25458.php</a><br></blockquote></div><br></div>
_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>Subscription: http://www.open-mpi.org/mailman/listinfo.cgi/users<br>Link to this post: http://www.open-mpi.org/community/lists/users/2014/10/25459.php</blockquote></div><br></div></body></html>
