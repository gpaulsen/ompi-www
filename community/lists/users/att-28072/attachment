<div dir="ltr"><div class="gmail_extra"><div class="gmail_quote"><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex"><br>
How did you configure for Cori?  You need to be using the slurm plm component for that system.  I know this sounds like gibberish.<br>
<br></blockquote><div><br></div><div><pre style="overflow:auto;font-family:Consolas,&#39;Liberation Mono&#39;,Menlo,Courier,monospace;font-size:13.6px;margin-top:0px;margin-bottom:0px;font-stretch:normal;line-height:1.45;padding:16px;border-radius:3px;word-wrap:normal;color:rgb(51,51,51);background-color:rgb(247,247,247)">../configure --with-libfabric=<span class="">$HOME</span>/OFI/install-ofi-gcc-gni-cori \
             --enable-mca-static=mtl-ofi \
             --enable-mca-no-build=btl-openib,btl-vader,btl-ugni,btl-tcp \
             --enable-static --disable-shared --disable-dlopen \
             --prefix=<span class="">$HOME</span>/MPI/install-ompi-ofi-gcc-gni-xpmem-cori \
             --with-cray-pmi --with-alps --with-cray-xpmem --with-slurm \
             --without-verbs --without-fca --without-mxm --without-ucx \
             --without-portals4 --without-psm --without-psm2 \
             --without-udreg --without-ugni --without-munge \
             --without-sge --without-loadleveler --without-tm --without-lsf \
             --without-pvfs2 --without-plfs \
             --without-cuda --disable-oshmem \
             --disable-mpi-fortran --disable-oshmem-fortran \
             LDFLAGS=<span class="" style="color:rgb(24,54,145)"><span class="">&quot;</span>-L/opt/cray/ugni/default/lib64 -lugni <span class="">\</span></span>
<span class="" style="color:rgb(24,54,145)">                      -L/opt/cray/alps/default/lib64 -lalps -lalpslli -lalpsutil <span class="">\</span></span>
<span class="" style="color:rgb(24,54,145)">                      -ldl -lrt<span class="">&quot;</span></span></pre></div><div><br></div><div>This is copied from <a href="https://github.com/jeffhammond/HPCInfo/blob/master/ofi/README.md#open-mpi">https://github.com/jeffhammond/HPCInfo/blob/master/ofi/README.md#open-mpi</a>, which I note in case you want to see what changes I&#39;ve made at any point in the future.</div><div> </div><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex">
There should be a with-slurm configure option to pick up this component.<br>
<br></blockquote><div>Indeed there is.</div><div> </div><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex">
Doesn&#39;t mpich have the option to use sysv memory?  You may want to try that<br>
<br></blockquote><div><br></div><div>MPICH?  Look, I may have earned my way onto Santa&#39;s naughty list more than a few times, but at least I have the decency not to post MPICH questions to the Open-MPI list ;-)</div><div><br></div><div>If there is a way to tell Open-MPI to use shm_open without filesystem backing (if that is even possible) at configure time, I&#39;d love to do that.</div><div> </div><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex">
Oh for tuning params you can use env variables.  For example lets say rather than using the gni provider in ofi mtl you want to try sockets. Then do<br>
<br>
Export OMPI_MCA_mtl_ofi_provider_include=sockets<br>
<br></blockquote><div><br></div><div>Thanks.  I&#39;m glad that there is an option to set them this way.</div><div> </div><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex">
In the spirit OMPI - may the force be with you.<br>
<br></blockquote><div><br></div><div>All I will say here is that Open-MPI has a Vader BTL :-)</div><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex"><div><div class="h5"><br>
&gt; On Thu 19.11.2015 09:44:20 Jeff Hammond wrote:<br>
&gt; &gt; I have no idea what this is trying to tell me. Help?<br>
&gt; &gt;<br>
&gt; &gt; jhammond@nid00024:~/MPI/qoit/collectives&gt; mpirun -n 2 ./driver.x 64<br>
&gt; &gt; [nid00024:00482] [[46168,0],0] ORTE_ERROR_LOG: Not found in file<br>
&gt; &gt; ../../../../../orte/mca/plm/alps/plm_alps_module.c at line 418<br>
&gt; &gt;<br>
&gt; &gt; I can run the same job with srun without incident:<br>
&gt; &gt;<br>
&gt; &gt; jhammond@nid00024:~/MPI/qoit/collectives&gt; srun -n 2 ./driver.x 64<br>
&gt; &gt; MPI was initialized.<br>
&gt; &gt;<br>
&gt; &gt; This is on the NERSC Cori Cray XC40 system. I build Open-MPI git head from<br>
&gt; &gt; source for OFI libfabric.<br>
&gt; &gt;<br>
&gt; &gt; I have many other issues, which I will report later. As a spoiler, if I<br>
&gt; &gt; cannot use your mpirun, I cannot set any of the MCA options there. Is<br>
&gt; &gt; there a method to set MCA options with environment variables? I could not<br>
&gt; &gt; find this documented anywhere.<br>
&gt; &gt;<br>
&gt; &gt; In particular, is there a way to cause shm to not use the global<br>
&gt; &gt; filesystem? I see this issue comes up a lot and I read the list archives,<br>
&gt; &gt; but the warning message (<br>
&gt; &gt; <a href="https://github.com/hpc/cce-mpi-openmpi-1.6.4/blob/master/ompi/mca/common/sm/" rel="noreferrer" target="_blank">https://github.com/hpc/cce-mpi-openmpi-1.6.4/blob/master/ompi/mca/common/sm/</a><br>
&gt; &gt; help-mpi-common-sm.txt) suggested that I could override it by setting TMP,<br>
&gt; &gt; TEMP or TEMPDIR, which I did to no avail.<br>
&gt;<br>
&gt; From my experience on edison: the one environment variable that does works is TMPDIR - the one that is not listed in the error message :-)<br></div></div></blockquote><div><br></div><div>That&#39;s great.  I will try that now.  Is there a Github issue open already to fix that documentation?  If not... </div><div> </div><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex"><div><div class="h5">
&gt; Can&#39;t help you with your mpirun problem though ...<br>
</div></div><div class="h5"><br></div></blockquote></div>No worries.  I appreciate all the help I can get.</div><div class="gmail_extra"><br></div><div class="gmail_extra">Thanks,</div><div class="gmail_extra"><br></div><div class="gmail_extra">Jeff<br clear="all"><div><br></div>-- <br><div class="gmail_signature">Jeff Hammond<br><a href="mailto:jeff.science@gmail.com" target="_blank">jeff.science@gmail.com</a><br><a href="http://jeffhammond.github.io/" target="_blank">http://jeffhammond.github.io/</a></div>
</div></div>

