<html><head></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">That is bizarre. Afraid you have me stumped here - I can't think why an action in the perl script would trigger an action in OMPI. If your OMPI proc doesn't in any way read the info in "log" (using your example), does it still have a problem? In other words, if the perl script still executes a system command, but the OMPI proc doesn't interact with it in any way, does the problem persist?<div><br></div><div>What I'm searching for is the connection. If your OMPI proc reads the results of that system command, then it's possible that something in your app is corrupting memory during the read operation - e.g., you are reading in more info than you have allocated memory.<br><div><br></div><div><br><div><div>On Jan 19, 2012, at 7:33 PM, Randolph Pullen wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div><div style="color:#000; background-color:#fff; font-family:times new roman, new york, times, serif;font-size:12pt"><div><span></span></div><div>FYI</div>  <div style="font-size: 12pt; font-family: 'times new roman', 'new york', times, serif; "> <div style="font-size: 12pt; font-family: 'times new roman', 'new york', times, serif; "> <div dir="ltr"> <font size="2" face="Arial"> ----- Forwarded Message -----<br>  <b><span style="font-weight:bold;">From:</span></b> Randolph Pullen &lt;<a href="mailto:randolph_pullen@yahoo.com.au">randolph_pullen@yahoo.com.au</a>&gt;<br> <b><span style="font-weight: bold;">To:</span></b> Jeff Squyres &lt;<a href="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a>&gt; <br> <b><span style="font-weight: bold;">Sent:</span></b> Friday, 20 January 2012 12:45 PM<br> <b><span style="font-weight: bold;">Subject:</span></b> Re: [OMPI users] system() call corrupts MPI processes<br> </font> </div> <br><div id="yiv1244797842"><div><div style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); font-size:
 12pt; font-family: 'times new roman', 'new york', times, serif; "><div><span>I'm using TCP on 1.4.1 (its actually IPoIB)</span></div><div><span>OpenIB is compiled in.</span></div><div><span>Note that these nodes are containers running in OpenVZ where IB is not available. &nbsp;there may be some SDP running in system level routines on the VH but this is unlikely.</span></div><div>OpenIB is not available to the VMs. &nbsp;they happily get TCP services from the VH</div><div>In any case, the problem still occurs if I use:&nbsp;--mca btl tcp,self</div><div><br></div><div>I have traced the perl code and observed that OpenMPI gets confused whenever the perl program executes a system command itself</div><div>eg:</div><div>`command 2&gt;&amp;1 1&gt; log`;</div><div><br></div><div>This probably narrows it down (I hope)</div>  <div style="font-size: 12pt; font-family: times, serif; "> <div style="font-size: 12pt; font-family: times, serif; "> <div dir="ltr"> <font size="2" face="Arial"> <hr size="1">  <b><span style="font-weight:bold;">From:</span></b> Jeff Squyres &lt;<a href="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a>&gt;<br> <b><span style="font-weight:bold;">To:</span></b> Randolph Pullen &lt;<a href="mailto:randolph_pullen@yahoo.com.au">randolph_pullen@yahoo.com.au</a>&gt;; Open MPI Users &lt;<a href="mailto:users@open-mpi.org">users@open-mpi.org</a>&gt; <br> <b><span style="font-weight:bold;">Sent:</span></b> Friday, 20 January 2012 1:52 AM<br> <b><span style="font-weight:bold;">Subject:</span></b> Re: [OMPI users] system() call corrupts MPI processes<br> </font> </div> <br>Which network transport are you using, and what version of Open MPI are you using?&nbsp; Do you have OpenFabrics support compiled into your Open MPI installation?<br><br>If you're just using TCP and/or shared memory, I can't think of a reason immediately as to why this wouldn't work, but there may be a subtle interaction in there
 somewhere that causes badness (e.g., memory corruption).<br><br><br>On Jan 19, 2012, at 1:57 AM, Randolph Pullen wrote:<br><br>&gt; <br>&gt; I have a section in my code running in rank 0 that must start a perl program that it then connects to via a tcp socket.<br>&gt; The initialisation section is shown here:<br>&gt; <br>&gt;&nbsp; &nbsp;  sprintf(buf, "%s/session_server.pl -p %d &amp;", PATH,port);<br>&gt;&nbsp; &nbsp;  int i = system(buf);<br>&gt;&nbsp; &nbsp;  printf("system returned %d\n", i);<br>&gt; <br>&gt; <br>&gt; Some time after I run this code, while waiting for the data from the perl program, the error below occurs:<br>&gt; <br>&gt; qplan connection<br>&gt; DCsession_fetch: waiting for Mcode data...<br>&gt; [dc1:05387] [[40050,1],0] ORTE_ERROR_LOG: A message is attempting to be sent to a process whose contact information is unknown in file rml_oob_send.c at line 105<br>&gt; [dc1:05387] [[40050,1],0] could not get route to
 [[INVALID],INVALID]<br>&gt; [dc1:05387] [[40050,1],0] ORTE_ERROR_LOG: A message is attempting to be sent to a process whose contact information is unknown in file base/plm_base_proxy.c at line 86<br>&gt; <br>&gt; <br>&gt; It seems that the linux system() call is breaking OpenMPI internal connections.&nbsp; Removing the system() call and executing the perl code externaly fixes the problem but I can't go into production like that as its a security issue.<br>&gt; <br>&gt; Any ideas ?<br>&gt; <br>&gt; (environment: OpenMPI 1.4.1 on kernel Linux dc1 2.6.18-274.3.1.el5.028stab094.3&nbsp; using TCP and mpirun)<br>&gt; _______________________________________________<br>&gt; users mailing list<br>&gt; <a rel="nofollow" ymailto="mailto:users@open-mpi.org" target="_blank" href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>&gt; <a rel="nofollow" target="_blank" href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br><br><br>-- <br>Jeff
 Squyres<br><a rel="nofollow" ymailto="mailto:jsquyres@cisco.com" target="_blank" href="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a><br>For corporate legal information go to:<br><a rel="nofollow" target="_blank" href="http://www.cisco.com/web/about/doing_business/legal/cri/">http://www.cisco.com/web/about/doing_business/legal/cri/</a><br><br><br><br> </div> </div>  </div></div></div><br><br> </div> </div>  </div></div>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>http://www.open-mpi.org/mailman/listinfo.cgi/users</blockquote></div><br></div></div></body></html>
