<html><head><meta http-equiv="Content-Type" content="text/html charset=windows-1252"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">Victor,<div><br></div><div>If the MX library supports a mapper, Open MPI takes provide selective hardware activation. Look at the MCA parameters supported by the MX devices to get more info (ompi_info —mca btl mx). The one that is of interest in this particular case is mx_if_include, allowing MX based jobs to only use the Myrinet card that has a mapper matching the provided key. You should set this MCA parameter to the last 6 digits of your mapper MAC (—mca btl mx_if_include abcdef).</div><div><br></div><div>&nbsp; George.</div><div><br><div><div>On Jan 14, 2014, at 00:36 , Barrett, Brian W &lt;<a href="mailto:bwbarre@sandia.gov">bwbarre@sandia.gov</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; font-size: 14px; font-family: Calibri, sans-serif;"><div>Victor -</div><div><br></div><div>I don't think our multi-port support with MX is particularly well tested (I know I don't test that path).</div><div><br></div><div>It looks like you might be able to work around the problem by setting -mca mtl_mx_endpoint_num 1 on the mpirun command line, which will only use the first port found. &nbsp;But I could be wrong.</div><div><br></div><div>Brian</div><div><br></div><span id="OLK_SRC_BODY_SECTION"><div>On 1/9/14 5:02 PM, "Victor Prosolin" &lt;<a href="mailto:Victor.Prosolin@RWDI.com" style="color: purple; text-decoration: underline;">Victor.Prosolin@RWDI.com</a>&gt; wrote:</div><div><br></div><blockquote id="MAC_OUTLOOK_ATTRIBUTION_BLOCKQUOTE" style="border-left-color: rgb(181, 196, 223); border-left-width: 5px; border-left-style: solid; padding: 0px 0px 0px 5px; margin: 0px 0px 0px 5px;" type="cite"><div xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" xmlns="http://www.w3.org/TR/REC-html40"><div lang="EN-CA" link="blue" vlink="purple"><div class="WordSection1" style="page: WordSection1;"><div style="margin: 0cm 0cm 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif;">H,<o:p></o:p></div><div style="margin: 0cm 0cm 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif;">Our cluster has servers with either a single port or a dual port Myrinet card. In case of a dual card, only one port is connected to the Myrinet switch. The OpenMPI library is configured with “--with-mx=…” option and it works fine when I submit jobs to single port servers only. However, when I try to include a server with a dual port card, I get a bunch of errors like the following:<o:p></o:p></div><div style="margin: 0cm 0cm 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif;"><i>[compute-08:17788] mx_connect fail for unknown<span class="Apple-converted-space">&nbsp;</span><b>60dd464f9d</b><span class="Apple-converted-space">&nbsp;</span>nic_id with key aaaaffff (error Destination NIC not found in network table)<o:p></o:p></i></div><div style="margin: 0cm 0cm 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif;"><o:p>&nbsp;</o:p></div><div style="margin: 0cm 0cm 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif;"><b><i>60dd464f9d<span class="Apple-converted-space">&nbsp;</span></i></b>is the wrong MAC address corresponding to port 1 (not connected) when port 0 is connected to the switch and has MAC &nbsp;<b><i>60dd464f9c</i></b>.<o:p></o:p></div><div style="margin: 0cm 0cm 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif;"><o:p>&nbsp;</o:p></div><div style="margin: 0cm 0cm 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif;">This is how (try to) I run the job:<o:p></o:p></div><div style="margin: 0cm 0cm 0.0001pt 36pt; font-size: 11pt; font-family: Calibri, sans-serif; text-indent: -18pt;"><i><span>1.<span style="font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-family: 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span></span></i><i>mpiexec -np 32 -host compute-08,compute-17,compute-18,compute-16 -mca mtl mx --mca pml cm ./wrf.exe<o:p></o:p></i></div><div style="margin: 0cm 0cm 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif;">or<o:p></o:p></div><div style="margin: 0cm 0cm 0.0001pt 36pt; font-size: 11pt; font-family: Calibri, sans-serif; text-indent: -18pt;"><span>2.<span style="font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-family: 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span></span>Using a similar command but via Sun Grid Engine.<o:p></o:p></div><div style="margin: 0cm 0cm 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif;"><i><o:p>&nbsp;</o:p></i></div><div style="margin: 0cm 0cm 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif;">The OS is Centos 6.4, 64bit. OpenMPI 1.6.5 compiled from the official src rpm with gcc 4.4.7, MX library 1.2.16 manually compiled. Again, this configuration works fine when only single port servers are used.<o:p></o:p></div><div style="margin: 0cm 0cm 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif;"><o:p>&nbsp;</o:p></div><div style="margin: 0cm 0cm 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif;">Is there a way to tell OpenMPI to stick to the one port that is connected? I haven’t found any options through ompi_info or via google… Any help will be greatly appreciated.<o:p></o:p></div><div style="margin: 0cm 0cm 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif;"><o:p>&nbsp;</o:p></div><div style="margin: 0cm 0cm 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif;">Sincerely,<o:p></o:p></div><div style="margin: 0cm 0cm 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif;">Victor.<span><o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif;"><o:p>&nbsp;</o:p></div></div></div></div></blockquote></span><div><br></div><div><div><br></div><div><div style="font-family: Consolas; font-size: 12px;">--</div><div style="font-family: Consolas; font-size: 12px;">&nbsp;&nbsp;Brian W. Barrett</div><div style="font-family: Consolas; font-size: 12px;">&nbsp;&nbsp;Scalable System Software Group</div><div style="font-family: Consolas; font-size: 12px;">&nbsp;&nbsp;Sandia National Laboratories</div></div></div>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org" style="color: purple; text-decoration: underline;">users@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" style="color: purple; text-decoration: underline;">http://www.open-mpi.org/mailman/listinfo.cgi/users</a></div></blockquote></div><br></div></body></html>
