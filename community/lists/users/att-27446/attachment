<div dir="ltr"><p dir="ltr"></p>
<p>Hi Nate,</p><p>Sorry for the delay in getting back to you.<br></p><p>We&#39;re somewhat stuck on how to help you, but here are two suggestions.</p><p>Could you add the following to your launch command line</p><p>--mca odls_base_verbose 100</p><p>so we can see exactly what arguments are being feed to java when launching<br>your app.</p><p>Also, if you could put your MPITestBroke.class file somewhere (like google drive)<br>where we could get it and try to run locally or at NERSC, that might help us <br>narrow down the problem.    Better yet, if you have the class or jar file for<br>the entire app plus some data sets, we could try that out as well.<br><br>All the config outputs, etc. you&#39;ve sent so far indicate a correct installation<br>of open mpi.</p><p>Howard</p><p><br></p><p dir="ltr">On Aug 6, 2015 1:54 PM, &quot;Nate Chambers&quot; &lt;<a href="mailto:nchamber@usna.edu" target="_blank">nchamber@usna.edu</a>&gt; wrote:<br></p><div class="gmail_quote"><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Howard,<div><br></div><div>I tried the nightly build openmpi-dev-2223-g731cfe3 and it still segfaults as before. I must admit I am new to MPI, so is it possible I&#39;m just configuring or running incorrectly? Let me list my steps for you, and maybe something will jump out? Also attached is my config.log.</div><div><br></div><div><br></div><div>CONFIGURE </div><div><div>./configure --prefix=&lt;install-dir&gt; --enable-mpi-java CC=gcc</div></div><div><br></div><div>MAKE</div><div>make all install</div><div><br></div><div>RUN</div><div>&lt;install-dir&gt;/mpirun -np 1 java MPITestBroke twitter/<br></div><div><br></div><div><br></div><div>DEFAULT JAVA AND GCC</div><div><div><br></div><div>$ java -version</div><div>java version &quot;1.7.0_21&quot;</div><div>Java(TM) SE Runtime Environment (build 1.7.0_21-b11)</div><div>Java HotSpot(TM) 64-Bit Server VM (build 23.21-b01, mixed mode)</div></div><div><br></div><div><div>$ gcc --v</div><div>Using built-in specs.</div><div>Target: x86_64-redhat-linux</div><div>Configured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=<a href="http://bugzilla.redhat.com/bugzilla" target="_blank">http://bugzilla.redhat.com/bugzilla</a> --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-languages=c,c++,objc,obj-c++,java,fortran,ada --enable-java-awt=gtk --disable-dssi --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-1.5.0.0/jre --enable-libgcj-multifile --enable-java-maintainer-mode --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --disable-libjava-multilib --with-ppl --with-cloog --with-tune=generic --with-arch_32=i686 --build=x86_64-redhat-linux</div><div>Thread model: posix</div><div>gcc version 4.4.7 20120313 (Red Hat 4.4.7-4) (GCC)</div></div><div><br></div><div><br></div><div><br></div><div><br></div></div><div class="gmail_extra"><br><div class="gmail_quote">On Thu, Aug 6, 2015 at 7:58 AM, Howard Pritchard <span dir="ltr">&lt;<a href="mailto:hppritcha@gmail.com" target="_blank">hppritcha@gmail.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">HI Nate,<div><br></div><div>We&#39;re trying this out on a mac running mavericks and a cray xc system.   the mac has java 8 </div><div>while the cray xc has java 7.</div><div><br></div><div>We could not get the code to run just using the java launch command, although we noticed if you add</div><div><br></div><div>







<p>    <span>catch</span>(NoClassDefFoundError e) {</p>
<p><span>      System.out.println(</span>&quot;Not using MPI its out to lunch for now&quot;<span>);</span></p>
<p>    }</p><p>as one of the catches after the try for firing up MPI, you can get further.</p><p>Instead we tried on the two systems using</p><p>mpirun -np 1 java MPITestBroke tweets repeat.txt</p><p>and, you guessed it, we can&#39;t reproduce the error, at least using master.</p><p>Would you mind trying to get a copy of nightly master build off of</p><p><a href="http://www.open-mpi.org/nightly/master/" target="_blank">http://www.open-mpi.org/nightly/master/</a><br></p><p>and install that version and give it a try.</p><p>If that works, then I&#39;d suggest using master (or v2.0) for now. <br></p><p>Howard</p><p><br></p></div><div><br></div></div><div class="gmail_extra"><br><div class="gmail_quote"><div><div>2015-08-05 14:41 GMT-06:00 Nate Chambers <span dir="ltr">&lt;<a href="mailto:nchamber@usna.edu" target="_blank">nchamber@usna.edu</a>&gt;</span>:<br></div></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div><div dir="ltr">Howard,<div><br></div><div>Thanks for looking at all this. Adding System.gc() did not cause it to segfault. The segfault still comes much later in the processing.</div><div><br></div><div>I was able to reduce my code to a single test file without other dependencies. It is attached. This code simply opens a text file and reads its lines, one by one. Once finished, it closes and opens the same file and reads the lines again. On my system, it does this about 4 times until the segfault fires. Obviously this code makes no sense, but it&#39;s based on our actual code that reads millions of lines of data and does various processing to it.</div><div><br></div><div>Attached is a tweets.tgz file that you can uncompress to have an input directory. The text file is just the same line over and over again. Run it as:</div><div><br></div><div><b>java MPITestBroke tweets/</b></div><div><br></div><div><br></div><div>Nate</div><div><br></div><div><br></div><div><br></div><div><br></div><div class="gmail_extra"><br><div class="gmail_quote">On Wed, Aug 5, 2015 at 8:29 AM, Howard Pritchard <span dir="ltr">&lt;<a href="mailto:hppritcha@gmail.com" target="_blank">hppritcha@gmail.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Hi Nate,<div><br></div><div>Sorry for the delay in getting back.  Thanks for the sanity check.  You may have a point about the args string to MPI.init - </div><div>there&#39;s nothing the Open MPI is needing from this but that is a difference with your use case - your app has an argument.</div><div><br></div><div>Would you mind adding a </div><div><br></div><div>System.gc()</div><div><br></div><div>call immediately after MPI.init call and see if the gc blows up with a segfault?</div><div><br></div><div>Also, may be interesting to add the -verbose:jni to your command line.</div><div><br></div><div>We&#39;ll do some experiments here with the init string arg.</div><div><br></div><div>Is your app open source where we could download it and try to reproduce the problem locally?</div><div><br></div><div>thanks,</div><div><br></div><div>Howard</div><div><br></div></div><div class="gmail_extra"><br><div class="gmail_quote"><div><div>2015-08-04 18:52 GMT-06:00 Nate Chambers <span dir="ltr">&lt;<a href="mailto:nchamber@usna.edu" target="_blank">nchamber@usna.edu</a>&gt;</span>:<br></div></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div><div dir="ltr">Sanity checks pass. Both Hello and Ring.java run correctly with the expected program&#39;s output.<div><br></div><div>Does MPI.init(args) expect anything from those command-line args? </div><div><br></div><div><br></div><div>Nate</div><div><br></div></div><div class="gmail_extra"><br><div class="gmail_quote">On Tue, Aug 4, 2015 at 12:26 PM, Howard Pritchard <span dir="ltr">&lt;<a href="mailto:hppritcha@gmail.com" target="_blank">hppritcha@gmail.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Hello Nate,<div><br></div><div>As a sanity check of your installation, could you try to compile the examples/*.java codes using the mpijavac you&#39;ve installed and see that those run correctly?</div><div>I&#39;d be just interested in the Hello.java and Ring.java?</div><div><br></div><div>Howard</div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div></div><div class="gmail_extra"><br><div class="gmail_quote"><div><div>2015-08-04 14:34 GMT-06:00 Nate Chambers <span dir="ltr">&lt;<a href="mailto:nchamber@usna.edu" target="_blank">nchamber@usna.edu</a>&gt;</span>:<br></div></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div><div dir="ltr">Sure, I reran the configure with CC=gcc and then make install. I think that&#39;s the proper way to do it. Attached is my config log. The behavior when running our code appears to be the same. The output is the same error I pasted in my email above. It occurs when calling MPI.init().<div><div><br></div><div>I&#39;m not great at debugging this sort of stuff, but happy to try things out if you need me to.</div><div><br></div><div>Nate</div></div><div><br></div></div><div class="gmail_extra"><br><div class="gmail_quote">On Tue, Aug 4, 2015 at 5:09 AM, Howard Pritchard <span dir="ltr">&lt;<a href="mailto:hppritcha@gmail.com" target="_blank">hppritcha@gmail.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Hello Nate,<div><br></div><div>As a first step to addressing this, could you please try using gcc rather than the Intel compilers to build Open MPI?</div><div><br></div><div>We&#39;ve been doing a lot of work recently on the java bindings, etc. but have never tried using any compilers other</div><div>than gcc when working with the java bindings.</div><div><br></div><div>Thanks,</div><div><br></div><div>Howard</div><div><br></div></div><div class="gmail_extra"><br><div class="gmail_quote"><div><div>2015-08-03 17:36 GMT-06:00 Nate Chambers <span dir="ltr">&lt;<a href="mailto:nchamber@usna.edu" target="_blank">nchamber@usna.edu</a>&gt;</span>:<br></div></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div><div dir="ltr"><div>We&#39;ve been struggling with this error for a while, so hoping someone more knowledgeable can help!</div><div><br></div><div>Our java MPI code exits with a segfault during its normal operation, <b>but the segfault occurs before our code ever uses MPI functionality like sending/receiving. </b>We&#39;ve removed all message calls and any use of MPI.COMM_WORLD from the code. The segfault occurs if we call MPI.init(args) in our code, and does not if we comment that line out. Further vexing us, the crash doesn&#39;t happen at the point of the MPI.init call, but later on in the program. I don&#39;t have an easy-to-run example here because our non-MPI code is so large and complicated. We have run simpler test programs with MPI and the segfault does not occur.</div><div><br></div><div>We have isolated the line where the segfault occurs. However, if we comment that out, the program will run longer, but then randomly (but deterministically) segfault later on in the code. Does anyone have tips on how to debug this? We have tried several flags with mpirun, but no good clues.</div><div><br></div><div>We have also tried several MPI versions, including stable 1.8.7 and the most recent 1.8.8rc1</div><div><br></div><div><br></div><div>ATTACHED</div><div>- config.log from installation</div><div>- output from `ompi_info -all`</div><div><br></div><div><br></div><div>OUTPUT FROM RUNNING</div><div><br></div><div><div>&gt; mpirun -np 2 java -mx4g FeaturizeDay datadir/ days.txt </div><div>...<br></div><div>some normal output from our code</div><div>...</div><div>--------------------------------------------------------------------------</div><div>mpirun noticed that process rank 0 with PID 29646 on node r9n69 exited on signal 11 (Segmentation fault).</div><div>--------------------------------------------------------------------------</div></div><div><br></div><div><br></div><div><br></div></div>
<br></div></div><span>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2015/08/27386.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/users/2015/08/27386.php</a><br></span></blockquote></div><br></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2015/08/27389.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/users/2015/08/27389.php</a><br></blockquote></div><br></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div></div>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2015/08/27391.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/users/2015/08/27391.php</a><br></blockquote></div><br></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2015/08/27392.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/users/2015/08/27392.php</a><br></blockquote></div><br></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div></div>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2015/08/27393.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/users/2015/08/27393.php</a><br></blockquote></div><br></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2015/08/27396.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/users/2015/08/27396.php</a><br></blockquote></div><br></div></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div></div>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2015/08/27399.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/users/2015/08/27399.php</a><br></blockquote></div><br></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2015/08/27405.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/users/2015/08/27405.php</a><br></blockquote></div><br></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2015/08/27406.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/users/2015/08/27406.php</a><br></blockquote></div>
</div>

