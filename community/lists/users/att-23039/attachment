<html><head><meta http-equiv="Content-Type" content="text/html charset=us-ascii"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">Hmmm...well, it seems to work for me:<div><br></div><div><div style="margin: 0px; font-size: 11px; font-family: Menlo;">$ mpirun -n 4 ./thread_init</div><div style="margin: 0px; font-size: 11px; font-family: Menlo;">Calling MPI_Init_thread...</div><div style="margin: 0px; font-size: 11px; font-family: Menlo;">Calling MPI_Init_thread...</div><div style="margin: 0px; font-size: 11px; font-family: Menlo;">Calling MPI_Init_thread...</div><div style="margin: 0px; font-size: 11px; font-family: Menlo;">Calling MPI_Init_thread...</div><div style="margin: 0px; font-size: 11px; font-family: Menlo;">MPI_Init_thread returned, provided = 3</div><div style="margin: 0px; font-size: 11px; font-family: Menlo;">MPI_Init_thread returned, provided = 3</div><div style="margin: 0px; font-size: 11px; font-family: Menlo;">MPI_Init_thread returned, provided = 3</div><div style="margin: 0px; font-size: 11px; font-family: Menlo;">MPI_Init_thread returned, provided = 3</div><div style="margin: 0px; font-size: 11px; font-family: Menlo;">$</div><div style="margin: 0px; font-size: 11px; font-family: Menlo;"><br></div><div style="margin: 0px; font-size: 11px; font-family: Menlo;">This is with the current 1.7 code branch, so it's possible something has been updated. You might try it with the next nightly tarball and see if it helps.</div><div style="margin: 0px; font-size: 11px; font-family: Menlo;"><br></div><div style="margin: 0px; font-size: 11px; font-family: Menlo;">BTW: The correct configure option is --enable-mpi-thread-multiple</div><div style="margin: 0px; font-size: 11px; font-family: Menlo;"><br></div><div style="margin: 0px; font-size: 11px; font-family: Menlo;">My test program:</div><div style="margin: 0px; font-size: 11px; font-family: Menlo;"><br></div><div style="margin: 0px; font-size: 11px; font-family: Menlo;"><div style="margin: 0px;">#include &lt;mpi.h&gt;</div><div style="margin: 0px;">#include &lt;stdio.h&gt;</div><div style="margin: 0px;">int main(int argc, const char* argv[]) {</div><div style="margin: 0px;">&nbsp;int provided = -1;</div><div style="margin: 0px;">&nbsp;printf("Calling MPI_Init_thread...\n");</div><div style="margin: 0px;">&nbsp;MPI_Init_thread(NULL, NULL, MPI_THREAD_MULTIPLE, &amp;provided);</div><div style="margin: 0px;">&nbsp;printf("MPI_Init_thread returned, provided = %d\n", provided);</div><div style="margin: 0px;">&nbsp;MPI_Finalize();</div><div style="margin: 0px;">&nbsp;return 0;</div><div style="margin: 0px;">}</div><div><br></div><div><br></div></div><div><div>On Nov 21, 2013, at 1:36 PM, Dominique Orban &lt;<a href="mailto:dominique.orban@gmail.com">dominique.orban@gmail.com</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite">Hi,<br><br>I'm compiling the example code at the bottom of the following page that illustrates MPI_Init_Thread(): <br><br><span class="Apple-tab-span" style="white-space:pre">	</span><a href="http://mpi.deino.net/mpi_functions/mpi_init_thread.html">http://mpi.deino.net/mpi_functions/mpi_init_thread.html</a><br><br>I have OpenMPI 1.7.3 installed on OSX 10.8.5 with --enable-thread-multiple compiled with clang-425.0.28. I can reproduce the following on OSX 10.9 (clang-500) and another user was able to reproduce it on some flavor of Linux:<br><br><span class="Apple-tab-span" style="white-space:pre">	</span>$ mpicc -g -o testmpi testmpi.c -lmpi<br><span class="Apple-tab-span" style="white-space:pre">	</span>$ mpirun -n 2 ./testmpi<br><span class="Apple-tab-span" style="white-space:pre">	</span>$ # hangs forever<br><br>I've no knowledge of how to debug MPI programs but it was suggested to me to do this:<br><br><span class="Apple-tab-span" style="white-space:pre">	</span>$ mpirun -n 2 xterm -e gdb ./testmpi<br><br>In the first xterm, I say 'run' in gdb, interrupt the program after a while and get a backtrace:<br><br><span class="Apple-tab-span" style="white-space:pre">	</span>^C<br><span class="Apple-tab-span" style="white-space:pre">	</span>Program received signal SIGINT, Interrupt.<br><span class="Apple-tab-span" style="white-space:pre">	</span>0x00007fff99116322 in select$DARWIN_EXTSN ()<br><span class="Apple-tab-span" style="white-space:pre">	</span> &nbsp;&nbsp;from /usr/lib/system/libsystem_kernel.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>(gdb) where<br><span class="Apple-tab-span" style="white-space:pre">	</span>#0 &nbsp;0x00007fff99116322 in select$DARWIN_EXTSN ()<br><span class="Apple-tab-span" style="white-space:pre">	</span> &nbsp;&nbsp;from /usr/lib/system/libsystem_kernel.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>#1 &nbsp;0x00000001001963c2 in select_dispatch ()<br><span class="Apple-tab-span" style="white-space:pre">	</span> &nbsp;&nbsp;from /usr/local/Cellar/open-mpi/1.7.3/lib/libopen-pal.6.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>#2 &nbsp;0x000000010018f178 in opal_libevent2021_event_base_loop ()<br><span class="Apple-tab-span" style="white-space:pre">	</span> &nbsp;&nbsp;from /usr/local/Cellar/open-mpi/1.7.3/lib/libopen-pal.6.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>#3 &nbsp;0x000000010015f059 in opal_progress ()<br><span class="Apple-tab-span" style="white-space:pre">	</span> &nbsp;&nbsp;from /usr/local/Cellar/open-mpi/1.7.3/lib/libopen-pal.6.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>#4 &nbsp;0x0000000100019321 in ompi_mpi_init () from /usr/local/lib/libmpi.1.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>#5 &nbsp;0x00000001000334da in MPI_Init_thread () from /usr/local/lib/libmpi.1.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>#6 &nbsp;0x0000000100000ddb in main (argc=1, argv=0x7fff5fbfedc0) at testmpi.c:9<br><span class="Apple-tab-span" style="white-space:pre">	</span>(gdb) backtrace<br><span class="Apple-tab-span" style="white-space:pre">	</span>#0 &nbsp;0x00007fff99116322 in select$DARWIN_EXTSN ()<br><span class="Apple-tab-span" style="white-space:pre">	</span> &nbsp;&nbsp;from /usr/lib/system/libsystem_kernel.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>#1 &nbsp;0x00000001001963c2 in select_dispatch ()<br><span class="Apple-tab-span" style="white-space:pre">	</span> &nbsp;&nbsp;from /usr/local/Cellar/open-mpi/1.7.3/lib/libopen-pal.6.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>#2 &nbsp;0x000000010018f178 in opal_libevent2021_event_base_loop ()<br><span class="Apple-tab-span" style="white-space:pre">	</span> &nbsp;&nbsp;from /usr/local/Cellar/open-mpi/1.7.3/lib/libopen-pal.6.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>#3 &nbsp;0x000000010015f059 in opal_progress ()<br><span class="Apple-tab-span" style="white-space:pre">	</span> &nbsp;&nbsp;from /usr/local/Cellar/open-mpi/1.7.3/lib/libopen-pal.6.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>#4 &nbsp;0x0000000100019321 in ompi_mpi_init () from /usr/local/lib/libmpi.1.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>#5 &nbsp;0x00000001000334da in MPI_Init_thread () from /usr/local/lib/libmpi.1.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>#6 &nbsp;0x0000000100000ddb in main (argc=1, argv=0x7fff5fbfedc0) at testmpi.c:9<br><span class="Apple-tab-span" style="white-space:pre">	</span>(gdb)<br><br>In the second xterm window:<br><br><span class="Apple-tab-span" style="white-space:pre">	</span>^C<br><span class="Apple-tab-span" style="white-space:pre">	</span>Program received signal SIGINT, Interrupt.<br><span class="Apple-tab-span" style="white-space:pre">	</span>0x00000001002e9a28 in mca_common_sm_init ()<br><span class="Apple-tab-span" style="white-space:pre">	</span> &nbsp;&nbsp;from /usr/local/Cellar/open-mpi/1.7.3/lib/libmca_common_sm.4.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>(gdb) where<br><span class="Apple-tab-span" style="white-space:pre">	</span>#0 &nbsp;0x00000001002e9a28 in mca_common_sm_init ()<br><span class="Apple-tab-span" style="white-space:pre">	</span> &nbsp;&nbsp;from /usr/local/Cellar/open-mpi/1.7.3/lib/libmca_common_sm.4.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>#1 &nbsp;0x00000001002e5a38 in mca_mpool_sm_init ()<br><span class="Apple-tab-span" style="white-space:pre">	</span> &nbsp;&nbsp;from /usr/local/Cellar/open-mpi/1.7.3/lib/openmpi/mca_mpool_sm.so<br><span class="Apple-tab-span" style="white-space:pre">	</span>#2 &nbsp;0x00000001000793fa in mca_mpool_base_module_create ()<br><span class="Apple-tab-span" style="white-space:pre">	</span> &nbsp;&nbsp;from /usr/local/lib/libmpi.1.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>#3 &nbsp;0x000000010053fb41 in mca_btl_sm_add_procs ()<br><span class="Apple-tab-span" style="white-space:pre">	</span> &nbsp;&nbsp;from /usr/local/Cellar/open-mpi/1.7.3/lib/openmpi/mca_btl_sm.so<br><span class="Apple-tab-span" style="white-space:pre">	</span>#4 &nbsp;0x0000000100535dfb in mca_bml_r2_add_procs ()<br><span class="Apple-tab-span" style="white-space:pre">	</span> &nbsp;&nbsp;from /usr/local/Cellar/open-mpi/1.7.3/lib/openmpi/mca_bml_r2.so<br><span class="Apple-tab-span" style="white-space:pre">	</span>#5 &nbsp;0x000000010051e59c in mca_pml_ob1_add_procs ()<br><span class="Apple-tab-span" style="white-space:pre">	</span> &nbsp;&nbsp;from /usr/local/Cellar/open-mpi/1.7.3/lib/openmpi/mca_pml_ob1.so<br><span class="Apple-tab-span" style="white-space:pre">	</span>#6 &nbsp;0x000000010001959b in ompi_mpi_init () from /usr/local/lib/libmpi.1.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>#7 &nbsp;0x00000001000334da in MPI_Init_thread () from /usr/local/lib/libmpi.1.dylib<br><span class="Apple-tab-span" style="white-space:pre">	</span>#8 &nbsp;0x0000000100000ddb in main (argc=1, argv=0x7fff5fbfedc0) at testmpi.c:9<br><span class="Apple-tab-span" style="white-space:pre">	</span>(gdb) <br><br><br>The output of `ompi_info --parsable` is here: https://gist.github.com/7590040<br><br>Thanks in advance.<br><br>Dominique<br><br><br><br>_______________________________________________<br>users mailing list<br>users@open-mpi.org<br>http://www.open-mpi.org/mailman/listinfo.cgi/users<br></blockquote></div><br></div></body></html>
