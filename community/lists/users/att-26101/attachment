<div dir="ltr">Dear Gilles, Dear all,<div><br></div><div>It works. The only thing that is missed is:</div><div><br></div><div><i>CALL MPI_Finalize(MPI%iErr)</i><br></div><div><br></div><div>at the end of the program.</div><div><br></div><div>Now, I have to test it sending some data from a processor to another.</div><div>I would like to ask you if you could explain me what you have done.<br></div><div>I wrote in the program:</div><div><i><br></i></div><div><div><i>   IF(MPI%myrank==1)THEN</i></div><div><i>      WRITE(*,*) DISPLACEMENTS</i></div><div><i>   ENDIF</i></div></div><div><br></div><div>and the results is:</div><div><br></div><div><div>       <i>139835891001320      -139835852218120      -139835852213832</i></div><div><i>      -139835852195016   8030673735967299609</i></div></div><div><br></div><div>I am not able to understand it.</div><div><br></div><div>Thanks a lot.</div><div><br></div><div>In the attachment you can find the program</div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div></div><div class="gmail_extra"><br clear="all"><div><div class="gmail_signature">Diego<br><br></div></div>
<br><div class="gmail_quote">On 4 January 2015 at 12:10, Gilles Gouaillardet <span dir="ltr">&lt;<a href="mailto:gilles.gouaillardet@gmail.com" target="_blank">gilles.gouaillardet@gmail.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Diego,<div><br></div><div>here is an updated revision i will double check tomorrow</div><div>/* i dit not test it yet, so forgive me it it does not compile/work */</div><div><br></div><div>Cheers,</div><div><br></div><div>Gilles</div></div><div class="gmail_extra"><br><div class="gmail_quote"><div><div class="h5">On Sun, Jan 4, 2015 at 6:48 PM, Diego Avesani <span dir="ltr">&lt;<a href="mailto:diego.avesani@gmail.com" target="_blank">diego.avesani@gmail.com</a>&gt;</span> wrote:<br></div></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div class="h5"><div dir="ltr">Dear Gilles, Dear all,<div><br><div>in the attachment you can find the program.</div><div><br></div><div>What do you meam &quot;<span style="font-size:12.7272720336914px">remove mpi_get_address(dummy) from all displacements</span>&quot;.</div><div><br></div><div>Thanks for all your help</div><div><br></div><div>Diego</div><div><br></div><div><br></div></div></div><div class="gmail_extra"><br clear="all"><div><div>Diego<br><br></div></div>
<br><div class="gmail_quote"><div><div>On 3 January 2015 at 00:45, Gilles Gouaillardet <span dir="ltr">&lt;<a href="mailto:gilles.gouaillardet@gmail.com" target="_blank">gilles.gouaillardet@gmail.com</a>&gt;</span> wrote:<br></div></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div>Diego,<br><br>George gave you the solution,<br><br>The snippet you posted has two mistakes<br>You did not remove mpi_get_address(dummy) from all displacements<br>(See my previous reply)<br>You pass incorrect values to mpi_type_create_resized<br><br>Can you post a trimmed version of your program instead of a snippet ?<br><br>Gus is right about using double precision vs real and -r8<br><br>Cheers,<br><br>Gilles<br><br>Diego Avesani &lt;<a href="mailto:diego.avesani@gmail.com" target="_blank">diego.avesani@gmail.com</a>&gt;さんのメール:<br><div dir="ltr">Dear Gilles Dear all,<div><br></div><div>I have done all that to avoid to pedding an integer, as suggested by George.</div><div>I define <span style="font-size:12.7272720336914px">tParticle as a common </span>object.<span style="font-size:12.7272720336914px"> </span></div><div><span style="font-size:12.7272720336914px">I am using Intel fortran compiler. </span></div><div><span style="font-size:12.7272720336914px"><br></span></div><div><span style="font-size:12.7272720336914px">George suggests:</span></div><div><span style="font-size:12.7272720336914px"><br></span></div><div><div style="font-size:12.7272720336914px"><i>&quot;&quot; The displacements are relative to the benign of your particle type. Thus the first one is not 0 but the displacement of “integer :: ip” due to the fact that the compiler is allowed to introduce gaps in order to better align.</i></div><div style="font-size:12.7272720336914px"><blockquote type="cite"><div dir="ltr"><div style="font-size:12.7272720336914px"><div><i>  DISPLACEMENTS(1)=MPI_GET_ADDRESS(dummy%ip)</i></div><div><i>  DISPLACEMENTS(2)=</i><i style="font-size:12.7272720336914px">MPI_GET_ADDRESS(dummy%RP[1])</i></div></div></div></blockquote><blockquote type="cite"><div dir="ltr"><div style="font-size:12.7272720336914px"><i>  DISPLACEMENTS(3)=</i><i style="font-size:12.7272720336914px">MPI_GET_ADDRESS(dummy%QQ[1])</i></div></div></blockquote><i>and then remove the MPI_GET_ADDRESS(dummy) from all of them.</i></div><div style="font-size:12.7272720336914px"><i><br></i></div><div style="font-size:12.7272720336914px"><i>3. After creating the structure type you need to resize it in order to correctly determine the span of the entire structure, and how an array of such structures lays in memory. Something like:</i></div><div style="font-size:12.7272720336914px"><i>MPI_TYPE_CREATE_RESIZED(old type, DISPLACEMENT(1),</i></div><div style="font-size:12.7272720336914px"><i>   MPI_GET_ADDRESS(dummy[2]) - MPI_GET_ADDRESS(dummy[1]), newt) &quot;&quot;</i></div><div style="font-size:12.7272720336914px"><i><br></i></div><div style="font-size:12.7272720336914px">What do you think?</div><div style="font-size:12.7272720336914px">George, Did i miss something?</div><div style="font-size:12.7272720336914px"><br></div><div style="font-size:12.7272720336914px">Thanks a lot</div><div style="font-size:12.7272720336914px"><div dir="ltr"></div></div></div><div><div style="min-height:100%"><div style="width:1686.36352539063px"><div><div><div><div style="width:1281.35px"><div><div><div><div><div style="min-height:774px"><div style="min-height:346.83519744873px"><div><div><div><div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div><span style="font-size:12.7272720336914px"><br></span></div><div><span style="font-size:12.7272720336914px"><br></span></div><div class="gmail_extra"><br clear="all"><div><div>Diego<br><br></div></div>
<br><div class="gmail_quote">On 2 January 2015 at 12:51, Gilles Gouaillardet <span dir="ltr">&lt;<a href="mailto:gilles.gouaillardet@gmail.com" target="_blank">gilles.gouaillardet@gmail.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex">Diego,<br><br>First, i recommend you redefine tParticle and add a padding integer so everything is aligned.<br><br><br>Before invoking MPI_Type_create_struct, you need to <br>call MPI_Get_address(dummy, base, MPI%err)<br>displacements = displacements - base<br><br>MPI_Type_create_resized might be unnecessary if tParticle is aligned <br>And the lower bound should be zero.<br><br>BTW, which compiler are you using ?<br>Is tParticle object a common ?<br>iirc, intel compiler aligns types automatically, but not commons, and that means MPI_Type_create_struct is not aligned as it should most of the time.<br><br>Cheers,<br><br>Gilles <br><br>Diego Avesani &lt;<a href="mailto:diego.avesani@gmail.com" target="_blank">diego.avesani@gmail.com</a>&gt;さんのメール:<div><div><br><div dir="ltr">dear all,<div><br></div><div>I have a problem with MPI_Type_Create_Struct and MPI_TYPE_CREATE_RESIZED.</div><div><br></div><div>I have this variable type:</div><div><br></div><div><div><i>  TYPE tParticle</i></div><div><i>     INTEGER  :: ip</i></div><div><i>     REAL     :: RP(2)</i></div><div><i>     REAL     :: QQ(2)</i></div><div><i>  ENDTYPE tParticle</i></div></div><div><br></div><div>Then I define:</div><div><br></div><div>Nstruct=3<br></div><div><div><i>ALLOCATE(TYPES(Nstruct))</i></div><div><i>ALLOCATE(LENGTHS(Nstruct))</i></div><div><i>ALLOCATE(DISPLACEMENTS(Nstruct))</i></div><div><i>!set the types</i></div><div><i>TYPES(1) = MPI_INTEGER</i></div><div><i>TYPES(2) = MPI_DOUBLE_PRECISION</i></div><div><i>TYPES(3) = MPI_DOUBLE_PRECISION</i></div><div><i>!set the lengths</i></div><div><i>LENGTHS(1) = 1</i></div><div><i>LENGTHS(2) = 2</i></div><div><i>LENGTHS(3) = 2</i></div><div><i><br></i></div><div>As gently suggested by Nick Papior Andersen and George Bosilca some months ago, I checked the variable adress to resize my struct variable to avoid empty space and</div><div>to have a more general definition.</div><div><br></div><div><i> !</i></div><div><i> CALL MPI_GET_ADDRESS(dummy%ip,    DISPLACEMENTS(1), MPI%iErr)</i></div><div><i> CALL MPI_GET_ADDRESS(dummy%RP(1), DISPLACEMENTS(2), MPI%iErr)</i></div><div><i> CALL MPI_GET_ADDRESS(dummy%QQ(1), DISPLACEMENTS(3), MPI%iErr)</i></div><div><i> !</i></div><div><i> CALL MPI_Type_Create_Struct(Nstruct,LENGTHS,DISPLACEMENTS,TYPES,MPI_PARTICLE_TYPE_OLD,MPI%iErr)</i></div><div><i> CALL MPI_Type_Commit(MPI_PARTICLE_TYPE_OLD,MPI%iErr)</i></div><div><i> !</i></div><div><i> CALL MPI_TYPE_CREATE_RESIZED(MPI_PARTICLE_TYPE_OLD, DISPLACEMENTS(1),DISPLACEMENTS(2) - DISPLACEMENTS(1), MPI_PARTICLE_TYPE)</i></div></div><div><br></div><div><br></div><div>This does not work. When my program run, I get an error:</div><div><br></div><div><div><i>forrtl: severe (174): SIGSEGV, segmentation fault occurred.</i></div><div><br></div><div>I have read the manual but probably I am not able to understand  <i>MPI_TYPE_CREATE_RESIZED. </i></div><div><i><br></i></div><div>Someone could help me?</div><div>                                                                                                                                             </div></div><div>Thanks a lot</div><div>Diego</div><div><br></div><div><br clear="all"><div><div>Diego<br><br></div></div>
</div></div>
</div></div><br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2015/01/26092.php" target="_blank">http://www.open-mpi.org/community/lists/users/2015/01/26092.php</a><br></blockquote></div><br></div></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div></div>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2015/01/26097.php" target="_blank">http://www.open-mpi.org/community/lists/users/2015/01/26097.php</a><br></blockquote></div><br></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div></div>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2015/01/26099.php" target="_blank">http://www.open-mpi.org/community/lists/users/2015/01/26099.php</a><br></blockquote></div><br></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2015/01/26100.php" target="_blank">http://www.open-mpi.org/community/lists/users/2015/01/26100.php</a><br></blockquote></div><br></div>

