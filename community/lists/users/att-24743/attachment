<html><head><meta http-equiv="Content-Type" content="text/html charset=utf-8"><base></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">This looks to me like a message from some older version of OMPI. Please check your LD_LIBRARY_PATH and ensure that the 1.9 installation is at the *front* of that list.<div><br></div><div>Of course, I'm also assuming that you installed the two versions into different locations - yes?</div><div><br></div><div>Also, add "--mca rmaps_base_verbose 20" to your cmd line - this will tell us what mappers are being considered.</div><div><br></div><div><br><div><div>On Jul 3, 2014, at 1:31 AM, Timur Ismagilov &lt;<a href="mailto:tismagilov@mail.ru">tismagilov@mail.ru</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When i used --map-by slot:pe=8, i got the same message&nbsp;<br><br><p>Your job failed to map. Either no mapper was available, or none<br>of the available mappers was able to perform the requested<br>mapping operation. This can happen if you request a map type<br>(e.g., loadbalance) and the corresponding mapper was not built.<br>...</p><br><br>Wed, 2 Jul 2014 07:36:48 -0700 от Ralph Castain &lt;<a href="mailto:rhc@open-mpi.org">rhc@open-mpi.org</a>&gt;:<br><blockquote style="border-left-width: 1px; border-left-style: solid; border-left-color: rgb(8, 87, 166); margin: 10px; padding: 0px 0px 0px 10px;"><div id=""><div class="js-helper js-readmsg-msg"><base target="_self" href="https://e.mail.ru/"><div id="style_14043118310000000695_BODY">Let's keep this on the user list so others with similar issues can find it.<div><br></div><div>My guess is that the $OMP_NUM_THREADS syntax isn't quite right, so it didn't pick up the actual value there. Since it doesn't hurt to have extra cpus, just set it to 8 for your test case and that should be fine, so adding a little clarity:</div><div><br></div><div>--map-by slot:pe=8</div><div><br></div><div>I'm not aware of any slurm utility similar to top, but there is no reason you can't just submit this as an interactive job and use top itself, is there?</div><div><br></div><div>As for that sbgp warning - you can probably just ignore it. Not sure why that is failing, but it just means that component will disqualify itself. If you want to eliminate it, just add</div><div><br></div><div>-mca sbgp ^ibnet</div><div><br></div><div>to your cmd line</div><div><br></div><div><br><div><div>On Jul 2, 2014, at 7:29 AM, Timur Ismagilov &lt;<a href="x-msg://e.mail.ru/compose/?mailto=mailto%3atismagilov@mail.ru" target="_blank">tismagilov@mail.ru</a>&gt; wrote:</div><br><blockquote type="cite"><div style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><p>Thanks, Ralph!</p><p>With '--map-by :pe=$OMP_NUM_THREADS' &nbsp;i got:<br></p><p>--------------------------------------------------------------------------<br>Your job failed to map. Either no mapper was available, or none<br>of the available mappers was able to perform the requested<br>mapping operation. This can happen if you request a map type<br>(e.g., loadbalance) and the corresponding mapper was not built.<br><br>What does it mean?</p><p>With '--bind-to socket' everything looks better, but performance still worse..( but better than it was)<br></p><ul><li>1 thread 0.028 sec</li><li>2 thread 0.018 sec</li><li>4 thread 0.020 sec&nbsp;</li><li>8 thread 0.021 sec</li></ul><p>Do i have utility similar to the 'top'&nbsp;with sbatch?<br><br>Also, every time, &nbsp;i got the message in ompi 1.9:<br>mca: base: components_register: component sbgp / ibnet register function failed<br>Is it bad?<br><br>Regards,&nbsp;<br>Timur<br><br>Wed, 2 Jul 2014 05:53:44 -0700 от Ralph Castain &lt;<a href="x-msg://e.mail.ru/compose/?mailto=mailto%3arhc@open%2dmpi.org" target="_blank">rhc@open-mpi.org</a>&gt;:<br></p><blockquote style="border-left-width: 1px; border-left-style: solid; border-left-color: rgb(8, 87, 166); margin: 10px; padding: 0px 0px 0px 10px;">OMPI started binding by default during the 1.7 series. You should add the following to your cmd line:<div><br></div><div>--map-by :pe=$OMP_NUM_THREADS</div><div><br></div><div>This will give you a dedicated core for each thread. Alternatively, you could instead add</div><div><br></div><div>--bind-to socket</div><div><br></div><div>OMPI 1.5.5 doesn't bind at all unless directed to do so, which is why you are getting the difference in behavior.</div><div><br></div><div><br></div><div><div><div>On Jul 2, 2014, at 12:33 AM, Timur Ismagilov &lt;<a target="_blank">tismagilov@mail.ru</a>&gt; wrote:</div><br><blockquote type="cite"><div><p>Hello!</p><p>I have open mpi&nbsp;1.9a1r32104 and open mpi 1.5.5.<br>I have much better perfomance in open mpi 1.5.5 with openMP on 8 cores<br><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">in &nbsp;the program:<br></span></p><p data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">....<br><br><span style="font-family: arial, helvetica; font-size: 12px; line-height: normal;">#define N 10000000</span></p><div><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;"><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;"></span></span><br></div><p>int main(int argc, char *argv[]) {<br>...............<br>MPI_Init(&amp;argc, &amp;argv);<br>...............<br>for (i = 0; i &lt; N; i++) {<br>a[i] = i * 1.0;<br>b[i] = i * 2.0;<br>}<br><br>#pragma omp parallel for shared(a, b, c) private(i)<br>for (i = 0; i &lt; N; i++) {<br>c[i] = a[i] + b[i];<br>}<br>.............<br>MPI_Finalize();<br>}</p><p><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">I got on 1 node<span>&nbsp;</span><br>(for i in 1 2 4 8 ; do export OMP_NUM_THREADS=$i; sbatch -p test -t 5 --exclusive -N 1 -o hybrid-hello_omp$i.out -e hybrid-hello_omp$i.err ompi_mxm3.0 ./hybrid-hello; done)</span><br></p><div style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;"><br></div><ul><li data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;"><span data-mce-type="bookmark" data-mce-style="overflow:hidden;line-height:0px" style="overflow: hidden; line-height: 0px;">﻿</span>open mpi 1.5.5 (Data for node: node1-128-17 Num slots: 8 Max slots: 0):&nbsp;<ul><li data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">8 threads&nbsp;0.014527 sec</li><li data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">4 threads 0.016138 sec</li><li data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">2 threads&nbsp;0.018764 sec</li><li data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;"><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">1 thread &nbsp; 0.029963 sec<br></span></li></ul></li></ul><ul><li><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;"><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;"><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;"><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">openmpi 1.9a1r32104 (<span style="font-family: arial, helvetica; font-size: 12px; line-height: normal;">node1-128-29: slots=8 max_slots=0 slots_inuse=0 state=UP</span></span></span></span></span><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">):</span><ul><li><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">8 threads&nbsp;0.035055 sec</span></li><li><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">4 threads&nbsp;0.029859 sec&nbsp;</span></li><li><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">2 threads&nbsp;0.019564 sec&nbsp;<span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">(same as&nbsp;</span><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">open mpi 1.5.5</span><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">)</span></span></li><li><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">1 thread &nbsp;&nbsp;0.028394 sec (same as<span>&nbsp;</span><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">open mpi 1.5.5</span>)<br></span></li></ul></li></ul><p><span data-mce-style="font-family: Arial, Tahoma, Verdana, sans-serif;font-size: 13px;line-height: 18.200000762939453px;" style="font-family: Arial, Tahoma, Verdana, sans-serif; font-size: 13px; line-height: 18.200000762939453px;">So, it looks like, that open mpi 1.9 use only 2 cores from 8.</span><br><br>What can i do with this?<br><br>$cat ompi_mxm3.0<br></p><p>#!/bin/sh</p><p>[ x"$TMPDIR" == x"" ] &amp;&amp; TMPDIR=/tmp</p><p>HOSTFILE=${TMPDIR}/hostfile.${SLURM_JOB_ID}<br>srun hostname -s|sort|uniq -c|awk '{print $2" slots="$1}' &gt; $HOSTFILE || { rm -f $HOSTFILE; exit 255; }<br>LD_PRELOAD=/mnt/data/users/dm2/vol3/semenov/_scratch/mxm/mxm-3.0/lib/libmxm.so mpirun -x LD_PRELOAD -x MXM_SHM_KCOPY_MODE=off --display-allocation --hostfile $HOSTFILE "$@"<br>rc=$?<br>rm -f $HOSTFILE</p><p>exit $rc<br><br>For open mpi 1.5.5 i remove LD_PRELOAD from run script.</p></div>_______________________________________________<br>users mailing list<br><a target="_blank">users@open-mpi.org</a><br>Subscription:<span>&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>Link to this post:<span>&nbsp;</span><a href="http://www.open-mpi.org/community/lists/users/2014/07/24738.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/07/24738.php</a></blockquote></div><br></div></blockquote><br><br></div></blockquote></div><br></div></div><base target="_self" href="https://e.mail.ru/"></div></div></blockquote><br><br></div></blockquote></div><br></div></body></html>
