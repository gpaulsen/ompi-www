<div dir="ltr"><div><div>Hi, Filippo<br><br></div>When launching with mpirun in a SLURM environment, srun is only being used to launch the ORTE daemons (orteds.)  Since the daemon will already exist on the node from which you invoked mpirun, this node will not be included in the list of nodes. SLURM&#39;s PMI library is not involved (that functionality is only necessary if you directly launch your MPI application with srun, in which case it is used to exchanged wireup info amongst slurmds.) This is the expected behavior. <br>
<br></div>~/ompi-top-level/orte/mca/plm/plm_slurm_module.c +294<br><div><div>/* if the daemon already exists on this node, then<br>         * don&#39;t include it<br>         */<br>        if (node-&gt;daemon_launched) {<br>
            continue;<br>        }<br><br></div><div>Do you have a frontend node that you can launch from? What happens if you set &quot;-np X&quot; where X = 8*ppn. The alternative is to do a direct launch of the MPI application with srun.<br>
</div><div><br><br></div><div>Best,<br><br>Josh<br><br>
</div></div></div><div class="gmail_extra"><br><br><div class="gmail_quote">On Wed, Aug 20, 2014 at 6:48 PM, Filippo Spiga <span dir="ltr">&lt;<a href="mailto:spiga.filippo@gmail.com" target="_blank">spiga.filippo@gmail.com</a>&gt;</span> wrote:<br>
<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div style="word-wrap:break-word">Dear Open MPI experts,<div><br></div><div>I have a problem that is related to the integration of OpenMPI, slurm and PMI interface. I spent some time today with a colleague of mine trying to figure out why we were not able to obtain all H5 profile files (generated by acct_gather_profile) using Open MPI. When I say &quot;all&quot; I mean if I run using 8 nodes (e.g. tesla[121-128]) then I always systematically miss the file related to the first one (the first node in the allocation list, in this case tesla121).</div>
<div><br></div><div>By comparing which processes are spawn on the compute nodes, I discovered that mpirun running on tesla121 calls srun only to spawn remotely new MPI processes to the other 7 nodes (maybe this is obvious, for me it was not)...</div>
<div><br></div><div><font face="Andale Mono">fs395      617  0.0  0.0 106200  1504 ?        S    22:41   0:00 /bin/bash /var/spool/slurm-test/slurmd/job390044/slurm_script<br>fs395      629  0.1  0.0 194552  5288 ?        Sl   22:41   0:00  \_ mpirun -bind-to socket --map-by ppr:1:socket --host tesla121,tesla122,tesla123,tesla124,tesla125,tesla126,tes<br>
fs395      632  0.0  0.0 659740  9148 ?        Sl   22:41   0:00  |   \_ srun --ntasks-per-node=1 --kill-on-bad-exit --cpu_bind=none --nodes=7 --nodelist=tesla122,tesla123,tesla1<br>fs395      633  0.0  0.0  55544  1072 ?        S    22:41   0:00  |   |   \_ srun --ntasks-per-node=1 --kill-on-bad-exit --cpu_bind=none --nodes=7 --nodelist=tesla122,tesla123,te<br>
fs395      651  0.0  0.0 106072  1392 ?        S    22:41   0:00  |   \_ /bin/bash ./run_linpack ./xhpl<br>fs395      654  295 35.5 120113412 23289280 ?  RLl  22:41   3:12  |   |   \_ ./xhpl<br>fs395      652  0.0  0.0 106072  1396 ?        S    22:41   0:00  |   \_ /bin/bash ./run_linpack ./xhpl<br>
fs395      656  307 35.5 120070332 23267728 ?  RLl  22:41   3:19  |       \_ ./xhpl</font></div><div><br></div><div><br></div><div>The &quot;xhpl&quot; processes allocated on the first node of a job are not called by srun and because of this the SLURM profile plugin is not activated on the node!!! As result I always miss the first node profile information. Intel MPI does not have this behavior, mpiexec.hydra uses srun on the first node. </div>
<div><br></div><div>I got to the conclusion that SLURM is configured properly, something is wrong in the way I lunch Open MPI using mpirun. If I disable SLURM support and I revert back to rsh (--mca plm rsh) everything work but there is not profiling because the SLURM plug-in is not activated. During the configure step, Open MPI 1.8.1 detects slurm and libmpi/libpmi2 correctly. Honestly, I would prefer to avoid to use srun as job luncher if possible...</div>
<div><br></div><div>Any suggestion to get this sorted out is really appreciated!</div><div><br></div><div>Best Regards,</div><div>Filippo<br><div><br></div><div>--<br>Mr. Filippo SPIGA, M.Sc.<br><a href="http://filippospiga.info" target="_blank">http://filippospiga.info</a> ~ skype: filippo.spiga<br>
<br>«Nobody will drive us out of Cantor&#39;s paradise.» ~ David Hilbert<br><br>*****<br>Disclaimer: &quot;Please note this message and any attachments are CONFIDENTIAL and may be privileged or otherwise protected from disclosure. The contents are not to be disclosed to anyone other than the addressee. Unauthorized recipients are requested to preserve this confidentiality and to advise the sender immediately of any error in transmission.&quot;<br>
<br></div><br></div></div><br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/08/25099.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/08/25099.php</a><br></blockquote></div><br></div>

