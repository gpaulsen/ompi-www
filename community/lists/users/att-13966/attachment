<table cellspacing="0" cellpadding="0" border="0" ><tr><td valign="top" style="font: inherit;">Jeff thanks for the clarification,<br>What I am trying to do is run N concurrent copies of a 1 to N data movement program to affect an N to N solution.&nbsp; The actual mechanism I am using is to spawn N copies of mpirun from PVM across the cluster. So each 1 to N MPI application starts at the same time with a different node as root.<br><br>Yes I know this is a bit odd…&nbsp; It was an attempt to be lazy and not re-write the code (again) and this appears to be a potential log N solution.<br><br>My thoughts are that the problem must be either:<br><br>1)&nbsp;&nbsp;&nbsp; Some bug in my code that does not occur normally (this seems unlikely because it halts in Bcast and runs in the normal 1 to N manner)<br>2)&nbsp;&nbsp;&nbsp; Something in MPI is fouling the bcast call<br>3)&nbsp;&nbsp;&nbsp; Something in PVM is fouling the bcast call<br><br>Obviously, this is
 not the PVM forum, but have I missed anything?<br><br>I’m not a network expert and I had assumed broadcasts must be implemented with&nbsp; multicasts to prevent broadcasts colliding between concurrent applications and thus conforming to the MPI safety/isolation dictum (this appears to be how PVM isolates broadcasts between applications).&nbsp; I can see now that a series of point to point send/receives should not be affected in this way.<br><br>This is what I would describe as “implementing Bcast with point to point transfers”&nbsp; as opposed to “implementing Bcast with broadcasts”<br><br>BTW: Implementing Bcast with Multicast or a combination of both multicasts and p2p transfers is another option and described by Hoefler et. al. in their paper “A practically constant-time MPI Broadcast Algorithm for large-scale InﬁniBand Clusters with Multicast”.<br><br>I guess I was eluding that if MPI used actual broadcast calls to transmit or
 syncronise, then a broadcast collision may be possible.&nbsp; I did not know that only p2p transfers where used in Bcast calls.<br><br>From here I need to decide to:<br><br>1)&nbsp;&nbsp;&nbsp; Generate a minimal example but given that this will require PVM, it is unlikely to see much use.<br><br>2)&nbsp;&nbsp;&nbsp; Write a N to N transfer system in MPI using inter-communicators, however this may not scale with only p2p transfers and is probably N Log N at best.<br><br>3)&nbsp;&nbsp;&nbsp; Write the N to N transfer system in PVM, Open Fabric calls or something that supports broadcast/multicast calls.<br><br>My application must transfer a large (potentially huge) amount of tuples from a table distributed across the cluster to a table replicated on each node.&nbsp; The similar (1 to N) system compresses tuples into 64k pages and sends these.&nbsp; The same method would be used and the page size could be varied for efficiency.<br><br>What are your
 thoughts?&nbsp; Can OpenMPI do this in under N log N time?<br><br>Regards,<br>Randolph<br><br><br>--- On <b>Wed, 11/8/10, Jeff Squyres <i>&lt;jsquyres@cisco.com&gt;</i></b> wrote:<br><blockquote style="border-left: 2px solid rgb(16, 16, 255); margin-left: 5px; padding-left: 5px;"><br>From: Jeff Squyres &lt;jsquyres@cisco.com&gt;<br>Subject: Re: [OMPI users] MPI_Bcast issue<br>To: "Open MPI Users" &lt;users@open-mpi.org&gt;<br>Received: Wednesday, 11 August, 2010, 6:24 AM<br><br><div class="plainMail">+1 on Eugene's comment that I don't fully understand what you are trying to do.&nbsp; Can you send a short example code?<br><br>Some random points:<br><br>- Edgar already chimed in about how MPI-2 allows the use of intercommunicators with bcast. Open MPI is MPI-2.1 complaint, so you can use intercommunicators with MPI_Bcast.<br><br>- I'm not sure what you mean by "implement broadcast with broadcast" -- that seems like a recursive definition...?<br><br>-
 Keep in mind that there are MPI standard-imposed limitations of how MPI_Bcast can function.&nbsp; What you *may* be running afoul of is MPI specifications and definitions -- not a bug in OMPI.&nbsp; But that's not entirely clear to me because I don't quite understand what you're trying to do.<br><br>- For example, remember that MPI 2.x defines that you can only have one ongoing collective on a communicator at a time.&nbsp; So if you're starting multiple bcasts on the same communicator simultaneously (effectively by using different root values in different processes on the same communicator), this is Bad.&nbsp; Dick intoned that you probably aren't doing that, but again, I'm not entirely sure what you're doing.<br><br>- Also, by the MPI spec, MPI_Bcast may or may not synchronize.&nbsp; In practice, if you're broadcasting a large message, most implementations will likely synchronize (where "large" is defined differently by each implementation).<br><br>-
 Open MPI has many different algorithms to implement the MPI_Bcast functionality.&nbsp; Which to use is chosen on the fly behind the scenes at run time depending on lots of things, such as number of peers in the communicator, size of the message, etc.<br><br>- All of Open MPI's network-based collectives use point-to-point communications underneath (shared memory may not, but that's not the issue here).&nbsp; One of the implementations is linear, meaning that the root sends the message to comm rank 1, then comm rank 2, ..etc.&nbsp; But this algorithm is only used when the message is small, the number of peers is small, etc.&nbsp; All the other algorithms are parallel in nature, meaning that after an iteration or two, multiple processes have the data and can start pipelining sends to other processes, etc.<br><br>- We don't have a multicast-based broadcast for a variety of reasons.&nbsp; MPI_Bcast needs to be reliable.&nbsp; Multicast is not reliable.&nbsp;
 There have been many good algorithms published over the years to make unreliable multicast be reliable, but no one has implemented those in a robust, production-quality manner for Open MPI.&nbsp; Part of the reason for that is the non-uniform support of robust multicast implementations by network vendors, the lack of spanning multicast across multiple subnets, etc.&nbsp; In practice, the log(n) algorithms that Open MPI uses have generally been "fast enough" such that there hasn't been a clamor for a multicast-based broadcast.&nbsp; To be fair: every once in a (great) while, someone says they need it, but to be totally blunt, a) we haven't received enough requests to implement it ourselves, or b) no one has contributed a patch / plugin that implements it.&nbsp; That sounds snobby, but I don't mean it that way: what I mean is that most of the features in Open MPI are customer-driven.&nbsp; All I'm saying is that we have a lot of other higher-priority
 customer-requested features that we're working on.&nbsp; Multicast-bcast support is not high enough in priority because not enough people have asked for it.<br><br>I hope that helps...<br><br><br><br>On Aug 9, 2010, at 10:43 PM, Randolph Pullen wrote:<br><br>&gt; The install was completly vanilla - no extras a plain .configure command line (on FC10 x8x_64 linux)<br>&gt; <br>&gt; Are you saying that all broadcast calls are actually implemented as serial point to point calls?<br>&gt; <br>&gt; <br>&gt; --- On Tue, 10/8/10, Ralph Castain &lt;<a ymailto="mailto:rhc@open-mpi.org" href="/mc/compose?to=rhc@open-mpi.org">rhc@open-mpi.org</a>&gt; wrote:<br>&gt; <br>&gt; From: Ralph Castain &lt;<a ymailto="mailto:rhc@open-mpi.org" href="/mc/compose?to=rhc@open-mpi.org">rhc@open-mpi.org</a>&gt;<br>&gt; Subject: Re: [OMPI users] MPI_Bcast issue<br>&gt; To: "Open MPI Users" &lt;<a ymailto="mailto:users@open-mpi.org"
 href="/mc/compose?to=users@open-mpi.org">users@open-mpi.org</a>&gt;<br>&gt; Received: Tuesday, 10 August, 2010, 12:33 AM<br>&gt; <br>&gt; No idea what is going on here. No MPI call is implemented as a multicast - it all flows over the MPI pt-2-pt system via one of the various algorithms.<br>&gt; <br>&gt; Best guess I can offer is that there is a race condition in your program that you are tripping when other procs that share the node change the timing.<br>&gt; <br>&gt; How did you configure OMPI when you built it?<br>&gt; <br>&gt; <br>&gt; On Aug 8, 2010, at 11:02 PM, Randolph Pullen wrote:<br>&gt; <br>&gt;&gt; The only MPI calls I am using are these (grep-ed from my code):<br>&gt;&gt; <br>&gt;&gt; MPI_Abort(MPI_COMM_WORLD, 1);<br>&gt;&gt; MPI_Barrier(MPI_COMM_WORLD);<br>&gt;&gt; MPI_Bcast(&amp;bufarray[0].hdr, sizeof(BD_CHDR), MPI_CHAR, 0, MPI_COMM_WORLD);<br>&gt;&gt; MPI_Comm_rank(MPI_COMM_WORLD,&amp;myid);<br>&gt;&gt;
 MPI_Comm_size(MPI_COMM_WORLD,&amp;numprocs); <br>&gt;&gt; MPI_Finalize();<br>&gt;&gt; MPI_Init(&amp;argc, &amp;argv);<br>&gt;&gt; MPI_Irecv(<br>&gt;&gt; MPI_Isend(<br>&gt;&gt; MPI_Recv(buff, BUFSIZE, MPI_CHAR, 0, TAG, MPI_COMM_WORLD, &amp;stat);<br>&gt;&gt; MPI_Send(buff, BUFSIZE, MPI_CHAR, 0, TAG, MPI_COMM_WORLD);<br>&gt;&gt; MPI_Test(&amp;request, &amp;complete, &amp;status);<br>&gt;&gt; MPI_Wait(&amp;request, &amp;status);&nbsp; <br>&gt;&gt; <br>&gt;&gt; The big wait happens on receipt of a bcast call that would otherwise work.<br>&gt;&gt; Its a bit mysterious really...<br>&gt;&gt; <br>&gt;&gt; I presume that bcast is implemented with multicast calls but does it use any actual broadcast calls at all?&nbsp; <br>&gt;&gt; I know I'm scraping the edges here looking for something but I just cant get my head around why it should fail where it has.<br>&gt;&gt; <br>&gt;&gt; --- On Mon, 9/8/10, Ralph Castain &lt;<a ymailto="mailto:rhc@open-mpi.org"
 href="/mc/compose?to=rhc@open-mpi.org">rhc@open-mpi.org</a>&gt; wrote:<br>&gt;&gt; <br>&gt;&gt; From: Ralph Castain &lt;<a ymailto="mailto:rhc@open-mpi.org" href="/mc/compose?to=rhc@open-mpi.org">rhc@open-mpi.org</a>&gt;<br>&gt;&gt; Subject: Re: [OMPI users] MPI_Bcast issue<br>&gt;&gt; To: "Open MPI Users" &lt;<a ymailto="mailto:users@open-mpi.org" href="/mc/compose?to=users@open-mpi.org">users@open-mpi.org</a>&gt;<br>&gt;&gt; Received: Monday, 9 August, 2010, 1:32 PM<br>&gt;&gt; <br>&gt;&gt; Hi Randolph<br>&gt;&gt; <br>&gt;&gt; Unless your code is doing a connect/accept between the copies, there is no way they can cross-communicate. As you note, mpirun instances are completely isolated from each other - no process in one instance can possibly receive information from a process in another instance because it lacks all knowledge of it -unless- they wireup into a greater communicator by performing connect/accept calls between them.<br>&gt;&gt;
 <br>&gt;&gt; I suspect you are inadvertently doing just that - perhaps by doing connect/accept in a tree-like manner, not realizing that the end result is one giant communicator that now links together all the N servers.<br>&gt;&gt; <br>&gt;&gt; Otherwise, there is no possible way an MPI_Bcast in one mpirun can collide or otherwise communicate with an MPI_Bcast between processes started by another mpirun.<br>&gt;&gt; <br>&gt;&gt; <br>&gt;&gt; <br>&gt;&gt; On Aug 8, 2010, at 7:13 PM, Randolph Pullen wrote:<br>&gt;&gt; <br>&gt;&gt;&gt; Thanks,&nbsp; although “An intercommunicator cannot be used for collective communication.” i.e ,&nbsp; bcast calls., I can see how the MPI_Group_xx calls can be used to produce a useful group and then communicator;&nbsp; - thanks again but this is really the side issue to my main question about MPI_Bcast.<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; I seem to have duplicate concurrent processes interfering with each other.&nbsp;
 This would appear to be a breach of the MPI safety dictum, ie MPI_COMM_WORD is supposed to only include the processes started by a single mpirun command and isolate these processes from other similar groups of processes safely.<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; So, it would appear to be a bug.&nbsp; If so this has significant implications for environments such as mine, where it may often occur that the same program is run by different users simultaneously.&nbsp; <br>&gt;&gt;&gt; <br>&gt;&gt;&gt; It is really this issue that it concerning me, I can rewrite the code but if it can crash when 2 copies run at the same time, I have a much bigger problem.<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; My suspicion is that a within the MPI_Bcast handshaking, a syncronising broadcast call may be colliding across the environments.&nbsp; My only evidence is an otherwise working program waits on broadcast reception forever when two or more copies are run at [exactly] the same
 time.<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; Has anyone else seen similar behavior in concurrently running programs that perform lots of broadcasts perhaps?<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; Randolph<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; <br>&gt;&gt;&gt; --- On Sun, 8/8/10, David Zhang &lt;<a ymailto="mailto:solarbikedz@gmail.com" href="/mc/compose?to=solarbikedz@gmail.com">solarbikedz@gmail.com</a>&gt; wrote:<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; From: David Zhang &lt;<a ymailto="mailto:solarbikedz@gmail.com" href="/mc/compose?to=solarbikedz@gmail.com">solarbikedz@gmail.com</a>&gt;<br>&gt;&gt;&gt; Subject: Re: [OMPI users] MPI_Bcast issue<br>&gt;&gt;&gt; To: "Open MPI Users" &lt;<a ymailto="mailto:users@open-mpi.org" href="/mc/compose?to=users@open-mpi.org">users@open-mpi.org</a>&gt;<br>&gt;&gt;&gt; Received: Sunday, 8 August, 2010, 12:34 PM<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; In particular, intercommunicators<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; On 8/7/10, Aurélien
 Bouteiller &lt;<a ymailto="mailto:bouteill@eecs.utk.edu" href="/mc/compose?to=bouteill@eecs.utk.edu">bouteill@eecs.utk.edu</a>&gt; wrote:<br>&gt;&gt;&gt; &gt; You should consider reading about communicators in MPI.<br>&gt;&gt;&gt; &gt;<br>&gt;&gt;&gt; &gt; Aurelien<br>&gt;&gt;&gt; &gt; --<br>&gt;&gt;&gt; &gt; Aurelien Bouteiller, Ph.D.<br>&gt;&gt;&gt; &gt; Innovative Computing Laboratory, The University of Tennessee.<br>&gt;&gt;&gt; &gt;<br>&gt;&gt;&gt; &gt; Envoyé de mon iPad<br>&gt;&gt;&gt; &gt;<br>&gt;&gt;&gt; &gt; Le Aug 7, 2010 à 1:05, Randolph Pullen &lt;<a ymailto="mailto:randolph_pullen@yahoo.com.au" href="/mc/compose?to=randolph_pullen@yahoo.com.au">randolph_pullen@yahoo.com.au</a>&gt; a<br>&gt;&gt;&gt; &gt; écrit :<br>&gt;&gt;&gt; &gt;<br>&gt;&gt;&gt; &gt;&gt; I seem to be having a problem with MPI_Bcast.<br>&gt;&gt;&gt; &gt;&gt; My massive I/O intensive data movement program must broadcast from n to n<br>&gt;&gt;&gt; &gt;&gt; nodes. My
 problem starts because I require 2 processes per node, a sender<br>&gt;&gt;&gt; &gt;&gt; and a receiver and I have implemented these using MPI processes rather<br>&gt;&gt;&gt; &gt;&gt; than tackle the complexities of threads on MPI.<br>&gt;&gt;&gt; &gt;&gt;<br>&gt;&gt;&gt; &gt;&gt; Consequently, broadcast and calls like alltoall are not completely<br>&gt;&gt;&gt; &gt;&gt; helpful.&nbsp; The dataset is huge and each node must end up with a complete<br>&gt;&gt;&gt; &gt;&gt; copy built by the large number of contributing broadcasts from the sending<br>&gt;&gt;&gt; &gt;&gt; nodes.&nbsp; Network efficiency and run time are paramount.<br>&gt;&gt;&gt; &gt;&gt;<br>&gt;&gt;&gt; &gt;&gt; As I don’t want to needlessly broadcast all this data to the sending nodes<br>&gt;&gt;&gt; &gt;&gt; and I have a perfectly good MPI program that distributes globally from a<br>&gt;&gt;&gt; &gt;&gt; single node (1 to N), I took the unusual decision to start N copies
 of<br>&gt;&gt;&gt; &gt;&gt; this program by spawning the MPI system from the PVM system in an effort<br>&gt;&gt;&gt; &gt;&gt; to get my N to N concurrent transfers.<br>&gt;&gt;&gt; &gt;&gt;<br>&gt;&gt;&gt; &gt;&gt; It seems that the broadcasts running on concurrent MPI environments<br>&gt;&gt;&gt; &gt;&gt; collide and cause all but the first process to hang waiting for their<br>&gt;&gt;&gt; &gt;&gt; broadcasts.&nbsp; This theory seems to be confirmed by introducing a sleep of<br>&gt;&gt;&gt; &gt;&gt; n-1 seconds before the first MPI_Bcast&nbsp; call on each node, which results<br>&gt;&gt;&gt; &gt;&gt; in the code working perfectly.&nbsp; (total run time 55 seconds, 3 nodes,<br>&gt;&gt;&gt; &gt;&gt; standard TCP stack)<br>&gt;&gt;&gt; &gt;&gt;<br>&gt;&gt;&gt; &gt;&gt; My guess is that unlike PVM, OpenMPI implements broadcasts with broadcasts<br>&gt;&gt;&gt; &gt;&gt; rather than multicasts.&nbsp; Can someone confirm this?&nbsp; Is this a
 bug?<br>&gt;&gt;&gt; &gt;&gt;<br>&gt;&gt;&gt; &gt;&gt; Is there any multicast or N to N broadcast where sender processes can<br>&gt;&gt;&gt; &gt;&gt; avoid participating when they don’t need to?<br>&gt;&gt;&gt; &gt;&gt;<br>&gt;&gt;&gt; &gt;&gt; Thanks in advance<br>&gt;&gt;&gt; &gt;&gt; Randolph<br>&gt;&gt;&gt; &gt;&gt;<br>&gt;&gt;&gt; &gt;&gt;<br>&gt;&gt;&gt; &gt;&gt;<br>&gt;&gt;&gt; &gt;&gt; _______________________________________________<br>&gt;&gt;&gt; &gt;&gt; users mailing list<br>&gt;&gt;&gt; &gt;&gt; <a ymailto="mailto:users@open-mpi.org" href="/mc/compose?to=users@open-mpi.org">users@open-mpi.org</a><br>&gt;&gt;&gt; &gt;&gt; <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>&gt;&gt;&gt; &gt;<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; -- <br>&gt;&gt;&gt; Sent from my mobile device<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; David Zhang<br>&gt;&gt;&gt; University of California, San
 Diego<br>&gt;&gt;&gt; <br>&gt;&gt;&gt; _______________________________________________<br>&gt;&gt;&gt; users mailing list<br>&gt;&gt;&gt; <a ymailto="mailto:users@open-mpi.org" href="/mc/compose?to=users@open-mpi.org">users@open-mpi.org</a><br>&gt;&gt;&gt; <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>&gt;&gt;&gt; <br>&gt;&gt;&gt;&nbsp; _______________________________________________<br>&gt;&gt;&gt; users mailing list<br>&gt;&gt;&gt; <a ymailto="mailto:users@open-mpi.org" href="/mc/compose?to=users@open-mpi.org">users@open-mpi.org</a><br>&gt;&gt;&gt; <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>&gt;&gt; <br>&gt;&gt; <br>&gt;&gt; -----Inline Attachment Follows-----<br>&gt;&gt; <br>&gt;&gt; _______________________________________________<br>&gt;&gt; users mailing list<br>&gt;&gt;
 <a ymailto="mailto:users@open-mpi.org" href="/mc/compose?to=users@open-mpi.org">users@open-mpi.org</a><br>&gt;&gt; <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>&gt;&gt; <br>&gt;&gt;&nbsp; _______________________________________________<br>&gt;&gt; users mailing list<br>&gt;&gt; <a ymailto="mailto:users@open-mpi.org" href="/mc/compose?to=users@open-mpi.org">users@open-mpi.org</a><br>&gt;&gt; <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>&gt; <br>&gt; <br>&gt; -----Inline Attachment Follows-----<br>&gt; <br>&gt; _______________________________________________<br>&gt; users mailing list<br>&gt; <a ymailto="mailto:users@open-mpi.org" href="/mc/compose?to=users@open-mpi.org">users@open-mpi.org</a><br>&gt; <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users"
 target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>&gt; <br>&gt;&nbsp; _______________________________________________<br>&gt; users mailing list<br>&gt; <a ymailto="mailto:users@open-mpi.org" href="/mc/compose?to=users@open-mpi.org">users@open-mpi.org</a><br>&gt; <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br><br><br>-- <br>Jeff Squyres<br><a ymailto="mailto:jsquyres@cisco.com" href="/mc/compose?to=jsquyres@cisco.com">jsquyres@cisco.com</a><br>For corporate legal information go to:<br><a href="http://www.cisco.com/web/about/doing_business/legal/cri/" target="_blank">http://www.cisco.com/web/about/doing_business/legal/cri/</a><br><br><br>_______________________________________________<br>users mailing list<br><a ymailto="mailto:users@open-mpi.org" href="/mc/compose?to=users@open-mpi.org">users@open-mpi.org</a><br><a
 href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div></blockquote></td></tr></table><br>



      &nbsp;
