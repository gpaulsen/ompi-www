<html><body><div style="color:#000; background-color:#fff; font-family:times new roman, new york, times, serif;font-size:12pt"><div><div><span style="font-family: 'times new roman', 'new york', times, serif; ">I have a test rig comprising 2 i7 systems with Melanox III HCA 10G cards</span><br></div><div><font face="times new roman, new york, times, serif">running Centos 5.7 Kernel 2.6.18-274</font></div><div><font face="times new roman, new york, times, serif">Open MPI 1.4.3</font></div><div><font face="times new roman, new york, times, serif">MLNX_OFED_LINUX-1.5.3-1.0.0.2 (OFED-1.5.3-1.0.0.2):</font></div><div><font face="times new roman, new york, times, serif">On a Cisco 24 pt switch</font></div><div><font face="times new roman, new york, times, serif"><br></font></div><div><font face="times new roman, new york, times, serif">Normal performance is:</font></div><div><font face="times new roman, new york, times, serif">$ mpirun --mca btl openib,self -n 2
 -hostfile mpi.hosts &nbsp;PingPong</font></div><div><font face="times new roman, new york, times, serif">results in:</font></div><div><font face="times new roman, new york, times, serif">&nbsp;Max rate = 958.388867 MB/sec &nbsp;Min latency = 4.529953 usec</font></div><div><font face="times new roman, new york, times, serif">and:</font></div><div><font face="times new roman, new york, times, serif">$ mpirun --mca btl tcp,self -n 2 -hostfile mpi.hosts &nbsp;PingPong</font></div><div><font face="times new roman, new york, times, serif">Max rate = 653.547293 MB/sec &nbsp;Min latency = 19.550323 usec</font></div><div><br></div><div><font face="times new roman, new york, times, serif"><br></font></div><div><font face="times new roman, new york, times, serif">My application exchanges about a gig of data between the processes with 2 sender and 2 consumer processes on each node with 1 additional controler process on the starting node.</font></div><div><font
 face="times new roman, new york, times, serif">The program splits the data into 64K blocks and uses non blocking sends and receives with busy/sleep loops to monitor progress until completion.</font></div><div><font face="times new roman, new york, times, serif"><br></font></div><div><font face="times new roman, new york, times, serif">My problem is I see better performance under IPoIB then I do on native IB (RDMA_CM).</font></div><div><font face="times new roman, new york, times, serif">My understanding is that IPoIB is limited to about 1G/s so I am at a loss to know why it is faster.</font></div><div><font face="times new roman, new york, times, serif"><br></font></div><div><font face="times new roman, new york, times, serif">These 2 configurations are equivelant (about 8-10 seconds per cycle)</font></div><div><font face="times new roman, new york, times, serif">mpirun --mca btl_openib_flags 2 --mca mpi_leave_pinned 1 --mca btl tcp,self -H vh2,vh1 -np
 9 --bycore prog</font></div><div><font face="times new roman, new york, times, serif">mpirun --mca btl_openib_flags 3 --mca mpi_leave_pinned 1 --mca btl tcp,self -H vh2,vh1 -np 9 --bycore prog</font></div><div><font face="times new roman, new york, times, serif"><br></font></div><div><font face="times new roman, new york, times, serif">And this one produces similar run times but seems to degrade with repeated cycles:</font></div><div><font face="times new roman, new york, times, serif">mpirun --mca btl_openib_eager_limit 64 --mca mpi_leave_pinned 1 --mca btl openib,self -H vh2,vh1 -np 9 --bycore &nbsp;prog</font></div><div><font face="times new roman, new york, times, serif"><br></font></div><div><font face="times new roman, new york, times, serif">Other &nbsp;btl_openib_flags settings result in much lower performance.&nbsp;</font></div><div><font face="times new roman, new york, times, serif">Changing the first of the above configs to use openIB
 results in a 21 second run time at best. &nbsp;Sometimes it takes up to 5 minutes.</font></div><div style="color: rgb(0, 0, 0); font-size: 15.833333015441895px; font-family: 'times new roman', 'new york', times, serif; background-color: transparent; font-style: normal; "><font face="times new roman, new york, times, serif"><span style="font-size: 16px; ">With openib:</span><br></font></div><div><font face="times new roman, new york, times, serif">- Repeated cycles during a single run seem to slow down with each cycle.</font></div><div><font face="times new roman, new york, times, serif">- On occasions it seems to stall indefinately, waiting on a single receive.&nbsp;</font></div><div style="color: rgb(0, 0, 0); font-size: 15.833333015441895px; font-family: 'times new roman', 'new york', times, serif; background-color: transparent; font-style: normal; "><font face="times new roman, new york, times, serif"><br></font></div><div style="color: rgb(0, 0, 0);
 font-size: 15.833333015441895px; font-family: 'times new roman', 'new york', times, serif; background-color: transparent; font-style: normal; "><font face="times new roman, new york, times, serif">Any ideas appreciated.</font></div><div style="color: rgb(0, 0, 0); font-size: 15.833333015441895px; font-family: 'times new roman', 'new york', times, serif; background-color: transparent; font-style: normal; "><br></div><div style="color: rgb(0, 0, 0); font-size: 15.833333015441895px; font-family: 'times new roman', 'new york', times, serif; background-color: transparent; font-style: normal; ">Thanks in advance,</div><div style="color: rgb(0, 0, 0); font-size: 15.833333015441895px; font-family: 'times new roman', 'new york', times, serif; background-color: transparent; font-style: normal; ">Randolph</div><div style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><br></div></div></div></body></html>
