<? include("../../include/msg-header.inc"); ?>
<!-- received="Tue Apr  3 09:46:28 2007" -->
<!-- isoreceived="20070403134628" -->
<!-- sent="Tue, 3 Apr 2007 09:45:52 -0400" -->
<!-- isosent="20070403134552" -->
<!-- name="Jeff Squyres" -->
<!-- email="jsquyres_at_[hidden]" -->
<!-- subject="Re: [OMPI users] problems with profile.d scripts generated using openmpi.spec" -->
<!-- id="10409DAE-7AB5-46EA-AF2E-FFD6F3B9119A_at_cisco.com" -->
<!-- charset="US-ASCII" -->
<!-- inreplyto="46124BB6.1080101_at_poczta.onet.pl" -->
<!-- expires="-1" -->
<div class="center">
<table border="2" width="100%" class="links">
<tr>
<th><a href="date.php">Date view</a></th>
<th><a href="index.php">Thread view</a></th>
<th><a href="subject.php">Subject view</a></th>
<th><a href="author.php">Author view</a></th>
</tr>
</table>
</div>
<p class="headers">
<strong>From:</strong> Jeff Squyres (<em>jsquyres_at_[hidden]</em>)<br>
<strong>Date:</strong> 2007-04-03 09:45:52
</p>
<ul class="links">
<!-- next="start" -->
<li><strong>Next message:</strong> <a href="2990.php">Mohamad Chaarawi: "Re: [OMPI users] [Re:  Memory leak in openmpi-1.2?]"</a>
<li><strong>Previous message:</strong> <a href="2988.php">Marcin Dulak: "[OMPI users] problems with profile.d scripts generated using openmpi.spec"</a>
<li><strong>In reply to:</strong> <a href="2988.php">Marcin Dulak: "[OMPI users] problems with profile.d scripts generated using openmpi.spec"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="2999.php">Marcin Dulak: "Re: [OMPI users] problems with profile.d scripts generated using openmpi.spec"</a>
<!-- reply="end" -->
</ul>
<hr>
<!-- body="start" -->
<p>
Thanks for the report!
<br>
<p>We've actually fixed and improved the specfile as part of the 1.2ofed  
<br>
release (see <a href="http://www.open-mpi.org/faq/?category=openfabrics#ofed">http://www.open-mpi.org/faq/?category=openfabrics#ofed</a>- 
<br>
and-ompi-versions); those fixes should be available soon.
<br>
<p>In the meantime, here's the specfile that we're using for the 1.2  
<br>
ofed release:
<br>
<p><a href="https://svn.open-mpi.org/trac/ompi/browser/branches/v1.2ofed/contrib/">https://svn.open-mpi.org/trac/ompi/browser/branches/v1.2ofed/contrib/</a> 
<br>
dist/linux/openmpi.spec
<br>
<p><p><p>On Apr 3, 2007, at 8:42 AM, Marcin Dulak wrote:
<br>
<p><span class="quotelev1">&gt; Hi,
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; I found that the /etc/profile.d/openmpi-1.2.sh and
</span><br>
<span class="quotelev1">&gt; /etc/profile.d/openmpi-1.2.csh generated using openmpi.spec are  
</span><br>
<span class="quotelev1">&gt; incorrect.
</span><br>
<span class="quotelev1">&gt; The contents of the generated (see the details of the generation  
</span><br>
<span class="quotelev1">&gt; process
</span><br>
<span class="quotelev1">&gt; at the very end of my email) scripts is the following:
</span><br>
<span class="quotelev1">&gt; ---------------------------------------------------------------------- 
</span><br>
<span class="quotelev1">&gt; ---------------------
</span><br>
<span class="quotelev1">&gt; /etc/profile.d/openmpi-1.2.sh
</span><br>
<span class="quotelev1">&gt; ---------------------------------------------------------------------- 
</span><br>
<span class="quotelev1">&gt; ---------------------
</span><br>
<span class="quotelev1">&gt; # NOTE: This is an automatically-generated file!  (generated by the
</span><br>
<span class="quotelev1">&gt; # Open MPI RPM).  Any changes made here will be lost a) if the RPM is
</span><br>
<span class="quotelev1">&gt; # uninstalled, or b) if the RPM is upgraded or uninstalled.
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; CHANGED=0
</span><br>
<span class="quotelev1">&gt; if test -z &quot;&quot;; then
</span><br>
<span class="quotelev1">&gt;     PATH=${PATH}:/opt/openmpi/1.2/bin/
</span><br>
<span class="quotelev1">&gt;     CHANGED=1
</span><br>
<span class="quotelev1">&gt; fi
</span><br>
<span class="quotelev1">&gt; if test -z &quot;&quot;; then
</span><br>
<span class="quotelev1">&gt;     LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/opt/openmpi/1.2/lib
</span><br>
<span class="quotelev1">&gt;     CHANGED=1
</span><br>
<span class="quotelev1">&gt; fi
</span><br>
<span class="quotelev1">&gt; if test -z &quot;&quot;; then
</span><br>
<span class="quotelev1">&gt;     MANPATH=${MANPATH}:/opt/openmpi/1.2/man
</span><br>
<span class="quotelev1">&gt;     CHANGED=1
</span><br>
<span class="quotelev1">&gt; fi
</span><br>
<span class="quotelev1">&gt; if test &quot;&quot; = &quot;1&quot;; then
</span><br>
<span class="quotelev1">&gt;     export PATH LD_LIBRARY_PATH MANPATH
</span><br>
<span class="quotelev1">&gt; fi
</span><br>
<span class="quotelev1">&gt; ---------------------------------------------------------------------- 
</span><br>
<span class="quotelev1">&gt; ---------------------
</span><br>
<span class="quotelev1">&gt; /etc/profile.d/openmpi-1.2.csh
</span><br>
<span class="quotelev1">&gt; ---------------------------------------------------------------------- 
</span><br>
<span class="quotelev1">&gt; ---------------------
</span><br>
<span class="quotelev1">&gt; # NOTE: This is an automatically-generated file!  (generated by the
</span><br>
<span class="quotelev1">&gt; # Open MPI RPM).  Any changes made here will be lost a) if the RPM is
</span><br>
<span class="quotelev1">&gt; # uninstalled, or b) if the RPM is upgraded or uninstalled.
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; if (&quot;&quot;) then
</span><br>
<span class="quotelev1">&gt;     setenv PATH ${PATH}:/opt/openmpi/1.2/bin/
</span><br>
<span class="quotelev1">&gt; endif
</span><br>
<span class="quotelev1">&gt; if (&quot;1LD_LIBRARY_PATH&quot;) then
</span><br>
<span class="quotelev1">&gt;     if (&quot;&quot;) then
</span><br>
<span class="quotelev1">&gt;         setenv LD_LIBRARY_PATH ${LD_LIBRARY_PATH}:/opt/openmpi/1.2/lib
</span><br>
<span class="quotelev1">&gt;     endif
</span><br>
<span class="quotelev1">&gt; endif
</span><br>
<span class="quotelev1">&gt; if (&quot;1MANPATH&quot;) then
</span><br>
<span class="quotelev1">&gt;     if (&quot;&quot;) then
</span><br>
<span class="quotelev1">&gt;         setenv MANPATH ${MANPATH}:/opt/openmpi/1.2/man
</span><br>
<span class="quotelev1">&gt;     endif
</span><br>
<span class="quotelev1">&gt; endif
</span><br>
<span class="quotelev1">&gt; ---------------------------------------------------------------------- 
</span><br>
<span class="quotelev1">&gt; ---------------------
</span><br>
<span class="quotelev1">&gt; The sh one is incorrect in the line
</span><br>
<span class="quotelev1">&gt; if test &quot;&quot; = &quot;1&quot;; then
</span><br>
<span class="quotelev1">&gt; which should be
</span><br>
<span class="quotelev1">&gt; if test &quot;$CHANGED&quot; = &quot;1&quot;; then
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; The csh one is incorrect in several places,
</span><br>
<span class="quotelev1">&gt; like 1LD_LIBRARY_PATH (comming from the missing backslash in  
</span><br>
<span class="quotelev1">&gt; openmpi.spec),
</span><br>
<span class="quotelev1">&gt; and the whole logic of csh seems to be incorrect as well (e.g. nothing
</span><br>
<span class="quotelev1">&gt; happens if LD_LIBRARY_PATH
</span><br>
<span class="quotelev1">&gt; is not set in the shell running the rpmbuild process!).
</span><br>
<span class="quotelev1">&gt; By the way, the dependence of the openmpi.spec file of the current
</span><br>
<span class="quotelev1">&gt; contents of the PATH etc. variables
</span><br>
<span class="quotelev1">&gt; is risky (when compiling, installing and uninstalling openmpi rpm
</span><br>
<span class="quotelev1">&gt; several times)
</span><br>
<span class="quotelev1">&gt; and I think that the user should be warned in some way by the  
</span><br>
<span class="quotelev1">&gt; script to
</span><br>
<span class="quotelev1">&gt; remove traces
</span><br>
<span class="quotelev1">&gt; of openmpi related variables from the shell running rpmbuild.
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; I attach a patch to the original 1.2 openmpi.spec file, which  
</span><br>
<span class="quotelev1">&gt; should fix
</span><br>
<span class="quotelev1">&gt; these problems.
</span><br>
<span class="quotelev1">&gt; I find the possibility of installation of openmpi to /opt/ very useful
</span><br>
<span class="quotelev1">&gt; and I hope that my comments help to improve it.
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; Marcin
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; Details of the rpm generation process:
</span><br>
<span class="quotelev1">&gt; I created the rpm of openmpi-1.2 using the provided buildrpm.sh and
</span><br>
<span class="quotelev1">&gt; openmpi.spec files
</span><br>
<span class="quotelev1">&gt; (I use:
</span><br>
<span class="quotelev1">&gt; RPM version 4.3.3,
</span><br>
<span class="quotelev1">&gt; GNU bash, version 3.00.15(1)-release (i686-redhat-linux-gnu)).
</span><br>
<span class="quotelev1">&gt; Here are my settings from buildrpm.sh script:
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; specfile=&quot;openmpi.spec&quot;
</span><br>
<span class="quotelev1">&gt; rpmbuild_options=&quot;--define 'mflags -j4'&quot;
</span><br>
<span class="quotelev1">&gt; configure_options=&quot;--with-tm=/usr/local FC=pgf90 F77=pgf90 CC=pgcc
</span><br>
<span class="quotelev1">&gt; CXX=pgCC CFLAGS=-Msignextend CXXFLAGS=-Msignextend
</span><br>
<span class="quotelev1">&gt; --with-wrapper-cflags=-Msignextend --with-wrapper-cxxflags=- 
</span><br>
<span class="quotelev1">&gt; Msignextend
</span><br>
<span class="quotelev1">&gt; FFLAGS=-Msignextend FCFLAGS=-Msignextend
</span><br>
<span class="quotelev1">&gt; --with-wrapper-fflags=-Msignextend --with-wrapper-fcflags=- 
</span><br>
<span class="quotelev1">&gt; Msignextend&quot;
</span><br>
<span class="quotelev1">&gt; rpmbuild_options=${rpmbuild_options}&quot; --define 'install_in_opt 1'
</span><br>
<span class="quotelev1">&gt; --define 'install_profile_d_scripts 1' --define 'install_modulefile  
</span><br>
<span class="quotelev1">&gt; 0'&quot;
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; _______________________________________________
</span><br>
<span class="quotelev1">&gt; users mailing list
</span><br>
<span class="quotelev1">&gt; users_at_[hidden]
</span><br>
<span class="quotelev1">&gt; <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a>
</span><br>
<p><p><pre>
-- 
Jeff Squyres
Cisco Systems
</pre>
<!-- body="end" -->
<hr>
<ul class="links">
<!-- next="start" -->
<li><strong>Next message:</strong> <a href="2990.php">Mohamad Chaarawi: "Re: [OMPI users] [Re:  Memory leak in openmpi-1.2?]"</a>
<li><strong>Previous message:</strong> <a href="2988.php">Marcin Dulak: "[OMPI users] problems with profile.d scripts generated using openmpi.spec"</a>
<li><strong>In reply to:</strong> <a href="2988.php">Marcin Dulak: "[OMPI users] problems with profile.d scripts generated using openmpi.spec"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="2999.php">Marcin Dulak: "Re: [OMPI users] problems with profile.d scripts generated using openmpi.spec"</a>
<!-- reply="end" -->
</ul>
<div class="center">
<table border="2" width="100%" class="links">
<tr>
<th><a href="date.php">Date view</a></th>
<th><a href="index.php">Thread view</a></th>
<th><a href="subject.php">Subject view</a></th>
<th><a href="author.php">Author view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<? include("../../include/msg-footer.inc") ?>
