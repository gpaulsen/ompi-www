<? include("../../include/msg-header.inc"); ?>
<!-- received="Tue Apr  3 08:42:35 2007" -->
<!-- isoreceived="20070403124235" -->
<!-- sent="Tue, 03 Apr 2007 14:42:30 +0200" -->
<!-- isosent="20070403124230" -->
<!-- name="Marcin Dulak" -->
<!-- email="Marcin_Dulak_at_[hidden]" -->
<!-- subject="[OMPI users] problems with profile.d scripts generated using openmpi.spec" -->
<!-- id="46124BB6.1080101_at_poczta.onet.pl" -->
<!-- charset="ISO-8859-1" -->
<!-- expires="-1" -->
<div class="center">
<table border="2" width="100%" class="links">
<tr>
<th><a href="date.php">Date view</a></th>
<th><a href="index.php">Thread view</a></th>
<th><a href="subject.php">Subject view</a></th>
<th><a href="author.php">Author view</a></th>
</tr>
</table>
</div>
<p class="headers">
<strong>From:</strong> Marcin Dulak (<em>Marcin_Dulak_at_[hidden]</em>)<br>
<strong>Date:</strong> 2007-04-03 08:42:30
</p>
<ul class="links">
<!-- next="start" -->
<li><strong>Next message:</strong> <a href="2989.php">Jeff Squyres: "Re: [OMPI users] problems with profile.d scripts generated using openmpi.spec"</a>
<li><strong>Previous message:</strong> <a href="2987.php">Bas van der Vlies: "Re: [OMPI users] [Re:  Memory leak in openmpi-1.2?]"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="2989.php">Jeff Squyres: "Re: [OMPI users] problems with profile.d scripts generated using openmpi.spec"</a>
<li><strong>Reply:</strong> <a href="2989.php">Jeff Squyres: "Re: [OMPI users] problems with profile.d scripts generated using openmpi.spec"</a>
<li><strong>Maybe reply:</strong> <a href="2999.php">Marcin Dulak: "Re: [OMPI users] problems with profile.d scripts generated using openmpi.spec"</a>
<!-- reply="end" -->
</ul>
<hr>
<!-- body="start" -->
<p>
Hi,
<br>
<p>I found that the /etc/profile.d/openmpi-1.2.sh and 
<br>
/etc/profile.d/openmpi-1.2.csh generated using openmpi.spec are incorrect.
<br>
The contents of the generated (see the details of the generation process 
<br>
at the very end of my email) scripts is the following:
<br>
-------------------------------------------------------------------------------------------
<br>
/etc/profile.d/openmpi-1.2.sh
<br>
-------------------------------------------------------------------------------------------
<br>
# NOTE: This is an automatically-generated file!  (generated by the
<br>
# Open MPI RPM).  Any changes made here will be lost a) if the RPM is
<br>
# uninstalled, or b) if the RPM is upgraded or uninstalled.
<br>
<p>CHANGED=0
<br>
if test -z &quot;&quot;; then
<br>
&nbsp;&nbsp;&nbsp;&nbsp;PATH=${PATH}:/opt/openmpi/1.2/bin/
<br>
&nbsp;&nbsp;&nbsp;&nbsp;CHANGED=1
<br>
fi
<br>
if test -z &quot;&quot;; then
<br>
&nbsp;&nbsp;&nbsp;&nbsp;LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/opt/openmpi/1.2/lib
<br>
&nbsp;&nbsp;&nbsp;&nbsp;CHANGED=1
<br>
fi
<br>
if test -z &quot;&quot;; then
<br>
&nbsp;&nbsp;&nbsp;&nbsp;MANPATH=${MANPATH}:/opt/openmpi/1.2/man
<br>
&nbsp;&nbsp;&nbsp;&nbsp;CHANGED=1
<br>
fi
<br>
if test &quot;&quot; = &quot;1&quot;; then
<br>
&nbsp;&nbsp;&nbsp;&nbsp;export PATH LD_LIBRARY_PATH MANPATH
<br>
fi
<br>
-------------------------------------------------------------------------------------------
<br>
/etc/profile.d/openmpi-1.2.csh
<br>
-------------------------------------------------------------------------------------------
<br>
# NOTE: This is an automatically-generated file!  (generated by the
<br>
# Open MPI RPM).  Any changes made here will be lost a) if the RPM is
<br>
# uninstalled, or b) if the RPM is upgraded or uninstalled.
<br>
<p>if (&quot;&quot;) then
<br>
&nbsp;&nbsp;&nbsp;&nbsp;setenv PATH ${PATH}:/opt/openmpi/1.2/bin/
<br>
endif
<br>
if (&quot;1LD_LIBRARY_PATH&quot;) then
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (&quot;&quot;) then
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setenv LD_LIBRARY_PATH ${LD_LIBRARY_PATH}:/opt/openmpi/1.2/lib
<br>
&nbsp;&nbsp;&nbsp;&nbsp;endif
<br>
endif
<br>
if (&quot;1MANPATH&quot;) then
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (&quot;&quot;) then
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setenv MANPATH ${MANPATH}:/opt/openmpi/1.2/man
<br>
&nbsp;&nbsp;&nbsp;&nbsp;endif
<br>
endif
<br>
-------------------------------------------------------------------------------------------
<br>
The sh one is incorrect in the line
<br>
if test &quot;&quot; = &quot;1&quot;; then
<br>
which should be
<br>
if test &quot;$CHANGED&quot; = &quot;1&quot;; then
<br>
<p>The csh one is incorrect in several places,
<br>
like 1LD_LIBRARY_PATH (comming from the missing backslash in openmpi.spec),
<br>
and the whole logic of csh seems to be incorrect as well (e.g. nothing 
<br>
happens if LD_LIBRARY_PATH
<br>
is not set in the shell running the rpmbuild process!).
<br>
By the way, the dependence of the openmpi.spec file of the current 
<br>
contents of the PATH etc. variables
<br>
is risky (when compiling, installing and uninstalling openmpi rpm 
<br>
several times)
<br>
and I think that the user should be warned in some way by the script to 
<br>
remove traces
<br>
of openmpi related variables from the shell running rpmbuild.
<br>
<p>I attach a patch to the original 1.2 openmpi.spec file, which should fix 
<br>
these problems.
<br>
I find the possibility of installation of openmpi to /opt/ very useful
<br>
and I hope that my comments help to improve it.
<br>
<p>Marcin
<br>
<p><p><p>Details of the rpm generation process:
<br>
I created the rpm of openmpi-1.2 using the provided buildrpm.sh and 
<br>
openmpi.spec files
<br>
(I use:
<br>
RPM version 4.3.3,
<br>
GNU bash, version 3.00.15(1)-release (i686-redhat-linux-gnu)).
<br>
Here are my settings from buildrpm.sh script:
<br>
<p>specfile=&quot;openmpi.spec&quot;
<br>
rpmbuild_options=&quot;--define 'mflags -j4'&quot;
<br>
configure_options=&quot;--with-tm=/usr/local FC=pgf90 F77=pgf90 CC=pgcc 
<br>
CXX=pgCC CFLAGS=-Msignextend CXXFLAGS=-Msignextend 
<br>
--with-wrapper-cflags=-Msignextend --with-wrapper-cxxflags=-Msignextend 
<br>
FFLAGS=-Msignextend FCFLAGS=-Msignextend 
<br>
--with-wrapper-fflags=-Msignextend --with-wrapper-fcflags=-Msignextend&quot;
<br>
rpmbuild_options=${rpmbuild_options}&quot; --define 'install_in_opt 1' 
<br>
--define 'install_profile_d_scripts 1' --define 'install_modulefile 0'&quot;
<br>
<!-- body="end" -->
<hr>
<ul class="links">
<!-- next="start" -->
<li><strong>Next message:</strong> <a href="2989.php">Jeff Squyres: "Re: [OMPI users] problems with profile.d scripts generated using openmpi.spec"</a>
<li><strong>Previous message:</strong> <a href="2987.php">Bas van der Vlies: "Re: [OMPI users] [Re:  Memory leak in openmpi-1.2?]"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="2989.php">Jeff Squyres: "Re: [OMPI users] problems with profile.d scripts generated using openmpi.spec"</a>
<li><strong>Reply:</strong> <a href="2989.php">Jeff Squyres: "Re: [OMPI users] problems with profile.d scripts generated using openmpi.spec"</a>
<li><strong>Maybe reply:</strong> <a href="2999.php">Marcin Dulak: "Re: [OMPI users] problems with profile.d scripts generated using openmpi.spec"</a>
<!-- reply="end" -->
</ul>
<div class="center">
<table border="2" width="100%" class="links">
<tr>
<th><a href="date.php">Date view</a></th>
<th><a href="index.php">Thread view</a></th>
<th><a href="subject.php">Subject view</a></th>
<th><a href="author.php">Author view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<? include("../../include/msg-footer.inc") ?>
