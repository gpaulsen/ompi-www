<html><body>
<p>So your tests show:<br>
1.  &quot;Shared library in FORTRAN   +   MPI executable in FORTRAN&quot; works.<br>
2. &quot;Shared library in C++   + MPI executable in FORTRAN &quot; does not work.<br>
<br>
It seems to me that the symbols in  C library are not really recognized by  FORTRAN executable as you thought.    What compilers  did yo use to built OpenMPI?<br>
<br>
 Different compiler has different convention to handle symbols.   E.g.  if there is a variable &quot;var_foo&quot;  in your FORTRAN code,  some FORTRN compiler will save &quot;var_foo_&quot;  in the object file by default;  if you want to access &quot;var_foo&quot;  in C code, you actually need to refer &quot;var_foo_&quot;  in C code.     If you define &quot;var_foo&quot; in a module in the FORTAN compiler,  some FORTRAN compiler may append the module name to &quot;var_foo&quot;. <br>
So I suggest to check the symbols in the object files generated by your FORTAN and C compiler to see the difference.<br>
<br>
Mi<br>
<img width="16" height="16" src="cid:1__=0ABBFE67DFEAB8B88f9e8a93df938@us.ibm.com" border="0" alt="Inactive hide details for &quot;Rajesh Ramaya&quot; &lt;rajesh.ramaya@e-xstream.com&gt;">&quot;Rajesh Ramaya&quot; &lt;rajesh.ramaya@e-xstream.com&gt;<br>
<br>
<br>

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr valign="top"><td style="background-image:url(cid:2__=0ABBFE67DFEAB8B88f9e8a93df938@us.ibm.com); background-repeat: no-repeat; " width="40%">
<ul>
<ul>
<ul>
<ul><b><font size="2">&quot;Rajesh Ramaya&quot; &lt;rajesh.ramaya@e-xstream.com&gt;</font></b><font size="2"> </font><br>
<font size="2">Sent by: users-bounces@open-mpi.org</font>
<p><font size="2">10/31/2008 03:07 PM</font>
<table border="1">
<tr valign="top"><td width="168" bgcolor="#FFFFFF"><div align="center"><font size="2">Please respond to<br>
Open MPI Users &lt;users@open-mpi.org&gt;</font></div></td></tr>
</table>
</ul>
</ul>
</ul>
</ul>
</td><td width="60%">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr valign="top"><td width="1%"><img width="58" height="1" src="cid:3__=0ABBFE67DFEAB8B88f9e8a93df938@us.ibm.com" border="0" alt=""><br>
<div align="right"><font size="2">To</font></div></td><td width="100%"><img width="1" height="1" src="cid:3__=0ABBFE67DFEAB8B88f9e8a93df938@us.ibm.com" border="0" alt=""><br>
<font size="2">&quot;'Open MPI Users'&quot; &lt;users@open-mpi.org&gt;, &quot;'Jeff Squyres'&quot; &lt;jsquyres@cisco.com&gt;</font></td></tr>

<tr valign="top"><td width="1%"><img width="58" height="1" src="cid:3__=0ABBFE67DFEAB8B88f9e8a93df938@us.ibm.com" border="0" alt=""><br>
<div align="right"><font size="2">cc</font></div></td><td width="100%"><img width="1" height="1" src="cid:3__=0ABBFE67DFEAB8B88f9e8a93df938@us.ibm.com" border="0" alt=""><br>
</td></tr>

<tr valign="top"><td width="1%"><img width="58" height="1" src="cid:3__=0ABBFE67DFEAB8B88f9e8a93df938@us.ibm.com" border="0" alt=""><br>
<div align="right"><font size="2">Subject</font></div></td><td width="100%"><img width="1" height="1" src="cid:3__=0ABBFE67DFEAB8B88f9e8a93df938@us.ibm.com" border="0" alt=""><br>
<font size="2">Re: [OMPI users] MPI + Mixed language coding(Fortran90 + C++)</font></td></tr>
</table>

<table border="0" cellspacing="0" cellpadding="0">
<tr valign="top"><td width="58"><img width="1" height="1" src="cid:3__=0ABBFE67DFEAB8B88f9e8a93df938@us.ibm.com" border="0" alt=""></td><td width="336"><img width="1" height="1" src="cid:3__=0ABBFE67DFEAB8B88f9e8a93df938@us.ibm.com" border="0" alt=""></td></tr>
</table>
</td></tr>
</table>
<br>
<tt>Hello Jeff Squyres,<br>
 &nbsp; Thank you very much for the immediate reply. I am able to successfully<br>
access the data from the common block but the values are zero. In my<br>
algorithm I even update a common block but the update made by the shared<br>
library is not taken in to account by the executable. Can you please be very<br>
specific how to make the parallel algorithm aware of the data? Actually I am<br>
not writing any MPI code inside? It's the executable (third party software)<br>
who does that part. All that I am doing is to compile my code with MPI c<br>
compiler and add it in the LD_LIBIRARY_PATH. <br>
In fact I did a simple test by creating a shared library using a FORTRAN<br>
code and the update made to the common block is taken in to account by the<br>
executable. Is there any flag or pragma that need to be activated for mixed<br>
language MPI?<br>
Thank you once again for the reply.<br>
<br>
Rajesh &nbsp; <br>
<br>
-----Original Message-----<br>
From: users-bounces@open-mpi.org [<a href="mailto:users-bounces@open-mpi.org">mailto:users-bounces@open-mpi.org</a>] On<br>
Behalf Of Jeff Squyres<br>
Sent: vendredi 31 octobre 2008 18:53<br>
To: Open MPI Users<br>
Subject: Re: [OMPI users] MPI + Mixed language coding(Fortran90 + C++)<br>
<br>
On Oct 31, 2008, at 11:57 AM, Rajesh Ramaya wrote:<br>
<br>
&gt; &nbsp; &nbsp; I am completely new to MPI. I have a basic question concerning &nbsp;<br>
&gt; MPI and mixed language coding. I hope any of you could help me out. &nbsp;<br>
&gt; Is it possible to access FORTRAN common blocks in C++ in a MPI &nbsp;<br>
&gt; compiled code. It works without MPI but as soon I switch to MPI the &nbsp;<br>
&gt; access of common block does not work anymore.<br>
&gt; I have a Linux MPI executable which loads a shared library at &nbsp;<br>
&gt; runtime and resolves all undefined symbols etc &nbsp;The shared library &nbsp;<br>
&gt; is written in C++ and the MPI executable in written in FORTRAN. Some &nbsp;<br>
&gt; of the input that the shared library looking for are in the Fortran &nbsp;<br>
&gt; common blocks. As I access those common blocks during runtime the &nbsp;<br>
&gt; values are not &nbsp;initialized. &nbsp;I would like to know if what I am &nbsp;<br>
&gt; doing is possible ?I hope that my problem is clear......<br>
<br>
<br>
Generally, MPI should not get in the way of sharing common blocks &nbsp;<br>
between Fortran and C/C++. &nbsp;Indeed, in Open MPI itself, we share a few &nbsp;<br>
common blocks between Fortran and the main C Open MPI implementation.<br>
<br>
What is the exact symptom that you are seeing? &nbsp;Is the application &nbsp;<br>
failing to resolve symbols at run-time, possibly indicating that &nbsp;<br>
something hasn't instantiated a common block? &nbsp;Or are you able to &nbsp;<br>
successfully access the data from the common block, but it doesn't &nbsp;<br>
have the values you expect (e.g., perhaps you're seeing all zeros)?<br>
<br>
If the former, you might want to check your build procedure. &nbsp;You &nbsp;<br>
*should* be able to simply replace your C++ / F90 compilers with &nbsp;<br>
mpicxx and mpif90, respectively, and be able to build an MPI version &nbsp;<br>
of your app. &nbsp;If the latter, you might need to make your parallel &nbsp;<br>
algorithm aware of what data is available in which MPI process -- &nbsp;<br>
perhaps not all the data is filled in on each MPI process...?<br>
<br>
-- <br>
Jeff Squyres<br>
Cisco Systems<br>
<br>
<br>
_______________________________________________<br>
users mailing list<br>
users@open-mpi.org<br>
</tt><tt><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a></tt><tt><br>
<br>
_______________________________________________<br>
users mailing list<br>
users@open-mpi.org<br>
</tt><tt><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a></tt><tt><br>
</tt><br>
</body></html>

