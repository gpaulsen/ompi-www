<html><head><meta http-equiv="Content-Type" content="text/html charset=us-ascii"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><br><div><div>On Mar 17, 2014, at 9:37 AM, Gus Correa &lt;<a href="mailto:gus@ldeo.columbia.edu">gus@ldeo.columbia.edu</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div style="font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">On 03/17/2014 10:52 AM, Jeff Squyres (jsquyres) wrote:<br><blockquote type="cite">To add on to what Ralph said:<br><br>1. There are two different message passing paths in OMPI:<br>&nbsp;&nbsp;&nbsp;- "OOB" (out of band): used for control messages<br>&nbsp;&nbsp;&nbsp;- "BTL" (byte transfer layer): used for MPI traffic<br>&nbsp;&nbsp;&nbsp;(there are actually others, but these seem to be the relevant 2 for your setup)<br><br>2. If you don't specify which OOB interfaces<br></blockquote>to use OMPI will (basically) just pick one.<br>It doesn't really matter which one it uses;<br>the OOB channel doesn't use too much bandwidth,<br>and is mostly just during startup and shutdown.<br><blockquote type="cite"><br>The one exception to this is stdout/stderr routing.<br></blockquote>If your MPI app writes to stdout/stderr, this also uses the OOB path.<br>So if you output a LOT to stdout, then the OOB interface choice might matter.<br><br>Hi All<br><br>Not trying to hijack Jianyu's very interesting and informative questions and thread, I have two questions and one note about it.<br>I promise to shut up after this.<br><br>Is the interface that OOB picks and uses<br>somehow related to how the hosts/nodes names listed<br>in a "hostfile"<br>(or in the mpiexec command -host option,<br>or in the Torque/SGE/Slurm node file,)<br>are resolved into IP addresses (via /etc/hosts, DNS or other mechanism)?<br><br>In other words, does OOB pick the interface associated to the IP address<br>that resolves the specific node name, or does OOB have its own will and<br>picks whatever interface it wants?<br></div></blockquote><div><br></div>The OOB on each node gets the list of available interfaces from the kernel on that node. When it needs to talk to someone on a remote node, it uses the standard mechanisms to resolve that node name to an IP address *if* it already isn't one - i.e., it checks the provided info to see if it is an IP address, and attempts to resolve the name if not.</div><div><br></div><div>Once it has an IP address for the remote host, it checks its interfaces to see if one is on the same subnet as the remote IP. If so, then it uses that interface to create the connection. If none of the interfaces share the same subnet as the remote IP, then the OOB picks the first kernel-ordered interface and attempts to connect via that one, in the hope that there is a router in the system capable of passing the connection to the remote subnet. The OOB will cycle across all its interfaces in that manner until one indicates that it was indeed able to connect - if not, then we error out.</div><div><br><blockquote type="cite"><div style="font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br>At some early point during startup I suppose mpiexec<br>needs to touch base first time with each node,<br>and I would guess the nodes' IP address<br>(and the corresponding interface) plays a role then.<br>Does OOB piggy-back that same interface to do its job?<br></div></blockquote><div><br></div>Yes - once we establish that connection, we use it for whatever OOB communication is required.</div><div><br><blockquote type="cite"><div style="font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br><blockquote type="cite"><br>3. If you don't specify which MPI interfaces to use, OMPI will basically find the<br></blockquote>"best" set of interfaces and use those. &nbsp;IP interfaces are always rated less than<br>OS-bypass interfaces (e.g., verbs/IB).<br><br><br>In a node outfitted with more than one Inifinband interface,<br>can one choose which one OMPI is going to use (say, if one wants to<br>reserve the other IB interface for IO)?<br><br>In other words, are there verbs/rdma syntax equivalent to<br><br>--mca btl_tcp_if_include<br><br>and to<br><br>--mca oob_tcp_if_include &nbsp;?<br><br>[Perhaps something like --mca btl_openib_if_include ...?]<br></div></blockquote><div><br></div>Yes - exactly as you describe</div><div><br><blockquote type="cite"><div style="font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br>Forgive me if this question doesn't make sense,<br>for maybe on its guts verbs/rdma already has a greedy policy of using everything available, but I don't know anything about it.<br><br><blockquote type="cite"><br>Or, as you noticed, you can give a comma-delimited list of BTLs to use.<br></blockquote>OMPI will then use -- at most -- exactly those BTLs, but definitely no others.<br>Each BTL typically has an additional parameter or parameters that can be used<br>to specify which interfaces to use for the network interface type that that BTL uses.<br>For example, btl_tcp_if_include tells the TCP BTL which interface(s) to use.<br><blockquote type="cite"><br>Also, note that you seem to have missed a BTL: sm (shared memory).<br></blockquote>sm is the preferred BTL to use for same-server communication.<br><br>This may be because several FAQs skip the sm BTL, even when it would<br>be an appropriate/recommended choice to include in the BTL list.<br>For instance:<br><br><a href="http://www.open-mpi.org/faq/?category=all#selecting-components">http://www.open-mpi.org/faq/?category=all#selecting-components</a><br><a href="http://www.open-mpi.org/faq/?category=all#tcp-selection">http://www.open-mpi.org/faq/?category=all#tcp-selection</a><br><br>The command line examples with an ellipsis "..." don't actually e<br>xclude the use of "sm", but IMHO are too vague and somewhat misleading.<br><br>I think this issue was reported/discussed before in the list,<br>but somehow the FAQ were not fixed.<br></div></blockquote><div><br></div>I can try to do something about it - largely a question of time :-/</div><div><br><blockquote type="cite"><div style="font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br>Thank you,<br>Gus Correa<br><br>It is much faster than both the TCP loopback device<br>(which OMPI excludes by default, BTW, which is probably<br>why you got reachability errors when you specifying<br>"--mca btl tcp,self") and the verbs (i.e., "openib")<br>BTL for same-server communication.<br><blockquote type="cite"><br>4. If you don't specify anything, OMPI usually picks the best thing for you.<br></blockquote>In your case, it'll probably be equivalent to:<br><blockquote type="cite"><br>&nbsp;mpirun --mca btl openib,sm,self ...<br><br>And the control messages will flow across one of your IP interfaces.<br><br>5. If you want to be specific about which one it uses,<br></blockquote>you can specify oob_tcp_if_include. &nbsp;For example:<br><blockquote type="cite"><br>&nbsp;&nbsp;mpirun --mca oob_tcp_if_include eth0 ...<br><br>Make sense?<br><br><br><br>On Mar 15, 2014, at 1:18 AM, Jianyu Liu &lt;<a href="mailto:jerry_leo@msn.com">jerry_leo@msn.com</a>&gt; wrote:<br><br><blockquote type="cite"><blockquote type="cite">On Mar 14, 2014, at 10:16:34 AM,Jeff Squyres &lt;jsquyres_at_[hidden]&gt; wrote:<br><br><blockquote type="cite">On Mar 14, 2014, at 10:11 AM, Ralph Castain &lt;rhc_at_[hidden]&gt; wrote:<br><br><blockquote type="cite">1. If specified '--mca btl tcp,self', which interface application will run on, use GigE adaper OR use the OpenFabrics interface in IP over IB mode (just like a high performance GigE adapter) ?<br></blockquote><br>Both - ip over ib looks just like an Ethernet adaptor<br></blockquote><br><br>To be clear: the TCP BTL will use all TCP interfaces (regardless of underlying physical transport). Your GigE adapter and your IP adapter both present IP interfaces to&gt;the OS, and both support TCP. So the TCP BTL will use them, because it just sees the TCP/IP interfaces.<br></blockquote><br>Thanks for your kindly input.<br><br>Please see if I have understood correctly<br><br>Assume there are two nework<br>&nbsp;&nbsp;Gigabit Ethernet<br><br>&nbsp;&nbsp;&nbsp;&nbsp;eth0-renamed : 192.168.[1-22].[1-14] / 255.255.192.0<br><br>&nbsp;&nbsp;InfiniBand network<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ib0 : &nbsp;172.20.[1-22].[1-4] / 255.255.0.0<br><br><br>1. If specified '--mca btl tcp,self<br><br>&nbsp;&nbsp;&nbsp;&nbsp;The control information ( such as setup and teardown ) are routed to and passed by Gigabit Ethernet in TCP/IP mode<br>&nbsp;&nbsp;&nbsp;&nbsp;The MPI messages are routed to and passed by InfiniBand network in IP over IB mode<br>&nbsp;&nbsp;&nbsp;&nbsp;On the same machine, the TCP lookback device will be used for passing control and MPI messages<br><br>2. If specified '--mca btl tcp,self --mca btl_tcp_if_include ib0'<br><br>&nbsp;&nbsp;&nbsp;&nbsp;Both of control information ( such as setup and teardown ) and MPI messages are routed to and passed by InfiniBand network in IP over IB mode<br>&nbsp;&nbsp;&nbsp;&nbsp;On the same machine, The TCP lookback device will be used for passing control and MPI messages<br><br><br>3. If specified '--mca btl openib,self'<br><br>&nbsp;&nbsp;&nbsp;&nbsp;The control information ( such as setup and teardown ) are routed to and passed by InfiniBand network in IP over IB mode<br>&nbsp;&nbsp;&nbsp;&nbsp;The MPI messages are routed to and passed by InfiniBand network in RDMA mode<br>&nbsp;&nbsp;&nbsp;&nbsp;On the same machine, the TCP lookback device will be used for passing control and MPI messages<br><br><br>4. If without specifiying any 'mca btl' parameters<br><br>&nbsp;&nbsp;&nbsp;&nbsp;The control information ( such as setup and teardown ) are routed to and passed by Gigabit Ethernet in TCP/IP mode<br>&nbsp;&nbsp;&nbsp;&nbsp;The MPI messages are routed and passed by InfiniBand network in RDMA mode<br>&nbsp;&nbsp;&nbsp;&nbsp;On the same machine, the shared memory (sm) BTL will be used for control and MPI passing messages<br><br><br>Appreciating your kindly input<br><br>Jianyu<span class="Apple-converted-space">&nbsp;</span><span class="Apple-tab-span" style="white-space: pre;">	</span><span class="Apple-tab-span" style="white-space: pre;">	</span><span class="Apple-converted-space">&nbsp;</span><span class="Apple-tab-span" style="white-space: pre;">	</span><span class="Apple-converted-space">&nbsp;</span>&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;">	</span><span class="Apple-tab-span" style="white-space: pre;">	</span><br>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>http://www.open-mpi.org/mailman/listinfo.cgi/users<br></blockquote><br><br></blockquote><br>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>http://www.open-mpi.org/mailman/listinfo.cgi/users</div></blockquote></div><br></body></html>
