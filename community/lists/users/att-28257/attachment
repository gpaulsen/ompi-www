<div dir="ltr"><div class="gmail_default" style="font-family:&#39;comic sans ms&#39;,sans-serif;color:rgb(56,118,29)">Maybe the example is too simple.  Here is another one which</div><div class="gmail_default" style="font-family:&#39;comic sans ms&#39;,sans-serif;color:rgb(56,118,29)">when run on two tasks sends two integers from each task to</div><div class="gmail_default" style="font-family:&#39;comic sans ms&#39;,sans-serif;color:rgb(56,118,29)">task 0.   Task 1 receives nothing.  This works with mpich and impi</div><div class="gmail_default" style="font-family:&#39;comic sans ms&#39;,sans-serif;color:rgb(56,118,29)">but fails with openmpi.  </div><div class="gmail_default" style="font-family:&#39;comic sans ms&#39;,sans-serif;color:rgb(56,118,29)"><br></div><div class="gmail_default" style=""><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">#include &lt;stdio.h&gt;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">#include &lt;mpi.h&gt;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif"><br></font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif"> my_mpi_test(int rank, int ntasks)</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">{</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  MPI_Datatype stype, rtype;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  int sbuf[2];</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  int rbuf[4];</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif"><br></font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  int slen[ntasks], sdisp[ntasks], stypes[ntasks], rlen[ntasks], rdisp[ntasks], rtypes[ntasks];</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  sbuf[0]=rank;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  sbuf[1]=ntasks+rank;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  slen[0]=2;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  slen[1]=0;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  stypes[0]=MPI_INT;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  stypes[1]=MPI_DATATYPE_NULL;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  sdisp[0]=0;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  sdisp[1]=4;  </font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  if(rank==0){</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">    rlen[0]=2;<span class="" style="white-space:pre">	</span></font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">    rlen[1]=2;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">    rtypes[0]=MPI_INT;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">    rtypes[1]=MPI_INT;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">    rdisp[0]=0;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">    rdisp[1]=8;  <span class="" style="white-space:pre">	</span></font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">    <span class="" style="white-space:pre">	</span></font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  }else{</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">    rlen[0]=0;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">    rlen[1]=0;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">    rtypes[0]=MPI_DATATYPE_NULL;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">    rtypes[1]=MPI_DATATYPE_NULL;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">    rdisp[0]=0;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">    rdisp[1]=0;</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  }</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif"><br></font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  MPI_Alltoallw(sbuf, slen, sdisp, stypes, rbuf, rlen, rdisp, rtypes, MPI_COMM_WORLD);</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  if(rank==0){</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">    printf(&quot;%d %d %d %d\n&quot;,rbuf[0],rbuf[1],rbuf[2],rbuf[3]);</font></div><div class="gmail_default" style=""><font color="#38761d" face="comic sans ms, sans-serif">  }</font></div><div style="color:rgb(56,118,29);font-family:&#39;comic sans ms&#39;,sans-serif"><br></div></div><div class="gmail_extra"><div class="gmail_extra">int main(int argc, char **argv)</div><div class="gmail_extra">{</div><div class="gmail_extra">  int rank, ntasks;</div><div class="gmail_extra">  </div><div class="gmail_extra">  MPI_Init(&amp;argc, &amp;argv);</div><div class="gmail_extra"><br></div><div class="gmail_extra">  MPI_Comm_rank(MPI_COMM_WORLD,&amp;rank);</div><div class="gmail_extra">  MPI_Comm_size(MPI_COMM_WORLD, &amp;ntasks);</div><div class="gmail_extra"><span class="" style="white-space:pre">	</span>   </div><div class="gmail_extra">  printf(&quot;rank %d ntasks %d\n&quot;,rank, ntasks);</div><div class="gmail_extra"><br></div><div class="gmail_extra">  my_mpi_test(rank,ntasks);</div><div class="gmail_extra"><br></div><div class="gmail_extra"><br></div><div class="gmail_extra">  MPI_Finalize();</div><div class="gmail_extra">}</div><div><br></div></div><div class="gmail_extra"><br></div><div class="gmail_extra"><br></div></div>

