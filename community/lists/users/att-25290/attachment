<html><head><meta http-equiv="Content-Type" content="text/html charset=us-ascii"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><br><div><div>On Sep 6, 2014, at 7:52 AM, Allin Cottrell &lt;<a href="mailto:cottrell@wfu.edu">cottrell@wfu.edu</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite">On Fri, 5 Sep 2014, Ralph Castain wrote:<br><br><blockquote type="cite">On Sep 5, 2014, at 3:34 PM, Allin Cottrell &lt;<a href="mailto:cottrell@wfu.edu">cottrell@wfu.edu</a>&gt; wrote:<br><br><blockquote type="cite">I suspect there is a new (to openmpi 1.8.N?) warning with respect to requesting a number of MPI processes greater than the number of "real" cores on a given machine. I can provide a good deal more information is that's required, but can I just pose it as a question for now? Does anyone know of a a relevant change in the code?<br><br>The reason I'm asking is that I've been experimenting, on a couple of machines and with more than one computational problem, to see if I'm better off restricting the number of MPI processes to the number of "real" or "physical" cores available, or if it's better to allow a larger number of processes up to the number of hyperthreads available (which is twice the number of cores on the machines I'm working on).<br></blockquote><br>If you are going to treat hyperthreads as independent processors, then you should probably set the --use-hwthreads-as-cpus flag so OMPI knows to treat it that way<br></blockquote><br>Hmm, where would I set that? (For reference) mpiexec --version gives<br><br>mpiexec (OpenRTE) 1.8.2<br><br>and if I append --use-hwthreads-as-cpus to my mpiexec command I get<br><br>mpiexec: Error: unknown option "--use-hwthreads-as-cpus"<br><br>However, via trial and error I've found that these options work: either<br><br>--map-by hwthread OR<br>--oversubscribe (not mentioned in the mpiexec man page)<br></blockquote><div><br></div>My apologies - the correct spelling is &nbsp;<span style="background-color: rgb(254, 244, 156); font-family: Menlo; font-size: 11px;">--use-hwthread-cpus</span></div><div><font face="Menlo"><span style="font-size: 11px; background-color: rgb(254, 244, 156);"><br></span></font><blockquote type="cite"><br>What's puzzling me, though, is that the use of these flags was not necessary when, earlier this year, I was running ompi 1.6.5. Neither is it necessary when running ompi 1.7.3 on a different machine. The warning that's printed without these flags seems to be new.<br></blockquote><div><br></div>The binding code changed during the course of the 1.7 series to provide more fine-controlled options</div><div><br><blockquote type="cite"><br><blockquote type="cite"><blockquote type="cite">It seems to me that openmpi &gt;= 1.8 is giving me a (somewhat obscure and non-user friendly) warning whenever I specify to mpiexec a number of processes &gt; the number of "real" cores [...]<br></blockquote><br>Could you pass along the warning? It should only give you a warning if the #procs &gt; #slots as you are then oversubscribed. You can turn that warning off by just add the oversubscribe flag to your mapping directive<br></blockquote><br>Here's what I'm seeing:<br><br>&lt;quote&gt;<br>A request was made to bind to that would result in binding more<br>processes than cpus on a resource:<br><br> &nbsp;&nbsp;Bind to: &nbsp;&nbsp;&nbsp;&nbsp;CORE<br> &nbsp;&nbsp;Node: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;waverley<br> &nbsp;&nbsp;#processes: &nbsp;2<br> &nbsp;&nbsp;#cpus: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1<br><br>You can override this protection by adding the "overload-allowed"<br>option to your binding directive.<br>&lt;/quote&gt;<br><br>The machine in question has two cores and four threads. The thing that's confusing here is that I'm not aware of supplying any "binding directive": my command line (for running on a single host) is just this:<br><br>mpiexec -np &lt;N&gt; &lt;myprogram&gt; &lt;myprogram-data&gt;<br><br>In fact it seems that current ompi "does the right thing" in respect of the division of labor even without the extra flags: depending on the nature of computation, I can get faster times with -np 4 than with -np 2 (and not degradation). It just insists on printing this warning which I'd like to be able to turn off "globally" if possible.<br></blockquote><div><br></div>You shouldn't be getting that warning if you aren't specifying a binding option, so it looks like a bug to me. I'll check and see what's going on. You might want to check, however, that you don't have a binding directive hidden in your environment or default MCA param file.</div><div><br></div><div>Meantime, just use the oversubscribe or overload-allowed options to turn it off. You can put those in the default MCA param file if you don't want to add it to the environment or cmd line. The MCA params would be:</div><div><br></div><div>OMPI_MCA_rmaps_base_oversubscribe=1</div><div><br></div><div>If you want to bind the procs to cores, but allow two procs to share the core (each will be bound to both hyperthreads):</div><div>OMPI_MCA_hwloc_base_binding_policy=core:overload</div><div><br></div><div>If you want to bind the procs to the hyperthreads (since one proc will be bound to a hypterthread, no overloading will occur):</div><div><div>OMPI_MCA_hwloc_base_use_hwthreads_as_cpus=1</div><div>OMPI_MCA_hwloc_base_binding_policy=hwthread</div><div><br></div><div>HTH</div><div>Ralph</div><div><br></div><blockquote type="cite"><br>Allin Cottrell<br>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>Subscription: http://www.open-mpi.org/mailman/listinfo.cgi/users<br>Link to this post: http://www.open-mpi.org/community/lists/users/2014/09/25288.php<br></blockquote></div><br></body></html>
