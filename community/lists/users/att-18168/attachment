<html><body><div style="color:#000; background-color:#fff; font-family:verdana, helvetica, sans-serif;font-size:12pt"><div><span>Hello Andre,</span></div><div><br><span></span></div><div><span>It may be possible that your openmpi does not support threaded MPI-calls (if these are happening). I had a similar problem, and it was traced to this cause. If you installed your openmpi from available repositories, chances are that you do not have thread-support.</span></div><div><br><span></span></div><div><span>Here's a small script that you can use to determine whether or not you have thread support:</span></div><div style="color: rgb(0, 96, 191);"><br><span></span></div><div style="color: rgb(0, 96, 191);">#include &lt;mpi.h&gt;</div><div style="color: rgb(0, 96, 191);">#include &lt;iostream&gt;<br><span></span></div><div><span><span style="color: rgb(0, 96, 191);">int main(int argc, char **argv)</span><br style="color: rgb(0, 96, 191);"><span style="color:
 rgb(0, 96, 191);">{</span><br style="color: rgb(0, 96, 191);"><span style="color: rgb(0, 96, 191);">&nbsp; int myrank;</span><br style="color: rgb(0, 96, 191);"><span style="color: rgb(0, 96, 191);">&nbsp; int desired_thread_support = MPI_THREAD_MULTIPLE;</span><br style="color: rgb(0, 96, 191);"><span style="color: rgb(0, 96, 191);">&nbsp; int provided_thread_support;</span><br style="color: rgb(0, 96, 191);"><br style="color: rgb(0, 96, 191);"><span style="color: rgb(0, 96, 191);">&nbsp; MPI_Init_thread(&amp;argc, &amp;argv, desired_thread_support, &amp;provided_thread_support);</span><br style="color: rgb(0, 96, 191);"><br style="color: rgb(0, 96, 191);"><span style="color: rgb(0, 96, 191);">&nbsp; /* check if the thread support has been provided */</span><br style="color: rgb(0, 96, 191);"><span style="color: rgb(0, 96, 191);">&nbsp; if (provided_thread_support!=desired_thread_support)</span><br style="color: rgb(0, 96, 191);"><span style="color:
 rgb(0, 96, 191);">&nbsp;&nbsp;&nbsp; {</span><br style="color: rgb(0, 96, 191);"><span style="color: rgb(0, 96, 191);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; "MPI thread support not available! Aborted. " &lt;&lt; std::endl;</span><br style="color: rgb(0, 96, 191);"><span style="color: rgb(0, 96, 191);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exit(-1);</span><br style="color: rgb(0, 96, 191);"><span style="color: rgb(0, 96, 191);">&nbsp;&nbsp;&nbsp; }</span><br style="color: rgb(0, 96, 191);"><span style="color: rgb(0, 96, 191);">&nbsp; MPI_Finalize();</span><br style="color: rgb(0, 96, 191);"><span style="color: rgb(0, 96, 191);">&nbsp; return 0;</span><br style="color: rgb(0, 96, 191);"><span style="color: rgb(0, 96, 191);">}</span><br></span></div><div><br><span></span></div><div><span>Compile and build as usual, using multiple processors.<br></span></div><div><br><span></span></div><div><span>Maybe this helps. If you do discover that you do not
 have support available, you will need to rebuild MPI with <span style="color: rgb(0, 0, 191);">--enable-mpi-threads=yes</span> flag.</span></div><div><br><span></span></div><div><span>HTH.</span></div><div><br><span></span></div><div><br><span></span></div><div><span>Devendra<br></span></div><div><br></div>  <div style="font-family: verdana, helvetica, sans-serif; font-size: 12pt;"> <div style="font-family: times new roman, new york, times, serif; font-size: 12pt;"> <div dir="ltr"> <font face="Arial" size="2"> <hr size="1">  <b><span style="font-weight:bold;">From:</span></b> "Theiner, Andre" &lt;andre.theiner@hp.com&gt;<br> <b><span style="font-weight: bold;">To:</span></b> "users@open-mpi.org" &lt;users@open-mpi.org&gt; <br> <b><span style="font-weight: bold;">Sent:</span></b> Monday, 16 January 2012, 11:55<br> <b><span style="font-weight: bold;">Subject:</span></b> [OMPI users] mpirun hangs when used on more than 2 CPUs<br> </font> </div> <br><div
 id="yiv290640733"><style><!--
#yiv290640733  
 _filtered #yiv290640733 {font-family:"Cambria Math";panose-1:2 4 5 3 5 4 6 3 2 4;}
 _filtered #yiv290640733 {font-family:Calibri;panose-1:2 15 5 2 2 2 4 3 2 4;}
 _filtered #yiv290640733 {font-family:"Futura Bk";panose-1:2 11 5 2 2 2 4 2 3 3;}
#yiv290640733  
#yiv290640733 p.yiv290640733MsoNormal, #yiv290640733 li.yiv290640733MsoNormal, #yiv290640733 div.yiv290640733MsoNormal
	{margin:0cm;margin-bottom:.0001pt;font-size:11.0pt;font-family:"sans-serif";}
#yiv290640733 a:link, #yiv290640733 span.yiv290640733MsoHyperlink
	{color:blue;text-decoration:underline;}
#yiv290640733 a:visited, #yiv290640733 span.yiv290640733MsoHyperlinkFollowed
	{color:purple;text-decoration:underline;}
#yiv290640733 span.yiv290640733EmailStyle17
	{font-family:"sans-serif";color:windowtext;}
#yiv290640733 .yiv290640733MsoChpDefault
	{}
 _filtered #yiv290640733 {margin:72.0pt 72.0pt 72.0pt 72.0pt;}
#yiv290640733 div.yiv290640733WordSection1
	{}
--></style><div><div class="yiv290640733WordSection1"><div class="yiv290640733MsoNormal"><span style="font-family:&quot;sans-serif&quot;;">&nbsp;</span></div><div class="yiv290640733MsoNormal"><span style="font-family:&quot;sans-serif&quot;;">Hi everyone,</span></div><div class="yiv290640733MsoNormal"><span style="font-family:&quot;sans-serif&quot;;">may I have your help on a strange problem?</span></div><div class="yiv290640733MsoNormal"><span style="font-family:&quot;sans-serif&quot;;">High performance computing is new to me and I have not much idea about OpenMPI and OpenFoam (OF) which uses the “mpirun” command.</span></div><div class="yiv290640733MsoNormal"><span style="font-family:&quot;sans-serif&quot;;">I have to support the OF application in my company and have been trying to find the problem since about 1 week.</span></div><div class="yiv290640733MsoNormal"><span style="font-family:&quot;sans-serif&quot;;">The versions are openmpi-1.3.2 and
 OF 2.0.1 which are running on openSUSE 11.3 x86_64.</span></div><div class="yiv290640733MsoNormal"><span style="font-family:&quot;sans-serif&quot;;">The computer is brand new, has 96 GB RAM, 12 CPUs and was installed with Linux some weeks ago.</span></div><div class="yiv290640733MsoNormal"><span style="font-family:&quot;sans-serif&quot;;">I installed OF 2.0.1 according to the vendors instructions at <a rel="nofollow" target="_blank" href="http://www.openfoam.org/archive/2.0.1/download/suse.php">http://www.openfoam.org/archive/2.0.1/download/suse.php</a>.</span></div><div class="yiv290640733MsoNormal"><span style="font-family:&quot;sans-serif&quot;;"> &nbsp;</span></div><div class="yiv290640733MsoNormal"><span style="font-family:&quot;sans-serif&quot;;">Here the problem:</span></div><div class="yiv290640733MsoNormal"><span style="font-family:&quot;sans-serif&quot;;">The experienced user tested the OF with a test case out of one of the vendors
 tutorials.</span></div><div class="yiv290640733MsoNormal"><span style="font-family:&quot;sans-serif&quot;;">He only used the computing power of his local machine “caelde04” , no other computers were accessed by mpirun.</span></div><div class="yiv290640733MsoNormal"><span style="font-family:&quot;sans-serif&quot;;"> &nbsp;</span></div><div class="yiv290640733MsoNormal"><span style="font-family:&quot;sans-serif&quot;;">He found no problem when testing in single “processor mode” but in “multiprocessor mode” his calculations hangs when he distributes</span></div><div class="yiv290640733MsoNormal"><span style="font-family:&quot;sans-serif&quot;;">the calculations to more than 2 CPUs. The OF vendor thinks this is an OpenMPI problem somehow and that is why I am trying to get</span></div><div class="yiv290640733MsoNormal"><span style="font-family:&quot;sans-serif&quot;;">help from this forum here.</span></div><div class="yiv290640733MsoNormal"><span
 style="font-family:&quot;sans-serif&quot;;">I attached 2 files, one is the “decomposeParDict” which resides in the “system” subdirectory of his test case and the other is the log file</span></div><div class="yiv290640733MsoNormal" style="line-height:200%;"><span style="font-family:&quot;sans-serif&quot;;">from the “decomposePar” command and the mpirun command “mpirun -np 9 interFoam –parallel”.</span></div><div class="yiv290640733MsoNormal" style="line-height:200%;"><span style="font-family:&quot;sans-serif&quot;;">Do you have an idea where the problem is or how I can narrow it down?<br>Thanks much for any help.</span></div><div class="yiv290640733MsoNormal" style=""><br><span style="font-family:&quot;sans-serif&quot;;">Andre</span><br><br><span style="font-size:10.0pt;"></span></div><div class="yiv290640733MsoNormal"> &nbsp;</div></div></div></div><br>_______________________________________________<br>users mailing list<br><a
 ymailto="mailto:users@open-mpi.org" href="mailto:users@open-mpi.org">users@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br><br> </div> </div>  </div></body></html>
