<html><head><base href="x-msg://176/"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">Hi Ed<div><br></div><div>I finally had some time to dig around a little. I believe we could make this work if I fix the multi-word cmd line param issue. Either "newgrp" or "sg" should resolve the problem - both are user-level cmds.</div><div><br></div><div>Up to you - let me know if you want me to pursue this.</div><div>Ralph</div><div><br></div><div><br></div><div><div><div>On Sep 14, 2011, at 3:31 PM, Blosch, Edwin L wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><span class="Apple-style-span" style="border-collapse: separate; font-family: Helvetica; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; font-size: medium; "><div lang="EN-US" link="blue" vlink="purple"><div class="WordSection1" style="page: WordSection1; "><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125); ">Thank you - &nbsp;I did pursue this kind of workaround, and it worked, but you’ll be happy to know that nothing had to be owned by root.<o:p></o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125); "><o:p>&nbsp;</o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125); ">ASIDE ----<o:p></o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125); ">Just to remind:&nbsp; The job script is a shell script that invokes mpirun; the job script itself is run with as the correct user, but the group id may be changed to whatever the user requests of the job-scheduling system.&nbsp; I think it may not be uncommon to have jobs that request a specific Unix group, for many reasons, but in our case the group is an input for the scheduler’s prioritization policy.<o:p></o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125); "><o:p>&nbsp;</o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125); ">Outcome: rank 0 runs user:group2 as the user requested, but the launched child processes run&nbsp; user:group1&nbsp; where group 1 is the user’s primary group. &nbsp;The peculiarity of this application is that each of the processes writes a file to disk, so the resulting group ownership of rank 0 files is group2, but the group ownership of all other ranks’ files is group1.&nbsp; That was the original problem I’m trying to work around.<o:p></o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125); ">--- END ASIDE<o:p></o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125); "><o:p>&nbsp;</o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125); ">Fortunately for me, there is another peculiarity of this application -- the executable gets copied out to /tmp (local space) on each of the hosts to be used in the job. &nbsp;We found this helped prevent some crashes during test phases where an executable gets overwritten while in use. &nbsp;Definitely a special behavior.&nbsp; But as a result of this peculiarity, the mpirun command ends up launching the copied executable, and I took advantage of that.<o:p></o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125); "><o:p>&nbsp;</o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125); ">I had the job script do chown user:group2 on the copied executables and then chmod 6711, and then I observed that the child processes ran as user:group2, same as the rank 0 process, so the files they created had the desired group ownership.<o:p></o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125); "><o:p>&nbsp;</o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125); ">I will explore Reuti’s guidance as well.<o:p></o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125); "><o:p>&nbsp;</o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125); ">Thank you<o:p></o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125); "><o:p>&nbsp;</o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125); "><o:p>&nbsp;</o:p></span></div><div style="border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; border-top-style: solid; border-top-color: rgb(181, 196, 223); border-top-width: 1pt; padding-top: 3pt; padding-right: 0in; padding-bottom: 0in; padding-left: 0in; "><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><b><span style="font-size: 10pt; font-family: Tahoma, sans-serif; ">From:</span></b><span style="font-size: 10pt; font-family: Tahoma, sans-serif; "><span class="Apple-converted-space">&nbsp;</span><a href="mailto:users-bounces@open-mpi.org" style="color: blue; text-decoration: underline; ">users-bounces@open-mpi.org</a><span class="Apple-converted-space">&nbsp;</span>[mailto:users-bounces@open-mpi.org]<span class="Apple-converted-space">&nbsp;</span><b>On Behalf Of<span class="Apple-converted-space">&nbsp;</span></b>Randall Svancara<br><b>Sent:</b><span class="Apple-converted-space">&nbsp;</span>Wednesday, September 14, 2011 3:07 PM<br><b>To:</b><span class="Apple-converted-space">&nbsp;</span>Open MPI Users<br><b>Subject:</b><span class="Apple-converted-space">&nbsp;</span>Re: [OMPI users] EXTERNAL: Re: Can you set the gid of the processes created by mpirun?<o:p></o:p></span></div></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><o:p>&nbsp;</o:p></div><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 12pt; font-size: 12pt; font-family: 'Times New Roman', serif; ">You could set the setuid bit on the application and chown it to root??&nbsp; It is about as secure as anything else that has been described thus far.&nbsp; As a system admin, I cringe at the thought of anything that would allow something to run as someone else,&nbsp; so there would have to be a pretty good justification for such unique use case as yours.&nbsp;<span class="Apple-converted-space">&nbsp;</span><br><br>Randall<o:p></o:p></p><div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; ">On Wed, Sep 14, 2011 at 12:56 PM, Reuti &lt;<a href="mailto:reuti@staff.uni-marburg.de" style="color: blue; text-decoration: underline; ">reuti@staff.uni-marburg.de</a>&gt; wrote:<o:p></o:p></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; ">Am 14.09.2011 um 19:02 schrieb Blosch, Edwin L:<o:p></o:p></div><div><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 12pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><br>&gt; Thanks for trying.<br>&gt;<br>&gt; Do you feel that this is an impossible request without the assistance of some process running as root, for example, as Reuti mentioned, the daemons of a job scheduler? &nbsp;Or are you saying it will just not be as straightforward as calling setgid as you had hoped?<br>&gt;<br>&gt; Also, do you think there is a way I could make use of the sg command below? &nbsp;Perhaps there is a way to have the rsh/ssh launcher start the application processes with a command like 'sg &lt;group&gt; &lt;executable name&gt;'?<o:p></o:p></p></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; ">What about a half-tight integration (or call it: classic tight integration), i.e. no recompilation necessary?<br><br>- setup your mpiexec call in the jobscript to use a plain rsh for the remote startup (no path given): –mca plm_rsh_agent rsh<br><br>- the PE of SGE needs the argument -catch_rsh in start_proc_args and the supplied script in $SGE_ROOT/mpi/startmpi.sh<br><br>&nbsp;(SGE will create a symbolic link in $TMPDIR therein [which will be called first this way] to the rsh-wrapper in $SGE_ROOT/mpi [pitfall: some applications need a -V to be added in the lines woth "qrsh", i.e. "qrsh -inherit -V ..." to send all environment variables to the slaves])<br><br>- what is your setting of qrsh_daemon/qrsh_command in `qconf -sconf`? This will then be used finally to reach the node and should be builtin or point to the SGE supplied rsh/rshd (no rshd necessary to install, no rshd is running all the time, no rshd will be started by xinet.d or alike)<br><br>- like you do already: switch off the built-in SGE starter in your mpiexec call: -mca plm_rsh_disable_qrsh 1<br><span style="color: rgb(136, 136, 136); "><br>-- Reuti<br></span><br>PS: To avoid misunderstandings: you could also set "–mca plm_rsh_agent foobar" and in $SGE_ROOT/mpi/startmpi.sh you change it to create a symbolic link called "foobar " in $TMPDIR. It's just a name at this stage of startup.<o:p></o:p></div><div><div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><br><br>&gt; Ed<br>&gt;<br>&gt;<br>&gt; NAME<br>&gt; &nbsp; &nbsp; &nbsp;sg - execute command as different group ID<br>&gt;<br>&gt; SYNOPSIS<br>&gt; &nbsp; &nbsp; &nbsp;sg [-] [group [-c ] command]<br>&gt;<br>&gt; DESCRIPTION<br>&gt; &nbsp; &nbsp; &nbsp;The sg command works similar to newgrp but accepts a command. The<br>&gt; &nbsp; &nbsp; &nbsp;command will be executed with the /bin/sh shell. With most shells you<br>&gt; &nbsp; &nbsp; &nbsp;may run sg from, you need to enclose multi-word commands in quotes.<br>&gt; &nbsp; &nbsp; &nbsp;Another difference between newgrp and sg is that some shells treat<br>&gt; &nbsp; &nbsp; &nbsp;newgrp specially, replacing themselves with a new instance of a shell<br>&gt; &nbsp; &nbsp; &nbsp;that newgrp creates. This doesn't happen with sg, so upon exit from a<br>&gt; &nbsp; &nbsp; &nbsp;sg command you are returned to your previous group ID.<br>&gt;<br>&gt;<br>&gt;<br>&gt;<br>&gt; -----Original Message-----<br>&gt; From:<span class="Apple-converted-space">&nbsp;</span><a href="mailto:users-bounces@open-mpi.org" style="color: blue; text-decoration: underline; ">users-bounces@open-mpi.org</a><span class="Apple-converted-space">&nbsp;</span>[mailto:<a href="mailto:users-bounces@open-mpi.org" style="color: blue; text-decoration: underline; ">users-bounces@open-mpi.org</a>] On Behalf Of Ralph Castain<br>&gt; Sent: Wednesday, September 14, 2011 11:33 AM<br>&gt; To: Open MPI Users<br>&gt; Subject: Re: [OMPI users] EXTERNAL: Re: Can you set the gid of the processes created by mpirun?<br>&gt;<br>&gt;<br>&gt; On Sep 14, 2011, at 9:39 AM, Blosch, Edwin L wrote:<br>&gt;<br>&gt;&gt; Thanks, Ralph,<br>&gt;&gt;<br>&gt;&gt; I get the failure messages, unfortunately:<br>&gt;&gt;<br>&gt;&gt; setgid FAILED<br>&gt;&gt; setgid FAILED<br>&gt;&gt; setgid FAILED<br>&gt;&gt;<br>&gt;&gt; I actually had attempted to call setgid from within the application previously, which looks similar to what you've done, but it failed. That was when I initiated the post to the mailing list. My conclusion, a guess really, was that Linux would not let me setgid from within my program because I was not root.<br>&gt;<br>&gt; I was afraid of that - the documentation seemed to indicate that would be the case, but I figured it was worth a quick try. Sorry I can't be of help.<br>&gt;<br>&gt;<br>&gt;&gt;<br>&gt;&gt;<br>&gt;&gt; -----Original Message-----<br>&gt;&gt; From:<span class="Apple-converted-space">&nbsp;</span><a href="mailto:users-bounces@open-mpi.org" style="color: blue; text-decoration: underline; ">users-bounces@open-mpi.org</a><span class="Apple-converted-space">&nbsp;</span>[mailto:<a href="mailto:users-bounces@open-mpi.org" style="color: blue; text-decoration: underline; ">users-bounces@open-mpi.org</a>] On Behalf Of Ralph Castain<br>&gt;&gt; Sent: Wednesday, September 14, 2011 8:15 AM<br>&gt;&gt; To: Open MPI Users<br>&gt;&gt; Subject: Re: [OMPI users] EXTERNAL: Re: Can you set the gid of the processes created by mpirun?<br>&gt;&gt;<br>&gt;&gt; The attached should set the gid of the remote daemons (and their children) to the gid of mpirun. No cmd line option or anything is required - it will just always do it.<br>&gt;&gt;<br>&gt;&gt; Would you mind giving it a try?<br>&gt;&gt;<br>&gt;&gt; Please let me know if/how it works.<br>&gt;&gt;<br>&gt;&gt; _______________________________________________<br>&gt;&gt; users mailing list<br>&gt;&gt;<span class="Apple-converted-space">&nbsp;</span><a href="mailto:users@open-mpi.org" style="color: blue; text-decoration: underline; ">users@open-mpi.org</a><br>&gt;&gt;<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank" style="color: blue; text-decoration: underline; ">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>&gt;<br>&gt;<br>&gt; _______________________________________________<br>&gt; users mailing list<br>&gt;<span class="Apple-converted-space">&nbsp;</span><a href="mailto:users@open-mpi.org" style="color: blue; text-decoration: underline; ">users@open-mpi.org</a><br>&gt;<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank" style="color: blue; text-decoration: underline; ">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>&gt; _______________________________________________<br>&gt; users mailing list<br>&gt;<span class="Apple-converted-space">&nbsp;</span><a href="mailto:users@open-mpi.org" style="color: blue; text-decoration: underline; ">users@open-mpi.org</a><br>&gt;<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank" style="color: blue; text-decoration: underline; ">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br><br><br>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org" style="color: blue; text-decoration: underline; ">users@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank" style="color: blue; text-decoration: underline; ">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><o:p></o:p></div></div></div></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif; "><br><br clear="all"><br>--<span class="Apple-converted-space">&nbsp;</span><br>Randall Svancara<br><a href="http://knowyourlinux.com/" target="_blank" style="color: blue; text-decoration: underline; ">http://knowyourlinux.com/</a><o:p></o:p></div></div>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org" style="color: blue; text-decoration: underline; ">users@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" style="color: blue; text-decoration: underline; ">http://www.open-mpi.org/mailman/listinfo.cgi/users</a></div></span></blockquote></div><br></div></body></html>
