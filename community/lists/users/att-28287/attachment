<div dir="ltr">All,<div><br></div><div>I&#39;m not too sure if this is an MPI issue, a Fortran issue, or something else but I thought I&#39;d ask the MPI gurus here first since my web search failed me.</div><div><br></div><div>There is a chance in the future I might want/need to query an environment variable in a Fortran program, namely to figure out what switch a currently running process is on (via SLURM_TOPOLOGY_ADDR in my case) and perhaps make a &quot;per-switch&quot; communicator.[1]</div><div><br></div><div>So, I coded up a boring Fortran program whose only exciting lines are:</div><div><br></div><div><div><font face="monospace, monospace">   call MPI_Get_Processor_Name(processor_name,name_length,ierror)</font></div><div><font face="monospace, monospace">   call get_environment_variable(&quot;HOST&quot;,host_name)</font></div><div><font face="monospace, monospace"><br></font></div><div><font face="monospace, monospace">   write (*,&#39;(A,X,I4,X,A,X,I4,X,A,X,A)&#39;) &quot;Process&quot;, myid, &quot;of&quot;, npes, &quot;is on processor&quot;, trim(processor_name)</font></div><div><font face="monospace, monospace">   write (*,&#39;(A,X,I4,X,A,X,I4,X,A,X,A)&#39;) &quot;Process&quot;, myid, &quot;of&quot;, npes, &quot;is on host&quot;, trim(host_name)</font></div></div><div><br></div><div>I decided to try out with the <font face="monospace, monospace">HOST</font> environment variable first because it is simple and different per node (I didn&#39;t want to take many, many nodes to find the point when a switch is traversed). I then grabbed two nodes with 4 processes per node and...:</div><div><br></div><div><div><font face="monospace, monospace">(1046) $ echo &quot;$SLURM_NODELIST&quot;</font></div><div><font face="monospace, monospace">borgj[020,036]</font></div><div><font face="monospace, monospace">(1047) $ pdsh -w &quot;$SLURM_NODELIST&quot; echo &#39;$HOST&#39;</font></div><div><font face="monospace, monospace">borgj036: borgj036<br></font></div><div><font face="monospace, monospace">borgj020: borgj020</font></div><div><font face="monospace, monospace">(1048) $ mpifort -o hostenv.x hostenv.F90</font></div><div><font face="monospace, monospace">(1049) $ mpirun -np 8 ./hostenv.x | sort -g -k2</font></div><div><font face="monospace, monospace">Process    0 of    8 is on host borgj020</font></div><div><font face="monospace, monospace">Process    0 of    8 is on processor borgj020</font></div><div><font face="monospace, monospace">Process    1 of    8 is on host borgj020</font></div><div><font face="monospace, monospace">Process    1 of    8 is on processor borgj020</font></div><div><font face="monospace, monospace">Process    2 of    8 is on host borgj020</font></div><div><font face="monospace, monospace">Process    2 of    8 is on processor borgj020</font></div><div><font face="monospace, monospace">Process    3 of    8 is on host borgj020</font></div><div><font face="monospace, monospace">Process    3 of    8 is on processor borgj020</font></div><div><font face="monospace, monospace">Process    4 of    8 is on host borgj020</font></div><div><font face="monospace, monospace">Process    4 of    8 is on processor borgj036</font></div><div><font face="monospace, monospace">Process    5 of    8 is on host borgj020</font></div><div><font face="monospace, monospace">Process    5 of    8 is on processor borgj036</font></div><div><font face="monospace, monospace">Process    6 of    8 is on host borgj020</font></div><div><font face="monospace, monospace">Process    6 of    8 is on processor borgj036</font></div><div><font face="monospace, monospace">Process    7 of    8 is on host borgj020</font></div><div><font face="monospace, monospace">Process    7 of    8 is on processor borgj036</font></div></div><div><br></div><div>It looks like MPI_Get_Processor_Name is doing its thing, but the HOST one seems to only be reflecting the first host. My guess is that OpenMPI doesn&#39;t export every processes&#39; environment separately to every process so it is reflecting HOST from process 0.</div><div><br></div><div>So, I guess my question is: can this be done? Is there an option to Open MPI that might do it? Or is this just something MPI doesn&#39;t do? Or is my Google-fu just too weak to figure out the right search-phrase to find the answer to this probable FAQ?</div><div><br></div><div>Matt</div><div><br></div><div>[1] Note, this might be unnecessary, but I got to the point where I wanted to see if I *could* do it, rather than *should*.<br clear="all"><div><br></div>-- <br><div class="gmail_signature"><div dir="ltr"><div><div dir="ltr"><div>Matt Thompson</div></div></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><div><div>Man Among Men</div></div></div><div><div><div>Fulcrum of History</div></div></div></blockquote></div></div>
</div></div>

