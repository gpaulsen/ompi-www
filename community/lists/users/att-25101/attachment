<html><head><meta http-equiv="Content-Type" content="text/html charset=iso-8859-1"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">Or you can add&nbsp;<div><br></div><div><div style="margin: 0px; font-size: 11px; font-family: Menlo; background-color: rgb(254, 244, 156);">&nbsp; &nbsp;-nolocal|--nolocal&nbsp; &nbsp; Do not run any MPI applications on the local node</div><div><br></div><div>to your mpirun command line and we won't run any application procs on the node where mpirun is executing</div><div><br></div><div><br></div><div><div>On Aug 20, 2014, at 4:28 PM, Joshua Ladd &lt;<a href="mailto:jladd.mlnx@gmail.com">jladd.mlnx@gmail.com</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div dir="ltr"><div><div>Hi, Filippo<br><br></div>When launching with mpirun in a SLURM environment, srun is only being used to launch the ORTE daemons (orteds.)&nbsp; Since the daemon will already exist on the node from which you invoked mpirun, this node will not be included in the list of nodes. SLURM's PMI library is not involved (that functionality is only necessary if you directly launch your MPI application with srun, in which case it is used to exchanged wireup info amongst slurmds.) This is the expected behavior. <br>
<br></div>~/ompi-top-level/orte/mca/plm/plm_slurm_module.c +294<br><div><div>/* if the daemon already exists on this node, then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * don't include it<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (node-&gt;daemon_launched) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; continue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br></div><div>Do you have a frontend node that you can launch from? What happens if you set "-np X" where X = 8*ppn. The alternative is to do a direct launch of the MPI application with srun.<br>
</div><div><br><br></div><div>Best,<br><br>Josh<br><br>
</div></div></div><div class="gmail_extra"><br><br><div class="gmail_quote">On Wed, Aug 20, 2014 at 6:48 PM, Filippo Spiga <span dir="ltr">&lt;<a href="mailto:spiga.filippo@gmail.com" target="_blank">spiga.filippo@gmail.com</a>&gt;</span> wrote:<br>
<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div style="word-wrap:break-word">Dear Open MPI experts,<div><br></div><div>I have a problem that is related to the integration of OpenMPI, slurm and PMI interface. I spent some time today with a colleague of mine trying to figure out why we were not able to obtain all H5 profile files (generated by&nbsp;acct_gather_profile) using Open MPI. When I say "all" I mean if I run using 8 nodes (e.g. tesla[121-128]) then I always systematically miss the file related to the first one (the first node in the allocation list, in this case tesla121).</div>
<div><br></div><div>By comparing which processes are spawn on the compute nodes, I discovered that mpirun running on tesla121 calls srun only to spawn remotely new MPI processes to the other 7 nodes (maybe this is obvious, for me it was not)...</div>
<div><br></div><div><font face="Andale Mono">fs395 &nbsp; &nbsp; &nbsp;617 &nbsp;0.0 &nbsp;0.0 106200 &nbsp;1504 ? &nbsp; &nbsp; &nbsp; &nbsp;S &nbsp; &nbsp;22:41 &nbsp; 0:00 /bin/bash /var/spool/slurm-test/slurmd/job390044/slurm_script<br>fs395 &nbsp; &nbsp; &nbsp;629 &nbsp;0.1 &nbsp;0.0 194552 &nbsp;5288 ? &nbsp; &nbsp; &nbsp; &nbsp;Sl &nbsp; 22:41 &nbsp; 0:00 &nbsp;\_ mpirun -bind-to socket --map-by ppr:1:socket --host tesla121,tesla122,tesla123,tesla124,tesla125,tesla126,tes<br>
fs395 &nbsp; &nbsp; &nbsp;632 &nbsp;0.0 &nbsp;0.0 659740 &nbsp;9148 ? &nbsp; &nbsp; &nbsp; &nbsp;Sl &nbsp; 22:41 &nbsp; 0:00 &nbsp;| &nbsp; \_ srun --ntasks-per-node=1 --kill-on-bad-exit --cpu_bind=none --nodes=7 --nodelist=tesla122,tesla123,tesla1<br>fs395 &nbsp; &nbsp; &nbsp;633 &nbsp;0.0 &nbsp;0.0 &nbsp;55544 &nbsp;1072 ? &nbsp; &nbsp; &nbsp; &nbsp;S &nbsp; &nbsp;22:41 &nbsp; 0:00 &nbsp;| &nbsp; | &nbsp; \_ srun --ntasks-per-node=1 --kill-on-bad-exit --cpu_bind=none --nodes=7 --nodelist=tesla122,tesla123,te<br>
fs395 &nbsp; &nbsp; &nbsp;651 &nbsp;0.0 &nbsp;0.0 106072 &nbsp;1392 ? &nbsp; &nbsp; &nbsp; &nbsp;S &nbsp; &nbsp;22:41 &nbsp; 0:00 &nbsp;| &nbsp; \_ /bin/bash ./run_linpack ./xhpl<br>fs395 &nbsp; &nbsp; &nbsp;654 &nbsp;295 35.5 120113412 23289280 ? &nbsp;RLl &nbsp;22:41 &nbsp; 3:12 &nbsp;| &nbsp; | &nbsp; \_ ./xhpl<br>fs395 &nbsp; &nbsp; &nbsp;652 &nbsp;0.0 &nbsp;0.0 106072 &nbsp;1396 ? &nbsp; &nbsp; &nbsp; &nbsp;S &nbsp; &nbsp;22:41 &nbsp; 0:00 &nbsp;| &nbsp; \_ /bin/bash ./run_linpack ./xhpl<br>
fs395 &nbsp; &nbsp; &nbsp;656 &nbsp;307 35.5 120070332 23267728 ? &nbsp;RLl &nbsp;22:41 &nbsp; 3:19 &nbsp;| &nbsp; &nbsp; &nbsp; \_ ./xhpl</font></div><div><br></div><div><br></div><div>The "xhpl" processes allocated on the first node of a job are not called by srun and because of this the SLURM profile plugin is not activated on the node!!! As result I always miss the first node profile information. Intel MPI does not have this behavior, mpiexec.hydra uses srun on the first node.&nbsp;</div>
<div><br></div><div>I got to the conclusion that SLURM is configured properly, something is wrong in the way I lunch Open MPI using mpirun. If I disable SLURM support and I revert back to rsh (--mca plm rsh) everything work but there is not profiling because the SLURM plug-in is not activated. During the configure step, Open MPI 1.8.1 detects slurm and libmpi/libpmi2 correctly. Honestly, I would prefer to avoid to use srun as job luncher if possible...</div>
<div><br></div><div>Any suggestion to get this sorted out is really appreciated!</div><div><br></div><div>Best Regards,</div><div>Filippo<br><div><br></div><div>--<br>Mr. Filippo SPIGA, M.Sc.<br><a href="http://filippospiga.info/" target="_blank">http://filippospiga.info</a>&nbsp;~ skype: filippo.spiga<br>
<br>«Nobody will drive us out of Cantor's paradise.» ~ David Hilbert<br><br>*****<br>Disclaimer: "Please note this message and any attachments are CONFIDENTIAL and may be privileged or otherwise protected from disclosure. The contents are not to be disclosed to anyone other than the addressee. Unauthorized recipients are requested to&nbsp;preserve this confidentiality and to advise the sender immediately of any error in transmission."<br>
<br></div><br></div></div><br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/08/25099.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/08/25099.php</a><br></blockquote></div><br></div>
_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>Subscription: http://www.open-mpi.org/mailman/listinfo.cgi/users<br>Link to this post: http://www.open-mpi.org/community/lists/users/2014/08/25100.php</blockquote></div><br></div></body></html>
