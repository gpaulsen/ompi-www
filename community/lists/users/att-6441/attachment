<HTML><HEAD><TITLE>Re: [OMPI users] configure script: Fortran 77-90: $LDFLAGS nothonored when checking whether gfortran and gfortran compilersare compatible: bug ?</TITLE>
<META http-equiv=Content-Type content="text/html; charset=utf-8">
<META content="MSHTML 6.00.6000.16674" name=GENERATOR></HEAD>
<BODY dir=ltr>
<DIV>Hi Jeff,</DIV>
<DIV>&nbsp;</DIV>
<DIV>I thought that the problem mentioned in the NEWS&nbsp;was only for&nbsp;Cray systems. I just checked ticket #1189 and this is exactly my case :-)</DIV>
<DIV>&nbsp;</DIV>
<DIV>Thanks a lot !</DIV>
<DIV>&nbsp;</DIV>
<DIV>Mehdi</DIV>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<DIV><FONT size=2>-----Original Message----- <BR><B>From:</B> users-bounces@open-mpi.org&nbsp;on behalf of&nbsp;Jeff Squyres <BR><B>Sent:</B> Wed 27/08/2008 18:00 <BR><B>To:</B> Open MPI Users <BR><B>Cc:</B> <BR><B>Subject:</B> Re: [OMPI users] configure script: Fortran 77-90: $LDFLAGS nothonored when checking whether gfortran and gfortran compilersare compatible: bug ?<BR><BR></FONT></DIV>
<P><FONT size=2>Sorry for the delay in replying.<BR><BR>Looks like this was fixed already in OMPI 1.2.5.&nbsp; So if you upgrade to&nbsp;<BR>1.2.6, you should be good.&nbsp; 1.2.7 should be out Real Soon Now, too.<BR><BR><BR>On Aug 21, 2008, at 8:54 AM, Mehdi Bozzo-Rey wrote:<BR><BR>&gt; Hello,<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; Looks like a bug; did I miss something ?<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; My environment:<BR>&gt;<BR>&gt; ###################################################<BR>&gt;<BR>&gt; [mbozzore@tyan04 openmpi-1.2.4]$ echo $CFLAGS<BR>&gt;<BR>&gt; -I/home/mbozzore/pvfs-2.6.3/include<BR>&gt;<BR>&gt; [mbozzore@tyan04 openmpi-1.2.4]$ echo $FFLAGS<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; [mbozzore@tyan04 openmpi-1.2.4]$ echo $LIBS<BR>&gt;<BR>&gt; -lpvfs2 -lpthread<BR>&gt;<BR>&gt; [mbozzore@tyan04 openmpi-1.2.4]$ echo $LDFLAGS<BR>&gt;<BR>&gt; -L/export/pvfs-2.6.3/lib/<BR>&gt;<BR>&gt; ###################################################<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; Open MPI version : 1.2.4; same behaviour expected with 1.2.6<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; arguments given to configure:<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; ./configure --prefix=/export/ompi-124-pvfs263 --with-io-romio-<BR>&gt; flags=--with-file-system=pvfs+nfs<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; config.log:<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; ####################################################################<BR>&gt;<BR>&gt; configure:36703: checking if Fortran compiler works<BR>&gt;<BR>&gt; configure:36759: gfortran -o conftest&nbsp; -L/export/pvfs-2.6.3/lib/&nbsp;&nbsp;<BR>&gt; conftest.f -lpvfs2 -lpthread &gt;&amp;5<BR>&gt;<BR>&gt; configure:36762: $? = 0<BR>&gt;<BR>&gt; configure:36768: ./conftest<BR>&gt;<BR>&gt; configure:36771: $? = 0<BR>&gt;<BR>&gt; configure:36793: result: yes<BR>&gt;<BR>&gt; configure:36819: checking whether gfortran and gfortran compilers&nbsp;<BR>&gt; are compatible<BR>&gt;<BR>&gt; configure:36844: gfortran&nbsp;&nbsp; -c conftestf90.f<BR>&gt;<BR>&gt; configure:36851: $? = 0<BR>&gt;<BR>&gt; configure:36861: gfortran&nbsp; -c conftestf77.f<BR>&gt;<BR>&gt; configure:36868: $? = 0<BR>&gt;<BR>&gt; configure:36878: gfortran&nbsp; -o conftest conftestf90.o conftestf77.o -<BR>&gt; lpvfs2 -lpthread<BR>&gt;<BR>&gt; /usr/bin/ld: cannot find -lpvfs2<BR>&gt;<BR>&gt; collect2: ld returned 1 exit status<BR>&gt;<BR>&gt; configure:36885: $? = 1<BR>&gt;<BR>&gt; configure:36912: here is the F77 program:<BR>&gt;<BR>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subroutine Conf1_test()<BR>&gt;<BR>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end<BR>&gt;<BR>&gt; configure:36925: here is the F90 program:<BR>&gt;<BR>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; program main<BR>&gt;<BR>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call Conf1_test()<BR>&gt;<BR>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end<BR>&gt;<BR>&gt; configure:36950: result: no<BR>&gt;<BR>&gt; configure:36952: WARNING: *** Fortran 77 and Fortran 90 compilers&nbsp;<BR>&gt; are not link compatible<BR>&gt;<BR>&gt; configure:36954: WARNING: *** Disabling MPI Fortran 90/95 bindings<BR>&gt;<BR>&gt; configure:36994: checking for extra arguments to build a shard library<BR>&gt;<BR>&gt; configure:37017: result: none needed<BR>&gt;<BR>&gt; configure:37416: checking if Fortran 90 compiler supports LOGICAL<BR>&gt;<BR>&gt; configure:37418: result: skipped<BR>&gt;<BR>&gt; configure:37780: checking if Fortran 90 compiler supports INTEGER<BR>&gt;<BR>&gt; configure:37782: result: skipped<BR>&gt;<BR>&gt; ####################################################################<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; With an updated configure script:<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; ####################################################################<BR>&gt;<BR>&gt; [mbozzore@tyan04 openmpi-1.2.4]$ diff -U4 configure.orig configure.new<BR>&gt;<BR>&gt; --- configure.orig&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2008-08-21 09:49:01.000000000 -0400<BR>&gt;<BR>&gt; +++ configure.new&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2008-08-21 11:10:31.000000000 -0400<BR>&gt;<BR>&gt; @@ -36874,10 +36874,10 @@<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;&nbsp; # 1 is the command<BR>&gt;<BR>&gt;&nbsp; # 2 is actions to do if success<BR>&gt;<BR>&gt;&nbsp; # 3 is actions to do if fail<BR>&gt;<BR>&gt; -echo "configure:36878: $OMPI_F90 $FCFLAGS -o conftest conftestf90.o&nbsp;<BR>&gt; conftestf77.o $LIBS" &gt;&amp;5<BR>&gt;<BR>&gt; -$OMPI_F90 $FCFLAGS -o conftest conftestf90.o conftestf77.o $LIBS&nbsp;<BR>&gt; 1&gt;&amp;5 2&gt;&amp;1<BR>&gt;<BR>&gt; +#echo "NEW configure:36878: $OMPI_F90 $FCFLAGS $LDFLAGS -o conftest&nbsp;<BR>&gt; conftestf90.o conftestf77.o $LIBS" &gt;&amp;5<BR>&gt;<BR>&gt; +$OMPI_F90 $FCFLAGS $LDFLAGS -o conftest conftestf90.o conftestf77.o&nbsp;<BR>&gt; $LIBS 1&gt;&amp;5 2&gt;&amp;1<BR>&gt;<BR>&gt;&nbsp; ompi_status=$?<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;&nbsp; # 1 is the message<BR>&gt;<BR>&gt;&nbsp; # 2 is whether to put a prefix or not<BR>&gt;<BR>&gt; ####################################################################<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; config.log:<BR>&gt;<BR>&gt; ####################################################################<BR>&gt;<BR>&gt; NEW configure:36878: gfortran&nbsp; -L/export/pvfs-2.6.3/lib/ -o conftest&nbsp;<BR>&gt; conftestf90.o conftestf77.o -lpvfs2 -lpthread<BR>&gt;<BR>&gt; configure:36885: $? = 0<BR>&gt;<BR>&gt; configure:36956: result: yes<BR>&gt;<BR>&gt; ####################################################################<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; From the FAQ: <A href="http://www.open-mpi.org/faq/?category=building#build-compiler-flags">http://www.open-mpi.org/faq/?category=building#build-compiler-flags</A><BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; LDFLAGS: Flags passed to the linker (not language-specific). This&nbsp;<BR>&gt; flag is rarely required; Open MPI will usually pick up all LDFLAGS&nbsp;<BR>&gt; that it needs by itself.<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; Mehdi<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; Mehdi Bozzo-Rey<BR>&gt;<BR>&gt; Open Source Solution Developer<BR>&gt;<BR>&gt; Platform OCS5<BR>&gt;<BR>&gt; Platform computing<BR>&gt;<BR>&gt; Phone: +1 905 948 4649<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; _______________________________________________<BR>&gt; users mailing list<BR>&gt; users@open-mpi.org<BR>&gt; <A href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</A><BR><BR><BR>--<BR>Jeff Squyres<BR>Cisco Systems<BR><BR>_______________________________________________<BR>users mailing list<BR>users@open-mpi.org<BR><A href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</A><BR></FONT></P></BLOCKQUOTE></BODY></HTML>