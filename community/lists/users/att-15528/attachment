<html><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div><div><div>On Feb 8, 2011, at 8:21 PM, Ralph Castain wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">I would personally suggest not reconfiguring your system simply to support a particular version of OMPI. The only difference between the 1.4 and 1.5 series wrt slurm is that we changed a few things to support a more recent version of slurm. It is relatively easy to backport that code to the 1.4 series, and it should be (mostly) backward compatible.<div><br></div><div>OMPI is agnostic wrt resource managers. We try to support all platforms, with our effort reflective of the needs of our developers and their organizations, and our perception of the relative size of the user community for a particular platform. Slurm is a fairly small community, mostly centered in the three DOE weapons labs, so our support for that platform tends to focus on their usage.</div><div><br></div><div>So, with that understanding...</div><div><br></div><div>Sam: can you confirm that 1.5.1 works on your TLCC machines?</div></div></blockquote><div><br></div><div>Open MPI 1.5.1 works as expected on our TLCC machines. &nbsp;Open MPI 1.4.3 with your SLURM update also tested.</div><br><blockquote type="cite"><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div><br></div><div>I have created a ticket to upgrade the 1.4.4 release (due out any time now) with the 1.5.1 slurm support. Any interested parties can follow it here:</div></div></blockquote><div><br></div><div>Thanks Ralph!</div><div><br></div><div>Sam</div><br><blockquote type="cite"><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div><br></div><div><a href="https://svn.open-mpi.org/trac/ompi/ticket/2717">https://svn.open-mpi.org/trac/ompi/ticket/2717</a></div><div><br></div><div>Ralph</div><div><br></div><div><br></div><div><div><div>On Feb 8, 2011, at 6:23 PM, Michael Curtis wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div><br>On 09/02/2011, at 9:16 AM, Ralph Castain wrote:<br><br><blockquote type="cite">See below<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">On Feb 8, 2011, at 2:44 PM, Michael Curtis wrote:<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite"><blockquote type="cite"><br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">On 09/02/2011, at 2:17 AM, Samuel K. Gutierrez wrote:<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite"><br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite"><blockquote type="cite">Hi Michael,<br></blockquote></blockquote></blockquote><blockquote type="cite"><blockquote type="cite"><blockquote type="cite"><br></blockquote></blockquote></blockquote><blockquote type="cite"><blockquote type="cite"><blockquote type="cite">You may have tried to send some debug information to the list, but it appears to have been blocked. &nbsp;Compressed text output of the backtrace text is sufficient.<br></blockquote></blockquote></blockquote><blockquote type="cite"><blockquote type="cite"><br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite"><br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">Odd, I thought I sent it to you directly. &nbsp;In any case, here is the backtrace and some information from gdb:<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite"><br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">$ salloc -n16 gdb -args mpirun mpi<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">(gdb) run<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">Starting program: /mnt/f1/michael/openmpi/bin/mpirun /mnt/f1/michael/home/ServerAdmin/mpi<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">[Thread debugging using libthread_db enabled]<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite"><br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">Program received signal SIGSEGV, Segmentation fault.<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">0x00007ffff7b76869 in process_orted_launch_report (fd=-1, opal_event=1, data=0x681170) at base/plm_base_launch_support.c:342<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">342<span class="Apple-tab-span" style="white-space:pre">	</span> &nbsp;&nbsp;&nbsp;pdatorted[mev-&gt;sender.vpid]-&gt;state = ORTE_PROC_STATE_RUNNING;<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">(gdb) bt<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">#0 &nbsp;0x00007ffff7b76869 in process_orted_launch_report (fd=-1, opal_event=1, data=0x681170) at base/plm_base_launch_support.c:342<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">#1 &nbsp;0x00007ffff78a7338 in event_process_active (base=0x615240) at event.c:651<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">#2 &nbsp;0x00007ffff78a797e in opal_event_base_loop (base=0x615240, flags=1) at event.c:823<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">#3 &nbsp;0x00007ffff78a756f in opal_event_loop (flags=1) at event.c:730<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">#4 &nbsp;0x00007ffff789b916 in opal_progress () at runtime/opal_progress.c:189<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">#5 &nbsp;0x00007ffff7b76e20 in orte_plm_base_daemon_callback (num_daemons=2) at base/plm_base_launch_support.c:459<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">#6 &nbsp;0x00007ffff7b7bed7 in plm_slurm_launch_job (jdata=0x610560) at plm_slurm_module.c:360<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">#7 &nbsp;0x0000000000403f46 in orterun (argc=2, argv=0x7fffffffe7d8) at orterun.c:754<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">#8 &nbsp;0x0000000000402fb4 in main (argc=2, argv=0x7fffffffe7d8) at main.c:13<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">(gdb) print pdatorted<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">$1 = (orte_proc_t **) 0x67c610<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">(gdb) print mev<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">$2 = (orte_message_event_t *) 0x681550<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">(gdb) print mev-&gt;sender.vpid<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">$3 = 4294967295<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">(gdb) print mev-&gt;sender<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">$4 = {jobid = 1721696256, vpid = 4294967295}<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">(gdb) print *mev<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">$5 = {super = {obj_magic_id = 16046253926196952813, obj_class = 0x7ffff7dd4f40, obj_reference_count = 1, cls_init_file_name = 0x7ffff7bb9a78 "base/plm_base_launch_support.c", <br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite"> cls_init_lineno = 423}, ev = 0x680850, sender = {jobid = 1721696256, vpid = 4294967295}, buffer = 0x6811b0, tag = 10, file = 0x680640 "rml_oob_component.c", line = 279}<br></blockquote></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">The jobid and vpid look like the defined INVALID values, indicating that something is quite wrong. This would quite likely lead to the segfault.<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite"><blockquote type="cite">From this, it would indeed appear that you are getting some kind of library confusion - the most likely cause of such an error is a daemon from a different version trying to respond, and so the returned message isn't correct.<br></blockquote></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">Not sure why else it would be happening...you could try setting -mca plm_base_verbose 5 to get more debug output displayed on your screen, assuming you built OMPI with --enable-debug.<br></blockquote><blockquote type="cite"><br></blockquote><br>Found the problem.... It is a site configuration issue, which I'll need to find a workaround for.<br><br>[bio-ipc.{FQDN}:27523] mca:base:select:( &nbsp;plm) Query of component [slurm] set priority to 75<br>[bio-ipc.{FQDN}:27523] mca:base:select:( &nbsp;plm) Selected component [slurm]<br>[bio-ipc.{FQDN}:27523] mca: base: close: component rsh closed<br>[bio-ipc.{FQDN}:27523] mca: base: close: unloading component rsh<br>[bio-ipc.{FQDN}:27523] plm:base:set_hnp_name: initial bias 27523 nodename hash 1936089714<br>[bio-ipc.{FQDN}:27523] plm:base:set_hnp_name: final jobfam 31383<br>[bio-ipc.{FQDN}:27523] [[31383,0],0] plm:base:receive start comm<br>[bio-ipc.{FQDN}:27523] [[31383,0],0] plm:slurm: launching job [31383,1]<br>[bio-ipc.{FQDN}:27523] [[31383,0],0] plm:base:setup_job for job [31383,1]<br>[bio-ipc.{FQDN}:27523] [[31383,0],0] plm:slurm: launching on nodes ipc3<br>[bio-ipc.{FQDN}:27523] [[31383,0],0] plm:slurm: final top-level argv:<br><span class="Apple-tab-span" style="white-space:pre">	</span>srun --nodes=1 --ntasks=1 --kill-on-bad-exit --nodelist=ipc3 orted -mca ess slurm -mca orte_ess_jobid 2056716288 -mca orte_ess_vpid 1 -mca orte_ess_num_procs 2 --hnp-uri "2056716288.0;tcp://lanip:37493;tcp://globalip:37493;tcp://lanip2:37493" -mca plm_base_verbose 20<br><br>I then inserted some printf's into the ess_slurm_module (rough and ready, I know, but I was in a hurry).<br><br>Just after initialisation: (at around line 345)<br>orte_ess_slurm: jobid 2056716288 vpid 1<br>So it gets that...<br>I narrowed it down to the get_slurm_nodename &nbsp;function, as the method didn't proceed past that point....<br><br>line 401:<br> &nbsp;&nbsp;&nbsp;tmp = strdup(orte_process_info.nodename);<br> &nbsp;&nbsp;&nbsp;printf( "Our node name == %s\n", tmp );<br>line 409:<br> &nbsp;&nbsp;&nbsp;for (i=0; NULL != &nbsp;names[i]; i++) {<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf( "Checking %s\n", names[ i ]);<br><br>Result:<br>Our node name == eng-ipc3.{FQDN}<br>Checking ipc3<br><br>So it's down to the mismatch of the slurm name and the hostname. &nbsp;slurm really encourages you not to use the fully qualified hostname, and I'd prefer not to have to reconfigure the whole system to use the shortname as hostnames. &nbsp;However, I note that 1.5.1 worked and backported some of the code -- it uses getenv( "SLURM_NODE_ID" ) to get that node number, which doesn't rely on an exact string match. &nbsp;Patching this makes things kind of work, but failures still occur during wire-up for more than one node. <br><br>I think the solution will have to be to change the hostnames on the system to match what is needed by slurm+openmpi. &nbsp;(doing this temporarily makes everything work with an unpatched 1.4.3 and the wireup completes successfully). &nbsp;Perhaps a note about system hostnames needs to be made somewhere in the OpenMPI / SLURM documentation? <br><br>Thank you Ralph &amp; Sam for your help. &nbsp;<br><br>Cheers,<br>Michael<br><br><br><br><br>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div></blockquote></div><br></div></div>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>http://www.open-mpi.org/mailman/listinfo.cgi/users</blockquote></div><br></div></body></html>
