<html><head><meta http-equiv="Content-Type" content="text/html charset=us-ascii"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">Here's another data point that might be useful: The error message is much more rare if I run my application on 4 cores instead of 8.<div><br></div><div>Thanks,</div><div><br></div><div>- Lee-Ping<br><div><br><div><div>On Sep 29, 2014, at 5:38 PM, Lee-Ping Wang &lt;<a href="mailto:leeping@stanford.edu">leeping@stanford.edu</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><meta http-equiv="Content-Type" content="text/html charset=us-ascii"><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">Sorry for my last email - I think I spoke too quick. &nbsp;I realized after reading some more documentation that OpenMPI always uses TCP sockets for out-of-band communication, so it doesn't make sense for me to set OMPI_MCA_oob=^tcp. &nbsp;That said, I am still running into a strange problem in my application when running on a specific machine (Blue Waters compute node); I don't see this problem on any other nodes.<div><br></div><div>When I run the same job (~5 seconds) in rapid succession, I see the following error message on the second execution:<br><div><br></div><div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">/tmp/leeping/opt/qchem-4.2/bin/parallel.csh,&nbsp; , qcopt_reactants.in, 8, 0, ./qchem24825/</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">MPIRUN in parallel.csh is /tmp/leeping/opt/qchem-4.2/ext-libs/openmpi/bin/mpirun</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">P4_RSHCOMMAND in parallel.csh is ssh</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">QCOUTFILE is stdout</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">Q-Chem machineFile is /tmp/leeping/opt/qchem-4.2/bin/mpi/machines</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">[nid15081:24859] Warning: could not find environment variable "QCLOCALSCR"</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">[nid15081:24859] Warning: could not find environment variable "QCREF"</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">initial socket setup ...start</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">-------------------------------------------------------</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">Primary job&nbsp; terminated normally, but 1 process returned</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">a non-zero exit code.. Per user-direction, the job has been aborted.</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">-------------------------------------------------------</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">--------------------------------------------------------------------------</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">mpirun detected that one or more processes exited with non-zero status, thus causing</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">the job to be terminated. The first process to do so was:</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0); min-height: 11px;"><br></div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; Process name: [[46773,1],0]</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; Exit code:&nbsp; &nbsp; 255</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">--------------------------------------------------------------------------</div><div><br></div><div>And here's the source code where the program is exiting (before "initial socket setup ...done")</div><div><br></div><div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);"><span style="color: #34bd26">int</span> GPICommSoc::init(MPI_Comm comm0) {</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0); min-height: 11px;"><br></div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(78, 117, 255); background-color: rgb(0, 0, 0);"><span style="color: #f5f5f5">&nbsp; &nbsp; </span>/* setup basic MPI information */</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; &nbsp; init_comm(comm0);</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0); min-height: 11px;"><br></div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; &nbsp; MPI_Barrier(comm);</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(78, 117, 255); background-color: rgb(0, 0, 0);"><span style="color: #f5f5f5">&nbsp; &nbsp; </span>/*-- start inisock and set serveradd[] array --*/</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; &nbsp; <span style="color: #ce7924">if</span> (me == <span style="color: #c33720">0</span>) {</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(195, 55, 32); background-color: rgb(0, 0, 0);"><span style="color: #f5f5f5">&nbsp; &nbsp; &nbsp; &nbsp; fprintf(</span>stdout<span style="color: #f5f5f5">,</span>"initial socket setup ...start<span style="color: #d53bd3">\n</span>"<span style="color: #f5f5f5">);</span></div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp; fflush(<span style="color: #c33720">stdout</span>);</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; &nbsp; }</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0); min-height: 11px;"><br></div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(78, 117, 255); background-color: rgb(0, 0, 0);"><span style="color: #f5f5f5">&nbsp; &nbsp; </span>// create the initial socket&nbsp;</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; &nbsp; inisock = new_server_socket(<span style="color: #c33720">NULL</span>,<span style="color: #c33720">0</span>);</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0); min-height: 11px;"><br></div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(78, 117, 255); background-color: rgb(0, 0, 0);"><span style="color: #f5f5f5">&nbsp; &nbsp; </span>// fill and gather the serveraddr array</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; &nbsp; <span style="color: #34bd26">int</span> szsock = <span style="color: #ce7924">sizeof</span>(SOCKADDR);</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; &nbsp; memset(&amp;serveraddr[<span style="color: #c33720">0</span>],<span style="color: #c33720">0</span>, szsock*nproc);</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; &nbsp; <span style="color: #34bd26">int</span> iniport=get_sockport(inisock);</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; &nbsp; set_sockaddr_byhname(<span style="color: #c33720">NULL</span>, iniport, &amp;serveraddr[me]);</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(78, 117, 255); background-color: rgb(0, 0, 0);"><span style="color: #f5f5f5">&nbsp; &nbsp; </span>//printsockaddr( serveraddr[me] );</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0); min-height: 11px;"><br></div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; &nbsp; SOCKADDR addrsend = serveraddr[me];</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; &nbsp; MPI_Allgather(&amp;addrsend,szsock,MPI_BYTE,</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;serveraddr[<span style="color: #c33720">0</span>], szsock,MPI_BYTE, comm);</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; &nbsp; <span style="color: #ce7924">if</span> (me == <span style="color: #c33720">0</span>) {</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(195, 55, 32); background-color: rgb(0, 0, 0);"><span style="color: #f5f5f5">&nbsp;&nbsp; &nbsp; &nbsp; fprintf(</span>stdout<span style="color: #f5f5f5">,</span>"initial socket setup ...done <span style="color: #d53bd3">\n</span>"</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; &nbsp; );</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; &nbsp; fflush(<span style="color: #c33720">stdout</span>);}</div></div><div><br></div><div>I didn't write this part of the program and I'm really a novice to MPI - but it seems like the initial execution of the program isn't freeing up some system resource as it should. &nbsp;Is there something that needs to be corrected in the code?</div><div><br></div><div>Thanks,</div><div><br></div><div>- Lee-Ping</div><div><br><div><div>On Sep 29, 2014, at 5:12 PM, Lee-Ping Wang &lt;<a href="mailto:leeping@stanford.edu">leeping@stanford.edu</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><meta http-equiv="Content-Type" content="text/html charset=us-ascii"><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">Hi there,<div><br></div><div>My application uses MPI to run parallel jobs on a single node, so I have no need of any support for communication between nodes. &nbsp;However, when I use mpirun to launch my application I see strange errors such as:</div><div><br></div><div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">--------------------------------------------------------------------------</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">No network interfaces were found for out-of-band communications. We require</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">at least one available network for out-of-band messaging.</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">--------------------------------------------------------------------------</div></div><div><br></div><div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">[nid23206:10697] [[33772,1],0] ORTE_ERROR_LOG: Unable to open a TCP socket for out-of-band communications in file oob_tcp_listener.c at line 113</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">[nid23206:10697] [[33772,1],0] ORTE_ERROR_LOG: Unable to open a TCP socket for out-of-band communications in file oob_tcp_component.c at line 584</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">--------------------------------------------------------------------------</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">It looks like orte_init failed for some reason; your parallel process is</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">likely to abort.&nbsp; There are many reasons that a parallel process can</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">fail during orte_init; some of which are due to configuration or</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">environment problems.&nbsp; This failure appears to be an internal failure;</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">here's some additional information (which may only be relevant to an</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">Open MPI developer):</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0); min-height: 11px;"><br></div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; orte_oob_base_select failed</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">&nbsp; --&gt; Returned value (null) (-43) instead of ORTE_SUCCESS</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">--------------------------------------------------------------------------</div></div><div><br></div><div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">/home/leeping/opt/qchem-4.2/ext-libs/openmpi/lib/libmpi.so.1(+0xfeaa9)[0x2b77e9de5aa9]</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">/home/leeping/opt/qchem-4.2/ext-libs/openmpi/lib/libmpi.so.1(ompi_btl_openib_connect_base_select_for_local_port+0xd0)[0x2b77e9de13a0]</div></div><div><br></div><div>It seems like in each case, OpenMPI is trying to use some feature related to networking and crashing as a result. &nbsp;My workaround is to deduce the components that are crashing and disable them in my environment variables like this:</div><div><br></div><div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">export OMPI_MCA_btl=self,sm</div><div style="margin: 0px; font-size: 10px; font-family: Menlo; color: rgb(245, 245, 245); background-color: rgb(0, 0, 0);">export OMPI_MCA_oob=^tcp</div></div><div><br></div><div>Is there a better way to do this - i.e. explicitly prohibit OpenMPI from using any network-related feature and run only on the local node?</div><div><br></div><div>Thanks,</div><div><br></div><div>- Lee-Ping</div><div><br></div></div>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/09/25410.php">http://www.open-mpi.org/community/lists/users/2014/09/25410.php</a></blockquote></div><br></div></div></div></div>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>Subscription: http://www.open-mpi.org/mailman/listinfo.cgi/users<br>Link to this post: http://www.open-mpi.org/community/lists/users/2014/09/25411.php</blockquote></div><br></div></div></body></html>
