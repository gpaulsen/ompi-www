<html><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div>Hi Jeff</div><div><br></div><div>This is a Mac OS X (10.5.7) specific issue, that occurs for all versions &gt; 1.2.9 that I've tested (1.3.0 through the 1.4 nightly), regardless of what fortran compiler you use (ifort / g95 / gfortran). I've been able to replicate this issue on other OS X machines, and I am sure that I am using the correct headers / libraries. Version 1.2.9 is working correctly. Here are some system details:</div><div><br></div><div>$ uname -a</div><div>Darwin zamblap.epp.ist.utl.pt 9.7.0 Darwin Kernel Version 9.7.0: Tue Mar 31 22:52:17 PDT 2009; root:xnu-1228.12.14~1/RELEASE_I386 i386</div><div><br></div><div><div>$ gcc --version</div><div>i686-apple-darwin9-gcc-4.0.1 (GCC) 4.0.1 (Apple Inc. build 5493)</div><div><br></div><div><div>$ ld -v</div><div>@(#)PROGRAM:ld &nbsp;PROJECT:ld64-85.2.1</div><div><br></div></div></div><div>This might be a (again, Mac OS X specific) libtool issue. If you look at the name list of the generated .dylib libraries for 1.3.3 you get:</div><div><br></div><div><div>$ nm /opt/openmpi/1.3.3-g95-32/lib/*.dylib | grep -i in_place</div><div>000a4d30 S _MPI_FORTRAN_IN_PLACE</div><div>000a4d34 S _mpi_fortran_in_place</div><div>000a4d38 S _mpi_fortran_in_place_</div><div>000a4d3c S _mpi_fortran_in_place__</div><div>000a4d30 S _MPI_FORTRAN_IN_PLACE</div><div>000a4d34 S _mpi_fortran_in_place</div><div>000a4d38 S _mpi_fortran_in_place_</div><div>000a4d3c S _mpi_fortran_in_place__</div><div>00007328 S __ZN3MPI8IN_PLACEE</div><div>00007328 S __ZN3MPI8IN_PLACEE</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; U _mpi_fortran_in_place__</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; U _mpi_fortran_in_place__</div><div>00036eea D _orte_snapc_base_store_in_place</div><div>00036eea D _orte_snapc_base_store_in_place</div><div><br></div><div>But for 1.2.9 you get:</div><div><br></div><div><div>$ nm /opt/openmpi/1.2.9-g95-32/lib/*.dylib | grep -i in_place</div><div>00093950 S _MPI_FORTRAN_IN_PLACE</div><div>00093954 S _mpi_fortran_in_place</div><div>00093958 S _mpi_fortran_in_place_</div><div>0009395c S _mpi_fortran_in_place__</div><div>00093950 S _MPI_FORTRAN_IN_PLACE</div><div>00093954 S _mpi_fortran_in_place</div><div>00093958 S _mpi_fortran_in_place_</div><div>0009395c S _mpi_fortran_in_place__</div><div>0000e00c D __ZN3MPI8IN_PLACEE</div><div>0000e00c D __ZN3MPI8IN_PLACEE</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; U _mpi_fortran_in_place__</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; U _mpi_fortran_in_place__</div><div><br></div><div>So the&nbsp;__ZN3MPI8IN_PLACEE symbol, that I guess refers to the Fortran MPI_IN_PLACE constant is being defined incorrectly in the 1.3.3 version as a&nbsp;S (symbol in a section other than those above), while it should be defined as a&nbsp;D (data section&nbsp; symbol) as part of an "external" common block, as it happens in 1.2.9. So when linking the 1.3.3 version the MPI_IN_PLACE constant will never have the same address as any of the mpi_fortran_in_place variables, but rather its own address.</div></div><div><br></div></div><div>Thanks again for your help,</div><div>Ricardo</div><br><div apple-content-edited="true"> <span class="Apple-style-span" style="font-size: 12px; "><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">---<span class="Apple-converted-space">&nbsp;</span></font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">Prof. Ricardo Fonseca</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; min-height: 14px; "><br></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">GoLP - Grupo de Lasers e Plasmas</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Instituto de Plasmas e Fusão Nuclear</p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">Instituto Superior Técnico</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">Av. Rovisco Pais</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">1049-001 Lisboa</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">Portugal</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; min-height: 14px; "><br></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">tel: +351 21 8419202</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">fax: +351 21 8464455</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">web: <a href="http://cfp.ist.utl.pt/golp/">http://cfp.ist.utl.pt/golp/</a><span class="Apple-converted-space">&nbsp;</span></font></p></div></div></span> </div><br><div><div>On Aug 1, 2009, at 17:00 , <a href="mailto:users-request@open-mpi.org">users-request@open-mpi.org</a> wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><span class="Apple-style-span" style="border-collapse: separate; color: rgb(0, 0, 0); font-family: Helvetica; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; ">Message: 2<br>Date: Sat, 1 Aug 2009 07:44:47 -0400<br>From: Jeff Squyres &lt;<a href="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a>&gt;<br>Subject: Re: [OMPI users] OMPI users] MPI_IN_PLACE in Fortran<br><span class="Apple-tab-span" style="white-space: pre; ">	</span>withMPI_REDUCE<span class="Apple-tab-span" style="white-space: pre; ">	</span>/ MPI_ALLREDUCE<br>To: Open MPI Users &lt;<a href="mailto:users@open-mpi.org">users@open-mpi.org</a>&gt;<br>Message-ID: &lt;<a href="mailto:CA25CCF4-C5E7-47C0-A24E-8B05B59A6474@cisco.com">CA25CCF4-C5E7-47C0-A24E-8B05B59A6474@cisco.com</a>&gt;<br>Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes<br><br>Hmm. &nbsp;FWIW, I'm unable to replicate your error. &nbsp;I tried with the OMPI &nbsp;<br>SVN trunk and a build of the OMPI 1.3.3 tarball using the GNU compiler &nbsp;<br>suite on RHEL4U5.<br><br>I've even compiled your sample code with "mpif90" using the "use mpi" &nbsp;<br>statement -- I did not get an unclassifiable statement. &nbsp;What version &nbsp;<br>of Open MPI are you using? &nbsp;Please sent the info listed here:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://www.open-mpi.org/community/help/">http://www.open-mpi.org/community/help/</a><br><br>Can you confirm that you're not accidentally mixing and matching &nbsp;<br>multiple versions of Open MPI?<br></span></blockquote></div><br></body></html>
