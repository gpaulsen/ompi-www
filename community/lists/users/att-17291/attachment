<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:p="urn:schemas-microsoft-com:office:powerpoint" xmlns:a="urn:schemas-microsoft-com:office:access" xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882" xmlns:s="uuid:BDC6E3F0-6DA3-11d1-A2A3-00AA00C14882" xmlns:rs="urn:schemas-microsoft-com:rowset" xmlns:z="#RowsetSchema" xmlns:b="urn:schemas-microsoft-com:office:publisher" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:c="urn:schemas-microsoft-com:office:component:spreadsheet" xmlns:odc="urn:schemas-microsoft-com:office:odc" xmlns:oa="urn:schemas-microsoft-com:office:activation" xmlns:html="http://www.w3.org/TR/REC-html40" xmlns:q="http://schemas.xmlsoap.org/soap/envelope/" xmlns:rtc="http://microsoft.com/officenet/conferencing" xmlns:D="DAV:" xmlns:Repl="http://schemas.microsoft.com/repl/" xmlns:mt="http://schemas.microsoft.com/sharepoint/soap/meetings/" xmlns:x2="http://schemas.microsoft.com/office/excel/2003/xml" xmlns:ppda="http://www.passport.com/NameSpace.xsd" xmlns:ois="http://schemas.microsoft.com/sharepoint/soap/ois/" xmlns:dir="http://schemas.microsoft.com/sharepoint/soap/directory/" xmlns:ds="http://www.w3.org/2000/09/xmldsig#" xmlns:dsp="http://schemas.microsoft.com/sharepoint/dsp" xmlns:udc="http://schemas.microsoft.com/data/udc" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:sub="http://schemas.microsoft.com/sharepoint/soap/2002/1/alerts/" xmlns:ec="http://www.w3.org/2001/04/xmlenc#" xmlns:sp="http://schemas.microsoft.com/sharepoint/" xmlns:sps="http://schemas.microsoft.com/sharepoint/soap/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:udcs="http://schemas.microsoft.com/data/udc/soap" xmlns:udcxf="http://schemas.microsoft.com/data/udc/xmlfile" xmlns:udcp2p="http://schemas.microsoft.com/data/udc/parttopart" xmlns:wf="http://schemas.microsoft.com/sharepoint/soap/workflow/" xmlns:dsss="http://schemas.microsoft.com/office/2006/digsig-setup" xmlns:dssi="http://schemas.microsoft.com/office/2006/digsig" xmlns:mdssi="http://schemas.openxmlformats.org/package/2006/digital-signature" xmlns:mver="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" xmlns:mrels="http://schemas.openxmlformats.org/package/2006/relationships" xmlns:spwp="http://microsoft.com/sharepoint/webpartpages" xmlns:ex12t="http://schemas.microsoft.com/exchange/services/2006/types" xmlns:ex12m="http://schemas.microsoft.com/exchange/services/2006/messages" xmlns:pptsl="http://schemas.microsoft.com/sharepoint/soap/SlideLibrary/" xmlns:spsl="http://microsoft.com/webservices/SharePointPortalServer/PublishedLinksService" xmlns:Z="urn:schemas-microsoft-com:" xmlns:st="&#1;" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv=Content-Type content="text/html; charset=us-ascii"><meta name=Generator content="Microsoft Word 12 (filtered medium)"><base href="x-msg://176/"><style><!--
/* Font Definitions */
@font-face
	{font-family:Helvetica;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:Helvetica;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
span.apple-style-span
	{mso-style-name:apple-style-span;}
span.apple-converted-space
	{mso-style-name:apple-converted-space;}
span.EmailStyle19
	{mso-style-type:personal-reply;
	font-family:"Calibri","sans-serif";
	color:#1F497D;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-size:10.0pt;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
--></style><!--[if gte mso 9]><xml>
<o:shapedefaults v:ext="edit" spidmax="1026" />
</xml><![endif]--><!--[if gte mso 9]><xml>
<o:shapelayout v:ext="edit">
<o:idmap v:ext="edit" data="1" />
</o:shapelayout></xml><![endif]--></head><body lang=EN-US link=blue vlink=purple style='word-wrap: break-word;-webkit-nbsp-mode: space;-webkit-line-break: after-white-space'><div class=WordSection1><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>I would appreciate trying to fix the multi-word argument to orte_launch_agent, unless you&#8217;ve already fixed it in a later series in which case I could update. &nbsp;My workaround with the setuid applied to a copied executable doesn&#8217;t work for other applications that run on our clusters ( I mean their job scripts would also have to be modified similarly).<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>I think OpenMPI should be able to launch all processes with the same uid and gid even when the user has launched the job while using one of his secondary groups.&nbsp; Whether it should be a change request or bug (unexpected, counter-intuitive), I&#8217;ll leave that to your judgment.<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>Thank you again for the support<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'><o:p>&nbsp;</o:p></span></p><div><div style='border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-size:10.0pt;font-family:"Tahoma","sans-serif"'>From:</span></b><span style='font-size:10.0pt;font-family:"Tahoma","sans-serif"'> users-bounces@open-mpi.org [mailto:users-bounces@open-mpi.org] <b>On Behalf Of </b>Ralph Castain<br><b>Sent:</b> Wednesday, September 14, 2011 5:10 PM<br><b>To:</b> Open MPI Users<br><b>Subject:</b> Re: [OMPI users] EXTERNAL: Re: Can you set the gid of the processes created by mpirun?<o:p></o:p></span></p></div></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>Hi Ed<o:p></o:p></p><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>I finally had some time to dig around a little. I believe we could make this work if I fix the multi-word cmd line param issue. Either &quot;newgrp&quot; or &quot;sg&quot; should resolve the problem - both are user-level cmds.<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal>Up to you - let me know if you want me to pursue this.<o:p></o:p></p></div><div><p class=MsoNormal>Ralph<o:p></o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><div><div><div><p class=MsoNormal>On Sep 14, 2011, at 3:31 PM, Blosch, Edwin L wrote:<o:p></o:p></p></div><p class=MsoNormal><br><br><o:p></o:p></p><div><div><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>Thank you - &nbsp;I did pursue this kind of workaround, and it worked, but you&#8217;ll be happy to know that nothing had to be owned by root.</span><o:p></o:p></p></div><div><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>&nbsp;</span><o:p></o:p></p></div><div><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>ASIDE ----</span><o:p></o:p></p></div><div><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>Just to remind:&nbsp; The job script is a shell script that invokes mpirun; the job script itself is run with as the correct user, but the group id may be changed to whatever the user requests of the job-scheduling system.&nbsp; I think it may not be uncommon to have jobs that request a specific Unix group, for many reasons, but in our case the group is an input for the scheduler&#8217;s prioritization policy.</span><o:p></o:p></p></div><div><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>&nbsp;</span><o:p></o:p></p></div><div><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>Outcome: rank 0 runs user:group2 as the user requested, but the launched child processes run&nbsp; user:group1&nbsp; where group 1 is the user&#8217;s primary group. &nbsp;The peculiarity of this application is that each of the processes writes a file to disk, so the resulting group ownership of rank 0 files is group2, but the group ownership of all other ranks&#8217; files is group1.&nbsp; That was the original problem I&#8217;m trying to work around.</span><o:p></o:p></p></div><div><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>--- END ASIDE</span><o:p></o:p></p></div><div><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>&nbsp;</span><o:p></o:p></p></div><div><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>Fortunately for me, there is another peculiarity of this application -- the executable gets copied out to /tmp (local space) on each of the hosts to be used in the job. &nbsp;We found this helped prevent some crashes during test phases where an executable gets overwritten while in use. &nbsp;Definitely a special behavior.&nbsp; But as a result of this peculiarity, the mpirun command ends up launching the copied executable, and I took advantage of that.</span><o:p></o:p></p></div><div><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>&nbsp;</span><o:p></o:p></p></div><div><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>I had the job script do chown user:group2 on the copied executables and then chmod 6711, and then I observed that the child processes ran as user:group2, same as the rank 0 process, so the files they created had the desired group ownership.</span><o:p></o:p></p></div><div><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>&nbsp;</span><o:p></o:p></p></div><div><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>I will explore Reuti&#8217;s guidance as well.</span><o:p></o:p></p></div><div><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>&nbsp;</span><o:p></o:p></p></div><div><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>Thank you</span><o:p></o:p></p></div><div><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>&nbsp;</span><o:p></o:p></p></div><div><p class=MsoNormal><span style='font-size:11.0pt;font-family:"Calibri","sans-serif";color:#1F497D'>&nbsp;</span><o:p></o:p></p></div><div style='border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0in 0in 0in;border-width:initial;border-color:initial'><div><p class=MsoNormal><b><span style='font-size:10.0pt;font-family:"Tahoma","sans-serif"'>From:</span></b><span class=apple-converted-space><span style='font-size:10.0pt;font-family:"Tahoma","sans-serif"'>&nbsp;</span></span><span style='font-size:10.0pt;font-family:"Tahoma","sans-serif"'><a href="mailto:users-bounces@open-mpi.org">users-bounces@open-mpi.org</a><span class=apple-converted-space>&nbsp;</span>[mailto:users-bounces@open-mpi.org]<span class=apple-converted-space>&nbsp;</span><b>On Behalf Of<span class=apple-converted-space>&nbsp;</span></b>Randall Svancara<br><b>Sent:</b><span class=apple-converted-space>&nbsp;</span>Wednesday, September 14, 2011 3:07 PM<br><b>To:</b><span class=apple-converted-space>&nbsp;</span>Open MPI Users<br><b>Subject:</b><span class=apple-converted-space>&nbsp;</span>Re: [OMPI users] EXTERNAL: Re: Can you set the gid of the processes created by mpirun?</span><o:p></o:p></p></div></div><div><p class=MsoNormal>&nbsp;<o:p></o:p></p></div><p class=MsoNormal style='margin-bottom:12.0pt'>You could set the setuid bit on the application and chown it to root??&nbsp; It is about as secure as anything else that has been described thus far.&nbsp; As a system admin, I cringe at the thought of anything that would allow something to run as someone else,&nbsp; so there would have to be a pretty good justification for such unique use case as yours.&nbsp;<span class=apple-converted-space>&nbsp;</span><br><br>Randall<o:p></o:p></p><div><div><p class=MsoNormal>On Wed, Sep 14, 2011 at 12:56 PM, Reuti &lt;<a href="mailto:reuti@staff.uni-marburg.de">reuti@staff.uni-marburg.de</a>&gt; wrote:<o:p></o:p></p></div><div><p class=MsoNormal>Am 14.09.2011 um 19:02 schrieb Blosch, Edwin L:<o:p></o:p></p></div><div><p class=MsoNormal style='margin-bottom:12.0pt'><br>&gt; Thanks for trying.<br>&gt;<br>&gt; Do you feel that this is an impossible request without the assistance of some process running as root, for example, as Reuti mentioned, the daemons of a job scheduler? &nbsp;Or are you saying it will just not be as straightforward as calling setgid as you had hoped?<br>&gt;<br>&gt; Also, do you think there is a way I could make use of the sg command below? &nbsp;Perhaps there is a way to have the rsh/ssh launcher start the application processes with a command like 'sg &lt;group&gt; &lt;executable name&gt;'?<o:p></o:p></p></div><div><p class=MsoNormal>What about a half-tight integration (or call it: classic tight integration), i.e. no recompilation necessary?<br><br>- setup your mpiexec call in the jobscript to use a plain rsh for the remote startup (no path given): &#8211;mca plm_rsh_agent rsh<br><br>- the PE of SGE needs the argument -catch_rsh in start_proc_args and the supplied script in $SGE_ROOT/mpi/startmpi.sh<br><br>&nbsp;(SGE will create a symbolic link in $TMPDIR therein [which will be called first this way] to the rsh-wrapper in $SGE_ROOT/mpi [pitfall: some applications need a -V to be added in the lines woth &quot;qrsh&quot;, i.e. &quot;qrsh -inherit -V ...&quot; to send all environment variables to the slaves])<br><br>- what is your setting of qrsh_daemon/qrsh_command in `qconf -sconf`? This will then be used finally to reach the node and should be builtin or point to the SGE supplied rsh/rshd (no rshd necessary to install, no rshd is running all the time, no rshd will be started by xinet.d or alike)<br><br>- like you do already: switch off the built-in SGE starter in your mpiexec call: -mca plm_rsh_disable_qrsh 1<br><span style='color:#888888'><br>-- Reuti<br></span><br>PS: To avoid misunderstandings: you could also set &quot;&#8211;mca plm_rsh_agent foobar&quot; and in $SGE_ROOT/mpi/startmpi.sh you change it to create a symbolic link called &quot;foobar &quot; in $TMPDIR. It's just a name at this stage of startup.<o:p></o:p></p></div><div><div><div><p class=MsoNormal><br><br>&gt; Ed<br>&gt;<br>&gt;<br>&gt; NAME<br>&gt; &nbsp; &nbsp; &nbsp;sg - execute command as different group ID<br>&gt;<br>&gt; SYNOPSIS<br>&gt; &nbsp; &nbsp; &nbsp;sg [-] [group [-c ] command]<br>&gt;<br>&gt; DESCRIPTION<br>&gt; &nbsp; &nbsp; &nbsp;The sg command works similar to newgrp but accepts a command. The<br>&gt; &nbsp; &nbsp; &nbsp;command will be executed with the /bin/sh shell. With most shells you<br>&gt; &nbsp; &nbsp; &nbsp;may run sg from, you need to enclose multi-word commands in quotes.<br>&gt; &nbsp; &nbsp; &nbsp;Another difference between newgrp and sg is that some shells treat<br>&gt; &nbsp; &nbsp; &nbsp;newgrp specially, replacing themselves with a new instance of a shell<br>&gt; &nbsp; &nbsp; &nbsp;that newgrp creates. This doesn't happen with sg, so upon exit from a<br>&gt; &nbsp; &nbsp; &nbsp;sg command you are returned to your previous group ID.<br>&gt;<br>&gt;<br>&gt;<br>&gt;<br>&gt; -----Original Message-----<br>&gt; From:<span class=apple-converted-space>&nbsp;</span><a href="mailto:users-bounces@open-mpi.org">users-bounces@open-mpi.org</a><span class=apple-converted-space>&nbsp;</span>[mailto:<a href="mailto:users-bounces@open-mpi.org">users-bounces@open-mpi.org</a>] On Behalf Of Ralph Castain<br>&gt; Sent: Wednesday, September 14, 2011 11:33 AM<br>&gt; To: Open MPI Users<br>&gt; Subject: Re: [OMPI users] EXTERNAL: Re: Can you set the gid of the processes created by mpirun?<br>&gt;<br>&gt;<br>&gt; On Sep 14, 2011, at 9:39 AM, Blosch, Edwin L wrote:<br>&gt;<br>&gt;&gt; Thanks, Ralph,<br>&gt;&gt;<br>&gt;&gt; I get the failure messages, unfortunately:<br>&gt;&gt;<br>&gt;&gt; setgid FAILED<br>&gt;&gt; setgid FAILED<br>&gt;&gt; setgid FAILED<br>&gt;&gt;<br>&gt;&gt; I actually had attempted to call setgid from within the application previously, which looks similar to what you've done, but it failed. That was when I initiated the post to the mailing list. My conclusion, a guess really, was that Linux would not let me setgid from within my program because I was not root.<br>&gt;<br>&gt; I was afraid of that - the documentation seemed to indicate that would be the case, but I figured it was worth a quick try. Sorry I can't be of help.<br>&gt;<br>&gt;<br>&gt;&gt;<br>&gt;&gt;<br>&gt;&gt; -----Original Message-----<br>&gt;&gt; From:<span class=apple-converted-space>&nbsp;</span><a href="mailto:users-bounces@open-mpi.org">users-bounces@open-mpi.org</a><span class=apple-converted-space>&nbsp;</span>[mailto:<a href="mailto:users-bounces@open-mpi.org">users-bounces@open-mpi.org</a>] On Behalf Of Ralph Castain<br>&gt;&gt; Sent: Wednesday, September 14, 2011 8:15 AM<br>&gt;&gt; To: Open MPI Users<br>&gt;&gt; Subject: Re: [OMPI users] EXTERNAL: Re: Can you set the gid of the processes created by mpirun?<br>&gt;&gt;<br>&gt;&gt; The attached should set the gid of the remote daemons (and their children) to the gid of mpirun. No cmd line option or anything is required - it will just always do it.<br>&gt;&gt;<br>&gt;&gt; Would you mind giving it a try?<br>&gt;&gt;<br>&gt;&gt; Please let me know if/how it works.<br>&gt;&gt;<br>&gt;&gt; _______________________________________________<br>&gt;&gt; users mailing list<br>&gt;&gt;<span class=apple-converted-space>&nbsp;</span><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>&gt;&gt;<span class=apple-converted-space>&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>&gt;<br>&gt;<br>&gt; _______________________________________________<br>&gt; users mailing list<br>&gt;<span class=apple-converted-space>&nbsp;</span><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>&gt;<span class=apple-converted-space>&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>&gt; _______________________________________________<br>&gt; users mailing list<br>&gt;<span class=apple-converted-space>&nbsp;</span><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>&gt;<span class=apple-converted-space>&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br><br><br>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><o:p></o:p></p></div></div></div></div><div><p class=MsoNormal><br><br clear=all><br>--<span class=apple-converted-space>&nbsp;</span><br>Randall Svancara<br><a href="http://knowyourlinux.com/" target="_blank">http://knowyourlinux.com/</a><o:p></o:p></p></div><p class=MsoNormal><span style='font-size:13.5pt;font-family:"Helvetica","sans-serif"'>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><o:p></o:p></span></p></div></div><p class=MsoNormal><o:p>&nbsp;</o:p></p></div></div></body></html>
