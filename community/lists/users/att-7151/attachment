<html><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div>Hi again,</div><div><br></div>Using MPI_Type_get_true_extent(), I changed the way of reporting type size and extent to:<div><br></div><div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="color: #294277"><span class="Apple-tab-span" style="white-space:pre">	</span>int</span> typesize;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span><span style="color: #294277">long</span> typeextent, typelb;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span>MPI_Type_size(<span style="color: #294277">this</span>->datatype,&amp;typesize);</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span>MPI_Type_get_true_extent(<span style="color: #294277">this</span>->datatype,&amp;typelb,&amp;typeextent);</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(195, 116, 28); "><span style="color: #000000"><span class="Apple-tab-span" style="white-space:pre">	</span></span>//MPI_Type_lb(this->datatype,&amp;typelb);</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(195, 116, 28); "><span style="color: #000000"><span class="Apple-tab-span" style="white-space:pre">	</span></span>//MPI_Type_extent(this->datatype,&amp;typeextent);</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(223, 7, 0); "><span style="color: #000000"><span class="Apple-tab-span" style="white-space:pre">	</span>printf(</span>"\ntype size for process rank (%d,%d) is %d doubles, type extent is %d doubles (up to %d), range is [%d, %d].\n"<span style="color: #000000">,pr,pc,typesize/(</span><span style="color: #294277">int</span><span style="color: #000000">)</span><span style="color: #294277">sizeof</span><span style="color: #000000">(</span><span style="color: #294277">double</span><span style="color: #000000">),(</span><span style="color: #294277">int</span><span style="color: #000000">)(typeextent/</span><span style="color: #294277">sizeof</span><span style="color: #000000">(</span><span style="color: #294277">double</span><span style="color: #000000">)),nx*ny,(</span><span style="color: #294277">int</span><span style="color: #000000">)(typelb/</span><span style="color: #294277">sizeof</span><span style="color: #000000">(</span><span style="color: #294277">double</span><span style="color: #000000">)),(</span><span style="color: #294277">int</span><span style="color: #000000">)((typelb+typeextent)/</span><span style="color: #294277">sizeof</span><span style="color: #000000">(</span><span style="color: #294277">double</span><span style="color: #000000">)));</span></div><p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco; min-height: 14.0px"><span class="Apple-tab-span" style="white-space:pre">	</span></p><div><div>Which now is giving me the correct answers for both situations. For the first one (works):</div><div><br></div><div><span class="Apple-tab-span" style="white-space:pre">	</span>type size for process rank (1,0) is 20 doubles, type extent is 60 doubles (up to 91), range is [28, 88].</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>type size for process rank (0,0) is 32 doubles, type extent is 81 doubles (up to 91), range is [0, 81].</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>type size for process rank (0,1) is 24 doubles, type extent is 80 doubles (up to 91), range is [4, 84].</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>type size for process rank (1,1) is 15 doubles, type extent is 59 doubles (up to 91), range is [32, 91].</div><div><br></div><div>For the second one (before getting the same double free error with MPI_File_set_view):</div><div><br></div><div><div><span class="Apple-tab-span" style="white-space:pre">	</span>type size for process rank (1,0) is 20 doubles, type extent is 48 doubles (up to 91), range is [4, 52].</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>type size for process rank (0,0) is 32 doubles, type extent is 51 doubles (up to 91), range is [0, 51].</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>type size for process rank (0,1) is 24 doubles, type extent is 38 doubles (up to 91), range is [52, 90].</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>type size for process rank (1,1) is 15 doubles, type extent is 35 doubles (up to 91), range is [56, 91].</div><div><br></div><div>Can anybody give me a hint here? Is there a bug in MPI_Type_create_darray I should be aware of?</div><div><br></div><div>Best,</div><div>A</div><div><br></div></div><div>On Oct 30, 2008, at 5:21 PM, Antonio Molins wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">Hi all,<div><br></div><div>I am having some trouble with this function. I want to map data to a 2x2 block-cyclic configuration in C, using the code:</div><div><br></div><div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span>MPI_Barrier(blacs_comm);</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(195, 116, 28); "><span style="color: #000000"><span class="Apple-tab-span" style="white-space:pre">	</span></span>// size of each matrix</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span><span style="color: #294277">int</span> *array_of_gsizes = <span style="color: #294277">new</span> <span style="color: #294277">int</span>[<span style="color: #294277">2</span>];</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span>array_of_gsizes[<span style="color: #294277">0</span>]=<span style="color: #294277">this</span>->nx;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span>array_of_gsizes[<span style="color: #294277">1</span>]=<span style="color: #294277">this</span>->ny;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(195, 116, 28); "><span style="color: #000000"><span class="Apple-tab-span" style="white-space:pre">	</span></span>// block-cyclic distritution used by ScaLAPACK</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span><span style="color: #294277">int</span> *array_of_distrs = <span style="color: #294277">new</span> <span style="color: #294277">int</span>[<span style="color: #294277">2</span>];</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span>array_of_distrs[<span style="color: #294277">0</span>]=MPI_DISTRIBUTE_CYCLIC;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span>array_of_distrs[<span style="color: #294277">1</span>]=MPI_DISTRIBUTE_CYCLIC;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span><span style="color: #294277">int</span> *array_of_dargs = <span style="color: #294277">new</span> <span style="color: #294277">int</span>[<span style="color: #294277">2</span>];</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span>array_of_dargs[<span style="color: #294277">0</span>]=BLOCK_SIZE;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span>array_of_dargs[<span style="color: #294277">1</span>]=BLOCK_SIZE;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span><span style="color: #294277">int</span> *array_of_psizes = <span style="color: #294277">new</span> <span style="color: #294277">int</span>[<span style="color: #294277">2</span>];</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span>array_of_psizes[<span style="color: #294277">0</span>]=Pr;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span>array_of_psizes[<span style="color: #294277">1</span>]=Pc;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(195, 116, 28); "><span style="color: #000000"><span class="Apple-tab-span" style="white-space:pre">	</span></span><span style="color: #294277">int</span><span style="color: #000000"> rank = pc+pr*Pc;&nbsp;</span></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span>MPI_Type_create_darray(Pr*Pc,rank,<span style="color: #294277">2</span>,array_of_gsizes,array_of_distrs,array_of_dargs,</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">							</span>array_of_psizes,MPI_ORDER_C,MPI_DOUBLE,&amp;<span style="color: #294277">this</span>->datatype);</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span>MPI_Type_commit(&amp;<span style="color: #294277">this</span>->datatype);</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span><span style="color: #294277">int</span> typesize;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span><span style="color: #294277">long</span> typeextent;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span>MPI_Type_size(<span style="color: #294277">this</span>->datatype,&amp;typesize);</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span>MPI_Type_extent(<span style="color: #294277">this</span>->datatype,&amp;typeextent);</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(223, 7, 0); "><span style="color: #000000"><span class="Apple-tab-span" style="white-space:pre">	</span>printf(</span>"type size for process rank (%d,%d) is %d doubles, type extent is %d doubles (up to&nbsp;%d)."<span style="color: #000000">,pr,pc,typesize/(</span><span style="color: #294277">int</span><span style="color: #000000">)</span><span style="color: #294277">sizeof</span><span style="color: #000000">(</span><span style="color: #294277">double</span><span style="color: #000000">),(</span><span style="color: #294277">int</span><span style="color: #000000">)(typeextent/</span><span style="color: #294277">sizeof</span><span style="color: #000000">(</span><span style="color: #294277">double</span><span style="color: #000000">)),nx*ny);</span></div></div><div><font class="Apple-style-span" face="Monaco" size="2"><span class="Apple-style-span" style="font-size: 10px;"><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span>MPI_File_open(blacs_comm,(<span style="color: #294277">char</span>*)filename, MPI_MODE_RDWR, MPI_INFO_NULL, &amp;<span style="color: #294277">this</span>->fid);</div><div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space:pre">	</span>MPI_File_set_view(<span style="color: #294277">this</span>->fid,<span style="color: #294277">this</span>->offset+i*nx*ny*<span style="color: #294277">sizeof</span>(<span style="color: #294277">double</span>),MPI_DOUBLE,<span style="color: #294277">this</span>->datatype,<span style="color: #df0700">"native"</span>,MPI_INFO_NULL);<span class="Apple-tab-span" style="white-space:pre">	</span></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span class="Apple-tab-span" style="white-space:pre">	</span><br class="webkit-block-placeholder"></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><br></div></div></span></font></div><div apple-content-edited="true"> <span class="Apple-style-span" style="border-collapse: separate; color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0; "><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><span class="Apple-style-span" style="border-collapse: separate; color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; "><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><span class="Apple-style-span" style="border-collapse: separate; color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; "><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div>This works well when used like this, but problem is that the matrix itself is written in disk column-major fashion, so I would want to use the code as if I was reading it transposed, that is:</div><div><br></div><div><span class="Apple-style-span" style="font-family: Monaco; font-size: 10px; "><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span>MPI_Barrier(blacs_comm);</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(195, 116, 28); "><span style="color: rgb(0, 0, 0); "><span class="Apple-tab-span" style="white-space: pre; ">	</span></span>// size of each matrix</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span><span style="color: rgb(41, 66, 119); ">int</span>&nbsp;*array_of_gsizes =&nbsp;<span style="color: rgb(41, 66, 119); ">new</span>&nbsp;<span style="color: rgb(41, 66, 119); ">int</span>[<span style="color: rgb(41, 66, 119); ">2</span>];</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span>array_of_gsizes[<span style="color: rgb(41, 66, 119); ">0</span>]=<span style="color: rgb(41, 66, 119); ">this</span>->ny;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span>array_of_gsizes[<span style="color: rgb(41, 66, 119); ">1</span>]=<span style="color: rgb(41, 66, 119); ">this</span>->nx;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(195, 116, 28); "><span style="color: rgb(0, 0, 0); "><span class="Apple-tab-span" style="white-space: pre; ">	</span></span>// block-cyclic distritution used by ScaLAPACK</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span><span style="color: rgb(41, 66, 119); ">int</span>&nbsp;*array_of_distrs =&nbsp;<span style="color: rgb(41, 66, 119); ">new</span>&nbsp;<span style="color: rgb(41, 66, 119); ">int</span>[<span style="color: rgb(41, 66, 119); ">2</span>];</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span>array_of_distrs[<span style="color: rgb(41, 66, 119); ">0</span>]=MPI_DISTRIBUTE_CYCLIC;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span>array_of_distrs[<span style="color: rgb(41, 66, 119); ">1</span>]=MPI_DISTRIBUTE_CYCLIC;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span><span style="color: rgb(41, 66, 119); ">int</span>&nbsp;*array_of_dargs =&nbsp;<span style="color: rgb(41, 66, 119); ">new</span>&nbsp;<span style="color: rgb(41, 66, 119); ">int</span>[<span style="color: rgb(41, 66, 119); ">2</span>];</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span>array_of_dargs[<span style="color: rgb(41, 66, 119); ">0</span>]=BLOCK_SIZE;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span>array_of_dargs[<span style="color: rgb(41, 66, 119); ">1</span>]=BLOCK_SIZE;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span><span style="color: rgb(41, 66, 119); ">int</span>&nbsp;*array_of_psizes =&nbsp;<span style="color: rgb(41, 66, 119); ">new</span>&nbsp;<span style="color: rgb(41, 66, 119); ">int</span>[<span style="color: rgb(41, 66, 119); ">2</span>];</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span>array_of_psizes[<span style="color: rgb(41, 66, 119); ">0</span>]=Pr;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span>array_of_psizes[<span style="color: rgb(41, 66, 119); ">1</span>]=Pc;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(195, 116, 28); "><span style="color: rgb(0, 0, 0); "><span class="Apple-tab-span" style="white-space: pre; ">	</span></span><span style="color: rgb(41, 66, 119); ">int</span><span style="color: rgb(0, 0, 0); ">&nbsp;rank = pr+pc*Pr;&nbsp;</span></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span>MPI_Type_create_darray(Pr*Pc,rank,<span style="color: rgb(41, 66, 119); ">2</span>,array_of_gsizes,array_of_distrs,array_of_dargs,</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">							</span>array_of_psizes,MPI_ORDER_C,MPI_DOUBLE,&amp;<span style="color: rgb(41, 66, 119); ">this</span>->datatype);</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span>MPI_Type_commit(&amp;<span style="color: rgb(41, 66, 119); ">this</span>->datatype);</div><div><font class="Apple-style-span" face="Monaco" size="2"><span class="Apple-style-span" style="font-family: Helvetica; font-size: 12px; "><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span>MPI_Type_size(<span style="color: rgb(41, 66, 119); ">this</span>->datatype,&amp;typesize);</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span>MPI_Type_extent(<span style="color: rgb(41, 66, 119); ">this</span>->datatype,&amp;typeextent);</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(223, 7, 0); "><span style="color: rgb(0, 0, 0); "><span class="Apple-tab-span" style="white-space: pre; ">	</span>printf(</span>"type size for process rank (%d,%d) is %d doubles, type extent is %d doubles (up to&nbsp;%d)."<span style="color: rgb(0, 0, 0); ">,pr,pc,typesize/(</span><span style="color: rgb(41, 66, 119); ">int</span><span style="color: rgb(0, 0, 0); ">)</span><span style="color: rgb(41, 66, 119); ">sizeof</span><span style="color: rgb(0, 0, 0); ">(</span><span style="color: rgb(41, 66, 119); ">double</span><span style="color: rgb(0, 0, 0); ">),(</span><span style="color: rgb(41, 66, 119); ">int</span><span style="color: rgb(0, 0, 0); ">)(typeextent/</span><span style="color: rgb(41, 66, 119); ">sizeof</span><span style="color: rgb(0, 0, 0); ">(</span><span style="color: rgb(41, 66, 119); ">double</span><span style="color: rgb(0, 0, 0); ">)),nx*ny);</span></div></div></span><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span>MPI_File_open(blacs_comm,(<span style="color: rgb(41, 66, 119); ">char</span>*)filename, MPI_MODE_RDWR, MPI_INFO_NULL, &amp;<span style="color: rgb(41, 66, 119); ">this</span>->fid);</div><div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-tab-span" style="white-space: pre; ">	</span>MPI_File_set_view(<span style="color: rgb(41, 66, 119); ">this</span>->fid,<span style="color: rgb(41, 66, 119); ">this</span>->offset+i*nx*ny*<span style="color: rgb(41, 66, 119); ">sizeof</span>(<span style="color: rgb(41, 66, 119); ">double</span>),MPI_DOUBLE,<span style="color: rgb(41, 66, 119); ">this</span>->datatype,<span style="color: rgb(223, 7, 0); ">"native"</span>,MPI_INFO_NULL);<span class="Apple-tab-span" style="white-space: pre; ">	</span></div></div></font></div></span></div><div><br></div><div>To my surprise, this code crashes while calling MPI_File_set_view()!!! And before you ask, I did try switching MPI_ORDER_C to MPI_ORDER_FORTRAN, I got the same results I am reporting here.</div><div><br></div><div>Also, I am quite intrigued by the text output of each of these programs: the first one will report:</div><div><br></div><div><div><span class="Apple-tab-span" style="white-space:pre">	</span>type size for process rank (0,0) is 32 doubles, type extent is 91 doubles (up to 91).</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>type size for process rank (1,0) is 20 doubles, type extent is 119 doubles (up to 91).</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>type size for process rank (0,1) is 24 doubles, type extent is 95 doubles (up to 91).</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>type size for process rank (1,1) is 15 doubles, type extent is 123 doubles (up to 91).</div><div><br></div><div>Anybody know why the extents are not equal???</div><div><br></div><div>Even weirder, the second one will report:</div><div><br></div><div><div><span class="Apple-tab-span" style="white-space:pre">	</span>type size for process rank (0,0) is 32 doubles, type extent is 91 doubles (up to 91).</div><div><div><span class="Apple-tab-span" style="white-space: pre; ">	</span>type size for process rank (1,0) is 20 doubles, type extent is 95 doubles (up to 91).</div></div><div><span class="Apple-tab-span" style="white-space:pre">	</span>type size for process rank (0,1) is 24 doubles, type extent is 143 doubles (up to 91).</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>type size for process rank (1,1) is 15 doubles, type extent is 147 doubles (up to 91).</div><div><br></div></div><div>The extent changed! I think this is somehow related to the posterior crash of MPI_File_set_view(), but that's as far as I can understand...</div><div><br></div></div><div>Any clue about what is happening? I attach the trace below.</div><div><br></div><div>Best,</div><div>A</div><div><br></div><div>--------------------------------------------------------------------------------</div><div>Antonio Molins, PhD Candidate</div><div>Medical Engineering and Medical Physics</div><div>Harvard - MIT Division of Health Sciences and Technology</div><div>--</div><div>"When a traveler reaches a fork in the road,&nbsp;</div><div><div>the<span class="Apple-converted-space">&nbsp;</span>ℓ1<span class="Apple-converted-space">&nbsp;</span>-norm tells him to take either one way or the other,&nbsp;</div><div>but the<span class="Apple-converted-space">&nbsp;</span>ℓ2<span class="Apple-converted-space">&nbsp;</span>-norm instructs him to head off into the bushes. "</div><div><br></div><div><span class="Apple-tab-span" style="white-space: pre; ">			</span>John F. Claerbout and Francis Muir, 1973&nbsp;</div><div><div>--------------------------------------------------------------------------------</div><br></div><div><div>*** glibc detected *** double free or corruption (!prev): 0x0000000000cf4130 ***</div><div>[login4:26709] *** Process received signal ***</div><div>[login4:26708] *** Process received signal ***</div><div>[login4:26708] Signal: Aborted (6)</div><div>[login4:26708] Signal code: &nbsp;(-6)</div><div>[login4:26709] Signal: Segmentation fault (11)</div><div>[login4:26709] Signal code: Address not mapped (1)</div><div>[login4:26709] Failing at address: 0x18</div><div>[login4:26708] [ 0] /lib64/tls/libpthread.so.0 [0x36ff10c5b0]</div><div>[login4:26708] [ 1] /lib64/tls/libc.so.6(gsignal+0x3d) [0x36fe62e26d]</div><div>[login4:26708] [ 2] /lib64/tls/libc.so.6(abort+0xfe) [0x36fe62fa6e]</div><div>[login4:26708] [ 3] /lib64/tls/libc.so.6 [0x36fe6635f1]</div><div>[login4:26708] [ 4] /lib64/tls/libc.so.6 [0x36fe6691fe]</div><div>[login4:26708] [ 5] /lib64/tls/libc.so.6(__libc_free+0x76) [0x36fe669596]</div><div>[login4:26708] [ 6] /opt/apps/intel10_1/openmpi/1.3/lib/libmpi.so.0 [0x2a962cc4ae]</div><div>[login4:26708] [ 7] /opt/apps/intel10_1/openmpi/1.3/lib/libmpi.so.0(ompi_ddt_destroy+0x65) [0x2a962cd31d]</div><div>[login4:26708] [ 8] /opt/apps/intel10_1/openmpi/1.3/lib/libmpi.so.0(MPI_Type_free+0x5b) [0x2a962f654f]</div><div>[login4:26708] [ 9] /opt/apps/intel10_1/openmpi/1.3/lib/openmpi/mca_io_romio.so(ADIOI_Flatten+0x1804) [0x2aa4603612]</div><div>[login4:26708] [10] /opt/apps/intel10_1/openmpi/1.3/lib/openmpi/mca_io_romio.so(ADIOI_Flatten_datatype+0xe7) [0x2aa46017fd]</div><div>[login4:26708] [11] /opt/apps/intel10_1/openmpi/1.3/lib/openmpi/mca_io_romio.so(ADIO_Set_view+0x14f) [0x2aa45ecb57]</div><div>[login4:26708] [12] /opt/apps/intel10_1/openmpi/1.3/lib/openmpi/mca_io_romio.so(mca_io_romio_dist_MPI_File_set_view+0x1dd) [0x2aa46088a9]</div><div>[login4:26708] [13] /opt/apps/intel10_1/openmpi/1.3/lib/openmpi/mca_io_romio.so [0x2aa45ec288]</div><div>[login4:26708] [14] /opt/apps/intel10_1/openmpi/1.3/lib/libmpi.so.0(MPI_File_set_view+0x53) [0x2a963002ff]</div><div>[login4:26708] [15] ./bin/test2(_ZN14pMatCollection3getEiP7pMatrix+0xc3) [0x42a50b]</div><div>[login4:26708] [16] ./bin/test2(main+0xc2e) [0x43014a]</div><div>[login4:26708] [17] /lib64/tls/libc.so.6(__libc_start_main+0xdb) [0x36fe61c40b]</div><div>[login4:26708] [18] ./bin/test2(_ZNSt8ios_base4InitD1Ev+0x42) [0x41563a]</div><div>[login4:26708] *** End of error message ***</div><div>[login4:26709] [ 0] /lib64/tls/libpthread.so.0 [0x36ff10c5b0]</div><div>[login4:26709] [ 1] /lib64/tls/libc.so.6 [0x36fe66882b]</div><div>[login4:26709] [ 2] /lib64/tls/libc.so.6 [0x36fe668f8d]</div><div>[login4:26709] [ 3] /lib64/tls/libc.so.6(__libc_free+0x76) [0x36fe669596]</div><div>[login4:26709] [ 4] /opt/apps/intel10_1/openmpi/1.3/lib/libmpi.so.0 [0x2a962cc4ae]</div><div>[login4:26709] [ 5] /opt/apps/intel10_1/openmpi/1.3/lib/libmpi.so.0(ompi_ddt_release_args+0x93) [0x2a962d5641]</div><div>[login4:26709] [ 6] /opt/apps/intel10_1/openmpi/1.3/lib/libmpi.so.0 [0x2a962cc514]</div><div>[login4:26709] [ 7] /opt/apps/intel10_1/openmpi/1.3/lib/libmpi.so.0(ompi_ddt_release_args+0x93) [0x2a962d5641]</div><div>[login4:26709] [ 8] /opt/apps/intel10_1/openmpi/1.3/lib/libmpi.so.0 [0x2a962cc514]</div><div>[login4:26709] [ 9] /opt/apps/intel10_1/openmpi/1.3/lib/libmpi.so.0(ompi_ddt_destroy+0x65) [0x2a962cd31d]</div><div>[login4:26709] [10] /opt/apps/intel10_1/openmpi/1.3/lib/libmpi.so.0(MPI_Type_free+0x5b) [0x2a962f654f]</div><div>[login4:26709] [11] /opt/apps/intel10_1/openmpi/1.3/lib/openmpi/mca_io_romio.so(ADIOI_Flatten+0x147) [0x2aa4601f55]</div><div>[login4:26709] [12] /opt/apps/intel10_1/openmpi/1.3/lib/openmpi/mca_io_romio.so(ADIOI_Flatten+0x1569) [0x2aa4603377]</div><div>[login4:26709] [13] /opt/apps/intel10_1/openmpi/1.3/lib/openmpi/mca_io_romio.so(ADIOI_Flatten_datatype+0xe7) [0x2aa46017fd]</div><div>[login4:26709] [14] /opt/apps/intel10_1/openmpi/1.3/lib/openmpi/mca_io_romio.so(ADIO_Set_view+0x14f) [0x2aa45ecb57]</div><div>[login4:26709] [15] /opt/apps/intel10_1/openmpi/1.3/lib/openmpi/mca_io_romio.so(mca_io_romio_dist_MPI_File_set_view+0x1dd) [0x2aa46088a9]</div><div>[login4:26709] [16] /opt/apps/intel10_1/openmpi/1.3/lib/openmpi/mca_io_romio.so [0x2aa45ec288]</div><div>[login4:26709] [17] /opt/apps/intel10_1/openmpi/1.3/lib/libmpi.so.0(MPI_File_set_view+0x53) [0x2a963002ff]</div><div>[login4:26709] [18] ./bin/test2(_ZN14pMatCollection3getEiP7pMatrix+0xc3) [0x42a50b]</div><div>[login4:26709] [19] ./bin/test2(main+0xc2e) [0x43014a]</div><div>[login4:26709] [20] /lib64/tls/libc.so.6(__libc_start_main+0xdb) [0x36fe61c40b]</div><div>[login4:26709] [21] ./bin/test2(_ZNSt8ios_base4InitD1Ev+0x42) [0x41563a]</div><div>[login4:26709] *** End of error message ***</div><div>--------------------------------------------------------------------------</div><div>mpirun noticed that process rank 2 with PID 26708 on node login4.ranger.tacc.utexas.edu exited on signal 6 (Aborted).</div><div>--------------------------------------------------------------------------</div></div></div></div></span><br class="Apple-interchange-newline"></div></span><br class="Apple-interchange-newline"></div></span><br class="Apple-interchange-newline"> </div><br></div></div>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a></blockquote></div><br><div> <span class="Apple-style-span" style="border-collapse: separate; color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0; "><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div><div>--------------------------------------------------------------------------------</div><div>Antonio Molins, PhD Candidate</div><div>Medical Engineering and Medical Physics</div><div>Harvard - MIT Division of Health Sciences and Technology</div><div>--</div><div>"Y así del poco dormir y del mucho leer,</div><div>se le secó el cerebro de manera que vino</div><div>a perder el juicio".</div><div>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;Miguel de Cervantes</div><div>--------------------------------------------------------------------------------</div><br></div></div></span><br class="Apple-interchange-newline"> </div><br></div></body></html>
