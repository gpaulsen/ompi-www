<html><head><meta http-equiv="Content-Type" content="text/html charset=us-ascii"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;" class="">Hello everyone,<div class=""><br class=""><div class="">in my application I use CUDA-aware OpenMPI 1.10.2 together with CUDA 7.5. If I call cudaSetDevice() cuda-memcheck reports this error for all subsequent MPI function calls:</div></div><div class=""><br class=""></div><div class=""><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">========= CUDA-MEMCHECK</span></div><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">========= Program hit CUDA_ERROR_INVALID_VALUE (error 1) due to "invalid argument" on CUDA API call to cuPointerGetAttributes.&nbsp;</span></div><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">========= &nbsp; &nbsp; Saved host backtrace up to driver entry point at error</span></div><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">========= &nbsp; &nbsp; Host Frame:/usr/lib64/libcuda.so.1 (cuPointerGetAttributes + 0x18d) [0x144ffd]</span></div><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">========= &nbsp; &nbsp; Host Frame:/modules/opt/spack/linux-x86_64/gcc-5.3.0/openmpicuda-1.10.2-y246ecjlhmkkh7lhbrgvdwpazc4mgetr/lib/libmpi.so.12 [0xb0f52]</span></div><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">========= &nbsp; &nbsp; Host Frame:/modules/opt/spack/linux-x86_64/gcc-5.3.0/openmpicuda-1.10.2-y246ecjlhmkkh7lhbrgvdwpazc4mgetr/lib/libopen-pal.so.13 (mca_cuda_convertor_init + 0xac) [0x3cbcc]</span></div><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">========= &nbsp; &nbsp; Host Frame:/modules/opt/spack/linux-x86_64/gcc-5.3.0/openmpicuda-1.10.2-y246ecjlhmkkh7lhbrgvdwpazc4mgetr/lib/libopen-pal.so.13 (opal_convertor_prepare_for_recv + 0x25) [0x33f65]</span></div><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">========= &nbsp; &nbsp; Host Frame:/modules/opt/spack/linux-x86_64/gcc-5.3.0/openmpicuda-1.10.2-y246ecjlhmkkh7lhbrgvdwpazc4mgetr/lib/libmpi.so.12 (mca_pml_ob1_recv_req_start + 0x15e) [0x1b487e]</span></div><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">========= &nbsp; &nbsp; Host Frame:/modules/opt/spack/linux-x86_64/gcc-5.3.0/openmpicuda-1.10.2-y246ecjlhmkkh7lhbrgvdwpazc4mgetr/lib/libmpi.so.12 (mca_pml_ob1_irecv + 0xc4) [0x1ab464]</span></div><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">========= &nbsp; &nbsp; Host Frame:/modules/opt/spack/linux-x86_64/gcc-5.3.0/openmpicuda-1.10.2-y246ecjlhmkkh7lhbrgvdwpazc4mgetr/lib/libmpi.so.12 (ompi_coll_tuned_barrier_intra_recursivedoubling + 0xde) [0x13d79e]</span></div><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">========= &nbsp; &nbsp; Host Frame:/modules/opt/spack/linux-x86_64/gcc-5.3.0/openmpicuda-1.10.2-y246ecjlhmkkh7lhbrgvdwpazc4mgetr/lib/libmpi.so.12 (MPI_Barrier + 0x72) [0x86eb2]</span></div><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">========= &nbsp; &nbsp; Host Frame:./Errortest [0x2cb3]</span></div><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">========= &nbsp; &nbsp; Host Frame:/usr/lib64/libc.so.6 (__libc_start_main + 0xf5) [0x21b15]</span></div><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">========= &nbsp; &nbsp; Host Frame:./Errortest [0x2b99]</span></div></div><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="font-variant-ligatures: no-common-ligatures" class=""><br class=""></span></div><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">A minimal example that reproduces the error on my system is:</span></div><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="color: rgb(213, 59, 211); font-variant-ligatures: no-common-ligatures;" class="">#include </span><span style="font-variant-ligatures: no-common-ligatures; color: rgb(195, 55, 32);" class="">&lt;mpi.h&gt;</span></div><div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;" class=""><span style="font-variant-ligatures: no-common-ligatures" class=""><div style="margin: 0px; line-height: normal; min-height: 13px;" class=""><span style="font-variant-ligatures: no-common-ligatures" class=""></span><br class=""></div><div style="margin: 0px; line-height: normal;" class=""><span style="font-variant-ligatures: no-common-ligatures; color: #34bd26" class="">int</span><span style="font-variant-ligatures: no-common-ligatures" class=""> main(</span><span style="font-variant-ligatures: no-common-ligatures; color: #34bd26" class="">int</span><span style="font-variant-ligatures: no-common-ligatures" class=""> argc, </span><span style="font-variant-ligatures: no-common-ligatures; color: #34bd26" class="">char</span><span style="font-variant-ligatures: no-common-ligatures" class=""> *argv[]) {</span></div><div style="margin: 0px; line-height: normal; min-height: 13px;" class=""><span style="font-variant-ligatures: no-common-ligatures" class=""></span><br class=""></div><div style="margin: 0px; line-height: normal;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">&nbsp; &nbsp; MPI_Init(&amp;argc, &amp;argv);</span></div><div style="margin: 0px; line-height: normal; min-height: 13px;" class=""><span style="font-variant-ligatures: no-common-ligatures" class=""></span><br class=""></div><div style="margin: 0px; line-height: normal;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">&nbsp; &nbsp; cudaSetDevice(</span><span style="font-variant-ligatures: no-common-ligatures; color: #c33720" class="">0</span><span style="font-variant-ligatures: no-common-ligatures" class="">);</span></div><div style="margin: 0px; line-height: normal; min-height: 13px;" class=""><span style="font-variant-ligatures: no-common-ligatures" class=""></span><br class=""></div><div style="margin: 0px; line-height: normal;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">&nbsp; &nbsp; MPI_Barrier(MPI_COMM_WORLD);</span></div><div style="margin: 0px; line-height: normal; min-height: 13px;" class=""><span style="font-variant-ligatures: no-common-ligatures" class=""></span><br class=""></div><div style="margin: 0px; line-height: normal;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">&nbsp; &nbsp; MPI_Finalize();</span></div><div style="margin: 0px; line-height: normal;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">&nbsp; &nbsp; </span><span style="font-variant-ligatures: no-common-ligatures; color: #ce7924" class="">return</span><span style="font-variant-ligatures: no-common-ligatures" class=""> </span><span style="font-variant-ligatures: no-common-ligatures; color: #c33720" class="">0</span><span style="font-variant-ligatures: no-common-ligatures" class="">;</span></div><div style="margin: 0px; line-height: normal;" class=""><span style="font-variant-ligatures: no-common-ligatures" class="">}</span></div><div style="margin: 0px; line-height: normal;" class=""><br class=""></div><div style="margin: 0px; line-height: normal;" class="">I find the same behavior when cudaSetDevice() is swapped with MPI_Init(). How can I avoid these errors and still select the GPU to work on?</div><div style="margin: 0px; line-height: normal;" class=""><br class=""></div><div style="margin: 0px; line-height: normal;" class="">Thank you,&nbsp;</div><div style="margin: 0px; line-height: normal;" class="">Kristina</div><div style="margin: 0px; line-height: normal;" class=""><br class=""></div><div style="margin: 0px; line-height: normal;" class=""><br class=""></div></span></div></body></html>
