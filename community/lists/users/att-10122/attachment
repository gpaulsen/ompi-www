<html><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div>Hi George</div><div><br></div><div>I did some extra digging and found that (for some reason) the MPI_IN_PLACE parameter is not being recognized as such by&nbsp;mpi_reduce_f (reduce_f.c:61). I added a couple of printfs:</div><div><br></div><div><div>&nbsp;&nbsp; &nbsp;printf(" sendbuf = %p \n", sendbuf );</div><div><br></div><div>&nbsp;&nbsp; &nbsp;printf(" MPI_FORTRAN_IN_PLACE = %p \n", &amp;MPI_FORTRAN_IN_PLACE );</div><div>&nbsp;&nbsp; &nbsp;printf(" mpi_fortran_in_place = %p \n", &amp;mpi_fortran_in_place );</div><div>&nbsp;&nbsp; &nbsp;printf(" mpi_fortran_in_place_ = %p \n", &amp;mpi_fortran_in_place_ );</div><div>&nbsp;&nbsp; &nbsp;printf(" mpi_fortran_in_place__ = %p \n", &amp;mpi_fortran_in_place__ );</div><div><br></div><div>And this is what I get on node 0:</div><div><br></div><div><div>&nbsp;sendbuf = 0x50920&nbsp;</div><div>&nbsp;MPI_FORTRAN_IN_PLACE = 0x17cd30&nbsp;</div><div>&nbsp;mpi_fortran_in_place = 0x17cd34&nbsp;</div><div>&nbsp;mpi_fortran_in_place_ = 0x17cd38&nbsp;</div><div>&nbsp;mpi_fortran_in_place__ = 0x17cd3c&nbsp;</div><div><br></div></div></div><div>This makes&nbsp;OMPI_F2C_IN_PLACE(sendbuf) fail. If I replace the line:</div><div><br></div><div>sendbuf = OMPI_F2C_IN_PLACE(sendbuf);</div><div><br></div><div>with:</div><div><br></div><div><div>&nbsp;&nbsp; &nbsp;if ( sendbuf == 0x50920 ) {</div><div>&nbsp;&nbsp; &nbsp; &nbsp;printf("sendbuf is MPI_IN_PLACE!\n");</div><div>&nbsp;&nbsp; &nbsp; &nbsp;sendbuf = MPI_IN_PLACE;</div><div>&nbsp;&nbsp; &nbsp;}</div><div><br></div><div>Then the code works and gives the correct result:</div><div><br></div><div><div>sendbuf is MPI_IN_PLACE!</div><div>&nbsp;Result:</div><div><div>&nbsp;3. 3. 3. 3.</div><div><br></div></div></div><div>So my guess is that somehow the MPI_IN_PLACE constant for fortran is getting the wrong address. Could this be related to the fortran compilers I'm using (ifort / g95)?</div><div><br></div><div>Ricardo</div></div><br><div apple-content-edited="true"> <span class="Apple-style-span" style="font-size: 12px; "><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">---<span class="Apple-converted-space">&nbsp;</span></font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">Prof. Ricardo Fonseca</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; min-height: 14px; "><br></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">GoLP - Grupo de Lasers e Plasmas</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Instituto de Plasmas e Fusão Nuclear</p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">Instituto Superior Técnico</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">Av. Rovisco Pais</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">1049-001 Lisboa</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">Portugal</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; min-height: 14px; "><br></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">tel: +351 21 8419202</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">fax: +351 21 8464455</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">web: <a href="http://cfp.ist.utl.pt/golp/">http://cfp.ist.utl.pt/golp/</a><span class="Apple-converted-space">&nbsp;</span></font></p></div></div></span> </div><br><div><div>On Jul 28, 2009, at 17:00 , <a href="mailto:users-request@open-mpi.org">users-request@open-mpi.org</a> wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><span class="Apple-style-span" style="border-collapse: separate; color: rgb(0, 0, 0); font-family: Helvetica; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; ">Message: 1<br>Date: Tue, 28 Jul 2009 11:16:34 -0400<br>From: George Bosilca &lt;<a href="mailto:bosilca@eecs.utk.edu">bosilca@eecs.utk.edu</a>&gt;<br>Subject: Re: [OMPI users] OMPI users] MPI_IN_PLACE in Fortran with<br><span class="Apple-tab-span" style="white-space: pre; ">	</span>MPI_REDUCE / MPI_ALLREDUCE<br>To: Open MPI Users &lt;<a href="mailto:users@open-mpi.org">users@open-mpi.org</a>&gt;<br>Message-ID: &lt;<a href="mailto:C0F59401-0A63-4EB8-804B-51D29071295E@eecs.utk.edu">C0F59401-0A63-4EB8-804B-51D29071295E@eecs.utk.edu</a>&gt;<br>Content-Type: text/plain; charset=ISO-8859-1; format=flowed; delsp=yes<br></span></blockquote></div><br></body></html>
