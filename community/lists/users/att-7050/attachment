<html><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">It depends on what you are trying to do. If you intend to use this solely with OMPI 1.2.x, then you could use some of those. However, they are risky as they are in general internal to OMPI's infrastructure - and thus, subject to change from one release to another.<div><br></div><div>We do have some environmental variables that we guarantee to be "stable" across releases. You could look for OMPI_COMM_WORLD_SIZE, or OMPI_UNIVERSE_SIZE (there are a couple of others as well, but any of these would do).</div><div><br></div><div>However, these will only tell you that the job was launched via OMPI's mpirun - it won't tell you that it was a parallel job. It could be a serial job that just happened to be launched by mpirun. For example, we set the same environmental params when we execute "mpirun hostname" - mpirun has no way of knowing the parallel vs serial nature of the app it is launching, so it sets all the variables required by a parallel job just-in-case.</div><div><br></div><div>Likewise, these variables will only tell you it is a parallel job launched by OMPI. If you use another MPI (e.g., MVAPICH), none of these would be set - yet it would still be a parallel job.</div><div><br></div><div>So it boils down to your particular mode of operation. If you only run with OMPI, and you would only launch via OMPI's mpirun if you wanted to execute in a parallel mode, then you could look for either of those two environmental params. Otherwise, you may have to do as Doug suggests and create your own "flag".</div><div><br></div><div>Ralph</div><div><br></div><div><div><div>On Oct 20, 2008, at 4:45 PM, Doug Reeder wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "> Brian,<div><br></div><div>In your code branch for the parallel run you could set an environment or internal variable when you call mpi_init. Can you parse the command line (arg 0) and figure out if you are running parallel or serial.</div><div><br></div><div>Doug Reeder<br><div><div>On Oct 20, 2008, at 3:40 PM, Adams, Brian M wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"> <font face="Arial, sans-serif" size="2"> <div>I work on an application (DAKOTA) that has opted for single binaries with source code to detect serial vs. MPI execution at run-time.&nbsp; While I realize there are many other ways to handle this (wrapper scripts, command-line switches, different binaries for serial vs. MPI, etc.), I'm looking for a reliable way to detect (in source) whether a binary has been launched in serial or with orterun.</div> <div>&nbsp;</div> <div>We typically do this via detecting environment variables, so the easiest path for me would be to know an environment variable present when an application is invoked with orterun that is not typically present outside that MPI runtime environment.&nbsp; Some candidates that came up in my particular environment include the following, but I don't know if any is a safe bet:</div> <div>&nbsp;</div> <div><font face="Courier New">OMPI_MCA_gpr_replica_uri</font></div> <div><font face="Courier New">OMPI_MCA_mpi_paffinity_processor</font></div> <div><font face="Courier New">OMPI_MCA_mpi_yield_when_idle</font></div> <div><font face="Courier New">OMPI_MCA_ns_nds</font></div> <div><font face="Courier New">OMPI_MCA_ns_nds_cellid</font></div> <div><font face="Courier New">OMPI_MCA_ns_nds_jobid</font></div> <div><font face="Courier New">OMPI_MCA_ns_nds_num_procs</font></div> <div><font face="Courier New">OMPI_MCA_ns_nds_vpid</font></div> <div><font face="Courier New">OMPI_MCA_ns_nds_vpid_start</font></div> <div><font face="Courier New">OMPI_MCA_ns_replica_uri</font></div> <div><font face="Courier New">OMPI_MCA_orte_app_num</font></div> <div><font face="Courier New">OMPI_MCA_orte_base_nodename</font></div> <div><font face="Courier New">OMPI_MCA_orte_precondition_transports</font></div> <div><font face="Courier New">OMPI_MCA_pls</font></div> <div><font face="Courier New">OMPI_MCA_ras</font></div> <div><font face="Courier New">OMPI_MCA_rds</font></div> <div><font face="Courier New">OMPI_MCA_rmaps</font></div> <div><font face="Courier New">OMPI_MCA_rmgr</font></div> <div><font face="Courier New">OMPI_MCA_universe</font></div> <div><font face="Courier New">&nbsp;</font></div> <div>I'd also welcome suggestions for other in-source tests that might reliably detect run via orterun.&nbsp; Thanks!</div> <div>&nbsp;</div> <div>Brian</div> <div>----------</div> <div>Brian M. Adams, PhD (<a href="mailto:briadam@sandia.gov">briadam@sandia.gov</a>)</div> <div>Optimization and Uncertainty Estimation</div> <div>Sandia National Laboratories, Albuquerque, NM</div> <div><a href="http://www.sandia.gov/~briadam"><font color="#0000FF"><u>http://www.sandia.gov/~briadam</u></font></a></div> <div>&nbsp;</div> <div>&nbsp;</div> </font><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">_______________________________________________</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">users mailing list</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><a href="mailto:users@open-mpi.org">users@open-mpi.org</a></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a></div> </blockquote></div><br></div></div>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>http://www.open-mpi.org/mailman/listinfo.cgi/users</blockquote></div><br></div></body></html>
