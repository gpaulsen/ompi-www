Diego,<br><br>First, i recommend you redefine tParticle and add a padding integer so everything is aligned.<br><br><br>Before invoking MPI_Type_create_struct, you need to <br>call MPI_Get_address(dummy, base, MPI%err)<br>displacements = displacements - base<br><br>MPI_Type_create_resized might be unnecessary if tParticle is aligned <br>And the lower bound should be zero.<br><br>BTW, which compiler are you using ?<br>Is tParticle object a common ?<br>iirc, intel compiler aligns types automatically, but not commons, and that means MPI_Type_create_struct is not aligned as it should most of the time.<br><br>Cheers,<br><br>Gilles <br><br>Diego Avesani &lt;diego.avesani@gmail.com&gt;さんのメール:<br><div dir="ltr">dear all,<div><br></div><div>I have a problem with MPI_Type_Create_Struct and MPI_TYPE_CREATE_RESIZED.</div><div><br></div><div>I have this variable type:</div><div><br></div><div><div><i>  TYPE tParticle</i></div><div><i>     INTEGER  :: ip</i></div><div><i>     REAL     :: RP(2)</i></div><div><i>     REAL     :: QQ(2)</i></div><div><i>  ENDTYPE tParticle</i></div></div><div><br></div><div>Then I define:</div><div><br></div><div>Nstruct=3<br></div><div><div><i>ALLOCATE(TYPES(Nstruct))</i></div><div><i>ALLOCATE(LENGTHS(Nstruct))</i></div><div><i>ALLOCATE(DISPLACEMENTS(Nstruct))</i></div><div><i>!set the types</i></div><div><i>TYPES(1) = MPI_INTEGER</i></div><div><i>TYPES(2) = MPI_DOUBLE_PRECISION</i></div><div><i>TYPES(3) = MPI_DOUBLE_PRECISION</i></div><div><i>!set the lengths</i></div><div><i>LENGTHS(1) = 1</i></div><div><i>LENGTHS(2) = 2</i></div><div><i>LENGTHS(3) = 2</i></div><div><i><br></i></div><div>As gently suggested by Nick Papior Andersen and George Bosilca some months ago, I checked the variable adress to resize my struct variable to avoid empty space and</div><div>to have a more general definition.</div><div><br></div><div><i> !</i></div><div><i> CALL MPI_GET_ADDRESS(dummy%ip,    DISPLACEMENTS(1), MPI%iErr)</i></div><div><i> CALL MPI_GET_ADDRESS(dummy%RP(1), DISPLACEMENTS(2), MPI%iErr)</i></div><div><i> CALL MPI_GET_ADDRESS(dummy%QQ(1), DISPLACEMENTS(3), MPI%iErr)</i></div><div><i> !</i></div><div><i> CALL MPI_Type_Create_Struct(Nstruct,LENGTHS,DISPLACEMENTS,TYPES,MPI_PARTICLE_TYPE_OLD,MPI%iErr)</i></div><div><i> CALL MPI_Type_Commit(MPI_PARTICLE_TYPE_OLD,MPI%iErr)</i></div><div><i> !</i></div><div><i> CALL MPI_TYPE_CREATE_RESIZED(MPI_PARTICLE_TYPE_OLD, DISPLACEMENTS(1),DISPLACEMENTS(2) - DISPLACEMENTS(1), MPI_PARTICLE_TYPE)</i></div></div><div><br></div><div><br></div><div>This does not work. When my program run, I get an error:</div><div><br></div><div><div><i>forrtl: severe (174): SIGSEGV, segmentation fault occurred.</i></div><div><br></div><div>I have read the manual but probably I am not able to understand  <i>MPI_TYPE_CREATE_RESIZED. </i></div><div><i><br></i></div><div>Someone could help me?</div><div>                                                                                                                                             </div></div><div>Thanks a lot</div><div>Diego</div><div><br></div><div><br clear="all"><div><div class="gmail_signature">Diego<br><br></div></div>
</div></div>
