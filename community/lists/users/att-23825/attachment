<html><head><meta http-equiv="Content-Type" content="text/html charset=us-ascii"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">I remember having a conversation with someone from R at Supercomputing last year, and this was one of the issues we discussed. The problem is that you have to ensure that R is built against the OMPI you are going to use, and it is usually better to have configured OMPI --disable-dlopen --enable-static to avoid library confusion when you later run R.<div><br></div><div>I'd give that a try and see if it solves your problems. The "recipe" given by Bennet looked right to me.</div><div><br></div><div><br><div><div>On Mar 12, 2014, at 12:32 PM, Ross Boylan &lt;<a href="mailto:ross@biostat.ucsf.edu">ross@biostat.ucsf.edu</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div style="font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">On Wed, 2014-03-12 at 11:50 +0100, Reuti wrote:<br><blockquote type="cite">Am 12.03.2014 um 11:39 schrieb Jeff Squyres (jsquyres):<br><br><blockquote type="cite">Generally, all you need to ensure that your personal copy of OMPI is used is to set the PATH and LD_LIBRARY_PATH to point to your new Open MPI installation. &nbsp;I do this all the time on my development cluster (where I have something like 6 billion different installations of OMPI available... mmm... should probably clean that up...)<br><br>export LD_LIBRARY_PATH=path_to_my_ompi/lib:$LD_LIBRARY_PATH<br>export PATH=path-to-my-ompi/bin:$PATH<br></blockquote></blockquote><br>I believe I've already done that. &nbsp;The script the launches everything is<br>(all one line originally)<br>R_PROFILE_USER=~/KHC/sunbelt/Rmpiprofile \<br>LD_LIBRARY_PATH=/home/ross/install/lib:$LD_LIBRARY_PATH \<br>PATH=/home/ross/install/bin:$PATH orterun -x R_PROFILE_USER -x<br>LD_LIBRARY_PATH -x PATH -hostfile ~/KHC/sunbelt/hosts \<br>-np 7 R --no-save &nbsp;-q<br><br>There is a complication with R; it sticks stuff in front of<br>LD_LIBRARY_PATH. &nbsp;However, the startup script Rmpiprofile &nbsp;fixes that,<br>though I'm not entirely sure that is effective. &nbsp;However, the old<br>libraries that are being loaded are not from any directories R added to<br>LD_LIBRARY_PATH; instead they are from /usr/lib, which is a standard<br>place for the dynamic loader to look.<br><br><br><blockquote type="cite"><blockquote type="cite">It should be noted that:<br><br>1. you need to *prefix* your PATH and LD_LIBRARY_PATH with these values<br>2. you need to set these values in a way that will be picked up on all servers that you use in your job. &nbsp;The safest way to do this is in your shell startup files (e.g., $HOME/.bashrc or whatever is relevant for your shell).<br></blockquote><br>I see "libtorque" in the output below - were these jobs running inside a queuing system? The set paths might be different therein, and need to be set in the job script in this case.<br><br></blockquote>No batch system (see script above for launch mechanism). We threw a lot<br>of stuff MPI configure was looking for onto the system. &nbsp;AFAIK torque<br>isn't even installed.<br><br>One possible issue is that the Rmpi module for R is not compiled by<br>mpicc; R has its own notions of proper options for the compiler and its<br>own infrastructure for building things. &nbsp;I did &nbsp;pass the location of my<br>local libraries into the build process.<br><br>This seems more like an issue with the dynamic loader, or with whatever<br>system R is using when it loads Rmpi.so.<br><br>Ross<br><blockquote type="cite">-- Reuti<br><br><br><blockquote type="cite">See <a href="http://www.open-mpi.org/faq/?category=running#run-prereqs">http://www.open-mpi.org/faq/?category=running#run-prereqs</a>, <a href="http://www.open-mpi.org/faq/?category=running#adding-ompi-to-path">http://www.open-mpi.org/faq/?category=running#adding-ompi-to-path</a>, and <a href="http://www.open-mpi.org/faq/?category=running#mpirun-prefix">http://www.open-mpi.org/faq/?category=running#mpirun-prefix</a>.<br><br>Note the --prefix option that is described in the 3rd FAQ item I cited -- that can be a bit easier, too.<br><br><br><br>On Mar 12, 2014, at 2:51 AM, Ross Boylan &lt;<a href="mailto:ross@biostat.ucsf.edu">ross@biostat.ucsf.edu</a>&gt; wrote:<br><br><blockquote type="cite">I took the advice here and built a personal copy of the current openmpi,<br>to see if the problems I was having with Rmpi were a result of the old<br>version on the system.<br><br>When I do ldd on the relevant libraries (Rmpi.so is loaded dynamically<br>by R) everything looks fine; path references that should be local are.<br>But when I run the program and do lsof it shows that both the system and<br>personal versions of key libraries are opened.<br><br>First, does anyone know which library will actually be used, or how to<br>tell which library is actually used, in this situation. &nbsp;I'm running on<br>linux (Debian squeeze)?<br><br>Second, it there some way to prevent the wrong/old/sytem libraries from<br>being loaded?<br><br>FWIW I'm still seeing the old misbehavior when I run this way, but, as I<br>said, I'm really not sure which libraries are being used. &nbsp;Since Rmpi<br>was built against the new/local ones, I think the fact that it doesn't<br>crash means I really am using the new ones.<br><br>Here are highlights of lsof on the process running R:<br>COMMAND &nbsp;&nbsp;PID USER &nbsp;&nbsp;FD &nbsp;&nbsp;TYPE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEVICE SIZE/OFF &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NODE NAME<br>R &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17634 ross &nbsp;cwd &nbsp;&nbsp;&nbsp;DIR &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;254,2 &nbsp;&nbsp;&nbsp;12288 150773764 /home/ross/KHC/sunbelt<br>R &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17634 ross &nbsp;rtd &nbsp;&nbsp;&nbsp;DIR &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8,1 &nbsp;&nbsp;&nbsp;&nbsp;4096 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 /<br>R &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17634 ross &nbsp;txt &nbsp;&nbsp;&nbsp;REG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8,1 &nbsp;&nbsp;&nbsp;&nbsp;5648 &nbsp;&nbsp;3058294 /usr/lib/R/bin/exec/R<br>R &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17634 ross &nbsp;DEL &nbsp;&nbsp;&nbsp;REG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8,1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2416718 /tmp/openmpi-sessions-ross@n100_0/60429/1/shared_mem_pool.n100<br>R &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17634 ross &nbsp;mem &nbsp;&nbsp;&nbsp;REG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8,1 &nbsp;&nbsp;335240 &nbsp;&nbsp;3105336 /usr/lib/openmpi/lib/libopen-pal.so.0.0.0<br>R &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17634 ross &nbsp;mem &nbsp;&nbsp;&nbsp;REG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8,1 &nbsp;&nbsp;304576 &nbsp;&nbsp;3105337 /usr/lib/openmpi/lib/libopen-rte.so.0.0.0<br>R &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17634 ross &nbsp;mem &nbsp;&nbsp;&nbsp;REG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8,1 &nbsp;&nbsp;679992 &nbsp;&nbsp;3105332 /usr/lib/openmpi/lib/libmpi.so.0.0.2<br>R &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17634 ross &nbsp;mem &nbsp;&nbsp;&nbsp;REG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8,1 &nbsp;&nbsp;&nbsp;93936 &nbsp;&nbsp;2967826 /usr/lib/libz.so.1.2.3.4<br>R &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17634 ross &nbsp;mem &nbsp;&nbsp;&nbsp;REG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8,1 &nbsp;&nbsp;&nbsp;10648 &nbsp;&nbsp;3187256 /lib/libutil-2.11.3.so<br>R &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17634 ross &nbsp;mem &nbsp;&nbsp;&nbsp;REG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8,1 &nbsp;&nbsp;&nbsp;32320 &nbsp;&nbsp;2359631 /usr/lib/libpciaccess.so.0.10.8<br>R &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17634 ross &nbsp;mem &nbsp;&nbsp;&nbsp;REG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8,1 &nbsp;&nbsp;&nbsp;33368 &nbsp;&nbsp;2359338 /usr/lib/libnuma.so.1<br>R &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17634 ross &nbsp;mem &nbsp;&nbsp;&nbsp;REG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;254,2 &nbsp;&nbsp;979113 152045740 /home/ross/install/lib/libopen-pal.so.6.1.0<br>R &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17634 ross &nbsp;mem &nbsp;&nbsp;&nbsp;REG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8,1 &nbsp;&nbsp;183456 &nbsp;&nbsp;2359592 /usr/lib/libtorque.so.2.0.0<br>R &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17634 ross &nbsp;mem &nbsp;&nbsp;&nbsp;REG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;254,2 &nbsp;1058125 152045781 /home/ross/install/lib/libopen-rte.so.7.0.0<br>R &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17634 ross &nbsp;mem &nbsp;&nbsp;&nbsp;REG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8,1 &nbsp;&nbsp;&nbsp;49936 &nbsp;&nbsp;2359341 /usr/lib/libibverbs.so.1.0.0<br>R &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17634 ross &nbsp;mem &nbsp;&nbsp;&nbsp;REG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;254,2 &nbsp;2802579 152045867 /home/ross/install/lib/libmpi.so.1.3.0<br>R &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17634 ross &nbsp;mem &nbsp;&nbsp;&nbsp;REG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;254,2 &nbsp;&nbsp;106626 152046481 /home/ross/Rlib-3.0.1/Rmpi/libs/Rmpi.so<br><br>So libmpi, libopen-pal, and libopen-rte all are opened in two versions and two locations.<br><br>Thanks.<br>Ross Boylan<br><br>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>http://www.open-mpi.org/mailman/listinfo.cgi/users<br></blockquote><br><br>--<span class="Apple-converted-space">&nbsp;</span><br>Jeff Squyres<br><a href="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a><br>For corporate legal information go to: http://www.cisco.com/web/about/doing_business/legal/cri/<br><br>_______________________________________________<br>users mailing list<br>users@open-mpi.org<br>http://www.open-mpi.org/mailman/listinfo.cgi/users<br></blockquote><br>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>http://www.open-mpi.org/mailman/listinfo.cgi/users<br></blockquote><br><br>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a></div></blockquote></div><br></div></body></html>
