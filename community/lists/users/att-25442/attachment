<div dir="ltr">Dear Nick,<div>thank you, </div><div>The important things is that the MPI_TYPE_CREATE_STRUCT works.</div><div><br></div><div>Now I will proceed with the debug by myself, I will check MPI_TYPE_CREATE_STRUCT ierr output and other part of my program.</div><div><br></div><div>Again thanks you</div></div><div class="gmail_extra"><br clear="all"><div>Diego<br><br></div>
<br><div class="gmail_quote">On 3 October 2014 15:45, Nick Papior Andersen <span dir="ltr">&lt;<a href="mailto:nickpapior@gmail.com" target="_blank">nickpapior@gmail.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Well it says <div><br></div><div>MPI_ERR_TYPE: invalid datatype<br></div><div><br></div><div>so I guess you have done something wrong. ;)</div><div><br></div><div>You should debug as much as you can your self. </div><div>1) Check that your type-creation calls actually proceed as expected</div><div>2) Check that your type-commit actually proceed as expected</div><div>3) Telling us that &quot;it is not working&quot; does not tell us anything! You have probably changed the code several times since you started with some corrections, hence we cannot see if you have introduced other errors.</div></div><div class="gmail_extra"><br><div class="gmail_quote"><div><div class="h5">2014-10-03 13:38 GMT+00:00 Diego Avesani <span dir="ltr">&lt;<a href="mailto:diego.avesani@gmail.com" target="_blank">diego.avesani@gmail.com</a>&gt;</span>:<br></div></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div class="h5"><div dir="ltr">Dear Nick,<div>after that I call:</div><div><br></div><div><div> CALL MPI_Sendrecv(P_SEND,nptSend,MPI_PARTICLE_TYPE,BCPU,201,&amp;</div><div>                                    P_RECV,nptSend,MPI_PARTICLE_TYPE,TCPU,201,&amp;</div><div>                                   MPI_COMM_WORLD,MPI_STATUS_IGNORE,MPI%iErr)</div></div><div><br></div><div>but I have the following error</div><div><br></div><div><div>[diedroLap:16824] *** An error occurred in MPI_Sendrecv</div><div>[diedroLap:16824] *** reported by process [139856324001793,139852725092354]</div><div>[diedroLap:16824] *** on communicator MPI_COMM_WORLD</div><div>[diedroLap:16824] *** MPI_ERR_TYPE: invalid datatype</div><div>[diedroLap:16824] *** MPI_ERRORS_ARE_FATAL (processes in this communicator will now abort,</div><div>[diedroLap:16824] ***    and potentially your MPI job)</div></div><div><br></div><div>Do you know something about this errors?</div><div><br></div><div>Thanks again</div></div><div class="gmail_extra"><br clear="all"><div>Diego<br><br></div>
<br><div class="gmail_quote"><div><div>On 3 October 2014 15:29, Nick Papior Andersen <span dir="ltr">&lt;<a href="mailto:nickpapior@gmail.com" target="_blank">nickpapior@gmail.com</a>&gt;</span> wrote:<br></div></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div><div dir="ltr"><div>Yes, I guess this is correct. Testing is easy! Try testing!<br></div><div>As I stated, I do not know enough about the custom type in MPI, this was my hunch feeling...</div><div class="gmail_extra"><br><div class="gmail_quote"><div><div>2014-10-03 13:23 GMT+00:00 Diego Avesani <span dir="ltr">&lt;<a href="mailto:diego.avesani@gmail.com" target="_blank">diego.avesani@gmail.com</a>&gt;</span>:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Dear Nick,<div>thanks again. </div><div>After reading your post I have thought to compile as</div><div><br></div><div>mpif90 -r8 *.f90<br></div></div></blockquote><div><br></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr"><div><br></div><div>and to have this type variable</div><span><div><br></div><div><div>TYPE tParticle</div><div>    SEQUENCE</div><div>    INTEGER :: ip</div><div>    INTEGER :: fake</div><div>    REAL    :: RP(2)</div><div>    REAL    :: QQ(4)</div><div>END TYPE tParticle</div></div><div><br></div></span><div>where I use fake to have 4 + 4 bytes, and then I have</div><div>TYPES(1)=MPI_INTEGER<br></div><span><div><div>TYPES(2)=MPI_DOUBLE_PRECISION      </div><div>TYPES(3)=MPI_DOUBLE_PRECISION     </div><div>nBLOCKS(1)=2                </div><div>nBLOCKS(2)=2</div><div>nBLOCKS(3)=4</div></div><div><br></div></span><div>Am I wrong? Do I have correctly understood?</div></div></blockquote><div><br></div></div></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div><div dir="ltr"><div>Really Really thanks</div><div><br></div></div><div class="gmail_extra"><br clear="all"><div>Diego<br><br></div>
<br><div class="gmail_quote"><div><div>On 3 October 2014 15:10, Nick Papior Andersen <span dir="ltr">&lt;<a href="mailto:nickpapior@gmail.com" target="_blank">nickpapior@gmail.com</a>&gt;</span> wrote:<br></div></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div><div dir="ltr"><br><div class="gmail_extra"><br><div class="gmail_quote"><span>2014-10-03 13:00 GMT+00:00 Diego Avesani <span dir="ltr">&lt;<a href="mailto:diego.avesani@gmail.com" target="_blank">diego.avesani@gmail.com</a>&gt;</span>:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Dear all, dear Nick,<div>thanks lot.</div><div>I have understood something, so I have create this variable type:</div><div><br></div><div><span><div>  TYPE tParticle</div><div>    SEQUENCE</div><div>    INTEGER :: ip</div></span><div>    INTEGER :: fake</div><span><div>    REAL    :: RP(2)</div><div>    REAL    :: QQ(4)</div><div>  END TYPE tParticle</div></span></div></div></blockquote></span><div>But did it work? :) Remember to tell mpi about the padding (add one more type).</div><div>Also, for cosmetic reasons I would do this:</div><div>TYPE tParticle</div><div>sequence</div><div>integer :: ip</div><div>real :: rp(2), qq(4)</div><div>! THIS IS A PADDING VARIABLE (SHOULD NEVER BE USED)</div><div>integer :: pad</div><div>end type</div><span><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr"><div><span><div><br></div></span><div>In the point number 2, do you mean to insert some align options?</div></div></div></blockquote></span><div>Search around for your compiler. However, this will be &quot;forcing&quot; your program to certain compilers, I would not recommend this (unless you have specific reasons anyway).</div><span><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr"><div><div><br></div><div>For the point number 3, I do not understand where where I am wrong. This is my code</div><div><br></div><div><div>    </div><div>     TYPES(1)=MPI_INTEGER </div></div></div></div></blockquote></span><div>Here it is wrong.</div><div>If you compile with -i8 your integer is not an integer, but a long. Your displacements should be correct, but not your designation of the data-type for mpi.</div><span><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr"><div><div><div>            </div><div>     TYPES(2)=MPI_DOUBLE_PRECISION      </div><div>     TYPES(3)=MPI_DOUBLE_PRECISION     </div><div>     nBLOCKS(1)=2                </div><div>     nBLOCKS(2)=2</div><div>     nBLOCKS(3)=4</div><div>     </div><div>     DISPLACEMENTS(1)=0</div><div>     DISPLACEMENTS(2)=sizeof(dummy%ip)+sizeof(dummy%fake)</div><div>     DISPLACEMENTS(3)=sizeof(dummy%ip)+sizeof(dummy%fake)+sizeof(dummy%RP(1))+sizeof(dummy%RP(2))</div><div>     </div><div>     CALL MPI_TYPE_CREATE_STRUCT(3,nBLOCKS,DISPLACEMENTS,TYPES,MPI_PARTICLE_TYPE,MPI%ierr)</div></div><div><br></div><div>This is how I compile</div><div><br></div><div>mpif90 -r8 *.f90</div></div></div></blockquote></span><div>No, that was not what you said! </div><div>You said you compiled it using:</div><div>mpif90 -r8 -i8 *.f90</div><div><br></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div><div dir="ltr"><div><br></div><div>Again, really really Thanks</div><div class="gmail_extra"><br clear="all"><div>Diego<br><br></div>
<br><div class="gmail_quote"><div><div>On 3 October 2014 14:30, Nick Papior Andersen <span dir="ltr">&lt;<a href="mailto:nickpapior@gmail.com" target="_blank">nickpapior@gmail.com</a>&gt;</span> wrote:<br></div></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div><div dir="ltr"><div>I would never compile a fortran program relying on a specific compiler option! I would never use r8/i8!<br></div><div>I would highly encourage you to explicitly set the precision of each variable if you need specific variable precision. There are plenty of tutorials around for this (selected_real/int_kind).</div><div><br></div><div>Secondly, the warning of mis-alignment is due to the data type not being a multiple of 8. You can pad it with additional bytes to reach a multiple of 8 (in this case add a fake integer, or character(len=4)).</div><div>I do not know if sequence is needed for the mpi data type (I guess it is needed when dealing with arrays of types, but again, I am not fully sure about this...).</div><div><br></div><div>A couple of options:</div><div>1) I think sequence should work if you pad it to align with 8 bytes.</div><div>2) add code that is directive specified against the compiler to tell the exact alignment of the data type</div><div>3) Your compilation of -r8 -i8 does probably not work due to the integer being long, and hence your data type of MPI_INTEGER (you did not tell us whether you corrected this)</div><div><br></div><div><br></div><div><br></div></div><div class="gmail_extra"><br><div class="gmail_quote"><div><div>2014-10-03 11:07 GMT+00:00 Diego Avesani <span dir="ltr">&lt;<a href="mailto:diego.avesani@gmail.com" target="_blank">diego.avesani@gmail.com</a>&gt;</span>:<br></div></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div><div dir="ltr">Dears,<div>First of all. Really really thanks for you help, I am learning a lot.</div><div>Second:</div><div>I try to study the MPI_TYPE_CREATE_STRUCT and all the things look correct.</div><div><br></div><div>I use Intel Fortran compiler and when I compile with -r8 means that I am compiling in double precision.</div><div><br></div><div>About Nick suggestion:</div><div>Coding</div><div><br></div><div><div>  TYPE tParticle</div><div>    SEQUENCE</div><div>    INTEGER :: ip</div><div>    REAL    :: RP(2)</div><div>    REAL    :: QQ(4)</div><div>  END TYPE tParticle</div><div><br></div><div><br></div><div>if I compile with</div><div>mpif90 -r8  *.f90 <br></div><div><br></div><div>I get the following error:</div><div><div>warning #6379: The structure contains one or more misaligned fields.   [TPARTICLE] TYPE tParticle</div></div><div><br></div><div><br></div><div>I can only compile as:</div><div>mpif90 -r8 -i8 *.f90 <br></div><div><br></div><div>But I get the same error:</div><div><br></div><div><div>An error occurred in MPI_Cart_create</div><div>[diedroLap:12267] *** reported by process [139817172008961,139814070386689]</div><div>[diedroLap:12267] *** on communicator MPI_COMM_WORLD</div><div>[diedroLap:12267] *** MPI_ERR_OTHER: known error not in list</div><div>[diedroLap:12267] *** MPI_ERRORS_ARE_FATAL (processes in this communicator will now abort,</div><div>[diedroLap:12267] ***    and potentially your MPI job)</div></div><div><br></div><div><br></div><div><br></div><div>What I can do? </div><div>Thanks a lot</div><div><br></div><div><br></div><div class="gmail_extra"><br><div class="gmail_quote">On 3 October 2014 08:15, Nick Papior Andersen <span dir="ltr">&lt;<a href="mailto:nickpapior@gmail.com" target="_blank">nickpapior@gmail.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex">sequence</blockquote></div><span><font color="#888888"><br><br><br clear="all"><div>Diego<br><br></div>
</font></span></div></div></div>
<br></div></div><span>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></span>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/10/25434.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/10/25434.php</a><span><font color="#888888"><br></font></span></blockquote></div><span><font color="#888888"><br><br clear="all"><br>-- <br><div dir="ltr"><div>Kind regards Nick</div></div>
</font></span></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div></div>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/10/25435.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/10/25435.php</a><br></blockquote></div><br></div></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div></div>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/10/25436.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/10/25436.php</a><span><font color="#888888"><br></font></span></blockquote></div><span><font color="#888888"><br><br clear="all"><br>-- <br><div dir="ltr"><div>Kind regards Nick</div></div>
</font></span></div></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div></div>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/10/25437.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/10/25437.php</a><br></blockquote></div><br></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div></div>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/10/25438.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/10/25438.php</a><span><font color="#888888"><br></font></span></blockquote></div><span><font color="#888888"><br><br clear="all"><br>-- <br><div dir="ltr"><div>Kind regards Nick</div></div>
</font></span></div></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div></div>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/10/25439.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/10/25439.php</a><br></blockquote></div><br></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org" target="_blank">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div></div>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/10/25440.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/10/25440.php</a><span class="HOEnZb"><font color="#888888"><br></font></span></blockquote></div><span class="HOEnZb"><font color="#888888"><br><br clear="all"><br>-- <br><div dir="ltr"><div>Kind regards Nick</div></div>
</font></span></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/10/25441.php" target="_blank">http://www.open-mpi.org/community/lists/users/2014/10/25441.php</a><br></blockquote></div><br></div>

