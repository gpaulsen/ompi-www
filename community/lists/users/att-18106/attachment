<html><head><base href="x-msg://105/"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">Hi Kelly<div><br></div><div>Each instance of mpirun is independent - there is no cross-mpirun coordination. So they will indeed trip over each other as you describe.</div><div><br></div><div>In more recent versions, you can restrict the available cores for each mpirun execution by having the external system "bind" OMPI to some subset of the available cores. However, I don't believe Torque provides that capability.</div><div><br></div><div>You can also set the default cpu set to be used - try adding -mca orte_cpu_set 1,2 &nbsp;where 1,2 are the cores you want that execution to use.</div><div><br></div><div>I can't guarantee it will work as I'm not sure it has been robustly tested, but it is supposed to do what you described (I added it for some other folks at LANL). Let me know and I'll fix it if required.</div><div><br></div><div>Alternatively, you can leave the procs unbound as you are doing and they'll run just fine, albeit a little slower.</div><div>Ralph</div><div><br><div><div>On Jan 9, 2012, at 8:24 AM, Thompson, Kelly G wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><span class="Apple-style-span" style="border-collapse: separate; font-family: Helvetica; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; font-size: medium; "><div lang="EN-US" link="blue" vlink="purple"><div class="WordSection1" style="page: WordSection1; "><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif; "><span style="font-size: 10pt; font-family: Arial, sans-serif; ">Hi,<o:p></o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif; "><span style="font-size: 10pt; font-family: Arial, sans-serif; "><o:p>&nbsp;</o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif; "><span style="font-size: 10pt; font-family: Arial, sans-serif; ">I am interested in running a handful of mpirun jobs in a single allocation.&nbsp; For example, my allocation is 2 nodes with 8 cores on each node (total of 16 cores).&nbsp; I want to run 2 five-rank jobs and 3 two-rank jobs simultaneously (total of 16 cores) and w/o oversubscribing any single core.&nbsp; I am currently using ‘--mca mpi_paffinity_alone 0’ and that appears to work, but it looks like recent versions (1.4+) of OpenMPI have better controls for processor affinity.&nbsp; Is there a better choice of flags for my situation?<o:p></o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif; "><span style="font-size: 10pt; font-family: Arial, sans-serif; "><o:p>&nbsp;</o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif; "><span style="font-size: 10pt; font-family: Arial, sans-serif; ">The bigger picture is that I am running 400-600 small unit tests in a single Torque allocation.&nbsp; My testing framework is aware of total available cores and the cores required per test so that the total simultaneous core count never exceeds my allocation.&nbsp; However, if I use any option other than ‘--mca mpi_paffinity_alone 0’, mpirun will place multiple jobs on the same cores and leave many cores with nothing to do.&nbsp; Is there a good description for how mpirun assigns jobs to cores – particularly in the situation where there are multiple mpirun jobs running on the same allocation?<o:p></o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif; "><span style="font-size: 10pt; font-family: Arial, sans-serif; "><o:p>&nbsp;</o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif; "><span style="font-size: 10pt; font-family: Arial, sans-serif; ">TIA<o:p></o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif; "><span style="font-size: 10pt; font-family: Arial, sans-serif; "><o:p>&nbsp;</o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif; "><span style="font-size: 10pt; font-family: Arial, sans-serif; ">-kt<o:p></o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif; "><span style="font-size: 10pt; font-family: Arial, sans-serif; ">---<o:p></o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif; "><span style="font-size: 10pt; font-family: Arial, sans-serif; ">Kelly Thompson<o:p></o:p></span></div><div style="margin-top: 0in; margin-right: 0in; margin-left: 0in; margin-bottom: 0.0001pt; font-size: 11pt; font-family: Calibri, sans-serif; "><span style="font-size: 10pt; font-family: Arial, sans-serif; "><a href="mailto:kgt@lanl.gov" style="color: blue; text-decoration: underline; ">kgt@lanl.gov</a><o:p></o:p></span></div></div>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org" style="color: blue; text-decoration: underline; ">users@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" style="color: blue; text-decoration: underline; ">http://www.open-mpi.org/mailman/listinfo.cgi/users</a></div></span></blockquote></div><br></div></body></html>
