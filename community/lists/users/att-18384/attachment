<html><body><div style="color:#000; background-color:#fff; font-family:times new roman, new york, times, serif;font-size:12pt"><div><span>You were right about iptables being very complex. It seems that uninstalling it completly did the trick. All my Send / Receive operations now complete as they should. Just one more question. Will uninstalling iptables have any undesired effects on my Linux cluster? </span></div><div><span></span>&nbsp;</div><div><span>Thaks!</span></div><div><span>Adrian<var id="yui-ie-cursor"></var></span></div><div><br></div>  <div style="font-family: times new roman, new york, times, serif; font-size: 12pt;"> <div style="font-family: times new roman, new york, times, serif; font-size: 12pt;"> <div dir="ltr"> <font size="2" face="Arial"> <div style="margin: 5px 0px; padding: 0px; border: 1px solid rgb(204, 204, 204); height: 0px; line-height: 0; font-size: 0px;" class="hr" contentEditable="false" readonly="true"></div>  <b><span
 style="font-weight: bold;">From:</span></b> Jeff Squyres &lt;jsquyres@cisco.com&gt;<br> <b><span style="font-weight: bold;">To:</span></b> adrian sabou &lt;adrian.sabou@yahoo.com&gt; <br> <b><span style="font-weight: bold;">Sent:</span></b> Friday, February 3, 2012 12:30 PM<br> <b><span style="font-weight: bold;">Subject:</span></b> Re: [OMPI users] OpenMPI / SLURM -&gt; Send/Recv blocking<br> </font> </div> <br>
On Feb 3, 2012, at 5:21 AM, adrian sabou wrote:<br><br>&gt; There is no iptables in my /etc/init.d.<br><br>It might be different in different OS's -- my RedHat-based system has /etc/init.d/iptables.<br><br>Perhaps try uninstalling iptables using your local package manager (rpm, yum, apt, ...whatever).<br><br>&gt; It's most probably a communication issue between the nodes. However, I have no ideea what it might be. It's weird though that the first Send / Receive pair works and only subsequent pairs fail. Anyway, thankyou for taking the time to help me out. I am grateful!<br>&gt;&nbsp; <br>&gt; Adrian<br>&gt; <br>&gt; From: Jeff Squyres &lt;<a href="mailto:jsquyres@cisco.com" ymailto="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a>&gt;<br>&gt; To: adrian sabou &lt;<a href="mailto:adrian.sabou@yahoo.com" ymailto="mailto:adrian.sabou@yahoo.com">adrian.sabou@yahoo.com</a>&gt;; Open MPI Users &lt;<a href="mailto:users@open-mpi.org"
 ymailto="mailto:users@open-mpi.org">users@open-mpi.org</a>&gt; <br>&gt; Sent: Thursday, February 2, 2012 11:19 PM<br>&gt; Subject: Re: [OMPI users] OpenMPI / SLURM -&gt; Send/Recv blocking<br>&gt; <br>&gt; When you run without a hostfile, you're likely only running on a single node via shared memory (unless you're running inside a SLURM job, which is unlikely, given the context of your mails).&nbsp; <br>&gt; <br>&gt; When you're running in SLURM, I'm guessing that you're running across multiple nodes.&nbsp; Are you using TCP as your MPI transport?<br>&gt; <br>&gt; If so, I would still recommend trying stopping iptables altogether -- /etc/init.d/iptables stop.&nbsp; It might not make a difference, but I've found iptables to be sufficiently complex that it's easier to take that variable out altogether by stopping it to really, really test to see if that's the problem.<br>&gt; <br>&gt; <br>&gt; <br>&gt; On Feb 2, 2012, at 9:48 AM, adrian sabou
 wrote:<br>&gt; <br>&gt; &gt; Hi,<br>&gt; &gt;&nbsp; <br>&gt; &gt; I have disabled iptables on all nodes using:<br>&gt; &gt;&nbsp; <br>&gt; &gt; iptables -F<br>&gt; &gt; iptables -X<br>&gt; &gt; iptables -t nat -F<br>&gt; &gt; iptables -t nat -X<br>&gt; &gt; iptables -t mangle -F<br>&gt; &gt; iptables -t mangle -X<br>&gt; &gt; iptables -P INPUT ACCEPT<br>&gt; &gt; iptables -P FORWARD ACCEPT<br>&gt; &gt; iptables -P OUTPUT ACCEPT<br>&gt; &gt;&nbsp; <br>&gt; &gt; My problem is still there. I have re-enabled iptables. The current output of the "iptables --list" command is:<br>&gt; &gt;&nbsp; <br>&gt; &gt; Chain INPUT (policy ACCEPT)<br>&gt; &gt; target&nbsp; &nbsp; prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination<br>&gt; &gt; ACCEPT&nbsp; &nbsp; udp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp dpt:domain<br>&gt; &gt; ACCEPT&nbsp; &nbsp; tcp&nbsp; --&nbsp;
 anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp dpt:domain<br>&gt; &gt; ACCEPT&nbsp; &nbsp; udp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp dpt:bootps<br>&gt; &gt; ACCEPT&nbsp; &nbsp; tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp dpt:bootps<br>&gt; &gt; Chain FORWARD (policy ACCEPT)<br>&gt; &gt; target&nbsp; &nbsp; prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination<br>&gt; &gt; ACCEPT&nbsp; &nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 192.168.122.0/24&nbsp; &nbsp; state RELATED,ESTABLISHED<br>&gt; &gt; ACCEPT&nbsp; &nbsp; all&nbsp; --&nbsp; 192.168.122.0/24&nbsp; &nbsp; anywhere<br>&gt; &gt; ACCEPT&nbsp; &nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
 anywhere<br>&gt; &gt; REJECT&nbsp; &nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reject-with icmp-port-unreachable<br>&gt; &gt; REJECT&nbsp; &nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reject-with icmp-port-unreachable<br>&gt; &gt; Chain OUTPUT (policy ACCEPT)<br>&gt; &gt; target&nbsp; &nbsp; prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination<br>&gt; &gt; I don't think this is it. I have tried to run a simple ping-pong program that I found (keeps bouncing a value between two processes) and I keep getting the same results : the first Send / Receive pairs (p1 sends to p2, p2 receives and sends back to p1, p1 receives) work and after that the program just blocks. However, like all other examples, the example works if I launch it with "mpirun -np 2 &lt;ping-pong&gt;" and
 bounces the value 100 times.<br>&gt; &gt;&nbsp; <br>&gt; &gt; Adrian<br>&gt; &gt; From: Jeff Squyres &lt;<a href="mailto:jsquyres@cisco.com" ymailto="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a>&gt;<br>&gt; &gt; To: adrian sabou &lt;<a href="mailto:adrian.sabou@yahoo.com" ymailto="mailto:adrian.sabou@yahoo.com">adrian.sabou@yahoo.com</a>&gt;; Open MPI Users &lt;<a href="mailto:users@open-mpi.org" ymailto="mailto:users@open-mpi.org">users@open-mpi.org</a>&gt; <br>&gt; &gt; Sent: Thursday, February 2, 2012 3:09 PM<br>&gt; &gt; Subject: Re: [OMPI users] OpenMPI / SLURM -&gt; Send/Recv blocking<br>&gt; &gt; <br>&gt; &gt; Have you disabled iptables (firewalling) on your nodes?<br>&gt; &gt; <br>&gt; &gt; Or, if you want to leave iptables enabled, set it such that all nodes in your cluster are allowed to open TCP connections from any port to any other port.<br>&gt; &gt; <br>&gt; &gt; <br>&gt; &gt; <br>&gt; &gt; <br>&gt; &gt; On Feb 2, 2012, at 4:49 AM,
 adrian sabou wrote:<br>&gt; &gt; <br>&gt; &gt; &gt; Hi,<br>&gt; &gt; &gt; <br>&gt; &gt; &gt; The only example that works is hello_c.c. All others (that use MPI_Send and MPI_Recv)(connectivity_c.c and ring_c.c) block after the first MPI_Send / MPI_Recv (although the first Send/Receive pair works well for all processes, subsequent Send/Receive pairs block). My slurm version is 2.1.0. It is also worth mentioning that all examples work when not using SLURM (launching with "mpirun -np 5 &lt;exaple_app&gt;"). Blocking occurs only when I try to run on multiple hosts with SLURM ("salloc -N5 mpirun &lt;example_app&gt;").<br>&gt; &gt; &gt; <br>&gt; &gt; &gt; Adrian<br>&gt; &gt; &gt; <br>&gt; &gt; &gt; From: Jeff Squyres &lt;<a href="mailto:jsquyres@cisco.com" ymailto="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a>&gt;<br>&gt; &gt; &gt; To: adrian sabou &lt;<a href="mailto:adrian.sabou@yahoo.com"
 ymailto="mailto:adrian.sabou@yahoo.com">adrian.sabou@yahoo.com</a>&gt;; Open MPI Users &lt;<a href="mailto:users@open-mpi.org" ymailto="mailto:users@open-mpi.org">users@open-mpi.org</a>&gt; <br>&gt; &gt; &gt; Sent: Wednesday, February 1, 2012 10:32 PM<br>&gt; &gt; &gt; Subject: Re: [OMPI users] OpenMPI / SLURM -&gt; Send/Recv blocking<br>&gt; &gt; &gt; <br>&gt; &gt; &gt; On Jan 31, 2012, at 11:16 AM, adrian sabou wrote:<br>&gt; &gt; &gt; <br>&gt; &gt; &gt; &gt; Like I said, a very simple program.<br>&gt; &gt; &gt; &gt; When launching this application with SLURM (using "salloc -N2 mpirun ./&lt;my_app&gt;"), it hangs at the barrier.<br>&gt; &gt; &gt; <br>&gt; &gt; &gt; Are you able to run the MPI example programs in examples/ ?<br>&gt; &gt; &gt; <br>&gt; &gt; &gt; &gt; However, it passes the barrier if I launch it without SLURM (using "mpirun -np 2 ./&lt;my_app&gt;"). I first noticed this problem when my application hanged if I tried to send two
 successive messages from a process to another. Only the first MPI_Send would work. The second MPI_Send would block indefinitely. I was wondering whether any of you have encountered a similar problem, or may have an ideea as to what is causing the Send/Receive pair to block when using SLURM. The exact output in my console is as follows:<br>&gt; &gt; &gt; &gt;&nbsp; <br>&gt; &gt; &gt; &gt;&nbsp; &nbsp; &nbsp; &nbsp; salloc: Granted job allocation 1138<br>&gt; &gt; &gt; &gt;&nbsp; &nbsp; &nbsp; &nbsp; Process 0 - Sending...<br>&gt; &gt; &gt; &gt;&nbsp; &nbsp; &nbsp; &nbsp; Process 1 - Receiving...<br>&gt; &gt; &gt; &gt;&nbsp; &nbsp; &nbsp; &nbsp; Process 1 - Received.<br>&gt; &gt; &gt; &gt;&nbsp; &nbsp; &nbsp; &nbsp; Process 1 - Barrier reached.<br>&gt; &gt; &gt; &gt;&nbsp; &nbsp; &nbsp; &nbsp; Process 0 - Sent.<br>&gt; &gt; &gt; &gt;&nbsp; &nbsp; &nbsp; &nbsp; Process 0 - Barrier reached.<br>&gt; &gt; &gt; &gt;&nbsp; &nbsp; &nbsp; &nbsp; (it just hangs
 here)<br>&gt; &gt; &gt; &gt;&nbsp; <br>&gt; &gt; &gt; &gt; I am new to MPI programming and to OpenMPI and would greatly appreciate any help. My OpenMPI version is 1.4.4 (although I have also tried it on 1.5.4), my SLURM version is 0.3.3-1 (slurm-llnl 2.1.0-1),<br>&gt; &gt; &gt; <br>&gt; &gt; &gt; I'm not sure what SLURM version that is -- my "srun --version" shows 2.2.4.&nbsp; 0.3.3 would be pretty ancient, no?<br>&gt; &gt; &gt; <br>&gt; &gt; &gt; -- <br>&gt; &gt; &gt; Jeff Squyres<br>&gt; &gt; &gt; <a href="mailto:jsquyres@cisco.com" ymailto="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a><br>&gt; &gt; &gt; For corporate legal information go to:<br>&gt; &gt; &gt; <a href="http://www.cisco.com/web/about/doing_business/legal/cri/" target="_blank">http://www.cisco.com/web/about/doing_business/legal/cri/</a><br>&gt; &gt; &gt; <br>&gt; &gt; &gt; <br>&gt; &gt; &gt; <br>&gt; &gt; &gt; _______________________________________________<br>&gt; &gt; &gt; users
 mailing list<br>&gt; &gt; &gt; <a href="mailto:users@open-mpi.org" ymailto="mailto:users@open-mpi.org">users@open-mpi.org</a><br>&gt; &gt; &gt; <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>&gt; &gt; <br>&gt; &gt; <br>&gt; &gt; -- <br>&gt; &gt; Jeff Squyres<br>&gt; &gt; <a href="mailto:jsquyres@cisco.com" ymailto="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a><br>&gt; &gt; For corporate legal information go to:<br>&gt; &gt; <a href="http://www.cisco.com/web/about/doing_business/legal/cri/" target="_blank">http://www.cisco.com/web/about/doing_business/legal/cri/</a><br>&gt; &gt; <br>&gt; &gt; <br>&gt; &gt; <br>&gt; &gt; _______________________________________________<br>&gt; &gt; users mailing list<br>&gt; &gt; <a href="mailto:users@open-mpi.org" ymailto="mailto:users@open-mpi.org">users@open-mpi.org</a><br>&gt; &gt; <a
 href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>&gt; <br>&gt; <br>&gt; -- <br>&gt; Jeff Squyres<br>&gt; <a href="mailto:jsquyres@cisco.com" ymailto="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a><br>&gt; For corporate legal information go to:<br>&gt; <a href="http://www.cisco.com/web/about/doing_business/legal/cri/" target="_blank">http://www.cisco.com/web/about/doing_business/legal/cri/</a><br>&gt; <br>&gt; <br>&gt; <br>&gt; _______________________________________________<br>&gt; users mailing list<br>&gt; <a href="mailto:users@open-mpi.org" ymailto="mailto:users@open-mpi.org">users@open-mpi.org</a><br>&gt; <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br><br><br>-- <br>Jeff Squyres<br><a href="mailto:jsquyres@cisco.com"
 ymailto="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a><br>For corporate legal information go to:<br><a href="http://www.cisco.com/web/about/doing_business/legal/cri/" target="_blank">http://www.cisco.com/web/about/doing_business/legal/cri/</a><br><br><br><br> </div> </div>  </div></body></html>
