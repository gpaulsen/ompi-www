<html><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div>(I just realized I had the wrong subject line, here it goes again)</div><div><br></div><div>Hi Jeff</div><div><br></div><div>Yes, I am using the right one. I've installed the freshly compiled openmpi into /opt/openmpi/1.3.3-g95-32. If I edit the mpif.h file by hand and put "error!" in the first line I get:<br><br>zamblap:sandbox zamb$ edit /opt/openmpi/1.3.3-g95-32/include/mpif.h<br><br>zamblap:sandbox zamb$ mpif77 inplace_test.f90<br><br>In file mpif.h:1<br><br>&nbsp;&nbsp;&nbsp;Included at inplace_test.f90:7<br><br>error!<br><br>1<br><br>Error: Unclassifiable statement at (1)<br><br>(btw, if I use the F90 bindings instead I get a similar problem, except the address for the MPI_IN_PLACE fortran constant is slightly different from the F77 binding, i.e. instead of 0x50920 I get 0x508e0)<br><br>Thanks for your help,<br><br>Ricardo</div><div><br></div><br><div><div>On Jul 29, 2009, at 17:00 , <a href="mailto:users-request@open-mpi.org">users-request@open-mpi.org</a> wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><span class="Apple-style-span" style="border-collapse: separate; color: rgb(0, 0, 0); font-family: Helvetica; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; ">Message: 2<br>Date: Wed, 29 Jul 2009 07:54:38 -0500<br>From: Jeff Squyres &lt;<a href="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a>&gt;<br>Subject: Re: [OMPI users] OMPI users] MPI_IN_PLACE in Fortran<br><span class="Apple-tab-span" style="white-space: pre; ">	</span>withMPI_REDUCE<span class="Apple-tab-span" style="white-space: pre; ">	</span>/ MPI_ALLREDUCE<br>To: "Open MPI Users" &lt;<a href="mailto:users@open-mpi.org">users@open-mpi.org</a>&gt;<br>Message-ID: &lt;<a href="mailto:986510B6-7103-4D7B-B7D6-9D8AFDC19E71@cisco.com">986510B6-7103-4D7B-B7D6-9D8AFDC19E71@cisco.com</a>&gt;<br>Content-Type: text/plain; charset=ISO-8859-1; format=flowed; delsp=yes<br><br>Can you confirm that you're using the right mpif.h?<br><br>Keep in mind that each MPI implementation's mpif.h is different -- &nbsp;<br>it's a common mistake to assume that the mpif.h from one MPI &nbsp;<br>implementation should work with another implementation (e.g., someone &nbsp;<br>copied mpif.h from one MPI to your software's source tree, so the &nbsp;<br>compiler always finds that one instead of the MPI-implementation-<span class="Apple-converted-space">&nbsp;</span><br>provided mpif.h.).<br><br><br>On Jul 28, 2009, at 1:17 PM, Ricardo Fonseca wrote:<br><br><blockquote type="cite">Hi George<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">I did some extra digging and found that (for some reason) the &nbsp;<br></blockquote><blockquote type="cite">MPI_IN_PLACE parameter is not being recognized as such by &nbsp;<br></blockquote><blockquote type="cite">mpi_reduce_f (reduce_f.c:61). I added a couple of printfs:<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">&nbsp;&nbsp;&nbsp;printf(" sendbuf = %p \n", sendbuf );<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">&nbsp;&nbsp;&nbsp;printf(" MPI_FORTRAN_IN_PLACE = %p \n", &amp;MPI_FORTRAN_IN_PLACE );<br></blockquote><blockquote type="cite">&nbsp;&nbsp;&nbsp;printf(" mpi_fortran_in_place = %p \n", &amp;mpi_fortran_in_place );<br></blockquote><blockquote type="cite">&nbsp;&nbsp;&nbsp;printf(" mpi_fortran_in_place_ = %p \n", &amp;mpi_fortran_in_place_ );<br></blockquote><blockquote type="cite">&nbsp;&nbsp;&nbsp;printf(" mpi_fortran_in_place__ = %p \n", &nbsp;<br></blockquote><blockquote type="cite">&amp;mpi_fortran_in_place__ );<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">And this is what I get on node 0:<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">sendbuf = 0x50920<br></blockquote><blockquote type="cite">MPI_FORTRAN_IN_PLACE = 0x17cd30<br></blockquote><blockquote type="cite">mpi_fortran_in_place = 0x17cd34<br></blockquote><blockquote type="cite">mpi_fortran_in_place_ = 0x17cd38<br></blockquote><blockquote type="cite">mpi_fortran_in_place__ = 0x17cd3c<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">This makes OMPI_F2C_IN_PLACE(sendbuf) fail. If I replace the line:<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">sendbuf = OMPI_F2C_IN_PLACE(sendbuf);<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">with:<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">&nbsp;&nbsp;&nbsp;if ( sendbuf == 0x50920 ) {<br></blockquote><blockquote type="cite">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("sendbuf is MPI_IN_PLACE!\n");<br></blockquote><blockquote type="cite">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sendbuf = MPI_IN_PLACE;<br></blockquote><blockquote type="cite">&nbsp;&nbsp;&nbsp;}<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">Then the code works and gives the correct result:<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">sendbuf is MPI_IN_PLACE!<br></blockquote><blockquote type="cite">Result:<br></blockquote><blockquote type="cite">3. 3. 3. 3.<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">So my guess is that somehow the MPI_IN_PLACE constant for fortran is &nbsp;<br></blockquote><blockquote type="cite">getting the wrong address. Could this be related to the fortran &nbsp;<br></blockquote><blockquote type="cite">compilers I'm using (ifort / g95)?<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">Ricardo<br></blockquote></span><br class="Apple-interchange-newline"></blockquote></div><br></body></html>
