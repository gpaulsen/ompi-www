<html><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div>I'm having trouble getting OpenMPI to set the working directory properly when running jobs on a Linux cluster. &nbsp;I made a test program (at end of post) that recreates the problem pretty well by just printing out the results of getcwd(). &nbsp;Here's output both with and without using -wdir:</div><div><br></div><div><blockquote type="cite" class=""><div><font class="Apple-style-span" color="#000000">(merle):~$ cd test</font></div><div><font class="Apple-style-span" color="#000000">(merle):test$ mpirun -np 2 test</font></div><div><font class="Apple-style-span" color="#000000">before MPI_Init:</font></div><div><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">PWD:</font><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">/home/tgamblin</font></div><div><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">getcwd:</font><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">/home/tgamblin</font></div><div><font class="Apple-style-span" color="#000000">before MPI_Init:</font></div><div><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">PWD:</font><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">/home/tgamblin</font></div><div><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">getcwd:</font><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">/home/tgamblin</font></div><div><font class="Apple-style-span" color="#000000">after MPI_Init:</font></div><div><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">PWD:</font><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">/home/tgamblin</font></div><div><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">getcwd:</font><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">/home/tgamblin</font></div><div><font class="Apple-style-span" color="#000000">after MPI_Init:</font></div><div><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">PWD:</font><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">/home/tgamblin</font></div><div><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">getcwd:</font><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">/home/tgamblin</font></div><div><font class="Apple-style-span" color="#000000">(merle):test$ mpirun -np 2 -wdir /home/tgamblin/test test</font></div><div><font class="Apple-style-span" color="#000000">before MPI_Init:</font></div><div><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">PWD:</font><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">/home/tgamblin</font></div><div><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">getcwd:</font><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">/home/tgamblin</font></div><div><font class="Apple-style-span" color="#000000">before MPI_Init:</font></div><div><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">PWD:</font><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">/home/tgamblin</font></div><div><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">getcwd:</font><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">/home/tgamblin</font></div><div><font class="Apple-style-span" color="#000000">after MPI_Init:</font></div><div><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">PWD:</font><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">/home/tgamblin</font></div><div><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">getcwd:</font><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">/home/tgamblin</font></div><div><font class="Apple-style-span" color="#000000">after MPI_Init:</font></div><div><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">PWD:</font><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">/home/tgamblin</font></div><div><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">getcwd:</font><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span><font class="Apple-style-span" color="#000000">/home/tgamblin</font></div></blockquote></div><div><br></div><div>Shouldn't these print out /home/tgamblin/test? &nbsp;Also, this is even stranger:</div><div><br></div><div><blockquote type="cite" class=""><div><font class="Apple-style-span" color="#000000">(merle):test$ mpirun -np 2 pwd</font></div><div><font class="Apple-style-span" color="#000000">/home/tgamblin/test</font></div><div><font class="Apple-style-span" color="#000000">/home/tgamblin/test</font></div></blockquote></div><div><br></div><div>I feel like my program should output the same thing as pwd.</div><div><br></div><div>I'm using OpenMPI 1.2.6, and the cluster has 8 nodes, with 2-by dual-core woodcrests each (total 32 cores). &nbsp;There are 2 tcp networks on this cluster, one that the head node uses to talk to the compute nodes and one (Gigabit) network that the compute nodes can reach each other (but not the head node) on. &nbsp;I have "btl_tcp_if_include = eth2" in my mca params file to keep the compute nodes using the fast interconnect to talk to each other, and I've pasted ifconfig output for the head node and for one compute node below. &nbsp;Also, if it helps, the home directories on this machine are mounted via autofs.</div><div><br></div><div>This is causing problems b/c I'm using apps that look for the config file in the working directory. Please let me know if you guys have any idea what's going on.</div><div><br></div><div>Thanks!</div><div>-Todd</div><div><br></div><div><br></div><div>TEST PROGRAM:</div><div><blockquote type="cite" class=""><div><font class="Apple-style-span" color="#000000">#include "mpi.h"</font></div><div><font class="Apple-style-span" color="#000000">#include &lt;cstdlib></font></div><div><font class="Apple-style-span" color="#000000">#include &lt;iostream></font></div><div><font class="Apple-style-span" color="#000000">#include &lt;sstream></font></div><div><font class="Apple-style-span" color="#000000">using namespace std;</font></div><div><font class="Apple-style-span" color="#000000"><br></font></div><div><font class="Apple-style-span" color="#000000">void testdir(const char*where) {</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp;char buf[1024];</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp;getcwd(buf, 1024);</font></div><div><font class="Apple-style-span" color="#000000"><br></font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp;ostringstream tmp;</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp;tmp &lt;&lt; where &lt;&lt; ":" &lt;&lt; endl</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp;&lt;&lt; "\tPWD:\t"&lt;&lt; getenv("PWD") &lt;&lt; endl</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp;&lt;&lt; "\tgetcwd:\t"&lt;&lt; getenv("PWD") &lt;&lt; endl;</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp;cout &lt;&lt; tmp.str();</font></div><div><font class="Apple-style-span" color="#000000">}</font></div><div><font class="Apple-style-span" color="#000000"><br></font></div><div><font class="Apple-style-span" color="#000000">int main(int argc, char **argv) {</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp;testdir("before MPI_Init");</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp;MPI_Init(&amp;argc, &amp;argv);</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp;testdir("after MPI_Init");</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp;MPI_Finalize();</font></div><div><font class="Apple-style-span" color="#000000">}</font></div></blockquote><br></div><div>HEAD NODE IFCONFIG:</div><div><blockquote type="cite" class=""><div><font class="Apple-style-span" color="#000000">eth0 &nbsp; &nbsp; &nbsp;Link encap:Ethernet &nbsp;HWaddr 00:18:8B:2F:3D:90 &nbsp;</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;inet addr:10.6.1.1 &nbsp;Bcast:10.6.1.255 &nbsp;Mask:255.255.255.0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;inet6 addr: fe80::218:8bff:fe2f:3d90/64 Scope:Link</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RX packets:1579250319 errors:0 dropped:0 overruns:0 frame:0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TX packets:874273636 errors:0 dropped:0 overruns:0 carrier:0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;collisions:0 txqueuelen:1000&nbsp;</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RX bytes:2361367146846 (2.1 TiB) &nbsp;TX bytes:85373933521 (79.5 GiB)</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Interrupt:169 Memory:f4000000-f4011100&nbsp;</font></div><div><font class="Apple-style-span" color="#000000"><br></font></div><div><font class="Apple-style-span" color="#000000">eth0:1 &nbsp; &nbsp;Link encap:Ethernet &nbsp;HWaddr 00:18:8B:2F:3D:90 &nbsp;</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;inet addr:10.6.2.1 &nbsp;Bcast:10.6.2.255 &nbsp;Mask:255.255.255.0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Interrupt:169 Memory:f4000000-f4011100&nbsp;</font></div><div><font class="Apple-style-span" color="#000000"><br></font></div><div><font class="Apple-style-span" color="#000000">eth1 &nbsp; &nbsp; &nbsp;Link encap:Ethernet &nbsp;HWaddr 00:18:8B:2F:3D:8E &nbsp;</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;inet addr:152.54.1.21 &nbsp;Bcast:152.54.3.255 &nbsp;Mask:255.255.252.0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;inet6 addr: fe80::218:8bff:fe2f:3d8e/64 Scope:Link</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RX packets:14436523 errors:0 dropped:0 overruns:0 frame:0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TX packets:7357596 errors:0 dropped:0 overruns:0 carrier:0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;collisions:0 txqueuelen:1000&nbsp;</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RX bytes:2354451258 (2.1 GiB) &nbsp;TX bytes:2218390772 (2.0 GiB)</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Interrupt:169 Memory:f8000000-f8011100&nbsp;</font></div><div><font class="Apple-style-span" color="#000000"><br></font></div><div><font class="Apple-style-span" color="#000000">lo &nbsp; &nbsp; &nbsp; &nbsp;Link encap:Local Loopback &nbsp;</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;inet addr:127.0.0.1 &nbsp;Mask:255.0.0.0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;inet6 addr: ::1/128 Scope:Host</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UP LOOPBACK RUNNING &nbsp;MTU:16436 &nbsp;Metric:1</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RX packets:540889623 errors:0 dropped:0 overruns:0 frame:0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TX packets:540889623 errors:0 dropped:0 overruns:0 carrier:0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;collisions:0 txqueuelen:0&nbsp;</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RX bytes:63787539844 (59.4 GiB) &nbsp;TX bytes:63787539844 (59.4 GiB)</font></div><div><br></div></blockquote><br></div><div>COMPUTE NODE IFCONFIG:</div><div><blockquote type="cite" class=""><div><font class="Apple-style-span" color="#000000">(compute-0-0):~$ ifconfig</font></div><div><font class="Apple-style-span" color="#000000">eth0 &nbsp; &nbsp; &nbsp;Link encap:Ethernet &nbsp;HWaddr 00:13:72:FA:42:ED &nbsp;</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;inet addr:10.6.1.254 &nbsp;Bcast:10.6.1.255 &nbsp;Mask:255.255.255.0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;inet6 addr: fe80::213:72ff:fefa:42ed/64 Scope:Link</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RX packets:200637 errors:0 dropped:0 overruns:0 frame:0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TX packets:165336 errors:0 dropped:0 overruns:0 carrier:0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;collisions:0 txqueuelen:1000&nbsp;</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RX bytes:187105568 (178.4 MiB) &nbsp;TX bytes:26263945 (25.0 MiB)</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Interrupt:169 Memory:f8000000-f8011100&nbsp;</font></div><div><font class="Apple-style-span" color="#000000"><br></font></div><div><font class="Apple-style-span" color="#000000">eth2 &nbsp; &nbsp; &nbsp;Link encap:Ethernet &nbsp;HWaddr 00:15:17:0E:9E:68 &nbsp;</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;inet addr:10.6.2.254 &nbsp;Bcast:10.6.2.255 &nbsp;Mask:255.255.255.0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;inet6 addr: fe80::215:17ff:fe0e:9e68/64 Scope:Link</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RX packets:20 errors:0 dropped:0 overruns:0 frame:0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TX packets:8 errors:0 dropped:0 overruns:0 carrier:0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;collisions:0 txqueuelen:1000&nbsp;</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RX bytes:1280 (1.2 KiB) &nbsp;TX bytes:590 (590.0 b)</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Base address:0xdce0 Memory:fc3e0000-fc400000&nbsp;</font></div><div><font class="Apple-style-span" color="#000000"><br></font></div><div><font class="Apple-style-span" color="#000000">lo &nbsp; &nbsp; &nbsp; &nbsp;Link encap:Local Loopback &nbsp;</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;inet addr:127.0.0.1 &nbsp;Mask:255.0.0.0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;inet6 addr: ::1/128 Scope:Host</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UP LOOPBACK RUNNING &nbsp;MTU:16436 &nbsp;Metric:1</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RX packets:65 errors:0 dropped:0 overruns:0 frame:0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TX packets:65 errors:0 dropped:0 overruns:0 carrier:0</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;collisions:0 txqueuelen:0&nbsp;</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RX bytes:4376 (4.2 KiB) &nbsp;TX bytes:4376 (4.2 KiB)</font></div><div><br></div></blockquote><br></div><div><br></div></body></html>
