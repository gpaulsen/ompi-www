<div dir="ltr"><div id="yui_3_13_0_1_1399065114564_2844" style class="">I have been using MPI for many many years so I have very well debugged mpi tests.   I am</div><div id="yui_3_13_0_1_1399065114564_2848" style class="">
having trouble on either openmpi-1.4.5  or  openmpi-1.6.5 versions though with getting the <br style class=""></div><div id="yui_3_13_0_1_1399065114564_2853" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
MPI_Barrier calls to work.   It works fine when I run all processes on one machine but when</div><div id="yui_3_13_0_1_1399065114564_2850" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
I run with two or more
 hosts the second call to MPI_Barrier always hangs.   Not the first one,</div><div id="yui_3_13_0_1_1399065114564_2854" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
but always the second one.   I looked at FAQ&#39;s and such but found nothing except for a comment</div><div id="yui_3_13_0_1_1399065114564_2849" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
that MPI_Barrier problems were often problems with fire walls.  Also mentioned as a problem</div><div id="yui_3_13_0_1_1399065114564_2855" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
was not having the same version of mpi on both machines.  I turned firewalls off
 and removed</div><div id="yui_3_13_0_1_1399065114564_2856" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
and reinstalled the same version on both hosts but I still see the same thing.   I then installed <br style class=""></div><div id="yui_3_13_0_1_1399065114564_2857" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
lam mpi on two of my machines and that works fine.   I can call the MPI_Barrier function when run on<br></div><div id="yui_3_13_0_1_1399065114564_2858" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
one of two machines by itself  many times with no hangs.  Only hangs if two or more hosts are involved.<br></div><div id="yui_3_13_0_1_1399065114564_2859" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
These runs are all being done on CentOS release 6.4.   Here is test program I used.<br style class=""></div><div id="yui_3_13_0_1_1399065114564_2860" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
<br style class=""></div><div id="yui_3_13_0_1_1399065114564_2861" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
main (argc, argv)<br style class="">int argc;<br style class="">char **argv;<br style class="">{<br style class="">    char message[20];<br style class="">    char hoster[256];<br style class="">   
 char nameis[256];<br style class="">    int fd, i, j, jnp, iret, myrank, np, ranker, recker;<br style class="">    MPI_Comm comm;<br><div id="yui_3_13_0_1_1399065114564_2861" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
    MPI_Status status;<br style class=""><br style class="">    MPI_Init( &amp;argc, &amp;argv );<br style class="">    MPI_Comm_rank( MPI_COMM_WORLD, &amp;myrank);<br style class="">    MPI_Comm_size( MPI_COMM_WORLD, &amp;np);<br style class="">
<br style class="">        gethostname(hoster,256);<br style class=""><br style class="">        printf(&quot; In rank %d and host= %s  Do Barrier call 1.\n&quot;,myrank,hoster);<br style class="">    MPI_Barrier(MPI_COMM_WORLD);  <br style class="">
        printf(&quot; In rank %d and host= %s  Do Barrier call
 2.\n&quot;,myrank,hoster);<br style class="">    MPI_Barrier(MPI_COMM_WORLD);  <br style class="">        printf(&quot; In rank %d and host= %s  Do Barrier call 3.\n&quot;,myrank,hoster);<br style class="">    MPI_Barrier(MPI_COMM_WORLD);  <br style class="">
    MPI_Finalize();<br style class="">    exit(0);<br style class="">}<br style class=""></div><div id="yui_3_13_0_1_1399065114564_2875" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
<br style class=""></div><div id="yui_3_13_0_1_1399065114564_2868" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
  Here are three runs of test program.  First with two processes on one
 host, then with</div><div id="yui_3_13_0_1_1399065114564_2869" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
two processes on another host, and finally with one process on each of two hosts.  The</div><div id="yui_3_13_0_1_1399065114564_2870" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
first two runs are fine but the last run hangs on the second MPI_Barrier.</div><div id="yui_3_13_0_1_1399065114564_2871" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
<br style class=""></div><div id="yui_3_13_0_1_1399065114564_2872" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
[root@centos MPI]# /usr/local/bin/mpirun -np 2 --host centos a.out<br style class=""> In rank 0 and host= centos  Do Barrier call 1.<br style class=""> In rank 1 and host= centos  Do Barrier call 1.<br style class=""> In rank 1 and host= centos  Do Barrier call 2.<br style class="">
 In rank 1 and host= centos  Do Barrier call 3.<br style class=""> In rank 0 and host= centos  Do Barrier call 2.<br style class=""> In rank 0 and host= centos  Do Barrier call 3.<br style class="">[root@centos MPI]# /usr/local/bin/mpirun -np 2 --host RAID a.out<br style class="">
/root/.bashrc: line 14: unalias: ls: not found<br style class=""> In rank 0 and host= RAID  Do Barrier call 1.<br style class=""> In rank 0 and host= RAID  Do Barrier call 2.<br style class=""> In rank 0 and host= RAID  Do Barrier call
 3.<br style class=""> In rank 1 and host= RAID  Do Barrier call 1.<br style class=""> In rank 1 and host= RAID  Do Barrier call 2.<br style class=""> In rank 1 and host= RAID  Do Barrier call 3.<br style class="">[root@centos MPI]# /usr/local/bin/mpirun -np 2 --host centos,RAID a.out<br style class="">
/root/.bashrc: line 14: unalias: ls: not found<br style class=""> In rank 0 and host= centos  Do Barrier call 1.<br style class=""> In rank 0 and host= centos  Do Barrier call 2.<br><div id="main"><div id="paneshell"><div id="shellcontent" class="">
<div id="shellinner"><div id="yui_3_13_0_1_1399065114564_2659" style class=""><div id="yui_3_13_0_1_1399065114564_2688" class="" tabindex="-1"><div id="yui_3_13_0_1_1399065114564_2709" class=""><div id="yui_3_13_0_1_1399065114564_2744" class="" tabindex="-1">
<div style="margin-top:0px" id="yui_3_13_0_1_1399065114564_2751" class="" tabindex="0"><div id="yui_3_13_0_1_1399065114564_2755" class=""><div id="yui_3_13_0_1_1399065114564_2847" class=""><div id="yiv1440412755"><div id="yui_3_13_0_1_1399065114564_2846">
<div id="yui_3_13_0_1_1399065114564_2845" style="color:rgb(0,0,0);background-color:rgb(255,255,255);font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;font-size:12pt"><div id="yui_3_13_0_1_1399065114564_2872" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
In rank 1 and host= RAID  Do Barrier call 1.<br style class=""> In rank 1 and host= RAID  Do Barrier call 2.<br style class=""></div><div id="yui_3_13_0_1_1399065114564_2882" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
<br style class=""> </div><div id="yui_3_13_0_1_1399065114564_2883" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
  Since it is such a simple test and problem and such a widely used MPI function, it must obviously</div><div id="yui_3_13_0_1_1399065114564_2884" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
be an installation or configuration problem.   A pstack for each of the hung MPI_Barrier processes <br style class=""></div><div id="yui_3_13_0_1_1399065114564_2885" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
on the two machines shows this:</div><div id="yui_3_13_0_1_1399065114564_2886" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
<br style class=""></div><div id="yui_3_13_0_1_1399065114564_2887" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
[root@centos ~]# pstack 31666<br style class="">#0  0x0000003baf0e8ee3 in __epoll_wait_nocancel () from /lib64/libc.so.6<br style class="">#1  0x00007f5de06125eb in epoll_dispatch () from /usr/local/lib/libmpi.so.1<br style class="">
#2  0x00007f5de061475a in opal_event_base_loop () from /usr/local/lib/libmpi.so.1<br style class="">#3  0x00007f5de0639229 in opal_progress () from /usr/local/lib/libmpi.so.1<br style class="">#4  0x00007f5de0586f75 in ompi_request_default_wait_all () from /usr/local/lib/libmpi.so.1<br style class="">
#5  0x00007f5ddc59565e in
 ompi_coll_tuned_sendrecv_actual () from /usr/local/lib/openmpi/mca_coll_tuned.so<br style class="">#6  0x00007f5ddc59d8ff in ompi_coll_tuned_barrier_intra_two_procs () from /usr/local/lib/openmpi/mca_coll_tuned.so<br style class="">
#7  0x00007f5de05941c2 in PMPI_Barrier () from /usr/local/lib/libmpi.so.1<br style class="">#8  0x0000000000400a43 in main ()<br style class=""></div><div style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
<br style class=""></div><div id="yui_3_13_0_1_1399065114564_2924" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
[root@RAID openmpi-1.6.5]# pstack 22167<br style class="">#0  0x00000030302e8ee3 in __epoll_wait_nocancel () from /lib64/libc.so.6<br style class="">#1  0x00007f7ee46885eb in epoll_dispatch () from /usr/local/lib/libmpi.so.1<br style class="">
#2  0x00007f7ee468a75a in opal_event_base_loop () from /usr/local/lib/libmpi.so.1<br style class="">#3  0x00007f7ee46af229 in opal_progress () from /usr/local/lib/libmpi.so.1<br style class="">#4  0x00007f7ee45fcf75 in ompi_request_default_wait_all () from /usr/local/lib/libmpi.so.1<br style class="">
#5  0x00007f7ee060b65e in ompi_coll_tuned_sendrecv_actual () from /usr/local/lib/openmpi/mca_coll_tuned.so<br style class="">#6  0x00007f7ee06138ff in ompi_coll_tuned_barrier_intra_two_procs () from /usr/local/lib/openmpi/mca_coll_tuned.so<br style class="">
#7  0x00007f7ee460a1c2 in PMPI_Barrier () from /usr/local/lib/libmpi.so.1<br style class="">#8  0x0000000000400a43 in main ()<br><br></div><div id="yui_3_13_0_1_1399065114564_2924" style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
 Which looks exactly the same on each machine.  Any thoughts or ideas would be greatly appreciated as <br>I am stuck.<br style class=""></div><div style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class="">
<br style class=""></div><div style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class=""> Clay Kirkland<br style class="">
</div><div style="color:rgb(0,0,0);font-size:16px;font-family:HelveticaNeue,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;background-color:transparent;font-style:normal" class=""><br style class=""></div></div></div>
</div></div></div></div>    <div id="yui_3_13_0_1_1399065114564_2745" class="" tabindex="0">  <div class="">  <table style="margin:0px;width:100%;border-spacing:0px;border-collapse:collapse" border="0"> <tbody> <tr> <td>  <br>
</td> </tr> <tr> <td>  <br></td> </tr> <tr> <td style="padding-bottom:5"> <div class=""> <div class="">  </div>   <div class="">   </div>  </div> <br></td> </tr> <tr> <td class=""> <div class="">    <div class=""><div class="">
 <div> <form method="post" enctype="multipart/form-data" class="" target="" action=""> <span class="" title="Attach File">  </span>   </form>   </div></div><div class=""> <div class=""> <span id="btn-fontnamesize" class="" title="Font"></span> <span class="" title="Bold"></span> <span class="" title="Italic"></span>  <span id="btn-forecolor" class="" title="Text Color"></span> <span id="btn-insertunordered" class=""></span> <span id="btn-indent" class=""></span> <span id="btn-text-align" class=""></span>  <span class="" title="Insert Link"></span> <span id="emoticon" class="" title="Emoticons"></span> <span class=""></span> <span id="btn-spellchk" class="" title="Check Spelling"></span> <span id="btn-spell-langs" title="Language Options" class=""></span>   <span id="switchtext-rich" class="" title="Switch to Plain Text" target="rich-text"></span> </div>
 </div> </div> </div> </td> </tr> </tbody> </table></div></div></div></div></div></div></div></div></div></div></div></div></div>

