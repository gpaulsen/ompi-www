<div>Hi there.</div><div><br></div><div>I have an application in which I need to terminate a process anytime due an external command. In order to maintain the consistence of the processes, I need to receive the messages that were already sent to the terminating process. I used the MPI_Iprobe to check whether there is messages to be received, but I noticed that I have to call this function twice. Otherwise it does not work properly. The code bellow <span class="Apple-style-span" style="font-family: arial, sans-serif; font-size: 13px; ">exemplifies what happens. Can anyone help me? Is there another way to do what I need?</span></div>
<meta http-equiv="content-type" content="text/html; charset=utf-8"><div><br></div><div>Thanks in advance.</div><div><br></div><br clear="all"><div>#include &quot;mpi.h&quot;</div><div>#include &lt;stdio.h&gt;</div><div> </div>
<div>int main(int argc, char *argv[]) {</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>int rank, size, i;</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>MPI_Status status;</div>
<div><br></div><div><span class="Apple-tab-span" style="white-space:pre">	</span>MPI_Init(&amp;argc, &amp;argv);</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>MPI_Comm_size(MPI_COMM_WORLD, &amp;size);</div>
<div><span class="Apple-tab-span" style="white-space:pre">	</span>MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);</div><div><span class="Apple-tab-span" style="white-space:pre">	</span></div><div><span class="Apple-tab-span" style="white-space:pre">	</span>if (size &lt; 2) {</div>
<div><span class="Apple-tab-span" style="white-space:pre">		</span>printf(&quot;Please run with two processes.\n&quot;); fflush(stdout);</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>MPI_Finalize();</div>
<div><span class="Apple-tab-span" style="white-space:pre">		</span>return 0;</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>}</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>if (rank == 0) {</div>
<div><span class="Apple-tab-span" style="white-space:pre">		</span>for (i=0; i&lt;10; i++) {</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>MPI_Send(&amp;i, 1, MPI_INT, 1, 123, MPI_COMM_WORLD);</div>
<div><span class="Apple-tab-span" style="white-space:pre">		</span>}</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>}</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>if (rank == 1) {</div>
<div><span class="Apple-tab-span" style="white-space:pre">		</span>int value, has_message;</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>MPI_Status status;</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>sleep (2);</div>
<div><span class="Apple-tab-span" style="white-space:pre">		</span></div><div><span class="Apple-tab-span" style="white-space:pre">		</span><b>// Code bellow does not work properly</b></div><div><span class="Apple-tab-span" style="white-space:pre">		</span>MPI_Iprobe(0, 123, MPI_COMM_WORLD, &amp;has_message, &amp;status);</div>
<div><span class="Apple-tab-span" style="white-space:pre">		</span>while (has_message) {</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>MPI_Recv(&amp;value, 1, MPI_INT, 0, 123, MPI_COMM_WORLD, &amp;status);</div>
<div><span class="Apple-tab-span" style="white-space:pre">			</span>printf(&quot;Process %d received message %d.\n&quot;, rank, value);</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>MPI_Iprobe(0, 123, MPI_COMM_WORLD, &amp;has_message, &amp;status);</div>
<div><span class="Apple-tab-span" style="white-space:pre">		</span>}</div><div><br></div><div><span class="Apple-tab-span" style="white-space:pre">		</span><b>// Calling MPI_Iprobe twice for each incoming message makes the code work.</b></div>
<div><span class="Apple-tab-span" style="white-space:pre">		</span>/*</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>MPI_Iprobe(0, 123, MPI_COMM_WORLD, &amp;has_message, &amp;status);</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>MPI_Iprobe(0, 123, MPI_COMM_WORLD, &amp;has_message, &amp;status);</div>
<div><span class="Apple-tab-span" style="white-space:pre">		</span>while (has_message) {</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>MPI_Recv(&amp;value, 1, MPI_INT, 0, 123, MPI_COMM_WORLD, &amp;status);</div>
<div><span class="Apple-tab-span" style="white-space:pre">			</span>printf(&quot;Process %d received message %d.\n&quot;, rank, value);</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>MPI_Iprobe(0, 123, MPI_COMM_WORLD, &amp;has_message, &amp;status);</div>
<div><span class="Apple-tab-span" style="white-space:pre">			</span>MPI_Iprobe(0, 123, MPI_COMM_WORLD, &amp;has_message, &amp;status);</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>}</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>*/</div>
<div><span class="Apple-tab-span" style="white-space:pre">		</span></div><div><span class="Apple-tab-span" style="white-space:pre">		</span>fflush(stdout);</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>}</div>
<div><span class="Apple-tab-span" style="white-space:pre">	</span>MPI_Finalize();</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>return 0;</div><div>}</div>

