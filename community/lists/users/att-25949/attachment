<html><head><meta http-equiv="Content-Type" content="text/html charset=utf-8"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;" class="">FWIW: I just committed that patch to the 1.8 repo, so it will be in tomorrow’s nightly 1.8 tarball:<div class=""><br class=""></div><div class=""><a href="http://www.open-mpi.org/nightly/v1.8/" class="">http://www.open-mpi.org/nightly/v1.8/</a></div><div class=""><br class=""></div><div class=""><br class=""><div><blockquote type="cite" class=""><div class="">On Dec 10, 2014, at 7:40 AM, Ralph Castain &lt;<a href="mailto:rhc@open-mpi.org" class="">rhc@open-mpi.org</a>&gt; wrote:</div><br class="Apple-interchange-newline"><div class=""><meta http-equiv="Content-Type" content="text/html charset=utf-8" class=""><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;" class="">You should be able to apply the patch - I don’t think that section of code differs from what is in the 1.8 repo.<div class=""><br class=""></div><div class="">The sha for 1.8.3 can be found on the web site (see right-most column in table):</div><div class=""><br class=""></div><div class=""><a href="http://www.open-mpi.org/software/ompi/v1.8/" class="">http://www.open-mpi.org/software/ompi/v1.8/</a></div><div class=""><br class=""></div><div class=""><br class=""><div class=""><blockquote type="cite" class=""><div class="">On Dec 10, 2014, at 7:35 AM, Eric Chamberland &lt;<a href="mailto:Eric.Chamberland@giref.ulaval.ca" class="">Eric.Chamberland@giref.ulaval.ca</a>&gt; wrote:</div><br class="Apple-interchange-newline"><div class=""><span style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;" class="">Hi Nathan,</span><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><span style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;" class="">I pulled your commit &nbsp;d0da29351f9 and tested it against our example.</span><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><span style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;" class="">It now works perfectly. &nbsp;Strangely, I can even unset "OMPI_MCA_mpi_yield_when_idle=1" and it doesn't seems to last longer.</span><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><span style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;" class="">Can I apply the patch to a fresh "1.8.3" and it should work?</span><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><span style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;" class="">Other question: how can I retrieve the SHA for 1.8.3? &nbsp;(Should they be tagged in the repository? Is it normal if I just see a "dev" tag??)</span><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><span style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;" class="">Thanks,</span><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><span style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;" class="">Eric</span><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><span style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;" class="">On 12/09/2014 04:19 PM, Nathan Hjelm wrote:</span><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><blockquote type="cite" style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><br class="">yield when idle is broken on 1.8. Fixing now.<br class=""><br class="">-Nathan<br class=""><br class="">On Tue, Dec 09, 2014 at 01:02:08PM -0800, Ralph Castain wrote:<br class=""><blockquote type="cite" class="">Hmmm….well, it looks like we are doing the right thing and running unbound when oversubscribed like this. I don’t have any brilliant idea why it would be running so slowly in that situation when compared with 1.6.5 - it could be that yield-when-idle is borked. I’ll try to dig into that notion a bit.<br class=""><br class=""><br class=""><blockquote type="cite" class="">On Dec 9, 2014, at 10:39 AM, Eric Chamberland &lt;<a href="mailto:Eric.Chamberland@giref.ulaval.ca" class="">Eric.Chamberland@giref.ulaval.ca</a>&gt; wrote:<br class=""><br class="">Hi again,<br class=""><br class="">I sorted and "seded" (cat outpout.1.00 |sed 's/default/default value/g'|sed 's/true/1/g' |sed 's/false/0/g') the output.1.00 file from:<br class=""><br class="">mpirun --output-filename output -mca mpi_show_mca_params all --report-bindings -np 32 myprog<br class=""><br class="">between a launch with 165 vs 183.<br class=""><br class="">The diff may be interesting but I can't interpret everything that is written...<br class=""><br class="">The files are attached...<br class=""><br class="">Thanks,<br class=""><br class="">Eric<br class=""><br class="">On 12/09/2014 01:02 PM, Eric Chamberland wrote:<br class=""><blockquote type="cite" class="">On 12/09/2014 12:24 PM, Ralph Castain wrote:<br class=""><blockquote type="cite" class="">Can you provide an example cmd line you use to launch one of these<br class="">tests using 1.8.3? Some of the options changed between the 1.6 and 1.8<br class="">series, and we bind by default in 1.8 - the combination may be causing<br class="">you a problem.<br class=""></blockquote><br class="">I very simply launch:<br class=""><br class="">"mpirun -np 32 myprog"<br class=""><br class="">Maybe the result of "-mca mpi_show_mca_params all" would be insightful?<br class=""><br class="">Eric<br class=""><br class=""><blockquote type="cite" class=""><br class=""><br class=""><blockquote type="cite" class="">On Dec 9, 2014, at 9:14 AM, Eric Chamberland<br class="">&lt;<a href="mailto:Eric.Chamberland@giref.ulaval.ca" class="">Eric.Chamberland@giref.ulaval.ca</a>&gt; wrote:<br class=""><br class="">Hi,<br class=""><br class="">we were used to do oversubscribing just to do code validation in<br class="">nightly automated parallel runs of our code.<br class=""><br class="">I just compiled openmpi 1.8.3 and launched the whole suit of<br class="">sequential/parallel tests and noticed a *major* slowdown in<br class="">oversubscribed parallel tests with 1.8.3 compared to 1.6.5.<br class=""><br class="">For example, on my computer (2 cpu), a validation test of 64<br class="">processes launched with 1.8.3 took 1500 seconds (~29 minutes) to<br class="">execute, while the very same test compiled with 1.6.5 took only 7.4<br class="">seconds!<br class=""><br class="">To have this result with 1.6.5 we had to set the variable<br class="">"OMPI_MCA_mpi_yield_when_idle=1", but it seems to have no effects in<br class="">1.8.3 when I launch more processes than number of core in my<br class="">computer, even if it is still mentioned to work (see<br class=""><a href="http://www.open-mpi.org/faq/?category=running#force-aggressive-degraded" class="">http://www.open-mpi.org/faq/?category=running#force-aggressive-degraded</a>).<br class="">However, when I launch with fewer processes than number of core, then<br class="">it is faster without "OMPI_MCA_mpi_yield_when_idle=1", which is the<br class="">same behavior in 1.6.5.<br class=""><br class="">I tried to launch with a host file like this:<br class=""><br class="">localhost slots=2<br class=""><br class="">but it changed nothing...<br class=""><br class="">What do I do wrong?<br class=""><br class="">Is it possible to retrieve "performances" of 1.6.5 for oversubscription?<br class=""><br class="">Is there a compilation option that I have to enable in 1.8.3?<br class=""><br class="">Here are the config.log and "ompi_info --all" files for both versions<br class="">of mpi:<br class=""><br class=""><a href="http://www.giref.ulaval.ca/~ericc/ompi_bug/config.165.log.gz" class="">http://www.giref.ulaval.ca/~ericc/ompi_bug/config.165.log.gz</a><br class=""><a href="http://www.giref.ulaval.ca/~ericc/ompi_bug/config.183.log.gz" class="">http://www.giref.ulaval.ca/~ericc/ompi_bug/config.183.log.gz</a><br class="">http://www.giref.ulaval.ca/~ericc/ompi_bug/ompi_info.all.165.txt.gz<br class="">http://www.giref.ulaval.ca/~ericc/ompi_bug/ompi_info.all.183.txt.gz<br class=""><br class="">Thanks,<br class=""><br class="">Eric<br class=""><br class=""><br class=""><br class=""><br class="">_______________________________________________<br class="">users mailing list<br class="">users@open-mpi.org<br class="">Subscription: http://www.open-mpi.org/mailman/listinfo.cgi/users<br class="">Link to this post:<br class="">http://www.open-mpi.org/community/lists/users/2014/12/25936.php<br class=""></blockquote><br class="">_______________________________________________<br class="">users mailing list<br class=""><a href="mailto:users@open-mpi.org" class="">users@open-mpi.org</a><br class="">Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" class="">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br class="">Link to this post:<br class=""><a href="http://www.open-mpi.org/community/lists/users/2014/12/25938.php" class="">http://www.open-mpi.org/community/lists/users/2014/12/25938.php</a><br class=""><br class=""></blockquote><br class="">_______________________________________________<br class="">users mailing list<br class=""><a href="mailto:users@open-mpi.org" class="">users@open-mpi.org</a><br class="">Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" class="">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br class="">Link to this post:<br class=""><a href="http://www.open-mpi.org/community/lists/users/2014/12/25940.php" class="">http://www.open-mpi.org/community/lists/users/2014/12/25940.php</a><br class=""></blockquote><br class="">&lt;output.1.00.filtre.165.sorted&gt;&lt;output.1.00.filtre.183.sorted.seded&gt;<br class=""></blockquote><br class="">_______________________________________________<br class="">users mailing list<br class=""><a href="mailto:users@open-mpi.org" class="">users@open-mpi.org</a><br class="">Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" class="">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br class="">Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2014/12/25942.php" class="">http://www.open-mpi.org/community/lists/users/2014/12/25942.php</a><br class=""></blockquote></blockquote><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><span style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;" class="">_______________________________________________</span><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><span style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;" class="">users mailing list</span><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><span style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;" class=""><a href="mailto:users@open-mpi.org" class="">users@open-mpi.org</a></span><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><span style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;" class="">Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" class="">http://www.open-mpi.org/mailman/listinfo.cgi/users</a></span><br style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class=""><span style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;" class="">Link to this post:<span class="Apple-converted-space">&nbsp;</span></span><a href="http://www.open-mpi.org/community/lists/users/2014/12/25947.php" style="font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;" class="">http://www.open-mpi.org/community/lists/users/2014/12/25947.php</a></div></blockquote></div><br class=""></div></div></div></blockquote></div><br class=""></div></body></html>
