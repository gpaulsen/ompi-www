<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"></head><body dir="auto"><div><br></div><blockquote type="cite"><div><br></div></blockquote><blockquote type="cite"><div><div dir="ltr">Hi all,<div><br></div><div style="">&nbsp;I got a problem when call MPI subroutines in a loop. For example, I have Fortran codes to randomly&nbsp;</div><div style="">select 10 points in a 2D space domain and change the values at those points near these 10 points to -10:</div>
<div style=""><br></div><div style="">&nbsp;real A( (100*rank+1):(100*rank+100),100 )</div><div style="">&nbsp;real inmax(2),outmax(2)</div><div style="">&nbsp;integer maxlocation(2),maxrank</div><div style="">&nbsp;&nbsp;</div><div style=""><br></div><div style="">call random_number(A) &nbsp;&nbsp;</div>
<div style=""><span style="background-color:rgb(255,255,255)"><font color="#000000">maxlocation=maxloc(A); &nbsp;!!! <i>find the coordinates of the local maximum;</i></font></span></div><div style=""><span style="background-color:rgb(255,255,255)">inmax(1)=maxval(A); &nbsp; &nbsp; &nbsp; &nbsp;!!! <i>get the local maximum value</i></span></div>
<div style="">inmax(2)=myrank; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!!!! <i>put the process rank</i></div><div style="">&nbsp; do i=1, 10</div><div style="">&nbsp; &nbsp;</div><div style="">&nbsp; &nbsp; &nbsp; &nbsp;call MPI_allreduce(inmax,outmax,1,mpi_2real, mpi_maxloc,MPI_comm_world,error) &nbsp;!!!<i>get the global maximum and the corresponding rank&nbsp;</i></div>
<div style="">&nbsp; &nbsp; &nbsp; &nbsp;maxrank=outmax(2ï¼‰</div><div style="">&nbsp; &nbsp; &nbsp; &nbsp;call MPI_Bcast(maxlocation,2,mpi_integer,maxrank,mpi_comm_world,error);</div><div style="">&nbsp; &nbsp; &nbsp; &nbsp;...</div><div style="">&nbsp; &nbsp; &nbsp; &nbsp;let points around maxlocation within distance of 10 equal to -10;</div>
<div style="">&nbsp; &nbsp; &nbsp; &nbsp;....</div><div style="">&nbsp; enddo</div><div style=""><br></div><div style="">&nbsp;&nbsp;</div><div style=""><b>The problem is there is runtime error like " segmentation fault".</b></div><div style=""><b>But If I put the codes within the loop into a subroutine, then write the code as</b></div>
<div style="">&nbsp;do i=1,10</div><div style="">&nbsp; &nbsp; &nbsp;call subroutine</div><div style=""><br></div><div style="">&nbsp;enddo</div><div style=""><br></div><div style=""><b>&nbsp;there will be no error.</b></div><div style=""><br></div><div style="">&nbsp; <b>Another problem is MPI_allreduce seems not as efficient as the combined use of " MPI_reduce &amp; MPI_Bcast" to realize the same purpose.</b></div>
<div style=""><br></div><div style=""><br></div><div style="">Ben &nbsp;</div></div>
</div></blockquote></body></html>
