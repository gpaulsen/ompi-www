<HTML dir=ltr><HEAD><TITLE>Re: [OMPI users] mpirun hanging when processes started on head node</TITLE>
<META http-equiv=Content-Type content="text/html; charset=unicode">
<META content="MSHTML 6.00.6000.16441" name=GENERATOR></HEAD>
<BODY>
<DIV id=idOWAReplyText44020 dir=ltr>
<DIV dir=ltr><FONT face=Arial color=#000000 size=2>Ralph,</FONT></DIV>
<DIV dir=ltr><FONT face=Arial size=2>&nbsp;&nbsp;&nbsp;&nbsp; Thanks for the quick response, clarifications below.</FONT></DIV>
<DIV dir=ltr><FONT face=Arial size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sean</FONT></DIV></DIV>
<DIV dir=ltr><BR>
<HR tabIndex=-1>
<FONT face=Tahoma size=2><B>From:</B> users-bounces@open-mpi.org on behalf of Ralph H Castain<BR><B>Sent:</B> Mon 6/11/2007 3:49 PM<BR><B>To:</B> Open MPI Users &lt;users@open-mpi.org&gt;<BR><B>Subject:</B> Re: [OMPI users] mpirun hanging when processes started on head node<BR></FONT><BR></DIV>
<DIV><FONT face="Verdana, Helvetica, Arial"><SPAN style="FONT-SIZE: 12px">Hi Sean<BR><BR>Could you please clarify something? I&#8217;m a little confused by your comments about where things are running. I&#8217;m assuming that you mean everything works fine if you type the mpirun command on the head node and just let it launch on your compute nodes &#8211; that the problems only occur when you specifically tell mpirun you want processes on the head node as well (or exclusively). Is that correct?</SPAN></FONT></DIV>
<P><FONT face="Verdana, Helvetica, Arial"><SPAN style="FONT-SIZE: 12px">[Sean] This is correct.</SPAN></FONT></P>
<P><FONT face="Verdana, Helvetica, Arial"><SPAN style="FONT-SIZE: 12px"></SPAN></FONT><FONT face="Verdana, Helvetica, Arial"><SPAN style="FONT-SIZE: 12px"><BR>There are several possible sources of trouble, if I have understood your situation correctly. Our bproc support is somewhat limited at the moment &#8211; you may be encountering one of those limits. We currently have bproc support focused on the configuration here at Los Alamos National Lab as (a) that is where the bproc-related developers are working, and (b) it is the only regular test environment we have to work with for bproc. We don&#8217;t normally use bproc in combination with hostfiles, so I&#8217;m not sure if there is a problem in that combination. I can investigate that a little later this week.</P>
<P>[Sean] If it is helpful,&nbsp;running 'export NODES=-1; mpirun -np 1 hostname' exibits identical behaviour.<BR><BR>Similarly, we require that all the nodes being used must be accessible via the same launch environment. It sounds like we may be able to launch processes on your head node via rsh, but not necessarily bproc. You might check to ensure that the head node will allow bproc-based process launch (I know ours don&#8217;t &#8211; all jobs are run solely on the compute nodes. I believe that is generally the case). We don&#8217;t currently support mixed environments, and I honestly don&#8217;t expect that to change anytime soon.<BR></P>
<P>[Sean] I'm working through the strace output to follow the progression on the head node. It looks like mpirun consults '/bpfs/self' and determines that the request is to be run on the local machine so it fork/execs 'orted' which then runs 'hostname'. 'mpirun' didn't consult '/bpfs' or utilize&nbsp;'rsh' after the determination to run on the local machine&nbsp;was made. When the 'hostname' command&nbsp;completes, 'orted' receives the SIGCHLD signal, performs some work and then both 'mpirun' and 'orted' go into what appears to be a poll() waiting for events.</P>
<P><BR>Hope that helps at least a little.</P>
<P>[Sean] I appreciate the help. We are running processes on the head node because&nbsp;the head node&nbsp;is the only node which can access external resources (storage devices). </P>
<P><BR>Ralph<BR><BR><BR><BR><BR><BR>On 6/11/07 1:04 PM, "Kelley, Sean" &lt;Sean.Kelley@solers.com&gt; wrote:<BR><BR></P></SPAN></FONT>
<BLOCKQUOTE><SPAN style="FONT-SIZE: 12px"><FONT face=Arial>I forgot to add that we are using 'bproc'. Launching processes on the compute nodes using bproc works well, I'm not sure if bproc is involved when processes are launched on the local node.<BR></FONT><FONT face="Verdana, Helvetica, Arial"><BR></FONT><FONT face=Arial>Sean<BR></FONT><FONT face="Verdana, Helvetica, Arial"><BR>
<HR align=center width="100%" SIZE=3>
</FONT><FONT face=Tahoma><B>From:</B> users-bounces@open-mpi.org on behalf of Kelley, Sean<BR><B>Sent:</B> Mon 6/11/2007 2:07 PM<BR><B>To:</B> users@open-mpi.org<BR><B>Subject:</B> [OMPI users] mpirun hanging when processes started on head node<BR></FONT><FONT face="Verdana, Helvetica, Arial"><BR></FONT><FONT face=Arial>Hi,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We are running the OFED 1.2rc4 distribution containing openmpi-1.2.2 on a RedhatEL4U4 system with Scyld Clusterware 4.1. The hardware configuration consists of a DELL 2950 as the headnode and 3 DELL 1950 blades as compute nodes using Cisco TopSpin Infiband HCAs and switches for the interconnect.<BR></FONT><FONT face="Verdana, Helvetica, Arial"><BR></FONT><FONT face=Arial>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;When we use 'mpirun' from the OFED/Open MPI distribution to start processes on the compute nodes, everything works correctly. However, when we try to start processes on the head node, the processes appear to run correctly but 'mpirun' hangs and does not terminate until killed. The attached 'run1.tgz' file contains detailed information from running the following command:<BR></FONT><FONT face="Verdana, Helvetica, Arial"><BR></FONT><FONT face=Arial>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mpirun --hostfile hostfile1 --np 1 --byslot --debug-daemons -d hostname<BR></FONT><FONT face="Verdana, Helvetica, Arial"><BR></FONT><FONT face=Arial>where 'hostfile1' contains the following:<BR></FONT><FONT face="Verdana, Helvetica, Arial"><BR></FONT><FONT face=Arial>-1 slots=2 max_slots=2<BR></FONT><FONT face="Verdana, Helvetica, Arial"><BR></FONT><FONT face=Arial>The 'run.log' is the output of the above line. The 'strace.out.0' is the result of 'strace -f' on the mpirun process (and the 'hostname' child process since mpirun simply forks the local processes). The child process (pid 23415 in this case) runs to completion and exits successfully. The parent process (mpirun) doesn't appear to recognize that the child has completed and hangs until killed (with a ^c). <BR></FONT><FONT face="Verdana, Helvetica, Arial"><BR></FONT><FONT face=Arial>Additionally, when we run a set of processes which span the headnode and the compute nodes, the processes on the head node complete successfully, but the processes on the compute nodes do not appear to start. mpirun again appears to hang.<BR></FONT><FONT face="Verdana, Helvetica, Arial"><BR></FONT><FONT face=Arial>Do I have a configuration error or is there a problem that I have encountered? Thank you in advance for your assistance or suggestions<BR></FONT><FONT face="Verdana, Helvetica, Arial"><BR></FONT><FONT face=Arial>Sean<BR></FONT><FONT face="Verdana, Helvetica, Arial"><BR></FONT><FONT face=Arial>------<BR>Sean M. Kelley<BR>sean.kelley@solers.com<BR></FONT><FONT face="Verdana, Helvetica, Arial"><BR>&nbsp;<BR><BR>
<HR align=center width="95%" SIZE=3>
</FONT><FONT face="Monaco, Courier New">_______________________________________________<BR>users mailing list<BR>users@open-mpi.org<BR><A href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</A><BR></FONT></SPAN></BLOCKQUOTE><SPAN style="FONT-SIZE: 12px"><FONT face="Monaco, Courier New">
<DIV><BR></DIV></FONT></SPAN></BODY></HTML>
