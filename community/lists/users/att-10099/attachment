<html><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div>Hi guys&nbsp;</div><div><br></div><div>I'm having a little trouble using MPI_IN_PLACE with&nbsp;&nbsp;MPI_REDUCE / MPI_ALLREDUCE in Fortran. If I try to MPI_IN_PLACE with C bindings it works fine running on 2 nodes:</div><div><br></div><div><div>Result:</div><div>3.000000 3.000000 3.000000 3.000000&nbsp;</div><div><br></div><div>Regardless of using MPI_Reduce or MPI_Allreduce. However, this fails for the fortran version:</div><div><br></div><div><div>&nbsp;Result:</div><div>&nbsp;&nbsp; 2.000000 &nbsp; &nbsp; &nbsp; 2.000000 &nbsp; &nbsp; &nbsp; 2.000000 &nbsp; &nbsp; &nbsp; 2.000000 &nbsp; &nbsp;</div></div></div><div><br></div><div>Apparently, MPI is ignoring values from the root node. Here's the source for the Fortran code:</div><div><br></div><div>---</div><div><br></div><div><div>program inplace</div><div><br></div><div>&nbsp;&nbsp;use mpi</div><div><br></div><div>&nbsp;&nbsp;implicit none</div><div>&nbsp;&nbsp;</div><div>&nbsp;&nbsp;integer :: ierr, rank, rsize, bsize</div><div>&nbsp;&nbsp;real, dimension( 2, 2 ) :: buffer, out</div><div>&nbsp;&nbsp;integer :: rc</div><div>&nbsp;&nbsp;</div><div>&nbsp;&nbsp;call MPI_INIT(ierr)</div><div>&nbsp;&nbsp;call MPI_COMM_RANK(MPI_COMM_WORLD, rank, ierr)</div><div>&nbsp;&nbsp;call MPI_COMM_SIZE(MPI_COMM_WORLD, rsize, ierr)</div><div><br></div><div>&nbsp;&nbsp;buffer = rank + 1</div><div>&nbsp;&nbsp;bsize = size(buffer,1) * size(buffer,2)</div><div><br></div><div>&nbsp;&nbsp;if ( rank == 0 ) then</div><div>&nbsp;&nbsp; &nbsp;call mpi_reduce( MPI_IN_PLACE, buffer, bsize, MPI_REAL, MPI_SUM, 0, MPI_COMM_WORLD, ierr )</div><div>&nbsp;&nbsp;else</div><div>&nbsp;&nbsp; &nbsp;call mpi_reduce( buffer, &nbsp; &nbsp; &nbsp; 0, &nbsp; &nbsp; &nbsp;bsize, MPI_REAL, MPI_SUM, 0, MPI_COMM_WORLD, ierr )</div><div>&nbsp;&nbsp;endif</div><div>&nbsp;</div><div>&nbsp;&nbsp;! use allreduce instead</div><div>&nbsp;&nbsp;! call mpi_allreduce( MPI_IN_PLACE, buffer, bsize, MPI_REAL, MPI_SUM, MPI_COMM_WORLD, ierr )</div><div><br></div><div>&nbsp;&nbsp;if ( rank == 0 ) then&nbsp;</div><div>&nbsp;&nbsp; &nbsp;print *, 'Result:'</div><div>&nbsp;&nbsp; &nbsp;print *, buffer</div><div>&nbsp;&nbsp;endif</div><div>&nbsp;&nbsp;</div><div>&nbsp;&nbsp;rc = 0</div><div>&nbsp;&nbsp;call mpi_finalize( rc )</div><div><br></div><div>end program</div></div><div><br></div><div>---</div><div><br></div><div>Any ideas?</div><div><br></div><div>Cheers,</div><div>Ricardo</div><div><br></div><div><br></div><div><br></div><br><div apple-content-edited="true"> <span class="Apple-style-span" style="font-size: 12px; "><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">---<span class="Apple-converted-space">&nbsp;</span></font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">Prof. Ricardo Fonseca</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; min-height: 14px; "><br></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">GoLP - Grupo de Lasers e Plasmas</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Instituto de Plasmas e Fusão Nuclear</p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">Instituto Superior Técnico</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">Av. Rovisco Pais</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">1049-001 Lisboa</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">Portugal</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; min-height: 14px; "><br></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">tel: +351 21 8419202</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">fax: +351 21 8464455</font></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: normal normal normal 12px/normal Helvetica; ">web: <a href="http://cfp.ist.utl.pt/golp/">http://cfp.ist.utl.pt/golp/</a><span class="Apple-converted-space">&nbsp;</span></font></p></div></div></span> </div><br></body></html>
