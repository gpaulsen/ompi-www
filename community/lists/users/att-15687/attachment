Resource managers generally frown on the idea of any program passing RM-managed envars from one node to another, and this is certainly true of slurm. The reason is that the RM reserves those values for its own use when managing remote nodes. For example, if you got an allocation and then used mpirun to launch a job across only a portion of that allocation, and then ran another mpirun instance in parallel on the remainder of the nodes, the slurm envars for those two mpirun instances -need- to be quite different. Having mpirun forward the values it sees would cause the system to become very confused.<div>
<br></div><div>We learned the hard way never to cross that line :-(</div><div><br></div><div>You have two options:</div><div><br></div><div>(a) you could get your sys admin to configure slurm correctly to provide your desired envars on the remote nodes. This is the recommended (by slurm and other RMs) way of getting what you requested. It is a simple configuration option - if he needs help, he should contact the slurm mailing list</div>
<div><br></div><div>(b) you can ask mpirun to do so, at your own risk. Specify each parameter with a &quot;-x FOO&quot; argument. See &quot;man mpirun&quot; for details. Keep an eye out for aberrant behavior.</div><div><br>
</div><div>Ralph</div><div><br><br><div class="gmail_quote">On Wed, Feb 23, 2011 at 8:38 AM, Henderson, Brent <span dir="ltr">&lt;<a href="mailto:brent.henderson@hp.com">brent.henderson@hp.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex;">
<div lang="EN-US" link="blue" vlink="purple"><div><p class="MsoNormal">Hi Everyone, I have an OpenMPI/SLURM specific question,</p><p class="MsoNormal"> </p><p class="MsoNormal">I’m using MPI as a launcher for another application I’m working on and it is dependent on the SLURM environment variables making their way into the a.out’s environment.  This works as I need if I use HP-MPI/PMPI, but when I use OpenMPI, it appears that not all are set as I would like across all of the ranks.</p>
<p class="MsoNormal"> </p><p class="MsoNormal">I have example output below from a simple a.out that just writes out the environment that it sees to a file whose name is based on the node name and rank number.  Note that with OpenMPI, that things like SLURM_NNODES and SLURM_TASKS_PER_NODE are not set the same for ranks on the different nodes and things like SLURM_LOCALID are just missing entirely.</p>
<p class="MsoNormal"> </p><p class="MsoNormal">So the question is, should the environment variables on the remote nodes (from the perspective of where the job is launched) have the full set of SLURM environment variables as seen on the launching node?</p>
<p class="MsoNormal"> </p><p class="MsoNormal">Thanks,</p><p class="MsoNormal"> </p><p class="MsoNormal">Brent Henderson</p><p class="MsoNormal"> </p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">[brent@node2 mpi]$ rm node*</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">[brent@node2 mpi]$ mkdir openmpi hpmpi</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">[brent@node2 mpi]$ salloc -N 2 -n 4 mpirun ./printenv.openmpi </span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">salloc: Granted job allocation 23</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">Hello world! I&#39;m 3 of 4 on node1</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">Hello world! I&#39;m 2 of 4 on node1</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">Hello world! I&#39;m 1 of 4 on node2</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">Hello world! I&#39;m 0 of 4 on node2</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">salloc: Relinquishing job allocation 23</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">[brent@node2 mpi]$ mv node* openmpi/</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">[brent@node2 mpi]$ egrep &#39;NODEID|NNODES|LOCALID|NODELIST|NPROCS|PROCID|TASKS_PER&#39; openmpi/node1.3.of.4 </span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_JOB_NODELIST=node[1-2]</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_NNODES=1</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_NODELIST=node[1-2]</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_TASKS_PER_NODE=1</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_NPROCS=1</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_STEP_NODELIST=node1</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_STEP_TASKS_PER_NODE=1</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_NODEID=0</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_PROCID=0</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_LOCALID=0</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">[brent@node2 mpi]$ egrep &#39;NODEID|NNODES|LOCALID|NODELIST|NPROCS|PROCID|TASKS_PER&#39; openmpi/node2.1.of.4</span></p><p class="MsoNormal">
<span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_JOB_NODELIST=node[1-2]</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_NNODES=2</span></p><p class="MsoNormal">
<span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_NODELIST=node[1-2]</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_TASKS_PER_NODE=2(x2)</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_NPROCS=4</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">[brent@node2 mpi]$</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;"> </span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;"> </span></p><p class="MsoNormal">
<span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">[brent@node2 mpi]$ /opt/hpmpi/bin/mpirun -srun -N 2 -n 4 ./printenv.hpmpi </span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">Hello world! I&#39;m 2 of 4 on node2</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">Hello world! I&#39;m 3 of 4 on node2</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">Hello world! I&#39;m 0 of 4 on node1</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">Hello world! I&#39;m 1 of 4 on node1</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">[brent@node2 mpi]$ mv node* hpmpi/</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">[brent@node2 mpi]$ egrep &#39;NODEID|NNODES|LOCALID|NODELIST|NPROCS|PROCID|TASKS_PER&#39; hpmpi/node1.1.of.4 </span></p><p class="MsoNormal">
<span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_NODELIST=node[1-2]</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_TASKS_PER_NODE=2(x2)</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_STEP_NODELIST=node[1-2]</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_STEP_TASKS_PER_NODE=2(x2)</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_NNODES=2</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_NPROCS=4</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_NODEID=0</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_PROCID=1</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_LOCALID=1</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">[brent@node2 mpi]$ egrep &#39;NODEID|NNODES|LOCALID|NODELIST|NPROCS|PROCID|TASKS_PER&#39; hpmpi/node2.3.of.4 </span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_NODELIST=node[1-2]</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_TASKS_PER_NODE=2(x2)</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_STEP_NODELIST=node[1-2]</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_STEP_TASKS_PER_NODE=2(x2)</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_NNODES=2</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_NPROCS=4</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_NODEID=1</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_PROCID=3</span></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">SLURM_LOCALID=1</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">[brent@node2 mpi]$ </span></p>
</div></div><br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>
<a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></blockquote></div><br></div>

