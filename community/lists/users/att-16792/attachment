Hello,<br><br>i need help regarding a mpi program which solves the 2d heat equation. <span id="result_box" class="short_text" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">I have rewritten </span><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">the original code</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">in my own way,<br>
</span></span><span id="result_box" class="" lang="en"><span class="" title="Cliquer ici pour voir d&#39;autres traductions"></span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">in oder to understand</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">well the parallelization</span></span>.<br>
<br><span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">I will</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">initially</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">make it work</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">with 4</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">processors (nproc=4)  with</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">a</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">2D domain</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">of 100 points,</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">that is to</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">say</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">10</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">on the x axis</span> </span><span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">(size_x=10) <br>
</span></span><span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">and 10</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">on the y axis (size_y=10). </span></span><span id="result_box" class="" lang="en"><span class="" title="Cliquer ici pour voir d&#39;autres traductions"></span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">The 2D</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">is divided into</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">four</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">(x_domains=2 and y_domains=</span><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">2).<br>
<br>T</span></span><span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">he</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">array of values</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">​​( &quot;x0 in the code ) has</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">a dimension of</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">8 * 8</span><span class="" title="Cliquer ici pour voir d&#39;autres traductions">, </span></span><span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">so</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">each</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">processor</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">works on</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps"></span><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">4 * 4</span></span> arrays.<br>
<br>The current process rank is stored in &quot;me&quot;.  <span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">I calculate</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">the</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">coordinates of the</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">domain</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">interval</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">for each worker</span></span> :<br>
<br>xdeb(me)&lt;x&lt;xfin(me) and ydeb(me)&lt;y&lt;yfin(me) for &quot;me&quot; process. I check it and it&#39;s correct.<br><br>The initial conditions like x_domains,y_domains,size_x, size_y, the max step, the tolerance, are stored in <a href="ftp://toulouse-immobilier.bz/pub/param">param</a> file.<br>
<br><span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">There are</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">a total of</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">three</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">main files : the main program <a href="ftp://toulouse-immobilier.bz/pub/explicitPar.f90">explicitPar.f90</a></span></span> which does <span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">initialization, calls in the main loop : the explitUtil solving routine </span></span>in <a href="ftp://toulouse-immobilier.bz/pub/explUtil.f90">explUtil.f90</a> and updates<span id="result_box" class="" lang="en"> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">the neighbors</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">of the current process with updateBound routine in <a href="ftp://toulouse-immobilier.bz/pub/updateBound.f90">updateBound.f90</a></span></span> .<br>
<span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps"><br>Everything seems ok except the &quot;updateBound&quot; routine :  I have a problem with the indexes of row and columns in the communication between<br>
North Neighbors, South Neighbors, West and East Neighbors.<br><br>For example, I have :<br><br></span></span><span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">------------------------------------------------------------------------------------------------------------</span></span><br>
<span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">! Send my boundary to North and receive from South<br><br>CALL MPI_SENDRECV(x(ydeb(me),xdeb(me)), 1, row_type ,neighBor(N),flag, &amp;<br>
                     x(yfin(me),xdeb(me)), 1, row_type,neighbor(S),flag, &amp;<br>                     comm2d, status, infompi)<br></span></span><span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">------------------------------------------------------------------------------------------------------------</span></span><span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps"> <br>
<br>For 4 processors and me=0, i have : <br></span></span><span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps"></span></span><span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps"><br>
 xdeb(0)=1<br></span></span><span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">xfin(0)=4</span></span><br><span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">ydeb(0)=5<br>
yfin(0 )=8<br> <br>So I send to the North neighbor the upper row indexed by x(ydeb(me),xdeb(me)). But I should have ghost cells for<br>the communication in this case for calculting the next values of &quot;x0&quot; array for each worker. Actually I need the <br>
boundaries values for each worker ( with 4*4 size) but I think I have to work on a 5*5 size for this calculation in order to<br>have ghost cells on the edges of 4*4 worker cells.<br><br></span></span><span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">You can</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">compile this code</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">by adapting the</span> <a href="ftp://toulouse-immobilier.bz/pub/makefile">makefile</a></span> with :&quot; $ make explicitPar &quot; <br>
and execute it in my case with : &quot;$ mpirun -n 4 explicitPar &quot;<br><br><br>Anyone could see what&#39;s wrong with my code ? Have I got to put a 12*12 size for the global domain ? it would allow to have 5*5 worker cells <span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">with</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">2</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">more for the</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">boundary condition (constant)</span><span class="" title="Cliquer ici pour voir d&#39;autres traductions">, so a total equal to 12 for size_x and size_y ( 8+2+2).<br>
<br></span></span><span id="result_box" class="" lang="en"> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">Note that</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">the edges of the</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">domain remain</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">equal</span> <span title="Cliquer ici pour voir d&#39;autres traductions" class="hps">to 10 as it&#39;s expected.<br>
<br>Any help would be really appreciated.<br><br>Thanks in advance.<br></span></span><span id="result_box" class="" lang="en"><span title="Cliquer ici pour voir d&#39;autres traductions" class="hps"><br></span></span>

