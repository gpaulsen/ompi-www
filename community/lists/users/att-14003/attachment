<table cellspacing="0" cellpadding="0" border="0" ><tr><td valign="top" style="font: inherit;">Sorry for the late replies but with work, time zones etc…<br><br>This post has been going on for a while and in an attempt bring it to a close I’m going to try to collapse this down to some core issues and answer all the questions in 1 place.<br><br>Richard: yes your last statement is correct, I am just using PVm solely as a launcher, the MPI worlds are semantically independent. <br><br>Jeffs suggestion that it may be a network congestion issue rings a bell somewhere.<br>Jeff, although it is possible to make a small example program, this would require PVM or some other method of launching MPI simultaneously on each node. I would agree that this is a bit off topic for this forum and so I won’t mention it further.&nbsp; <br><br>In finalizing this issue, I would like to discuss the characteristics of the other options available.&nbsp; If I understood what to
 expect from the alltoall on a large cluster and given the scenario outlined below it may help me greatly in deciding how (or if) to re-write this.<br><br>BTW:&nbsp; Jeff,&nbsp; sorry if I miss quoted you, I must have miss-understood.<br>From your post reproduced in part here:<br>==============================================================<br>&gt;- All of Open MPI's network-based collectives use point-to-point <br>&gt;communications underneath (shared memory may not, but that's not the issue <br>&gt;here).&nbsp; One of the implementations is linear, meaning that the root sends the <br>&gt;message to comm rank 1, then comm rank 2, ..etc.&nbsp; But this algorithm is only <br>&gt;used when the message is small, the number of peers is small, etc.&nbsp; All the other <br>&gt;algorithms are parallel in nature, meaning that after an iteration or two, &gt;multiple processes have the data and can start pipelining sends to other <br>&gt;processes,
 etc.<br>==============================================================<br><br>What I meant when I said b-tree is nearly right I think – I should have said ‘in an N-Tree manner’ but both would produce O(log N) solutions and I agree that these are all perfectly fine for almost everything.<br><br>This assumes that you have ‘adequate’ network bandwidth as you correctly pointed out in your recent post.&nbsp; This may not be the case for my problem (see below)<br><br>The Problem:<br>-&nbsp;&nbsp;&nbsp; A large all to all (N to N transmission or N broadcasts) of possibly hundreds of GB in total.<br>-&nbsp;&nbsp;&nbsp; The cluster size my clients will use is unknown at this time but probably in the order of between 10 to a few hundred nodes.<br>-&nbsp;&nbsp;&nbsp; The number of nodes is likely to increase with the data size but the ratio of data/node is unknown and variable.<br><br>My design Goals:<br>1.&nbsp;&nbsp;&nbsp; Speed and accuracy are
 everything.&nbsp; Accuracy is paramount but the system would become unusable if this algorithm became exponential.<br>2.&nbsp;&nbsp;&nbsp; I love the flexibility OMPI brings to fabric deployment.&nbsp; I want to pass on the richness of these choices to my clients/customers – however if IB (or some other) plugin solution moved the alltoall algorithm from say&nbsp; O(N log N) to&nbsp; just O(Log N) transmission, its mandatory use may be an acceptable solution on larger clusters<br><br>My Assumptions<br>1.&nbsp;&nbsp;&nbsp; I can concentrate on providing the best near linear solutions and ignore site implementation peculiarities<br>2.&nbsp;&nbsp;&nbsp; Tuning each installation can accommodate all site specific idiosyncrasies<br>3.&nbsp;&nbsp;&nbsp; The solution will probably be network bound.&nbsp; No mater how fast the network is, 100GB may well be too much for concurrent p2p transmissions to run in O(log N) time<br>[please feel free to trash my
 assumptions]<br><br>This is a difficult problem, I have written 3 solutions for this using different technologies and I have been unsatisfied with each so far.<br><br>Theoretically the problem can be solved in N broadcasts but [Jeff] as you point out, in practice, data loss is likely on the nodes who are not ready etc..&nbsp; However a near O(N) solution&nbsp; should be possible.<br><br>It appears that OMPI’s Bcast is O(log N) for N &gt; a trivial number of nodes<br>So AlltoAll is probably at least O(N log N) – unless it utilises something other than p2p transmissions and its only O(N log N) if there is adequate bandwidth on the network fabric.<br><br>Do I have it correct?<br>Is alltoall going to work for me ?<br><br>Randolph<br><br><br><br><br>--- On <b>Fri, 13/8/10, Jeff Squyres <i>&lt;jsquyres@cisco.com&gt;</i></b> wrote:<br><blockquote style="border-left: 2px solid rgb(16, 16, 255); margin-left: 5px; padding-left: 5px;"><br>From: Jeff Squyres
 &lt;jsquyres@cisco.com&gt;<br>Subject: Re: [OMPI users] MPI_Bcast issue<br>To: "Open MPI Users" &lt;users@open-mpi.org&gt;<br>Received: Friday, 13 August, 2010, 3:03 AM<br><br><div class="plainMail">Dick / all --<br><br>I just had a phone call with Ralph Castain who has had some additional off-list mails with Randolph.&nbsp; Apparently, none of us understand the model that is being used here.&nbsp; There are also apparently some confidentiality issues involved such that it might be difficult to publicly state enough information to allow the open community to understand, diagnose, and fix the issue.&nbsp; So I'm not quite sure how to proceed here -- I'm afraid that I don't have the time or resources for private problem resolution in an unorthodox situation like this.<br><br>For example, I was under the impression that PVM was solely being used as a launcher.&nbsp; This is apparently not the case -- the original code is a PVM job that has been modified to
 eventually call MPI_INIT.&nbsp; I don't know how much more I can say on this open list.<br><br>Hence, I'm throughly confused as to the model that is being used at this point.&nbsp; I don't think I can offer any further help unless a small [non-PVM] example is provided to the community that can show the problem.<br><br>I also asked a bunch of questions in a prior post that would be helpful to have answered before going further.<br><br>Sorry!&nbsp; :-(<br><br><br><br>On Aug 12, 2010, at 9:32 AM, Richard Treumann wrote:<br><br>&gt; <br>&gt; You said&nbsp; "separate MPI&nbsp; applications doing 1 to &gt; N broadcasts over PVM".&nbsp; You do not mean you are using pvm_bcast though - right? <br>&gt; <br>&gt; If these N MPI applications are so independent that you could run one at a time or run them on N different clusters and still get the result you want (not the time to solution) then I cannot imagine how there could be cross talk.&nbsp;&nbsp;&nbsp;<br>&gt;
 <br>&gt; I have been assuming that when you describe this as an NxN problem, you mean there is some desired interaction among the N MPI worlds.&nbsp;&nbsp;&nbsp;<br>&gt; <br>&gt; If I have misunderstood and the N MPI worlds stared with N mpirun operations under PVM are each semantically independent of the other (N-1) then I am totally at a loss for an explanation. <br>&gt; <br>&gt;&nbsp;&nbsp;&nbsp;<br>&gt; Dick Treumann&nbsp; -&nbsp; MPI Team&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;<br>&gt; IBM Systems &amp; Technology Group<br>&gt; Dept X2ZA / MS P963 -- 2455 South Road -- Poughkeepsie, NY 12601<br>&gt; Tele (845) 433-7846&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;Fax (845) 433-8363<br>&gt; <br>&gt; <br>&gt; <a ymailto="mailto:users-bounces@open-mpi.org" href="/mc/compose?to=users-bounces@open-mpi.org">users-bounces@open-mpi.org</a> wrote on 08/11/2010 08:59:16 PM:<br>&gt; <br>&gt; &gt; [image removed] <br>&gt; &gt; <br>&gt; &gt; Re: [OMPI users]
 MPI_Bcast issue <br>&gt; &gt; <br>&gt; &gt; Randolph Pullen <br>&gt; &gt; <br>&gt; &gt; to: <br>&gt; &gt; <br>&gt; &gt; Open MPI Users <br>&gt; &gt; <br>&gt; &gt; 08/11/2010 09:01 PM <br>&gt; &gt; <br>&gt; &gt; Sent by: <br>&gt; &gt; <br>&gt; &gt; <a ymailto="mailto:users-bounces@open-mpi.org" href="/mc/compose?to=users-bounces@open-mpi.org">users-bounces@open-mpi.org</a> <br>&gt; &gt; <br>&gt; &gt; Please respond to Open MPI Users <br>&gt; &gt; <br>&gt; &gt; I (a single user) am running N separate MPI&nbsp; applications doing 1 to<br>&gt; &gt; N broadcasts over PVM, each MPI application is started on each <br>&gt; &gt; machine simultaneously by PVM - the reasons are back in the post history.<br>&gt; &gt; <br>&gt; &gt; The problem is that they somehow collide - yes I know this should <br>&gt; &gt; not happen, the question is why.<br>&gt; &gt; <br>&gt; &gt; --- On Wed, 11/8/10, Richard Treumann &lt;<a ymailto="mailto:treumann@us.ibm.com"
 href="/mc/compose?to=treumann@us.ibm.com">treumann@us.ibm.com</a>&gt; wrote: <br>&gt; &gt; <br>&gt; &gt; From: Richard Treumann &lt;<a ymailto="mailto:treumann@us.ibm.com" href="/mc/compose?to=treumann@us.ibm.com">treumann@us.ibm.com</a>&gt;<br>&gt; &gt; Subject: Re: [OMPI users] MPI_Bcast issue<br>&gt; &gt; To: "Open MPI Users" &lt;<a ymailto="mailto:users@open-mpi.org" href="/mc/compose?to=users@open-mpi.org">users@open-mpi.org</a>&gt;<br>&gt; &gt; Received: Wednesday, 11 August, 2010, 11:34 PM<br>&gt; <br>&gt; &gt; <br>&gt; &gt; Randolf <br>&gt; &gt; <br>&gt; &gt; I am confused about using multiple, concurrent mpirun operations.&nbsp; <br>&gt; &gt; If there are M uses of mpirun and each starts N tasks (carried out <br>&gt; &gt; under pvm or any other way) I would expect you to have M completely <br>&gt; &gt; independent MPI jobs with N tasks (processes) each.&nbsp; You could have <br>&gt; &gt; some root in each of the M MPI jobs do an MPI_Bcast to
 the other <br>&gt; &gt; N-1) in that job but there is no way in MPI (without using <br>&gt; &gt; accept.connect) to get tasks of job 0 to give data to tasks of jobs 1-(m-1). <br>&gt; &gt; <br>&gt; &gt; With M uses of mpirun, you have M worlds that are forever isolated <br>&gt; &gt; from the other M-1 worlds (again, unless you do accept/connect) <br>&gt; &gt; <br>&gt; &gt; In what sense are you treating this as an single MxN application?&nbsp;&nbsp;&nbsp;<br>&gt; &gt; ( I use M &amp; N to keep them distinct. I assume if M == N, we have your case) <br>&gt; &gt; <br>&gt; &gt; <br>&gt; &gt; Dick Treumann&nbsp; -&nbsp; MPI Team&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;<br>&gt; &gt; IBM Systems &amp; Technology Group<br>&gt; &gt; Dept X2ZA / MS P963 -- 2455 South Road -- Poughkeepsie, NY 12601<br>&gt; &gt; Tele (845) 433-7846&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;Fax (845) 433-8363 <br>&gt; &gt; <br>&gt; &gt; -----Inline Attachment Follows-----<br>&gt;
 <br>&gt; &gt; _______________________________________________<br>&gt; &gt; users mailing list<br>&gt; &gt; <a ymailto="mailto:users@open-mpi.org" href="/mc/compose?to=users@open-mpi.org">users@open-mpi.org</a><br>&gt; &gt; <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a> <br>&gt; &gt; <br>&gt; &gt; <br>&gt; &gt;&nbsp; _______________________________________________<br>&gt; &gt; users mailing list<br>&gt; &gt; <a ymailto="mailto:users@open-mpi.org" href="/mc/compose?to=users@open-mpi.org">users@open-mpi.org</a><br>&gt; &gt; <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users_______________________________________________" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users_______________________________________________</a><br>&gt; users mailing list<br>&gt; <a ymailto="mailto:users@open-mpi.org"
 href="/mc/compose?to=users@open-mpi.org">users@open-mpi.org</a><br>&gt; <a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br><br><br>-- <br>Jeff Squyres<br><a ymailto="mailto:jsquyres@cisco.com" href="/mc/compose?to=jsquyres@cisco.com">jsquyres@cisco.com</a><br>For corporate legal information go to:<br><a href="http://www.cisco.com/web/about/doing_business/legal/cri/" target="_blank">http://www.cisco.com/web/about/doing_business/legal/cri/</a><br><br><br>_______________________________________________<br>users mailing list<br><a ymailto="mailto:users@open-mpi.org" href="/mc/compose?to=users@open-mpi.org">users@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div></blockquote></td></tr></table><br>



      &nbsp;
