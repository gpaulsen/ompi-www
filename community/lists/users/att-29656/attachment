<div dir="ltr">All,<div><br></div><div>I&#39;ve been struggling here at NASA Goddard trying to get PGI 16.5 + Open MPI 1.10.3 working on the Discover cluster. What was happening was I&#39;d run our climate model at, say, 4x24 and it would work sometimes. Most of the time. Every once in a while, it&#39;d throw a segfault. If we changed the layout or number of processors, more (and sometimes different) segfaults are trigger.</div><div><br></div><div>As we could build with PGI 15.7 + Open MPI 1.10.3 (where Open MPI is built exactly the same) and run perfectly, I was focusing on the Open MPI build. I tried compiling it at -O3, -O, -O0, all sorts of things and was about to throw in the towel as all failed.</div><div><br></div><div>But, I saw Open MPI 2.0.0 was out and figured, may as well try the latest before reporting to the mailing list. I built it and, huzzah!, it works! I&#39;m happy! Except that every time I execute &#39;mpirun&#39; I get odd errors:</div><div><br></div><div><div><font face="monospace, monospace">(1034) $ mpirun -np 4 ./helloWorld.mpi2.exe </font></div><div><font face="monospace, monospace">--------------------------------------------------------------------------</font></div><div><font face="monospace, monospace">WARNING: There was an error initializing an OpenFabrics device.</font></div><div><font face="monospace, monospace"><br></font></div><div><font face="monospace, monospace">  Local host:   borgr074</font></div><div><font face="monospace, monospace">  Local device: mlx5_0</font></div><div><font face="monospace, monospace">--------------------------------------------------------------------------</font></div><div><font face="monospace, monospace">[borgr074][[35244,1],1][btl_openib_component.c:1618:init_one_device] error obtaining device attributes for mlx5_0 errno says Cannot allocate memory</font></div><div><font face="monospace, monospace">[borgr074][[35244,1],3][btl_openib_component.c:1618:init_one_device] error obtaining device attributes for mlx5_0 errno says Cannot allocate memory</font></div><div><font face="monospace, monospace">[borgr074][[35244,1],0][btl_openib_component.c:1618:init_one_device] error obtaining device attributes for mlx5_0 errno says Cannot allocate memory</font></div><div><font face="monospace, monospace">[borgr074][[35244,1],2][btl_openib_component.c:1618:init_one_device] error obtaining device attributes for mlx5_0 errno says Cannot allocate memory</font></div><div><font face="monospace, monospace">MPI Version: 3.1</font></div><div><font face="monospace, monospace">MPI Library Version: Open MPI v2.0.0, package: Open MPI mathomp4@borg01z239 Distribution, ident: 2.0.0, repo rev: v2.x-dev-1570-g0a4a5d7, Jul 12, 2016</font></div><div><font face="monospace, monospace">Process    0 of    4 is on borgr074</font></div><div><font face="monospace, monospace">Process    3 of    4 is on borgr074</font></div><div><font face="monospace, monospace">Process    1 of    4 is on borgr074</font></div><div><font face="monospace, monospace">Process    2 of    4 is on borgr074</font></div><div><font face="monospace, monospace">[borgr074:29032] 3 more processes have sent help message help-mpi-btl-openib.txt / error in device init</font></div><div><font face="monospace, monospace">[borgr074:29032] Set MCA parameter &quot;orte_base_help_aggregate&quot; to 0 to see all help / error messages</font></div></div><div><br></div><div><div>If I run with <font face="monospace, monospace">--mca btl_base_verbose 1</font> and use more than one node, I see that the openib/verbs (still not sure what to call this) btl isn&#39;t being used, but rather tcp:</div><div><br></div><div><div><font face="monospace, monospace">[borgr075:14374] mca: bml: Using tcp btl for send to [[35628,1],15] on node borgr074</font></div><div><font face="monospace, monospace">[borgr075:14374] mca: bml: Using tcp btl for send to [[35628,1],15] on node borgr074</font></div></div><div><br></div><div>which makes sense since it can&#39;t find an Infiniband device.</div><div><br></div><div>My first thought is that the build/configure procedure of the past doesn&#39;t quite jibe with what Open MPI 2.0.0 is expecting? I build Open MPI as:</div><div><br></div><div><div><font face="monospace, monospace">export CC=pgcc</font></div><div><font face="monospace, monospace">export CXX=pgc++</font></div><div><font face="monospace, monospace">export FC=pgfortran</font></div><div><font face="monospace, monospace"><br></font></div><div><span style="font-family:monospace,monospace">export CFLAGS=&quot;-fpic -m64&quot;</span><br></div><div><font face="monospace, monospace">export CXXFLAGS=&quot;-fpic -m64&quot;</font></div><div><font face="monospace, monospace">export FCFLAGS=&quot;-m64 -fpic&quot;</font></div><div><font face="monospace, monospace">export PREFIX=/discover/swdev/mathomp4/MPI/openmpi/2.0.0/pgi-16.5-k40</font></div><div><font face="monospace, monospace"><br></font></div><div><font face="monospace, monospace">export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/usr/slurm/lib64</font></div><div><font face="monospace, monospace">export LDFLAGS=&quot;-L/usr/slurm/lib64&quot;</font></div><div><font face="monospace, monospace">export CPPFLAGS=&quot;-I/usr/slurm/include&quot;</font></div><div><font face="monospace, monospace"><br></font></div><div><font face="monospace, monospace">export LIBS=&quot;-lpciaccess&quot;</font></div><div><font face="monospace, monospace"><br></font></div><div><font face="monospace, monospace">build() {</font></div><div><font face="monospace, monospace">  echo `pwd`</font></div><div><font face="monospace, monospace">  ./configure --with-slurm --disable-wrapper-rpath --enable-shared --prefix=${PREFIX}</font></div><div><font face="monospace, monospace">  make -j8</font></div><div><font face="monospace, monospace">  make install</font></div><div><font face="monospace, monospace">}</font></div><div><font face="monospace, monospace"><br></font></div><div><font face="monospace, monospace">echo &quot;calling build&quot;</font></div><div><font face="monospace, monospace">build</font></div><div><font face="monospace, monospace">echo &quot;exiting&quot;</font></div></div><div><br></div><div>This is a build script built over time; it might have things unnecessary for an Open MPI 2.0 build, but perhaps now it needs more info? I can say that in the past (say with 1.10.3) it definitely found the openib/verbs btl and used it!</div><div><br></div><div>Per the website, I&#39;m attaching links to my config.log and &quot;<font face="monospace, monospace">ompi_info --all</font>&quot; information:</div><div><div><br class=""><a href="https://dl.dropboxusercontent.com/u/61696/Open%20MPI/config.log.gz">https://dl.dropboxusercontent.com/u/61696/Open%20MPI/config.log.gz</a><br></div><div><a href="https://dl.dropboxusercontent.com/u/61696/Open%20MPI/build.pgi16.5.log.gz">https://dl.dropboxusercontent.com/u/61696/Open%20MPI/build.pgi16.5.log.gz</a><br></div><div><a href="https://dl.dropboxusercontent.com/u/61696/Open%20MPI/ompi_info.txt.gz">https://dl.dropboxusercontent.com/u/61696/Open%20MPI/ompi_info.txt.gz</a><br></div></div><div><br></div><div>I tried to run &quot;<font face="monospace, monospace">ompi_info -v ompi full --parsable</font>&quot; as asked but that doesn&#39;t seem possible anymore:<br></div><div><br></div><div><div><font face="monospace, monospace">(1053) $ ompi_info -v ompi full --parsable</font></div><div><font face="monospace, monospace">ompi_info: Error: unknown option &quot;-v&quot;</font></div><div><font face="monospace, monospace">Type &#39;ompi_info --help&#39; for usage.</font></div></div><div><br></div><div>I am asking our machine gurus about the Infiniband network per: <a href="https://www.open-mpi.org/faq/?category=openfabrics#ofa-troubleshoot">https://www.open-mpi.org/faq/?category=openfabrics#ofa-troubleshoot</a></div>-- <br><div class="gmail_signature" data-smartmail="gmail_signature"><div dir="ltr"><div><div dir="ltr"><div>Matt Thompson</div></div></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><div><div>Man Among Men</div></div></div><div><div><div>Fulcrum of History</div></div></div></blockquote></div></div>
</div></div>

