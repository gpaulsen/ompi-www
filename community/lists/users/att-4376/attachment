Thanks for your reply,<br /><br />&nbsp;&nbsp;&nbsp; but the program is running on TCP interconnect with same datasize and also on IB with small datasize say 1MB. So i dont think problem is in OpenMPI, it has to do something with IB logic, which probably doesnt work well with threads.<br /><br />I also tried the program with MPI_THREAD_SERIALIZED, but in vain.<br /><br />&nbsp;When is the version 1.3 scheduled to be released? Would it fix such issues?<br /><br />Correct me, if i am wrong<br /><br />-Neeraj<br /><br />On Wed, 31 Oct 2007 05:31:32 -0700 Open MPI Users  wrote<br /><br />  THREAD_MULTIPLE support does not work in the 1.2 series.  Try turning  <br /><br />  it off.<br /><br />  <br /><br />  <br /><br />  On Oct 30, 2007, at 12:17 AM, Neeraj Chourasia wrote:<br /><br />  <br /><br />  &gt; Hi folks,<br /><br />  &gt;<br /><br />  &gt;         I have been seeing some nasty behaviour in MPI_Send/Recv  <br /><br />  &gt; with large dataset(8 MB), when used with OpenMP and Openmpi  <br /><br />  &gt; together with IB Interconnect. Attached is a program.<br /><br />  &gt;<br /><br />  &gt;        The code first calls MPI_Init_thread() followed by openmp  <br /><br />  &gt; thread creation API. The program works fine, if we do single side<br /><br />  &gt; comm unication [Thread 0 of process 0 sending some data to any  <br /><br />  &gt; thread of process 1], but it hangs if both side tries to send some  <br /><br />  &gt; data (8 MB) using IB Interconnect<br /><br />  &gt;<br /><br />  &gt;         Interesting to note that program works fine, if we send  <br /><br />  &gt; short data(1 MB or below).<br /><br />  &gt;<br /><br />  &gt;         I see this with<br /><br />  &gt;<br /><br />  &gt;         openmpi-1.2 or openmpi-1.2.4 (compiled with --enable-mpi- <br /><br />  &gt; threads)<br /><br />  &gt;         ofed 1.2<br /><br />  &gt;         2.6.9-42.4sp.XCsmp<br /><br />  &gt;         icc (Intel Compiler)<br /><br />  &gt;<br /><br />  &gt;         compiled as<br /><br />  &gt;                 mpicc -O3 -openmp temp.c<br /><br />  &gt;         run as<br /><br />  &gt;                 mpirun -np 2 -hostfile nodelist a.out<br /><br />  &gt;<br /><br />  &gt;         The error i am getting is<br /><br />  &gt;          <br /><br />  &gt; ---------------------------------------------------------------------- <br /><br />  &gt; ---------------------------------------------------------------------- <br /><br />  &gt; ----------------------<br /><br />  &gt;<br /><br />  &gt;         [0,1,1][btl_openib_component.c: <br /><br />  &gt; 1199:btl_openib_component_progress] from n129 to: n115 error  <br /><br />  &gt; polling LP CQ with status LOCAL PROTOCOL ERROR status number 4 for  <br /><br />  &gt; wr_id 6391728 opcode 0<br /><br />  &gt; [0,1,1][btl_openib_component.c:1199:btl_openib_component_progress]  <br /><br />  &gt; from n129 to: n115 error polling LP CQ with status WORK REQUEST  <br /><br />  &gt; FLUSHED ERROR status number 5 for wr_id 7058304 opcode 128<br /><br />  &gt; [0,1,0][btl_openib_component.c:1199:btl_openib_component_progress]  <br /><br />  &gt; from n115 to: n129 [0,1,0][btl_openib_component.c: <br /><br />  &gt; 1199:btl_openib_component_progress] from n115 to: n129 error  <br /><br />  &gt; polling LP CQ with status WORK REQUEST FLUSHED ERROR status number  <br /><br />  &gt; 5 for wr_id 6854256 opcode 128<br /><br />  &gt; error polling LP CQ with status LOCAL LENGTH ERROR status number 1  <br /><br />  &gt; for wr_id 6920112 opcode 0<br /><br />  &gt;<br /><br />  &gt;          <br /><br />  &gt; ---------------------------------------------------------------------- <br /><br />  &gt; ---------------------------------------------------------------------- <br /><br />  &gt; -------------------<br /><br />  &gt;<br /><br />  &gt;<br /><br />  &gt;         Anyone else seeing similar?  Any ideas for workarounds?<br /><br />  &gt;         As a point of reference, program works fine, if we force  <br /><br />  &gt; openmpi to select TCP interconnect using --mca btl tcp,self.<br /><br />  &gt;<br /><br />  &gt; -Neeraj<br /><br />  &gt;<br /><br />  &gt; <br /><br />  &gt; _______________________________________________<br /><br />  &gt; users mailing list<br /><br />  &gt; users@open-mpi.org<br /><br />  &gt; http://www.open-mpi.org/mailman/listinfo.cgi/users<br /><br />  <br /><br />  <br /><br />  -- <br /><br />  Jeff Squyres<br /><br />  Cisco Systems<br /><br />  <br /><br />  _______________________________________________<br /><br />  users mailing list<br /><br />  users@open-mpi.org<br /><br />  http://www.open-mpi.org/mailman/listinfo.cgi/users<br /><br />  
<br><Table border=0 Width=644 Height=57 cellspacing=0 cellpadding=0 style='font-family:Verdana;font-size:11px;line-height:15px;'><TR><td><a href='http://adworks.rediff.com/cgi-bin/AdWorks/click.cgi/www.rediff.com/signature-home.htm/1050715198@Middle5/1503566_1496716/1502984/1?PARTNER=3&OAS_QUERY=null target=new '><img src =http://imadworks.rediff.com/cgi-bin/AdWorks/adimage.cgi/1503566_1496716/creative_1502984.gif  alt='Naukri Resume'  border=0></a></td></TR></Table>
