<div dir="ltr">Hi Gilles,<div><br></div><div>I would like to be able to run on anywhere from 1-16 nodes.</div><div><br></div><div>Let me explain our (mpi/parallelism) situation briefly for more context:</div><div>We have a &quot;master&quot; job that needs MPI functionality.  This master job is written in python (we use mpi4py).  The master job then makes spawn calls out to other MPI programs written in either C or Fortran. The C/Fortran programs do not need to communicate with the master python MPI job (although it would be nice to have the option at some point).  The master job runs the child processes, collects their outputs, then reruns them with new input parameters. This continues for a long time in a big for-loop.</div><div><br></div><div>So that&#39;s our setup, and that is the context in which I found this issue.</div><div><br></div><div>Unfortunately I am not the cluster admin for our university&#39;s cluster (at UW Madison).  There are probably close to 100 people who use the cluster, so I am guessing that the admins might be reluctant to install an mpi library that might not be stable.  If you think I am misunderstanding what you are asking, let me know please.  If the ETA on fixing this bug is going to be closer to 6 months rather than 1 month, it might be useful to do what you suggest if it will provide a noticeable speed up.</div><div><br></div><div>I&#39;ll admit that I have run into quite a few issues already getting the MPI within this code to work, so I am slightly hesitant to add more complexity to it and other potential avenues for hangs/crashes :(  I don&#39;t understand the intricacies of MPI very well though, so if you don&#39;t think this is an issue then that is a big bonus!</div><div><br></div><div>Thanks!<br>Jason</div><div><br></div><div><br></div></div><div class="gmail_extra"><br clear="all"><div><div class="gmail_signature" data-smartmail="gmail_signature"><div dir="ltr">Jason Maldonis<div>Research Assistant of Professor Paul Voyles</div><div>Materials Science Grad Student<br></div><div>University of Wisconsin, Madison<br>1509 University Ave, Rm M142<br>Madison, WI 53706<br></div><div><a href="mailto:maldonis@wisc.edu" target="_blank">maldonis@wisc.edu</a></div><div>608-295-5532</div></div></div></div>
<br><div class="gmail_quote">On Wed, Jun 15, 2016 at 5:34 AM, Gilles Gouaillardet <span dir="ltr">&lt;<a href="mailto:gilles.gouaillardet@gmail.com" target="_blank">gilles.gouaillardet@gmail.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">Jason,<div><br></div><div>How many nodes are you running on ?</div><div><br></div><div>Since you have an IB network, IB is used for intra node communication between tasks that are not part of the same OpenMPI job (read spawn group)</div><div>I can make a simple patch to use tcp instead of IB for these intra node communication,</div><div>Let me know if you are willing to give it a try</div><div><br></div><div>Cheers,</div><div><br></div><div>Gilles<div><div class="h5"><br><br>On Wednesday, June 15, 2016, Jason Maldonis &lt;<a href="mailto:maldonis@wisc.edu" target="_blank">maldonis@wisc.edu</a>&gt; wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Thanks Ralph for all the help. I will do that until it gets fixed.<div><br></div><div>Nathan, I am very very interested in this working because we are developing some new cool code for research in materials science. This is the last piece of the puzzle for us I believe. I can use TCP for now though of course. While I doubt I can help, if you are having trouble reproducing the problem or something else, feel free to let me know. I understand you probably have a bunch of other things on your plate too, but if there is something I can do to speed up the process, just let me know.</div><div><br></div><div>Lastly, what are the chances there is a place/website/etc where I can watch to see when the fix for this has been made?</div><div><br></div><div>Thanks everyone!</div><div>Jason</div></div><div class="gmail_extra"><br clear="all"><div><div data-smartmail="gmail_signature"><div dir="ltr">Jason Maldonis<div>Research Assistant of Professor Paul Voyles</div><div>Materials Science Grad Student<br></div><div>University of Wisconsin, Madison<br>1509 University Ave, Rm M142<br>Madison, WI 53706<br></div><div><a>maldonis@wisc.edu</a></div><div><a href="tel:608-295-5532" value="+16082955532" target="_blank">608-295-5532</a></div></div></div></div>
<br><div class="gmail_quote">On Tue, Jun 14, 2016 at 4:51 PM, Ralph Castain <span dir="ltr">&lt;<a>rhc@open-mpi.org</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
<div style="word-wrap:break-word">You don’t want to always use those options as your performance will take a hit - TCP vs Infiniband isn’t a good option. Sadly, this is something we need someone like Nathan to address as it is a bug in the code base, and in an area I’m not familiar with<div><br></div><div>For now, just use TCP so you can move forward</div><div><br></div><div><br><div><blockquote type="cite"><div><div><div>On Jun 14, 2016, at 2:14 PM, Jason Maldonis &lt;<a>maldonis@wisc.edu</a>&gt; wrote:</div><br></div></div><div><div><div><div dir="ltr">Ralph, The problem *does* go away if I add &quot;<span style="font-size:12.8px">-mca btl tcp,sm,self&quot; to the mpiexec cmd line. (By the way, I am using mpiexec rather than mpirun; do you recommend one over the other?) Will you tell me what this means for me? For example, should I always append these arguments to mpiexec for my non-test jobs as well?   I do not know what you mean by fabric unfortunately, but I can give you some system information (see end of email). Unfortunately I am not a system admin so I do not have sudo rights. Just let me know if I can tell you something more specific though and I will get it.</span><div><span style="font-size:12.8px"><br></span></div><div><span style="font-size:12.8px">Nathan,  Thank you for your response. Unfortunately I have no idea what that means :(  I can forward that to our cluster managers, but I do not know if that is enough information for them to understand what they might need to do to help me with this issue.</span></div><div><span style="font-size:12.8px"><br></span></div><font face="monospace, monospace">$ lscpu<br>Architecture:          x86_64<br>CPU op-mode(s):        32-bit, 64-bit<br>Byte Order:            Little Endian<br>CPU(s):                20<br>On-line CPU(s) list:   0-19<br>Thread(s) per core:    1<br>Core(s) per socket:    10<br>Socket(s):             2<br>NUMA node(s):          2<br>Vendor ID:             GenuineIntel<br>CPU family:            6<br>Model:                 63<br>Stepping:              2<br>CPU MHz:               2594.159<br>BogoMIPS:              5187.59<br>Virtualization:        VT-x<br>L1d cache:             32K<br>L1i cache:             32K<br>L2 cache:              256K<br>L3 cache:              25600K<br>NUMA node0 CPU(s):     0,2,4,6,8,10,12,14,16,18<br>NUMA node1 CPU(s):     1,3,5,7,9,11,13,15,17,19</font><div><span style="font-size:12.8px"><br></span></div><div><span style="font-size:12.8px">Thanks,</span></div><div><span style="font-size:12.8px">Jason</span></div></div><div class="gmail_extra"><br clear="all"><div><div data-smartmail="gmail_signature"><div dir="ltr">Jason Maldonis<div>Research Assistant of Professor Paul Voyles</div><div>Materials Science Grad Student<br></div><div>University of Wisconsin, Madison<br>1509 University Ave, Rm M142<br>Madison, WI 53706<br></div><div><a>maldonis@wisc.edu</a></div><div><a href="tel:608-295-5532" value="+16082955532" target="_blank">608-295-5532</a></div></div></div></div>
<br><div class="gmail_quote">On Tue, Jun 14, 2016 at 1:27 PM, Nathan Hjelm <span dir="ltr">&lt;<a>hjelmn@me.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">


<div><div>That message is coming from udcm in the openib btl. It indicates some sort of failure in the connection mechanism. It can happen if the listening thread no longer exists or is taking too long to process messages.</div><div><br></div><div>-Nathan</div><div><div><div><br></div><div><br>On Jun 14, 2016, at 12:20 PM, Ralph Castain &lt;<a>rhc@open-mpi.org</a>&gt; wrote:<br><br></div></div></div><div><blockquote type="cite"><div style="word-wrap:break-word"><div><div>Hmm…I’m unable to replicate a problem on my machines. What fabric are you using? Does the problem go away if you add “-mca btl tcp,sm,self” to the mpirun cmd line?<div><br><div><blockquote type="cite"><div>On Jun 14, 2016, at 11:15 AM, Jason Maldonis &lt;<a>maldonis@wisc.edu</a>&gt; wrote:</div><div><div dir="ltr"><div>Hi Ralph, et. al,</div><div><br></div>Great, thank you for the help. I downloaded the mpi loop spawn test directly from what I think is the master repo on github:  <a href="https://github.com/open-mpi/ompi/blob/master/orte/test/mpi/loop_spawn.c" target="_blank">https://github.com/open-mpi/ompi/blob/master/orte/test/mpi/loop_spawn.c</a><div>I am still using the mpi code from 1.10.2, however.<br><div><br></div><div>Is that test updated with the correct code? If so, I am still getting the same &quot;too many retries sending message to 0x0184:0x00001d27, giving up&quot; errors. I also just downloaded the June 14 nightly tarball (7.79MB) from: <a href="https://www.open-mpi.org/nightly/v2.x/" target="_blank">https://www.open-mpi.org/nightly/v2.x/</a> and I get the same error.</div><div><br></div><div>Could you please point me to the correct code?</div><div><br></div><div>If you need me to provide more information please let me know.<br><br>Thank you,</div><div>Jason</div></div></div><div class="gmail_extra"><br clear="all"><div><div><div dir="ltr">Jason Maldonis<div>Research Assistant of Professor Paul Voyles</div><div>Materials Science Grad Student<br></div><div>University of Wisconsin, Madison<br>1509 University Ave, Rm M142<br>Madison, WI 53706<br></div><div><a>maldonis@wisc.edu</a></div><div><a href="tel:608-295-5532" value="+16082955532" target="_blank">608-295-5532</a></div></div></div></div><br><div class="gmail_quote">On Tue, Jun 14, 2016 at 10:59 AM, Ralph Castain <span dir="ltr">&lt;<a>rhc@open-mpi.org</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div style="word-wrap:break-word">I dug into this a bit (with some help from others) and found that the spawn code appears to be working correctly - it is the test in orte/test that is wrong. The test has been correctly updated in the 2.x and master repos, but we failed to backport it to the 1.10 series. I have done so this morning, and it will be in the upcoming 1.10.3 release (out very soon).<div><div><div><br></div><div><br><div><blockquote type="cite"><div>On Jun 13, 2016, at 3:53 PM, Ralph Castain &lt;<a>rhc@open-mpi.org</a>&gt; wrote:</div><br><div><div style="word-wrap:break-word">No, that PR has nothing to do with loop_spawn. I’ll try to take a look at the problem.<div><br><div><blockquote type="cite"><div>On Jun 13, 2016, at 3:47 PM, Jason Maldonis &lt;<a>maldonis@wisc.edu</a>&gt; wrote:</div><br><div><div dir="ltr"><div dir="ltr"><p style="margin-bottom:16px;color:#333333;font-family:&#39;Helvetica Neue&#39;,Helvetica,&#39;Segoe UI&#39;,Arial,freesans,sans-serif,&#39;Apple Color Emoji&#39;,&#39;Segoe UI Emoji&#39;,&#39;Segoe UI Symbol&#39;;font-size:14px;line-height:22.4px;margin-top:0px!important">Hello,</p><p style="margin-bottom:16px;color:#333333;font-family:&#39;Helvetica Neue&#39;,Helvetica,&#39;Segoe UI&#39;,Arial,freesans,sans-serif,&#39;Apple Color Emoji&#39;,&#39;Segoe UI Emoji&#39;,&#39;Segoe UI Symbol&#39;;font-size:14px;line-height:22.4px;margin-top:0px!important"><span style="line-height:22.4px">I am using OpenMPI 1.10.2 compiled with Intel. I am trying to get the </span><code style="line-height:22.4px;font-family:Consolas,&#39;Liberation Mono&#39;,Menlo,Courier,monospace;font-size:11.9px;padding:0.2em 0px;margin:0px;border-radius:3px;background-color:rgba(0,0,0,0.0392157)">spawn</code><span style="line-height:22.4px"> </span><span style="line-height:22.4px">functionality to work inside a for loop, but continue to get the error</span><span style="line-height:22.4px"> &quot;</span><code style="line-height:22.4px;font-family:Consolas,&#39;Liberation Mono&#39;,Menlo,Courier,monospace;font-size:11.9px;padding:0.2em 0px;margin:0px;border-radius:3px;background-color:rgba(0,0,0,0.0392157)">too many retries sending message to &lt;addr&gt;, giving up&quot;</code><span style="line-height:22.4px"> </span><span style="line-height:22.4px">somewhere down the line in the for loop, seemingly because the processors are not being fully freed when disconnecting/finishing. I found the</span><span style="line-height:22.4px"> </span><code style="line-height:22.4px;color:#4078c0;font-family:Consolas,&#39;Liberation Mono&#39;,Menlo,Courier,monospace;font-size:11.9px;padding:0.2em 0px;margin:0px;border-radius:3px;background-color:rgba(0,0,0,0.0392157)"><a href="https://github.com/open-mpi/ompi/blob/master/orte/test/mpi/loop_spawn.c" style="color:#4078c0;text-decoration:none;background-color:transparent" target="_blank">orte/test/mpi/loop_spawn.c</a> </code><span style="line-height:22.4px">example/test, and it has the exact same problem. I also found</span><span style="line-height:22.4px"> </span><a href="https://www.open-mpi.org/community/lists/devel/2016/04/18814.php" style="line-height:22.4px;color:#4078c0;text-decoration:none;background-color:transparent" target="_blank">this</a><span style="line-height:22.4px"> </span><span style="line-height:22.4px">mailing list post from ~ a month and a half ago.</span><br></p><p style="margin-top:0px;margin-bottom:16px;color:#333333;font-family:&#39;Helvetica Neue&#39;,Helvetica,&#39;Segoe UI&#39;,Arial,freesans,sans-serif,&#39;Apple Color Emoji&#39;,&#39;Segoe UI Emoji&#39;,&#39;Segoe UI Symbol&#39;;font-size:14px;line-height:22.4px">Is this PR (<a href="https://github.com/open-mpi/ompi/pull/1473" target="_blank">https://github.com/open-mpi/ompi/pull/1473</a>) about the same issue I am having (ie the <code style="font-family:Consolas,&#39;Liberation Mono&#39;,Menlo,Courier,monospace;font-size:11.9px;padding:0.2em 0px;margin:0px;border-radius:3px;background-color:rgba(0,0,0,0.0392157)">loop_spawn</code> example not working)? If so, do you know if we can downgrade to e.g. 1.10.1 or another version? Or is there another solution to fix this bug until you get a new release out (or is one coming shortly to fix this maybe?)?</p><p style="margin-top:0px;margin-bottom:16px;color:#333333;font-family:&#39;Helvetica Neue&#39;,Helvetica,&#39;Segoe UI&#39;,Arial,freesans,sans-serif,&#39;Apple Color Emoji&#39;,&#39;Segoe UI Emoji&#39;,&#39;Segoe UI Symbol&#39;;font-size:14px;line-height:22.4px">Below is the output of the <code style="font-family:Consolas,&#39;Liberation Mono&#39;,Menlo,Courier,monospace;font-size:11.9px;padding:0.2em 0px;margin:0px;border-radius:3px;background-color:rgba(0,0,0,0.0392157)">loop_spawn</code> test on our university&#39;s cluster, which I know very little about in terms of architecture but can get information if it&#39;s helpful. The large group of people who manage this cluster are very good.</p><p style="margin-top:0px;margin-bottom:16px;color:#333333;font-family:&#39;Helvetica Neue&#39;,Helvetica,&#39;Segoe UI&#39;,Arial,freesans,sans-serif,&#39;Apple Color Emoji&#39;,&#39;Segoe UI Emoji&#39;,&#39;Segoe UI Symbol&#39;;font-size:14px;line-height:22.4px">Thanks for your time.</p><p style="margin-top:0px;margin-bottom:16px;color:#333333;font-family:&#39;Helvetica Neue&#39;,Helvetica,&#39;Segoe UI&#39;,Arial,freesans,sans-serif,&#39;Apple Color Emoji&#39;,&#39;Segoe UI Emoji&#39;,&#39;Segoe UI Symbol&#39;;font-size:14px;line-height:22.4px">Jason</p><pre style="font-family:Consolas,&#39;Liberation Mono&#39;,Menlo,Courier,monospace;font-size:11.9px;margin-top:0px;font-stretch:normal;line-height:1.45;word-wrap:normal;padding:16px;overflow:auto;border-radius:3px;color:#333333;margin-bottom:0px!important;background-color:#f7f7f7"><code style="font-family:Consolas,&#39;Liberation Mono&#39;,Menlo,Courier,monospace;font-size:11.9px;padding:0px;margin:0px;border-radius:3px;border:0px;display:inline;overflow:visible;line-height:inherit;word-wrap:normal;background:transparent">mpiexec -np 5 loop_spawn
parent*******************************
parent: Launching MPI*
parent*******************************
parent: Launching MPI*
parent*******************************
parent: Launching MPI*
parent*******************************
parent: Launching MPI*
parent*******************************
parent: Launching MPI*
parent: MPI_Comm_spawn #0 return : 0
parent: MPI_Comm_spawn #0 return : 0
parent: MPI_Comm_spawn #0 return : 0
parent: MPI_Comm_spawn #0 return : 0
parent: MPI_Comm_spawn #0 return : 0
Child: launch
Child merged rank = 5, size = 6
parent: MPI_Comm_spawn #0 rank 4, size 6
parent: MPI_Comm_spawn #0 rank 0, size 6
parent: MPI_Comm_spawn #0 rank 2, size 6
parent: MPI_Comm_spawn #0 rank 3, size 6
parent: MPI_Comm_spawn #0 rank 1, size 6
Child 329941: exiting
parent: MPI_Comm_spawn #1 return : 0
parent: MPI_Comm_spawn #1 return : 0
parent: MPI_Comm_spawn #1 return : 0
parent: MPI_Comm_spawn #1 return : 0
parent: MPI_Comm_spawn #1 return : 0
Child: launch
parent: MPI_Comm_spawn #1 rank 0, size 6
parent: MPI_Comm_spawn #1 rank 2, size 6
parent: MPI_Comm_spawn #1 rank 1, size 6
parent: MPI_Comm_spawn #1 rank 3, size 6
Child merged rank = 5, size = 6
parent: MPI_Comm_spawn #1 rank 4, size 6
Child 329945: exiting
parent: MPI_Comm_spawn #2 return : 0
parent: MPI_Comm_spawn #2 return : 0
parent: MPI_Comm_spawn #2 return : 0
parent: MPI_Comm_spawn #2 return : 0
parent: MPI_Comm_spawn #2 return : 0
Child: launch
parent: MPI_Comm_spawn #2 rank 3, size 6
parent: MPI_Comm_spawn #2 rank 0, size 6
parent: MPI_Comm_spawn #2 rank 2, size 6
Child merged rank = 5, size = 6
parent: MPI_Comm_spawn #2 rank 1, size 6
parent: MPI_Comm_spawn #2 rank 4, size 6
Child 329949: exiting
parent: MPI_Comm_spawn #3 return : 0
parent: MPI_Comm_spawn #3 return : 0
parent: MPI_Comm_spawn #3 return : 0
parent: MPI_Comm_spawn #3 return : 0
parent: MPI_Comm_spawn #3 return : 0
Child: launch
[node:port?] too many retries sending message to &lt;addr&gt;, giving up
-------------------------------------------------------
Child job 5 terminated normally, but 1 process returned
a non-zero exit code.. Per user-direction, the job has been aborted.
-------------------------------------------------------
--------------------------------------------------------------------------
mpiexec detected that one or more processes exited with non-zero status, thus causing
the job to be terminated. The first process to do so was:

  Process name: [[...],0]
  Exit code:    255
--------------------------------------------------------------------------</code></pre></div></div>_______________________________________________<br>users mailing list<br><a>users@open-mpi.org</a><br>Subscription: <a href="https://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">https://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2016/06/29425.php" target="_blank">http://www.open-mpi.org/community/lists/users/2016/06/29425.php</a></div></blockquote></div><br></div></div></div></blockquote></div><br></div></div></div></div><br>_______________________________________________<br> users mailing list<br> <a>users@open-mpi.org</a><br> Subscription: <a href="https://www.open-mpi.org/mailman/listinfo.cgi/users" rel="noreferrer" target="_blank">https://www.open-mpi.org/mailman/listinfo.cgi/users</a><br> Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2016/06/29435.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/users/2016/06/29435.php</a><br></blockquote></div><br></div>_______________________________________________<br>users mailing list<br><a>users@open-mpi.org</a><br>Subscription: <a href="https://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">https://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2016/06/29438.php" target="_blank">http://www.open-mpi.org/community/lists/users/2016/06/29438.php</a></div></blockquote></div><br></div></div></div><div><span><div><div>_______________________________________________<br>users mailing list<br><a>users@open-mpi.org</a><br>Subscription: <a href="https://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">https://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div></div>Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2016/06/29439.php" target="_blank">http://www.open-mpi.org/community/lists/users/2016/06/29439.php</a></span></div></div></blockquote></div></div><br>_______________________________________________<br>
users mailing list<br>
<a>users@open-mpi.org</a><br>
Subscription: <a href="https://www.open-mpi.org/mailman/listinfo.cgi/users" rel="noreferrer" target="_blank">https://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2016/06/29440.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/users/2016/06/29440.php</a><br></blockquote></div><br></div>
_______________________________________________<br>users mailing list<br><a>users@open-mpi.org</a><br>Subscription: <a href="https://www.open-mpi.org/mailman/listinfo.cgi/users" target="_blank">https://www.open-mpi.org/mailman/listinfo.cgi/users</a><br></div></div>Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2016/06/29444.php" target="_blank">http://www.open-mpi.org/community/lists/users/2016/06/29444.php</a></div></blockquote></div><br></div></div><br>_______________________________________________<br>
users mailing list<br>
<a>users@open-mpi.org</a><br>
Subscription: <a href="https://www.open-mpi.org/mailman/listinfo.cgi/users" rel="noreferrer" target="_blank">https://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2016/06/29445.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/users/2016/06/29445.php</a><br></blockquote></div><br></div>
</blockquote></div></div></div>
<br>_______________________________________________<br>
users mailing list<br>
<a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>
Subscription: <a href="https://www.open-mpi.org/mailman/listinfo.cgi/users" rel="noreferrer" target="_blank">https://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/users/2016/06/29451.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/users/2016/06/29451.php</a><br></blockquote></div><br></div>

