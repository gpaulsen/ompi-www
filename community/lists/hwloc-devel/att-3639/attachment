<div dir="ltr">I just tried building the hwloc trunk (from a nightly tarball) on Fedora17.<div style>The following lines appear in the libtool script generated by configure:</div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px">
<div style><div style># Compile-time system search path for libraries.</div></div><div style><div style>sys_lib_search_path_spec=&quot;/usr/lib/gcc/x86_64-redhat-linux/4.7.2 /usr/lib64 /lib64 &quot;</div></div><div style>
<div style># Run-time system search path for libraries.</div></div><div style><div style>sys_lib_dlsearch_path_spec=&quot;/lib /usr/lib &quot;</div><div style><br></div></div></blockquote><div style>If I am understanding things correctly, this means that libtool expects that it NEEDS to encode the rpath for libs to be installed in /lib64 and /usr/lib64 because they do not appear in sys_lib_dlsearch_path_spec.</div>
<div style><br></div><div style>HOWEVER, if I first run &quot;autoreconf --install --force&quot; to use the system-provided libtool:</div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div style><div style>
# Compile-time system search path for libraries.</div></div><div style><div style>sys_lib_search_path_spec=&quot;/usr/lib/gcc/x86_64-redhat-linux/4.7.2 /usr/lib64 /lib64 &quot;</div></div><div style><div style># Run-time system search path for libraries.</div>
</div><div style><div style>sys_lib_dlsearch_path_spec=&quot;/lib64 /usr/lib64 /lib /usr/lib &quot;</div></div></blockquote><div style>Which, I believe, is the desired behavior.</div><div style><br></div><div style>I don&#39;t know if fedora has made any significant changes to it, but they are using libtool 2.4.2, which is newer than the 2.4 that comes in the hwloc nightly tarballs.</div>
<div style><br></div><div style>I know from experience that libtool 2.4.2 fixed a problem in 2.4 in which shared libs were not built correctly with the PGI compilers.  So, I&#39;d recommend updating libtoool regardless of whether doing so resolves the rpath issue reported on Fedora 18.</div>
<div style><br></div><div style>-Paul</div><div style><br></div></div><div class="gmail_extra"><br><br><div class="gmail_quote">On Tue, Apr 23, 2013 at 1:26 PM, Samuel Thibault <span dir="ltr">&lt;<a href="mailto:samuel.thibault@inria.fr" target="_blank">samuel.thibault@inria.fr</a>&gt;</span> wrote:<br>
<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">Brice Goglin, le Tue 23 Apr 2013 19:12:08 +0200, a écrit :<br>
&gt; I assume that libtool doesn&#39;t add a rpath when you install in standard<br>
&gt; directories?<br>
<br>
Yes, it&#39;s doing stuff to detect with paths are actually already in the<br>
standard search dirs.<br>
<br>
&gt; If /usr/lib64 is the default path for 64bits libs on Fedora, shouldn&#39;t somebody<br>
&gt; take care of removing the corresponding rpath too?<br>
<br>
libtool should be already doing that.<br>
<br>
&gt; This is likely related (but the reversed case) to the comment about Fedora in<br>
&gt; <a href="http://wiki.debian.org/RpathIssue" target="_blank">http://wiki.debian.org/RpathIssue</a>. One link on that page says that rerunning<br>
&gt; libtoolize before configure may help. Can you try that? (maybe compare the new<br>
&gt; libtool script with the one from the hwloc tarball to check that some lib64<br>
&gt; things appeared?)<br>
&gt;<br>
&gt;<br>
&gt;       □ If the application uses a local copy of libtool, add the following<br>
&gt;         lines to the spec after %configure:=&gt; it will make tests FAIL (without<br>
&gt;         this change, it runs just fine - all tests are PASSED)<br>
&gt;<br>
&gt;     FAIL: test-hwloc-annotate.sh<br>
&gt;     FAIL: test-hwloc-assembler.sh<br>
&gt;     PASS: test-hwloc-calc.sh<br>
&gt;     PASS: test-hwloc-distances.sh<br>
&gt;     PASS: test-hwloc-distrib.sh<br>
&gt;     FAIL: test-hwloc-info.sh<br>
&gt;<br>
&gt;<br>
&gt; I am not sure why some fail while the other succeed. You may need to set<br>
&gt; LD_LIBRARY_PATH to fix this?<br>
<br>
The libtool script is supposed to automatically add it.<br>
<br>
It would probably be worth running by hand to see what actually fails.<br>
<br>
Samuel<br>
_______________________________________________<br>
hwloc-devel mailing list<br>
<a href="mailto:hwloc-devel@open-mpi.org">hwloc-devel@open-mpi.org</a><br>
<a href="http://www.open-mpi.org/mailman/listinfo.cgi/hwloc-devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/hwloc-devel</a></blockquote></div><br><br clear="all"><div><br></div>-- <br><font face="courier new, monospace"><div>
Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Future Technologies Group</div><div>Computer and Data Sciences Department     Tel: +1-510-495-2352</div>
<div>Lawrence Berkeley National Laboratory     Fax: +1-510-486-6900</div></font>
</div>

