<?
$subject_val = "Re: [hwloc-devel] RPATH issues when building in Fedora 18";
include("../../include/msg-header.inc");
?>
<!-- received="Tue Apr 23 17:08:53 2013" -->
<!-- isoreceived="20130423210853" -->
<!-- sent="Tue, 23 Apr 2013 14:08:47 -0700" -->
<!-- isosent="20130423210847" -->
<!-- name="Paul Hargrove" -->
<!-- email="phhargrove_at_[hidden]" -->
<!-- subject="Re: [hwloc-devel] RPATH issues when building in Fedora 18" -->
<!-- id="CAAvDA16Qta2uVD=eAyv-M1jcrz65hr8w7zH8AUf0PFa6=Xz4dg_at_mail.gmail.com" -->
<!-- charset="UTF-8" -->
<!-- inreplyto="20130423202651.GI6807_at_type.youpi.perso.aquilenet.fr" -->
<!-- expires="-1" -->
<div class="center">
<table border="2" width="100%" class="links">
<tr>
<th><a href="date.php">Date view</a></th>
<th><a href="index.php">Thread view</a></th>
<th><a href="subject.php">Subject view</a></th>
<th><a href="author.php">Author view</a></th>
</tr>
</table>
</div>
<p class="headers">
<strong>Subject:</strong> Re: [hwloc-devel] RPATH issues when building in Fedora 18<br>
<strong>From:</strong> Paul Hargrove (<em>phhargrove_at_[hidden]</em>)<br>
<strong>Date:</strong> 2013-04-23 17:08:47
</p>
<ul class="links">
<!-- next="start" -->
<li><strong>Next message:</strong> <a href="3640.php">Brice Goglin: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<li><strong>Previous message:</strong> <a href="3638.php">Samuel Thibault: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<li><strong>In reply to:</strong> <a href="3636.php">Samuel Thibault: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="3640.php">Brice Goglin: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<li><strong>Reply:</strong> <a href="3640.php">Brice Goglin: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<!-- reply="end" -->
</ul>
<hr>
<!-- body="start" -->
<p>
I just tried building the hwloc trunk (from a nightly tarball) on Fedora17.
<br>
The following lines appear in the libtool script generated by configure:
<br>
<p># Compile-time system search path for libraries.
<br>
sys_lib_search_path_spec=&quot;/usr/lib/gcc/x86_64-redhat-linux/4.7.2 /usr/lib64
<br>
/lib64 &quot;
<br>
# Run-time system search path for libraries.
<br>
sys_lib_dlsearch_path_spec=&quot;/lib /usr/lib &quot;
<br>
<p>If I am understanding things correctly, this means that libtool expects
<br>
that it NEEDS to encode the rpath for libs to be installed in /lib64 and
<br>
/usr/lib64 because they do not appear in sys_lib_dlsearch_path_spec.
<br>
<p>HOWEVER, if I first run &quot;autoreconf --install --force&quot; to use the
<br>
system-provided libtool:
<br>
<p># Compile-time system search path for libraries.
<br>
sys_lib_search_path_spec=&quot;/usr/lib/gcc/x86_64-redhat-linux/4.7.2 /usr/lib64
<br>
/lib64 &quot;
<br>
# Run-time system search path for libraries.
<br>
sys_lib_dlsearch_path_spec=&quot;/lib64 /usr/lib64 /lib /usr/lib &quot;
<br>
<p>Which, I believe, is the desired behavior.
<br>
<p>I don't know if fedora has made any significant changes to it, but they are
<br>
using libtool 2.4.2, which is newer than the 2.4 that comes in the hwloc
<br>
nightly tarballs.
<br>
<p>I know from experience that libtool 2.4.2 fixed a problem in 2.4 in which
<br>
shared libs were not built correctly with the PGI compilers.  So, I'd
<br>
recommend updating libtoool regardless of whether doing so resolves the
<br>
rpath issue reported on Fedora 18.
<br>
<p>-Paul
<br>
<p><p><p>On Tue, Apr 23, 2013 at 1:26 PM, Samuel Thibault
<br>
&lt;samuel.thibault_at_[hidden]&gt;wrote:
<br>
<p><span class="quotelev1">&gt; Brice Goglin, le Tue 23 Apr 2013 19:12:08 +0200, a &#195;&#169;crit :
</span><br>
<span class="quotelev2">&gt; &gt; I assume that libtool doesn't add a rpath when you install in standard
</span><br>
<span class="quotelev2">&gt; &gt; directories?
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; Yes, it's doing stuff to detect with paths are actually already in the
</span><br>
<span class="quotelev1">&gt; standard search dirs.
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev2">&gt; &gt; If /usr/lib64 is the default path for 64bits libs on Fedora, shouldn't
</span><br>
<span class="quotelev1">&gt; somebody
</span><br>
<span class="quotelev2">&gt; &gt; take care of removing the corresponding rpath too?
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; libtool should be already doing that.
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev2">&gt; &gt; This is likely related (but the reversed case) to the comment about
</span><br>
<span class="quotelev1">&gt; Fedora in
</span><br>
<span class="quotelev2">&gt; &gt; <a href="http://wiki.debian.org/RpathIssue">http://wiki.debian.org/RpathIssue</a>. One link on that page says that
</span><br>
<span class="quotelev1">&gt; rerunning
</span><br>
<span class="quotelev2">&gt; &gt; libtoolize before configure may help. Can you try that? (maybe compare
</span><br>
<span class="quotelev1">&gt; the new
</span><br>
<span class="quotelev2">&gt; &gt; libtool script with the one from the hwloc tarball to check that some
</span><br>
<span class="quotelev1">&gt; lib64
</span><br>
<span class="quotelev2">&gt; &gt; things appeared?)
</span><br>
<span class="quotelev2">&gt; &gt;
</span><br>
<span class="quotelev2">&gt; &gt;
</span><br>
<span class="quotelev2">&gt; &gt;       &#226;&#150;&#161; If the application uses a local copy of libtool, add the
</span><br>
<span class="quotelev1">&gt; following
</span><br>
<span class="quotelev2">&gt; &gt;         lines to the spec after %configure:=&gt; it will make tests FAIL
</span><br>
<span class="quotelev1">&gt; (without
</span><br>
<span class="quotelev2">&gt; &gt;         this change, it runs just fine - all tests are PASSED)
</span><br>
<span class="quotelev2">&gt; &gt;
</span><br>
<span class="quotelev2">&gt; &gt;     FAIL: test-hwloc-annotate.sh
</span><br>
<span class="quotelev2">&gt; &gt;     FAIL: test-hwloc-assembler.sh
</span><br>
<span class="quotelev2">&gt; &gt;     PASS: test-hwloc-calc.sh
</span><br>
<span class="quotelev2">&gt; &gt;     PASS: test-hwloc-distances.sh
</span><br>
<span class="quotelev2">&gt; &gt;     PASS: test-hwloc-distrib.sh
</span><br>
<span class="quotelev2">&gt; &gt;     FAIL: test-hwloc-info.sh
</span><br>
<span class="quotelev2">&gt; &gt;
</span><br>
<span class="quotelev2">&gt; &gt;
</span><br>
<span class="quotelev2">&gt; &gt; I am not sure why some fail while the other succeed. You may need to set
</span><br>
<span class="quotelev2">&gt; &gt; LD_LIBRARY_PATH to fix this?
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; The libtool script is supposed to automatically add it.
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; It would probably be worth running by hand to see what actually fails.
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; Samuel
</span><br>
<span class="quotelev1">&gt; _______________________________________________
</span><br>
<span class="quotelev1">&gt; hwloc-devel mailing list
</span><br>
<span class="quotelev1">&gt; hwloc-devel_at_[hidden]
</span><br>
<span class="quotelev1">&gt; <a href="http://www.open-mpi.org/mailman/listinfo.cgi/hwloc-devel">http://www.open-mpi.org/mailman/listinfo.cgi/hwloc-devel</a>
</span><br>
<p><p><p><p><pre>
-- 
Paul H. Hargrove                          PHHargrove_at_[hidden]
Future Technologies Group
Computer and Data Sciences Department     Tel: +1-510-495-2352
Lawrence Berkeley National Laboratory     Fax: +1-510-486-6900
</pre>
<hr>
<ul>
<li>text/html attachment: <a href="http://www.open-mpi.org/community/lists/hwloc-devel/att-3639/attachment">attachment</a>
</ul>
<!-- attachment="attachment" -->
<!-- body="end" -->
<hr>
<ul class="links">
<!-- next="start" -->
<li><strong>Next message:</strong> <a href="3640.php">Brice Goglin: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<li><strong>Previous message:</strong> <a href="3638.php">Samuel Thibault: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<li><strong>In reply to:</strong> <a href="3636.php">Samuel Thibault: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="3640.php">Brice Goglin: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<li><strong>Reply:</strong> <a href="3640.php">Brice Goglin: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<!-- reply="end" -->
</ul>
<div class="center">
<table border="2" width="100%" class="links">
<tr>
<th><a href="date.php">Date view</a></th>
<th><a href="index.php">Thread view</a></th>
<th><a href="subject.php">Subject view</a></th>
<th><a href="author.php">Author view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<? include("../../include/msg-footer.inc") ?>
