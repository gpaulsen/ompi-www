<?
$subject_val = "Re: [hwloc-devel] RPATH issues when building in Fedora 18";
include("../../include/msg-header.inc");
?>
<!-- received="Tue Apr 23 18:05:22 2013" -->
<!-- isoreceived="20130423220522" -->
<!-- sent="Wed, 24 Apr 2013 00:05:16 +0200" -->
<!-- isosent="20130423220516" -->
<!-- name="Brice Goglin" -->
<!-- email="Brice.Goglin_at_[hidden]" -->
<!-- subject="Re: [hwloc-devel] RPATH issues when building in Fedora 18" -->
<!-- id="5177059C.4010609_at_inria.fr" -->
<!-- charset="ISO-8859-1" -->
<!-- inreplyto="CAAvDA16Qta2uVD=eAyv-M1jcrz65hr8w7zH8AUf0PFa6=Xz4dg_at_mail.gmail.com" -->
<!-- expires="-1" -->
<div class="center">
<table border="2" width="100%" class="links">
<tr>
<th><a href="date.php">Date view</a></th>
<th><a href="index.php">Thread view</a></th>
<th><a href="subject.php">Subject view</a></th>
<th><a href="author.php">Author view</a></th>
</tr>
</table>
</div>
<p class="headers">
<strong>Subject:</strong> Re: [hwloc-devel] RPATH issues when building in Fedora 18<br>
<strong>From:</strong> Brice Goglin (<em>Brice.Goglin_at_[hidden]</em>)<br>
<strong>Date:</strong> 2013-04-23 18:05:16
</p>
<ul class="links">
<!-- next="start" -->
<li><strong>Next message:</strong> <a href="3641.php">Paul Hargrove: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<li><strong>Previous message:</strong> <a href="3639.php">Paul Hargrove: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<li><strong>In reply to:</strong> <a href="3639.php">Paul Hargrove: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="3641.php">Paul Hargrove: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<li><strong>Reply:</strong> <a href="3641.php">Paul Hargrove: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<!-- reply="end" -->
</ul>
<hr>
<!-- body="start" -->
<p>
Jeff, can you fix the trunk nightly script to use libtool 2.4.2 instead
<br>
of 2.4 ? Thanks.
<br>
<p>Paul, the v1.7 branch nightly and the official v1.7 release tarball use
<br>
2.4.2 and I think we have the same problem there too. Rerunning
<br>
autoreconf with centos63 or fedora17 libtool 2.2.6 seems to fix the
<br>
problem. What I don't understand is where configure gets this list of
<br>
directory from. Sleeping may help.
<br>
<p>Brice
<br>
<p><p><p>Le 23/04/2013 23:08, Paul Hargrove a &#233;crit :
<br>
<span class="quotelev1">&gt; I just tried building the hwloc trunk (from a nightly tarball) on
</span><br>
<span class="quotelev1">&gt; Fedora17.
</span><br>
<span class="quotelev1">&gt; The following lines appear in the libtool script generated by configure:
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt;     # Compile-time system search path for libraries.
</span><br>
<span class="quotelev1">&gt;     sys_lib_search_path_spec=&quot;/usr/lib/gcc/x86_64-redhat-linux/4.7.2
</span><br>
<span class="quotelev1">&gt;     /usr/lib64 /lib64 &quot;
</span><br>
<span class="quotelev1">&gt;     # Run-time system search path for libraries.
</span><br>
<span class="quotelev1">&gt;     sys_lib_dlsearch_path_spec=&quot;/lib /usr/lib &quot;
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; If I am understanding things correctly, this means that libtool
</span><br>
<span class="quotelev1">&gt; expects that it NEEDS to encode the rpath for libs to be installed in
</span><br>
<span class="quotelev1">&gt; /lib64 and /usr/lib64 because they do not appear in
</span><br>
<span class="quotelev1">&gt; sys_lib_dlsearch_path_spec.
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; HOWEVER, if I first run &quot;autoreconf --install --force&quot; to use the
</span><br>
<span class="quotelev1">&gt; system-provided libtool:
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt;     # Compile-time system search path for libraries.
</span><br>
<span class="quotelev1">&gt;     sys_lib_search_path_spec=&quot;/usr/lib/gcc/x86_64-redhat-linux/4.7.2
</span><br>
<span class="quotelev1">&gt;     /usr/lib64 /lib64 &quot;
</span><br>
<span class="quotelev1">&gt;     # Run-time system search path for libraries.
</span><br>
<span class="quotelev1">&gt;     sys_lib_dlsearch_path_spec=&quot;/lib64 /usr/lib64 /lib /usr/lib &quot;
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; Which, I believe, is the desired behavior.
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; I don't know if fedora has made any significant changes to it, but
</span><br>
<span class="quotelev1">&gt; they are using libtool 2.4.2, which is newer than the 2.4 that comes
</span><br>
<span class="quotelev1">&gt; in the hwloc nightly tarballs.
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; I know from experience that libtool 2.4.2 fixed a problem in 2.4 in
</span><br>
<span class="quotelev1">&gt; which shared libs were not built correctly with the PGI compilers.
</span><br>
<span class="quotelev1">&gt;  So, I'd recommend updating libtoool regardless of whether doing so
</span><br>
<span class="quotelev1">&gt; resolves the rpath issue reported on Fedora 18.
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; -Paul
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; On Tue, Apr 23, 2013 at 1:26 PM, Samuel Thibault
</span><br>
<span class="quotelev1">&gt; &lt;samuel.thibault_at_[hidden] &lt;mailto:samuel.thibault_at_[hidden]&gt;&gt; wrote:
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt;     Brice Goglin, le Tue 23 Apr 2013 19:12:08 +0200, a &#233;crit :
</span><br>
<span class="quotelev2">&gt;     &gt; I assume that libtool doesn't add a rpath when you install in
</span><br>
<span class="quotelev1">&gt;     standard
</span><br>
<span class="quotelev2">&gt;     &gt; directories?
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt;     Yes, it's doing stuff to detect with paths are actually already in the
</span><br>
<span class="quotelev1">&gt;     standard search dirs.
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev2">&gt;     &gt; If /usr/lib64 is the default path for 64bits libs on Fedora,
</span><br>
<span class="quotelev1">&gt;     shouldn't somebody
</span><br>
<span class="quotelev2">&gt;     &gt; take care of removing the corresponding rpath too?
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt;     libtool should be already doing that.
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev2">&gt;     &gt; This is likely related (but the reversed case) to the comment
</span><br>
<span class="quotelev1">&gt;     about Fedora in
</span><br>
<span class="quotelev2">&gt;     &gt; <a href="http://wiki.debian.org/RpathIssue">http://wiki.debian.org/RpathIssue</a>. One link on that page says
</span><br>
<span class="quotelev1">&gt;     that rerunning
</span><br>
<span class="quotelev2">&gt;     &gt; libtoolize before configure may help. Can you try that? (maybe
</span><br>
<span class="quotelev1">&gt;     compare the new
</span><br>
<span class="quotelev2">&gt;     &gt; libtool script with the one from the hwloc tarball to check that
</span><br>
<span class="quotelev1">&gt;     some lib64
</span><br>
<span class="quotelev2">&gt;     &gt; things appeared?)
</span><br>
<span class="quotelev2">&gt;     &gt;
</span><br>
<span class="quotelev2">&gt;     &gt;
</span><br>
<span class="quotelev2">&gt;     &gt;       ? If the application uses a local copy of libtool, add the
</span><br>
<span class="quotelev1">&gt;     following
</span><br>
<span class="quotelev2">&gt;     &gt;         lines to the spec after %configure:=&gt; it will make tests
</span><br>
<span class="quotelev1">&gt;     FAIL (without
</span><br>
<span class="quotelev2">&gt;     &gt;         this change, it runs just fine - all tests are PASSED)
</span><br>
<span class="quotelev2">&gt;     &gt;
</span><br>
<span class="quotelev2">&gt;     &gt;     FAIL: test-hwloc-annotate.sh
</span><br>
<span class="quotelev2">&gt;     &gt;     FAIL: test-hwloc-assembler.sh
</span><br>
<span class="quotelev2">&gt;     &gt;     PASS: test-hwloc-calc.sh
</span><br>
<span class="quotelev2">&gt;     &gt;     PASS: test-hwloc-distances.sh
</span><br>
<span class="quotelev2">&gt;     &gt;     PASS: test-hwloc-distrib.sh
</span><br>
<span class="quotelev2">&gt;     &gt;     FAIL: test-hwloc-info.sh
</span><br>
<span class="quotelev2">&gt;     &gt;
</span><br>
<span class="quotelev2">&gt;     &gt;
</span><br>
<span class="quotelev2">&gt;     &gt; I am not sure why some fail while the other succeed. You may
</span><br>
<span class="quotelev1">&gt;     need to set
</span><br>
<span class="quotelev2">&gt;     &gt; LD_LIBRARY_PATH to fix this?
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt;     The libtool script is supposed to automatically add it.
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt;     It would probably be worth running by hand to see what actually fails.
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt;     Samuel
</span><br>
<span class="quotelev1">&gt;     _______________________________________________
</span><br>
<span class="quotelev1">&gt;     hwloc-devel mailing list
</span><br>
<span class="quotelev1">&gt;     hwloc-devel_at_[hidden] &lt;mailto:hwloc-devel_at_[hidden]&gt;
</span><br>
<span class="quotelev1">&gt;     <a href="http://www.open-mpi.org/mailman/listinfo.cgi/hwloc-devel">http://www.open-mpi.org/mailman/listinfo.cgi/hwloc-devel</a>
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; -- 
</span><br>
<span class="quotelev1">&gt; Paul H. Hargrove                          PHHargrove_at_[hidden]
</span><br>
<span class="quotelev1">&gt; &lt;mailto:PHHargrove_at_[hidden]&gt;
</span><br>
<span class="quotelev1">&gt; Future Technologies Group
</span><br>
<span class="quotelev1">&gt; Computer and Data Sciences Department     Tel: +1-510-495-2352
</span><br>
<span class="quotelev1">&gt; Lawrence Berkeley National Laboratory     Fax: +1-510-486-6900
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt;
</span><br>
<span class="quotelev1">&gt; _______________________________________________
</span><br>
<span class="quotelev1">&gt; hwloc-devel mailing list
</span><br>
<span class="quotelev1">&gt; hwloc-devel_at_[hidden]
</span><br>
<span class="quotelev1">&gt; <a href="http://www.open-mpi.org/mailman/listinfo.cgi/hwloc-devel">http://www.open-mpi.org/mailman/listinfo.cgi/hwloc-devel</a>
</span><br>
<p><p><hr>
<ul>
<li>text/html attachment: <a href="http://www.open-mpi.org/community/lists/hwloc-devel/att-3640/attachment">attachment</a>
</ul>
<!-- attachment="attachment" -->
<!-- body="end" -->
<hr>
<ul class="links">
<!-- next="start" -->
<li><strong>Next message:</strong> <a href="3641.php">Paul Hargrove: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<li><strong>Previous message:</strong> <a href="3639.php">Paul Hargrove: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<li><strong>In reply to:</strong> <a href="3639.php">Paul Hargrove: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="3641.php">Paul Hargrove: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<li><strong>Reply:</strong> <a href="3641.php">Paul Hargrove: "Re: [hwloc-devel] RPATH issues when building in Fedora 18"</a>
<!-- reply="end" -->
</ul>
<div class="center">
<table border="2" width="100%" class="links">
<tr>
<th><a href="date.php">Date view</a></th>
<th><a href="index.php">Thread view</a></th>
<th><a href="subject.php">Subject view</a></th>
<th><a href="author.php">Author view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<? include("../../include/msg-footer.inc") ?>
