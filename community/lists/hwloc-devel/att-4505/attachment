<html><head></head><body>Thanks.<br>
Could you test this new asm on all your systems/compilers? I don&#39;t want break that fragile code again.<br>
Brice<br><br><div class="gmail_quote">Le 21 juillet 2015 08:17:06 UTC+02:00, Paul Hargrove &lt;phhargrove@lbl.gov&gt; a écrit :<blockquote class="gmail_quote" style="margin: 0pt 0pt 0pt 0.8ex; border-left: 1px solid rgb(204, 204, 204); padding-left: 1ex;">
<div dir="ltr">Oops - send the wrong asm code.<div>While &quot;=S&quot; is correct for the second constraint, I meant to send a version that had &quot;=r&quot; because it allows the compiler more choices.</div><div><br /></div><div>-Paul</div></div><div class="gmail_extra"><br /><div class="gmail_quote">On Mon, Jul 20, 2015 at 11:12 PM, Paul Hargrove <span dir="ltr">&lt;<a href="mailto:phhargrove@lbl.gov" target="_blank">phhargrove@lbl.gov</a>&gt;</span> wrote:<br /><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">PGI-14.10 for 32-bit targets fails in the same manner as 13.7, 13.9 and 13.10.<div><br /></div><div>I believe the following inline x86 asm is correct and more robust than the existing code that pgi appears to reject:</div><div><br /></div><div><div><font face="monospace, monospace">#elif defined(HWLOC_X86_32_ARCH)</font></div><div><font face="monospace, monospace">  __asm__(</font></div><div><font
face="monospace, monospace">  &quot;xchg %%ebx,%1\n\t&quot;</font></div><div><font face="monospace, monospace">  &quot;cpuid\n\t&quot;</font></div><div><font face="monospace, monospace">  &quot;xchg %%ebx,%1\n\t&quot;</font></div><div><font face="monospace, monospace">  : &quot;=a&quot; (*eax), &quot;=S&quot; (*ebx), &quot;=c&quot; (*ecx), &quot;=d&quot; (*edx)</font></div><div><font face="monospace, monospace">  : &quot;0&quot; (*eax), &quot;2&quot; (*ecx));</font></div><div><font face="monospace, monospace">#else</font></div><span class="HOEnZb"><font color="#888888"></font><div><font color="#888888"><br /></font></div><div>-Paul</div></span></div></div><div class="HOEnZb"><div class="h5"><div class="gmail_extra"><br /><div class="gmail_quote">On Mon, Jul 20, 2015 at 9:50 PM, Paul Hargrove <span dir="ltr">&lt;<a href="mailto:phhargrove@lbl.gov" target="_blank">phhargrove@lbl.gov</a>&gt;</span> wrote:<br /><blockquote class="gmail_quote" style="margin:0 0 0
.8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Pavan,<div><br /></div><div>I can confirm that I see the same with PGI-13.10.</div><div><br /></div><div>I have a couple systems with 14.x installed but neither with 32-bit support.</div><div>I am downloading 32-bit support now (which I am assuming will work with the existing license) and will report back.</div><div><br /></div><div>-Paul</div></div><div class="gmail_extra"><br /><div class="gmail_quote"><span>On Mon, Jul 20, 2015 at 9:00 PM, Balaji, Pavan <span dir="ltr">&lt;<a href="mailto:balaji@anl.gov" target="_blank">balaji@anl.gov</a>&gt;</span> wrote:<br /></span><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><span>Hello,<br />
<br />
The hwloc-1.11 build seems to fail with the pgi compiler on 32-bit platforms.  I see the following error:<br />
<br />
----8&lt;----<br />
  CC       topology-x86.lo<br />
PGC-F-0000-Internal compiler error. unable to allocate a register       8 (topology-x86.c: 87)<br />
PGC/x86 Linux 13.9-0: compilation aborted<br />
----8&lt;----<br />
<br />
I only tried pgi-13.7 and 13.9 (I don&#39;t have access to later compiler versions).  It looks like the compiler doesn&#39;t like the assembly code in include/private/cpuid-x86.h for 32-bit platforms.<br />
<br />
<br />
<br />
Thanks,<br />
<br />
  -- Pavan<br />
<br />
_______________________________________________<br />
hwloc-devel mailing list<br />
</span><a href="mailto:hwloc-devel@open-mpi.org" target="_blank">hwloc-devel@open-mpi.org</a><br />
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/hwloc-devel" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/hwloc-devel</a><br />
Link to this post: <a href="http://www.open-mpi.org/community/lists/hwloc-devel/2015/07/4501.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/hwloc-devel/2015/07/4501.php</a><span><font color="#888888"><br />
</font></span></blockquote></div><span><font color="#888888"><br /><br clear="all" /></font><div><font color="#888888"><br /></font></div>-- <br /><div><div dir="ltr"><div><font face="courier new, monospace"></font><div><font face="courier new, monospace">Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></font></div><div>Computer Languages &amp; Systems Software (CLaSS) Group</div><div>Computer Science Department               Tel: <a href="tel:%2B1-510-495-2352" value="+15104952352" target="_blank">+1-510-495-2352</a></div><div>Lawrence Berkeley National Laboratory     Fax: <a href="tel:%2B1-510-486-6900" value="+15104866900" target="_blank">+1-510-486-6900</a></div></div></div></div>
</span></div>
</blockquote></div><br /><br clear="all" /><div><br /></div>-- <br /><div><div dir="ltr"><div><font face="courier new, monospace"></font><div><font face="courier new, monospace">Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></font></div><div>Computer Languages &amp; Systems Software (CLaSS) Group</div><div>Computer Science Department               Tel: <a href="tel:%2B1-510-495-2352" value="+15104952352" target="_blank">+1-510-495-2352</a></div><div>Lawrence Berkeley National Laboratory     Fax: <a href="tel:%2B1-510-486-6900" value="+15104866900" target="_blank">+1-510-486-6900</a></div></div></div></div>
</div>
</div></div></blockquote></div><br /><br clear="all" /><div><br /></div>-- <br /><div class="gmail_signature"><div dir="ltr"><div><font face="courier new, monospace"></font><div><font face="courier new, monospace">Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></font></div><div>Computer Languages &amp; Systems Software (CLaSS) Group</div><div>Computer Science Department               Tel: +1-510-495-2352</div><div>Lawrence Berkeley National Laboratory     Fax: +1-510-486-6900</div></div></div></div>
</div>
<p style="margin-top: 2.5em; margin-bottom: 1em; border-bottom: 1px solid #000"></p><pre class="k9mail"><hr /><br />hwloc-devel mailing list<br />hwloc-devel@open-mpi.org<br />Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/hwloc-devel">http://www.open-mpi.org/mailman/listinfo.cgi/hwloc-devel</a><br />Link to this post: <a href="http://www.open-mpi.org/community/lists/hwloc-devel/2015/07/4505.php">http://www.open-mpi.org/community/lists/hwloc-devel/2015/07/4505.php</a></pre></blockquote></div></body></html>
