<html v="urn:schemas-microsoft-com:vml" o="urn:schemas-microsoft-com:office:office" w="urn:schemas-microsoft-com:office:word" m="http://schemas.microsoft.com/office/2004/12/omml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><meta name="Generator" content="Microsoft Word 14 (filtered medium)" /><style><!--
/* Font Definitions */
@font-face
 {font-family:"Cambria Math";
 panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
 {font-family:Calibri;
 panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
 {font-family:Tahoma;
 panose-1:2 11 6 4 3 5 4 4 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
 {margin:0cm;
 margin-bottom:.0001pt;
 font-size:11.0pt;
 font-family:"Calibri","sans-serif";
 color:black;
 mso-fareast-language:EN-US;}
a:link, span.MsoHyperlink
 {mso-style-priority:99;
 color:blue;
 text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
 {mso-style-priority:99;
 color:purple;
 text-decoration:underline;}
span.EmailStyle17
 {mso-style-type:personal;
 font-family:"Calibri","sans-serif";
 color:windowtext;}
span.EmailStyle18
 {mso-style-type:personal-reply;
 font-family:"Calibri","sans-serif";
 color:#1F497D;}
.MsoChpDefault
 {mso-style-type:export-only;
 font-size:10.0pt;}
@page WordSection1
 {size:612.0pt 792.0pt;
 margin:72.0pt 72.0pt 72.0pt 72.0pt;}
div.WordSection1
 {page:WordSection1;}
--></style></head><body bgcolor="white" lang="EN-GB" link="blue" vlink="purple">Wait, I missed the &quot;io node&quot; part of your first mail. The bgq support is for compute nodes running cnk. Are io nodes running linux on same hardware as the compute nodes?<br>
<br>
I have an account on vesta. Where should I logon to have a look?<br>
Brice<br>
<br><br><div class="gmail_quote">On 25 mars 2014 08:12:58 UTC+01:00, &quot;Biddiscombe, John A.&quot; &lt;biddisco@cscs.ch&gt; wrote:<blockquote class="gmail_quote" style="margin: 0pt 0pt 0pt 0.8ex; border-left: 1px solid rgb(204, 204, 204); padding-left: 1ex;">




<!--[if gte mso 9]><xml>
<o:shapedefaults v:ext="edit" spidmax="1026" />
</xml><![endif]--><!--[if gte mso 9]><xml>
<o:shapelayout v:ext="edit">
<o:idmap v:ext="edit" data="1" />
</o:shapelayout></xml><![endif]-->


<div class="WordSection1">
<p class="MsoNormal"><span style="color:#1F497D">Brice,<p></p></span></p>
<p class="MsoNormal"><span style="color:#1F497D"><p>&nbsp;</p></span></p>
<p class="MsoNormal"><span style="font-size:12.0pt;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;;mso-fareast-language:EN-GB">lstopo --whole-system<p></p></span></p>
<p class="MsoNormal"><span style="font-size:12.0pt;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;;mso-fareast-language:EN-GB"><p>&nbsp;</p></span></p>
<p class="MsoNormal"><span style="font-size:12.0pt;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;;mso-fareast-language:EN-GB">gives the same output and setting env var BG_THREADMODEL=2 does not appear to make any visible difference.
<p></p></span></p>
<p class="MsoNormal"><span style="font-size:12.0pt;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;;mso-fareast-language:EN-GB"><p>&nbsp;</p></span></p>
<p class="MsoNormal"><span style="font-size:12.0pt;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;;mso-fareast-language:EN-GB">my configure command for compiling hwloc had no special options,<p></p></span></p>
<p class="MsoNormal"><span style="font-size:12.0pt;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;;mso-fareast-language:EN-GB">./configure --prefix=/gpfs/bbp.cscs.ch/home/biddisco/apps/clang/hwloc-1.8.1<p></p></span></p>
<p class="MsoNormal"><span style="color:#1F497D"><p>&nbsp;</p></span></p>
<p class="MsoNormal"><span style="color:#1F497D">should I rerun with something set?<p></p></span></p>
<p class="MsoNormal"><span style="color:#1F497D"><p>&nbsp;</p></span></p>
<p class="MsoNormal"><span style="color:#1F497D">Thanks<p></p></span></p>
<p class="MsoNormal"><span style="color:#1F497D"><p>&nbsp;</p></span></p>
<p class="MsoNormal"><span style="color:#1F497D">JB<p></p></span></p>
<p class="MsoNormal"><span style="color:#1F497D"><p>&nbsp;</p></span></p>
<p class="MsoNormal"><span style="color:#1F497D"><p>&nbsp;</p></span></p>
<div style="border:none;border-left:solid blue 1.5pt;padding:0cm 0cm 0cm 4.0pt">
<div>
<div style="border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0cm 0cm 0cm">
<p class="MsoNormal"><b><span lang="EN-US" style="font-size:10.0pt;font-family:&quot;Tahoma&quot;,&quot;sans-serif&quot;;color:windowtext;mso-fareast-language:EN-GB">From:</span></b><span lang="EN-US" style="font-size:10.0pt;font-family:&quot;Tahoma&quot;,&quot;sans-serif&quot;;color:windowtext;mso-fareast-language:EN-GB">
 hwloc-users [mailto:hwloc-users-bounces@open-mpi.org] <b>On Behalf Of </b>Brice Goglin<br />
<b>Sent:</b> 25 March 2014 08:04<br />
<b>To:</b> Hardware locality user list<br />
<b>Subject:</b> Re: [hwloc-users] BGQ question.<p></p></span></p>
</div>
</div>
<p class="MsoNormal"></p><p>&nbsp;</p>
<div>
<p class="MsoNormal">Le 25/03/2014 07:51, Biddiscombe, John A. a Ã©crit&nbsp;:</p><p></p>
</div>
<blockquote style="margin-top:5.0pt;margin-bottom:5.0pt">
<p class="MsoNormal">I&#8217;m compiling hwloc using clang (bgclang&#43;&#43;11 from ANL) to run on IO nodes af a BGQ. It seems to have compiled ok, and when I run lstopo, I get an output like this (below), which looks reasonable, but there are 15 sockets instead of 16.
 I&#8217;m a little worried because the first time I compiled, I had problems where apps would report an error from HWLOC on start and tell me to set HWLOC_FORCE_BGQ=1. when I did set this env var, it would then report that &#8220;topology became empty&#8221; and the app would
 segfault due to the unexpected return from hwloc presumably.</p><p></p>
</blockquote>
<p class="MsoNormal"><span style="font-size:12.0pt;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;;mso-fareast-language:EN-GB"><br />
Can you give a bit more details on what you did there? I'd like to check if that case should be better supported or not.<br />
<br />
<br />
<p></p></span></p>
<p class="MsoNormal">I wiped everything and recompiled (not sure what I did differently), and now it behaves more sensibly, but with 15 instead of 16 sockets.</p><p></p>
<p class="MsoNormal">&nbsp;</p><p></p>
<p class="MsoNormal">Should IO be worried? </p><p></p>
<p class="MsoNormal" style="margin-bottom:12.0pt"><span style="font-size:12.0pt;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;;mso-fareast-language:EN-GB"><br />
The topology detection is hardwired so you shouldn't worried on the hardware side.<br />
The problem could be related to how you reserved resources before running lstopo.<br />
Does lstopo --whole-system see more sockets?<br />
Does BG_THREADMODEL=2 help?<br />
<br />
Brice<p></p></span></p>
</div>
</div>


<p style="margin-top: 2.5em; margin-bottom: 1em; border-bottom: 1px solid #000"></p><pre class="k9mail"><hr /><br />hwloc-users mailing list<br />hwloc-users@open-mpi.org<br /><a href="http://www.open-mpi.org/mailman/listinfo.cgi/hwloc-users">http://www.open-mpi.org/mailman/listinfo.cgi/hwloc-users</a></pre></blockquote></div></body></html>
