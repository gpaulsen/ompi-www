<html><head></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">The problem is here:<div><br></div><div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* Pack the faulty vpid */</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (ORTE_SUCCESS != (rc = opal_dss.pack(buffer, &amp;proc, 1, ORTE_NAME))) {</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ORTE_ERROR_LOG(rc);</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;goto CLEANUP;</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</div><div><br></div><div>The variable proc is apparently a pointer to orte_process_name_t. You therefore should have packed it like this:</div><div><br></div><div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* Pack the faulty vpid */</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (ORTE_SUCCESS != (rc = opal_dss.pack(buffer, proc, 1, ORTE_NAME))) {</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ORTE_ERROR_LOG(rc);</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;goto CLEANUP;</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</div></div><div><br></div><div>i.e.., without the &amp; in front. Accordingly, the problem was that the HNP was getting garbage for the process name, and thus finding NULL at the specified locations.</div><div><br></div><div>Just for testing, you might want to print out the received process name to ensure your communication is correct :-)</div><div><br></div><div><br></div><div><div>On Mar 22, 2011, at 5:58 AM, Hugo Meyer wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div class="gmail_quote"><div>Thanks again Ralph for your reply.</div><div>&nbsp;</div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex;"><div style="word-wrap:break-word"><div>
<div class="im"><div></div></div>There's your problem - that module is run in the daemon, where the orte_job_data pointer array isn't used. You have to use the orte_local_jobdata and orte_local_children lists instead. So once the HNP replies with the jobid, you look up the orte_odls_job_t for that job from the orte_local_jobdata list.</div>
</div></blockquote><div><br></div><div>I'm sending now to you all the piece of code involved, at the beginning i'm doing something about what you are saying. Then having the child info i ask to the hnp for the jobdata of the child, but i'm still getting no data about the child (that is the dead process). I'm trying to get this info to send info to another orted to restart this failed process.</div>
<div><br></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex;"><div style="word-wrap:break-word"><div><br></div><div>I'm not sure what you are trying to accomplish, so I can't give further advice. Note that daemons have limited knowledge of application processes that are not their own immediate children. What little they know regarding processes other than their own is stored in the nidmap/pidmap arrays - limited to location, local rank, and node rank. They have no storage currently allocated for things like the state of a non-local process.</div>
</div></blockquote><div><br></div><div>I want to restart the process in another node, that's why i'm needing the jobdata. So, the hnp cannot do something like:</div><div><i>jdata = orte_get_job_data_object(proc.jobid))</i>&nbsp;&nbsp;</div>
<div><br></div><div>when the proc doesn't belong to him??</div><div>So where i can obtain this information, because i'm asumming that i cannot ask about the dead process to his daemon (because i assume that the daemon also is dead, but that's not true). I was supossing that in the HNP i could execute the sentence above.</div>
<div><br></div><div>I'm attaching all the code involving the described situation. But i have made some changes after my first email, but what i'm trying to do is basically the same. In the line 23 of the orted_comm.c, that i'm sending, i'm always getting NULL as a result, so i can't obtain the jdata.</div>
<div><br></div><div>Thanks a lot again for your help.</div><div><br></div><div>Best Regards.&nbsp;</div><div><br></div><div>Hugo Meyer</div></div><br>
<span>&lt;orted_comm.c&gt;</span><span>&lt;errmgr_orted.c&gt;</span></blockquote></div><br></div></body></html>
