<html><head><meta http-equiv="Content-Type" content="text/html charset=iso-8859-1"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">Actually, as I look at it, the logic escapes me anyway. Basically, you only have two options - use the vfs struct for Sun, and use fs struct for everything else. I'm not aware of any other choice, and indeed the list of all the systems for the latter actually is intended to amount to "anything else".<div><br></div><div>So I just changed it to an "else" statement in the trunk and scheduled it for 1.7.4 if it passes muster - see how this works for you.</div><div><br></div><div>Ralph</div><div><br></div><div><br><div><div>On Jan 8, 2014, at 4:52 PM, Paul Hargrove &lt;<a href="mailto:phhargrove@lbl.gov">phhargrove@lbl.gov</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div dir="ltr">This partial make output shows a build failure of the current trunk tarball on FreeBSD-9/x86-64:<div><div><font face="courier new, monospace">&nbsp; CC &nbsp; &nbsp; &nbsp; path.lo</font></div><div><font face="courier new, monospace">/home/phargrov/OMPI/openmpi-trunk-freebsd9-amd64/openmpi-1.9a1r30146/opal/util/path.c: In function 'opal_path_df':</font></div>
<div><font face="courier new, monospace">/home/phargrov/OMPI/openmpi-trunk-freebsd9-amd64/openmpi-1.9a1r30146/opal/util/path.c:556: error: 'buf' undeclared (first use in this function)</font></div><div><font face="courier new, monospace">/home/phargrov/OMPI/openmpi-trunk-freebsd9-amd64/openmpi-1.9a1r30146/opal/util/path.c:556: error: (Each undeclared identifier is reported only once</font></div>
<div><font face="courier new, monospace">/home/phargrov/OMPI/openmpi-trunk-freebsd9-amd64/openmpi-1.9a1r30146/opal/util/path.c:556: error: for each function it appears in.)</font></div><div><font face="courier new, monospace">*** [path.lo] Error code 1</font></div>
<div><font face="arial, helvetica, sans-serif"><br></font></div><div><font face="arial, helvetica, sans-serif">Builds of the trunk on NetBSD and OpenBSD fail in the same way.</font></div><div><font face="arial, helvetica, sans-serif"><br>
</font></div><div><font face="arial, helvetica, sans-serif">The code in opal_path_df() seems not to define the variable "buf" unless certain defines are present, but then tries to USE the variable unconditionally. &nbsp;That unconditional use of "buf" is the proximate cause of the failure.</font></div>
<div><br></div><div>A very-likely-related observation:</div><div>The code in opal/util/path.c seems to expect __BSD to be defined under *some* circumstance, but it is not defined by any current {Free,Net,Open}BSD:</div><div>
<br></div><div>FreeBSD-9:</div><div><div><font face="courier new, monospace">$ touch empty.c</font></div><div><font face="courier new, monospace">$ gcc -dM -E empty.c | grep BSD</font></div><div><font face="courier new, monospace">#define __FreeBSD_cc_version 900001</font></div>
<div><font face="courier new, monospace">#define __VERSION__ "4.2.1 20070831 patched [FreeBSD]"</font></div><div><font face="courier new, monospace">#define __FreeBSD__ 9</font></div></div><div><br></div><div>NetBSD-6:</div>
<div><span style="font-family:'courier new',monospace">-bash-4.2$ touch empty.c</span><br></div><div><div><span style="font-family:'courier new',monospace">-bash-4.2$ gcc -dM -E empty.c | grep BSD</span><br>
</div><div><font face="courier new, monospace">#define __NetBSD__ 1</font></div></div><div><font face="courier new, monospace"><br></font></div><div><font face="arial, helvetica, sans-serif">OpenBSD-5:</font></div><div><div>
<font face="courier new, monospace">-bash-4.2$ touch empty.c</font></div><div><font face="courier new, monospace">-bash-4.2$ gcc -dM -E empty.c | grep BSD</font></div><div><font face="courier new, monospace">#define __OpenBSD__ 1</font></div>
</div><div><br></div><div>So, there are TWO issues:</div><div><br></div><div>1) opal_path_df() defines the variable "buf" only conditionally but then uses it UNconditionally.</div><div><br></div><div>2) logic which appears to be intended for at least FreeBSD is probably not reachable in any build.</div>
<div><br></div><div>-Paul</div><div><div><br></div>-- <br><font face="courier new, monospace"><div>Paul H. Hargrove &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div>
<div>Future Technologies Group</div><div>Computer and Data Sciences Department &nbsp; &nbsp; Tel: +1-510-495-2352</div><div>Lawrence Berkeley National Laboratory &nbsp; &nbsp; Fax: +1-510-486-6900</div></font>
</div></div></div>
_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>http://www.open-mpi.org/mailman/listinfo.cgi/devel</blockquote></div><br></div></body></html>
