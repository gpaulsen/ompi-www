<div dir="ltr">I have a system with InifniPath HCAs, where I&#39;ve historically tested mtl:psm.<div>For some reason, that appears to have ceased working some time in the past 4 months.</div><div>However, this report is about something else.</div><div>I am using the current master tarball: openmpi-dev-1203-g171d674.tar.bz2</div><div><br></div><div>When I ran configure, verbs support was found even though it was not my intent to use it.</div><div>So, I am running with an explicit blt list that omits verbs and am disabling the broken mtl:psm and mtl:ofi as well.</div><div>However, I am getting complaints from some verbs-related code:</div><div><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="monospace, monospace" size="1">$ mpirun -mca btl sm,self,tcp -mca mtl ^psm,ofi -np 2 -host n15,n16  examples/ring_c</font></div><div><font face="monospace, monospace" size="1">libibverbs: Warning: couldn&#39;t open config directory &#39;/etc/libibverbs.d&#39;.</font></div><div><font face="monospace, monospace" size="1">libibverbs: Warning: no userspace device-specific driver found for /sys/class/infiniband_verbs/uverbs0</font></div><div><font face="monospace, monospace" size="1">--------------------------------------------------------------------------</font></div><div><font face="monospace, monospace" size="1">Fork support was requested but the library call ibv_fork_init() failed.</font></div><div><font face="monospace, monospace" size="1"><br></font></div><div><font face="monospace, monospace" size="1">  Hostname:    n16</font></div><div><font face="monospace, monospace" size="1">  Error (22):  Invalid argument</font></div><div><font face="monospace, monospace" size="1">--------------------------------------------------------------------------</font></div><div><font face="monospace, monospace" size="1">--------------------------------------------------------------------------</font></div><div><font face="monospace, monospace" size="1">Fork support was requested but the library call ibv_fork_init() failed.</font></div><div><font face="monospace, monospace" size="1"><br></font></div><div><font face="monospace, monospace" size="1">  Hostname:    n15</font></div><div><font face="monospace, monospace" size="1">  Error (22):  Invalid argument</font></div><div><font face="monospace, monospace" size="1">--------------------------------------------------------------------------</font></div><div><font face="monospace, monospace" size="1">--------------------------------------------------------------------------</font></div><div><font face="monospace, monospace" size="1">Fork support was requested but the library call ibv_fork_init() failed.</font></div><div><font face="monospace, monospace" size="1"><br></font></div><div><font face="monospace, monospace" size="1">  Hostname:    n16</font></div><div><font face="monospace, monospace" size="1">  Error (22):  Invalid argument</font></div><div><font face="monospace, monospace" size="1">--------------------------------------------------------------------------</font></div><div><font face="monospace, monospace" size="1">--------------------------------------------------------------------------</font></div><div><font face="monospace, monospace" size="1">Fork support was requested but the library call ibv_fork_init() failed.</font></div><div><font face="monospace, monospace" size="1"><br></font></div><div><font face="monospace, monospace" size="1">  Hostname:    n15</font></div><div><font face="monospace, monospace" size="1">  Error (22):  Invalid argument</font></div><div><font face="monospace, monospace" size="1">--------------------------------------------------------------------------</font></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><font face="monospace, monospace" size="1">Process 0 sending 10 to 1, tag 201 (2 processes in ring)<br></font><font face="monospace, monospace" size="1">Process 0 sent to 1<br></font><font face="monospace, monospace" size="1">Process 0 decremented value: 9<br></font><font face="monospace, monospace" size="1">Process 0 decremented value: 8<br></font><font face="monospace, monospace" size="1">Process 0 decremented value: 7<br></font><font face="monospace, monospace" size="1">Process 0 decremented value: 6<br></font><font face="monospace, monospace" size="1">Process 0 decremented value: 5<br></font><font face="monospace, monospace" size="1">Process 0 decremented value: 4<br></font><font face="monospace, monospace" size="1">Process 0 decremented value: 3<br></font><font face="monospace, monospace" size="1">Process 0 decremented value: 2<br></font><font face="monospace, monospace" size="1">Process 0 decremented value: 1<br></font><font face="monospace, monospace" size="1">Process 0 decremented value: 0<br></font><font face="monospace, monospace" size="1">Process 0 exiting<br></font><font face="monospace, monospace" size="1">Process 1 exiting</font></blockquote><div><br></div><div><br></div><div>There are at least THREE things &quot;wrong&quot; in my opinion.</div><div><br></div><div>The first is the following two lines:</div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><div><font face="monospace, monospace" size="1">libibverbs: Warning: couldn&#39;t open config directory &#39;/etc/libibverbs.d&#39;.</font></div></div><div><div><font face="monospace, monospace" size="1">libibverbs: Warning: no userspace device-specific driver found for /sys/class/infiniband_verbs/uverbs0</font></div></div></blockquote><div><div>However, I can run ibv_devinfo (and see ACTIVE ports) on both of the compute nodes.</div></div><div>So, these appear to me to be a complaint about the login node (which is simply not on the IB network).</div><div>I did not ask for ibv, and even if I did the message about a non-IB login node is just an annoyance.</div><div><br></div><div>The second is the &quot;ibv_fork_init()&quot; message twice per host, again when I have NOT requested btl:verbs. </div><div><br></div><div>The third is that I had to pass so many mca params just to get as far as this!</div><div><br></div><div>I did find that adding &quot;-mca oob tcp&quot; eliminated all the messages.</div><div>So, I am assuming oob:ud is responsible for this mess.</div><div><br></div><div>This does not appear to be a very good default behavior.</div><div>+ I believe oob:ud should *silently* disqualify itself when the node running &quot;mpirun&quot; is not on the IB network.</div><div>+ I don&#39;t know why/when the ibv_fork_init() messages came about but they are quite annoying when I don&#39;t even intend to *use* ibv.</div><div><br></div><div>-Paul</div><div><br clear="all"><div><br></div>-- <br><div class="gmail_signature"><div dir="ltr"><div><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Computer Languages &amp; Systems Software (CLaSS) Group</div><div>Computer Science Department               Tel: +1-510-495-2352</div><div>Lawrence Berkeley National Laboratory     Fax: +1-510-486-6900</div></font></div></div></div>
</div></div>

