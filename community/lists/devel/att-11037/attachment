<html><head></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">Dang! &nbsp;You're absolutely right! &nbsp;Mea culpa.<div><br></div><div>Thanks,</div><div><br><div>
<span class="Apple-style-span" style="border-collapse: separate; color: rgb(0, 0, 0); font-family: 'Helvetica Neue'; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; font-size: medium; ">Larry Baker<br>US Geological Survey<br>650-329-5608<br><a href="mailto:baker@usgs.gov">baker@usgs.gov</a><br><br><br></span>
</div>
<br><div><div>On 24 May 2012, at 1:19 PM, Jeff Squyres wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div>FWIW, I think we imported your patch a while ago. &nbsp;Here it is on the trunk:<br><br><a href="https://svn.open-mpi.org/trac/ompi/browser/trunk/opal/mca/memory/linux/malloc.c#L3933">https://svn.open-mpi.org/trac/ompi/browser/trunk/opal/mca/memory/linux/malloc.c#L3933</a><br><br>And here it is on v1.6:<br><br>https://svn.open-mpi.org/trac/ompi/browser/branches/v1.6/opal/mca/memory/linux/malloc.c#L3933<br><br><br><br>On May 24, 2012, at 2:06 PM, Larry Baker wrote:<br><br><blockquote type="cite">Terry,<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">What you are seeing is a bug in the vectorizer in the Intel 2011.6.233 release. &nbsp;We've talked about this before. &nbsp;You should probably remove that compiler from your system(s). &nbsp;I think the new release of OpenMPI describes this problem, but does not stop if from occurring. &nbsp;I write a patch for ptmalloc2/malloc.c for OpenMPI 1.4.3 which automatically adjusts the optimization level for _int_malloc(), which is where the bug occurs.<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">Larry Baker<br></blockquote><blockquote type="cite">US Geological Survey<br></blockquote><blockquote type="cite">650-329-5608<br></blockquote><blockquote type="cite">baker@usgs.gov<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">---------- Start of Patch ----------<br></blockquote><blockquote type="cite">--- opal/mca/memory/ptmalloc2/malloc.c.original<span class="Apple-tab-span" style="white-space:pre">	</span>2010-04-13 10:30:26.000000000 -0700<br></blockquote><blockquote type="cite">+++ opal/mca/memory/ptmalloc2/malloc.c<span class="Apple-tab-span" style="white-space:pre">	</span>2011-11-04 15:01:37.000000000 -0700<br></blockquote><blockquote type="cite">@@ -2,6 +2,17 @@<br></blockquote><blockquote type="cite"> /* Copyright (c) 2010 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cisco Systems, Inc. &nbsp;All rights reserved.<br></blockquote><blockquote type="cite"> &nbsp;*/<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">+/* With Intel Composer XE V12.1.0, release 2011.6.233, any launch &nbsp;&nbsp;*/<br></blockquote><blockquote type="cite">+/* fails, even before main(), due to a bug in the vectorizer (see &nbsp;&nbsp;*/<br></blockquote><blockquote type="cite">+/* https://svn.open-mpi.org/trac/ompi/changeset/25290). &nbsp;The fix is */<br></blockquote><blockquote type="cite">+/* to disable vectorization by reducing the optimization level to &nbsp;&nbsp;*/<br></blockquote><blockquote type="cite">+/* -O1 for _int_malloc(). &nbsp;The only reliable method to identify &nbsp;&nbsp;&nbsp;&nbsp;*/<br></blockquote><blockquote type="cite">+/* release 2011.6.233 is the predefined __INTEL_COMPILER_BUILD_DATE */<br></blockquote><blockquote type="cite">+/* macro, which will have the value 20110811 (Linux, Windows, and &nbsp;&nbsp;*/<br></blockquote><blockquote type="cite">+/* Mac OS X). &nbsp;(The predefined __INTEL_COMPILER macro is nonsense, &nbsp;*/<br></blockquote><blockquote type="cite">+/* 9999, and both the 2011.6.233 and 2011.7.256 releases identify &nbsp;&nbsp;*/<br></blockquote><blockquote type="cite">+/* themselves as V12.1.0 from the -v command line option.) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br></blockquote><blockquote type="cite">+<br></blockquote><blockquote type="cite"> #define OPAL_DISABLE_ENABLE_MEM_DEBUG 1<br></blockquote><blockquote type="cite"> #include "opal_config.h"<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">@@ -3945,6 +3956,12 @@<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;------------------------------ malloc ------------------------------<br></blockquote><blockquote type="cite"> */<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">+#ifdef __INTEL_COMPILER_BUILD_DATE<br></blockquote><blockquote type="cite">+#if __INTEL_COMPILER_BUILD_DATE == 20110811<br></blockquote><blockquote type="cite">+#pragma GCC optimization_level 1<br></blockquote><blockquote type="cite">+#endif<br></blockquote><blockquote type="cite">+#endif<br></blockquote><blockquote type="cite">+<br></blockquote><blockquote type="cite"> Void_t*<br></blockquote><blockquote type="cite"> _int_malloc(mstate av, size_t bytes)<br></blockquote><blockquote type="cite"> {<br></blockquote><blockquote type="cite">---------- End of Patch ----------<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">On 24 May 2012, at 6:54 AM, TERRY DONTJE wrote:<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite"><blockquote type="cite">I am seeing several Cart Fortran tests (like MPI_Cart_coords_f) segv in opal_memory_ptmalloc2_int_free when OMPI trunk is compiled with icc 12.1.0 for 64 bit on linux. &nbsp;&nbsp;Just wondering if anyone has seen anything similar to this with a different version of icc. &nbsp;Other non-Intel compilers seem to not exhibit this issue.<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite"><br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">-- <br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">Terry D. Dontje | Principal Software Engineer<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">Developer Tools Engineering | +1.781.442.2631<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">Oracle - Performance Technologies<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">95 Network Drive, Burlington, MA 01803<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">Email terry.dontje@oracle.com<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite"><br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite"><br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite"><br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">_______________________________________________<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">devel mailing list<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">devel@open-mpi.org<br></blockquote></blockquote><blockquote type="cite"><blockquote type="cite">http://www.open-mpi.org/mailman/listinfo.cgi/devel<br></blockquote></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">_______________________________________________<br></blockquote><blockquote type="cite">devel mailing list<br></blockquote><blockquote type="cite">devel@open-mpi.org<br></blockquote><blockquote type="cite">http://www.open-mpi.org/mailman/listinfo.cgi/devel<br></blockquote><br><br>-- <br>Jeff Squyres<br>jsquyres@cisco.com<br>For corporate legal information go to: http://www.cisco.com/web/about/doing_business/legal/cri/<br><br><br>_______________________________________________<br>devel mailing list<br>devel@open-mpi.org<br>http://www.open-mpi.org/mailman/listinfo.cgi/devel<br></div></blockquote></div><br></div></body></html>
