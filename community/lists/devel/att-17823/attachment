<div dir="ltr">Ralph<div><br></div><div>mx = Myricom (not Mellanox, which is mxm).<br></div><div>So,  there is probably nobody to fix anything specific to the MX support.</div><div>Thus if this newly reported problem is (as I am going to guess) in config/ompi_check_mx.m4 then it may go unfixed.</div><div>You say you and I are the only ones to care, and I think we both care for reasons related to software quality rather than any desire to use MX.</div><div><br></div><div>However, the LDFLAGS issues with the tests don&#39;t seem to be related to a specific network.</div><div>Unfortunately, I am right now composing an email reporting that you and I arrived at the WRONG fix for that yesterday.</div><div><br></div><div>-Paul</div></div><div class="gmail_extra"><br><div class="gmail_quote">On Mon, Aug 24, 2015 at 10:26 AM, Ralph Castain <span dir="ltr">&lt;<a href="mailto:rhc@open-mpi.org" target="_blank">rhc@open-mpi.org</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div style="word-wrap:break-word">You know, if it wren’t for the impact it would have on our users, I’d almost say that if Mellanox doesn’t care enough to ensure this works, then maybe we should just release and see if someone actually does care?<div><br></div><div>I’ll try again later today if/when I have time. Otherwise, I’ll raise it at tomorrow’s telecon and see if anyone cares enough to fix it. At the moment, it appears only you and I do - and I’m not sure I care enough to keep poking it :-)</div><div><br></div><div>Thanks Paul!</div><div>Ralph</div><div><br><div><blockquote type="cite"><div><div class="h5"><div>On Aug 24, 2015, at 10:19 AM, Paul Hargrove &lt;<a href="mailto:phhargrove@lbl.gov" target="_blank">phhargrove@lbl.gov</a>&gt; wrote:</div><br></div></div><div><div><div class="h5"><div dir="ltr"><div>Sorry to yet again be the bearer of bad news.</div><div><br></div><div>I am now configuring with</div><div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><font face="monospace, monospace" size="1">--prefix=[...] --enable-debug --with-libfabric=/opt/libfabric-1.0.0 --with-mx=/opt/mx2g --disable-dlopen</font></div></blockquote></div><div>This is like the previous configuration that caused problems, but with &quot;--disable-dlopen&quot; instead of &quot;--enable-static --disable-shared&quot;.</div><div><div>I seems that each time I try something new, something else breaks.</div></div><div><br></div><div>The build finishes fine.</div><div>I can compile the examples fine.</div><div>But I once again see a failure to run an example:</div><div><br></div><div><font face="monospace, monospace" size="1">$ mpirun -mca btl sm,self -np 2 examples/ring_c&#39;</font><div><font face="monospace, monospace" size="1">-------------------------------------------------------</font></div><div><font face="monospace, monospace" size="1">Primary job  terminated normally, but 1 process returned</font></div><div><font face="monospace, monospace" size="1">a non-zero exit code.. Per user-direction, the job has been aborted.</font></div><div><font face="monospace, monospace" size="1">-------------------------------------------------------</font></div><div><font face="monospace, monospace" size="1">examples/ring_c: error while loading shared libraries: libmyriexpress.so: cannot open shared object file: No such file or directory</font></div><div><br></div><div>ldd agrees:</div><div><br></div><div><div><font size="1" face="monospace, monospace">$ ldd examples/ring_c</font></div><div><font size="1" face="monospace, monospace">        linux-vdso.so.1 =&gt;  (0x00007fff332f0000)</font></div><div><font size="1" face="monospace, monospace">        libmpi.so.12 =&gt; /scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib/libmpi.so.12 (0x00007f1879305000)</font></div><div><font size="1" face="monospace, monospace">        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f18790d2000)</font></div><div><font size="1" face="monospace, monospace">        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f1878d3e000)</font></div><div><font size="1" face="monospace, monospace">        libibverbs.so.1 =&gt; /usr/lib64/libibverbs.so.1 (0x00007f1878b2c000)</font></div><div><font size="1" face="monospace, monospace">        <span style="background-color:rgb(255,255,0)">libmyriexpress.so =&gt; not found</span></font></div><div><font size="1" face="monospace, monospace">        libfabric.so.1 =&gt; /opt/libfabric-1.0.0/lib/libfabric.so.1 (0x00007f18788fe000)</font></div><div><font size="1" face="monospace, monospace">        libopen-rte.so.12 =&gt; /scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib/libopen-rte.so.12 (0x00007f1878565000)</font></div><div><font size="1" face="monospace, monospace">        libopen-pal.so.13 =&gt; /scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib/libopen-pal.so.13 (0x00007f1878241000)</font></div><div><font size="1" face="monospace, monospace">        libnuma.so.1 =&gt; /usr/lib64/libnuma.so.1 (0x00007f1878036000)</font></div><div><font size="1" face="monospace, monospace">        libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f1877e32000)</font></div><div><font size="1" face="monospace, monospace">        librt.so.1 =&gt; /lib64/librt.so.1 (0x00007f1877c29000)</font></div><div><font size="1" face="monospace, monospace">        libm.so.6 =&gt; /lib64/libm.so.6 (0x00007f18779a5000)</font></div><div><font size="1" face="monospace, monospace">        libutil.so.1 =&gt; /lib64/libutil.so.1 (0x00007f18777a2000)</font></div><div><font size="1" face="monospace, monospace">        /lib64/ld-linux-x86-64.so.2 (0x00007f1879a2a000)</font></div><div><font size="1" face="monospace, monospace">        libnl.so.1 =&gt; /lib64/libnl.so.1 (0x00007f187754f000)</font></div></div><div><br></div><div>However, this time it looks like everything is linked correctly:</div><div><br></div><div><div><font face="monospace, monospace" size="1">$ mpicc --show examples/ring_c.c</font></div><div><font face="monospace, monospace" size="1">gcc examples/ring_c.c -I/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/include -pthread <span style="background-color:rgb(255,255,0)">-L/opt/mx2g/lib</span> -L/opt/libfabric-1.0.0/lib <span style="background-color:rgb(255,255,0)">-Wl,-rpath -Wl,/opt/mx2g/lib</span> -Wl,-rpath -Wl,/opt/libfabric-1.0.0/lib -Wl,-rpath -Wl,/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib -Wl,--enable-new-dtags -L/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib -lmpi</font></div></div><div><br></div><div><font face="monospace, monospace" size="1">$ chrpath --list examples/ring_c</font></div><div><font face="monospace, monospace" size="1">examples/ring_c: RPATH=<span style="background-color:rgb(255,255,0)">/opt/mx2g/lib</span>:/opt/libfabric-1.0.0/lib:/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib</font></div><div><br></div><div><br></div><div>Looking a bit further I find that none of the MPI, OPAL or ORTE libs was built with the MX libdir in its rpath, though MPI and OPAL have libfabric:</div><div><br></div><div><div><font face="monospace, monospace" size="1">$ chrpath --list INST/lib/libmpi.so      </font></div><div><font face="monospace, monospace" size="1">INST/lib/libmpi.so: RPATH=/opt/libfabric-1.0.0/lib:/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib</font></div></div><div><div><font face="monospace, monospace" size="1">$ chrpath --list INST/lib/libopen-pal.so </font></div><div><font face="monospace, monospace" size="1">INST/lib/libopen-pal.so: RPATH=::/opt/libfabric-1.1.0/lib</font></div><div><font face="monospace, monospace" size="1">$ chrpath --list INST/lib/libopen-rte.so  </font></div><div><font face="monospace, monospace" size="1">INST/lib/libopen-rte.so: RPATH=/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib</font></div></div><div><br></div><div><br></div><div>Extracted from the &quot;make V=1&quot; output, here are the (shortened) link commands for libmpi.so:</div><div><br></div><div><div><font face="monospace, monospace" size="1">/bin/sh ../libtool  --tag=CC   --mode=link gcc -std=gnu99  -g -finline-functions -fno-strict-aliasing -pthread -version-info 12:0:0   -o <a href="http://libmpi.la/" target="_blank">libmpi.la</a> -rpath /scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib  [.lo and .la files] -lrt -lm -lutil</font></div><div><font face="monospace, monospace" size="1"><br></font></div><div><font face="monospace, monospace" size="1">libtool: link: gcc -std=gnu99 -shared  -fPIC -DPIC  [.o and .a files] -Wl,--no-whole-archive  -Wl,-rpath -Wl,/opt/libfabric-1.0.0/lib -Wl,-rpath -Wl,/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/BLD/orte/.libs -Wl,-rpath -Wl,/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/BLD/opal/.libs <span style="background-color:rgb(0,255,0)">-Wl,-rpath -Wl,/opt/libfabric-1.0.0/lib</span> -Wl,-rpath -Wl,/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib -L/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/BLD/opal/.libs <span style="background-color:rgb(255,255,0)">-L/opt/mx2g/lib</span> -libverbs <span style="background-color:rgb(255,255,0)">-lmyriexpress</span> <span style="background-color:rgb(0,255,0)">-L/opt/libfabric-1.0.0/lib /opt/libfabric-1.0.0/lib/libfabric.so</span> -lpthread /scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/BLD/orte/.libs/libopen-rte.so /scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/BLD/opal/.libs/libopen-pal.so -lnuma -ldl -lrt -lm -lutil  -pthread   -pthread -Wl,-soname -Wl,libmpi.so.12 -o .libs/libmpi.so.12.0.0</font></div></div><div><br></div><div>The appropriate &quot;-L&quot; and &quot;-l&quot; options are present for libmryiexpress, but there is no corresponding &quot;-Wl,-rpath, -Wl,...&quot;.</div><div><br></div><div>In contrast, libfabric gets  &quot;-L&quot; and &quot;-Wl,-rpath, -Wl,...&quot;.</div><div>Curiously, libfabric.so gets linked by full path, instead of &quot;-lfabric&quot;.</div><div>I am not sure if that difference is meaningful or not, but thought I would mention it just in case it is.</div><div><br></div><div>-Paul</div><div><br></div>-- <br><div><div dir="ltr"><div><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Computer Languages &amp; Systems Software (CLaSS) Group</div><div>Computer Science Department               Tel: <a href="tel:%2B1-510-495-2352" value="+15104952352" target="_blank">+1-510-495-2352</a></div><div>Lawrence Berkeley National Laboratory     Fax: <a href="tel:%2B1-510-486-6900" value="+15104866900" target="_blank">+1-510-486-6900</a></div></font></div></div></div>
</div></div></div></div>
_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org" target="_blank">devel@open-mpi.org</a><br>Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2015/08/17821.php" target="_blank">http://www.open-mpi.org/community/lists/devel/2015/08/17821.php</a></div></blockquote></div><br></div></div><br>_______________________________________________<br>
devel mailing list<br>
<a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2015/08/17822.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/devel/2015/08/17822.php</a><br></blockquote></div><br><br clear="all"><div><br></div>-- <br><div class="gmail_signature"><div dir="ltr"><div><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Computer Languages &amp; Systems Software (CLaSS) Group</div><div>Computer Science Department               Tel: +1-510-495-2352</div><div>Lawrence Berkeley National Laboratory     Fax: +1-510-486-6900</div></font></div></div></div>
</div>

