<html><head><meta http-equiv="Content-Type" content="text/html charset=us-ascii"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">I took care of it - thanks!<div><br><div style=""><div>On Sep 16, 2014, at 7:36 AM, <a href="mailto:tmishima@jcity.maeda.co.jp">tmishima@jcity.maeda.co.jp</a> wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div style="font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Gilles,<br><br>Your patch looks good to me and I think this issue should be fixed<br>in the upcoming openmpi-1.8.3. Could you commit it to the trunk and<br>create a CMR for it?<br><br>Tetsuya<br><br><blockquote type="cite">Mishima-san,<br><br>the root cause is macro expansion does not always occur as one would<br>have expected ...<br><br>could you please give a try to the attached patch ?<br><br>it compiles (at least with gcc) and i made zero tests so far ....<br><br>Cheers,<br><br>Gilles<br><br>On 2014/09/01 10:44, <a href="mailto:tmishima@jcity.maeda.co.jp">tmishima@jcity.maeda.co.jp</a> wrote:<br><blockquote type="cite">Hi folks,<br><br>I tried to build openmpi-1.8.2 with PGI fortran and -i8(64bit fortran<br></blockquote></blockquote>int)<br><blockquote type="cite"><blockquote type="cite">option<br>as shown below:<br><br>./configure \<br>--prefix=/home/mishima/opt/mpi/openmpi-1.8.2-pgi14.7_int64 \<br>--enable-abi-breaking-fortran-status-i8-fix \<br>--with-tm \<br>--with-verbs \<br>--disable-ipv6 \<br>CC=pgcc CFLAGS="-tp k8-64e -fast" \<br>CXX=pgCC CXXFLAGS="-tp k8-64e -fast" \<br>F77=pgfortran FFLAGS="-i8 -tp k8-64e -fast" \<br>FC=pgfortran FCFLAGS="-i8 -tp k8-64e -fast"<br><br>Then I saw this compile error in making oshmem at the last stage:<br><br>if test ! -r pshmem_real8_swap_f.c ; then \<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pname=`echo pshmem_real8_swap_f.c | cut -b '2-'` ; \<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ln -s ../../../../oshmem/shmem/fortran/$pname<br>pshmem_real8_swap_f.c ; \<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi<br>&nbsp;CC &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pshmem_real8_swap_f.lo<br>if test ! -r pshmem_int4_cswap_f.c ; then \<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pname=`echo pshmem_int4_cswap_f.c | cut -b '2-'` ; \<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ln -s ../../../../oshmem/shmem/fortran/$pname<br>pshmem_int4_cswap_f.c ; \<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi<br>&nbsp;CC &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pshmem_int4_cswap_f.lo<br>PGC-S-0058-Illegal lvalue (pshmem_int4_cswap_f.c: 39)<br>PGC/x86-64 Linux 14.7-0: compilation completed with severe errors<br>make[3]: *** [pshmem_int4_cswap_f.lo] Error 1<br>make[3]: Leaving directory<br><br></blockquote></blockquote>`/home/mishima/mis/openmpi/openmpi-pgi14.7/int64/openmpi-1.8.2/oshmem/shmem/fortran/profile'<br><br><blockquote type="cite"><blockquote type="cite">make[2]: *** [all-recursive] Error 1<br>make[2]: Leaving directory<br><br></blockquote></blockquote>`/home/mishima/mis/openmpi/openmpi-pgi14.7/int64/openmpi-1.8.2/oshmem/shmem/fortran'<br><br><blockquote type="cite"><blockquote type="cite">make[1]: *** [all-recursive] Error 1<br>make[1]: Leaving directory<br>`/home/mishima/mis/openmpi/openmpi-pgi14.7/int64/openmpi-1.8.2/oshmem'<br>make: *** [all-recursive] Error 1<br><br>I confirmed that it worked if I added configure option of<br></blockquote></blockquote>--disable-oshmem.<br><blockquote type="cite"><blockquote type="cite">So, I hope that oshmem experts would fix this problem.<br><br>(additional note)<br>I switched to use gnu compiler and checked with this configuration,<br></blockquote></blockquote>then<br><blockquote type="cite"><blockquote type="cite">I got the same error:<br><br>./configure \<br>--prefix=/home/mishima/opt/mpi/openmpi-1.8.2-gnu_int64 \<br>--enable-abi-breaking-fortran-status-i8-fix \<br>--disable-ipv6 \<br>F77=gfortran \<br>FC=gfortran \<br>CC=gcc \<br>CXX=g++ \<br>FFLAGS="-m64 -fdefault-integer-8" \<br>FCFLAGS="-m64 -fdefault-integer-8" \<br>CFLAGS=-m64 \<br>CXXFLAGS=-m64<br><br>make<br>....<br>if test ! -r pshmem_int4_cswap_f.c ; then \<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pname=`echo pshmem_int4_cswap_f.c | cut -b '2-'` ; \<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ln -s ../../../../oshmem/shmem/fortran/$pname<br>pshmem_int4_cswap_f.c ; \<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi<br>&nbsp;CC &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pshmem_int4_cswap_f.lo<br>pshmem_int4_cswap_f.c: In function 'shmem_int4_cswap_f':<br>pshmem_int4_cswap_f.c:39: error: invalid lvalue in unary '&amp;'<br>make[3]: *** [pshmem_int4_cswap_f.lo] Error 1<br><br>Regards<br>Tetsuya Mishima<br><br>_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>Subscription: http://www.open-mpi.org/mailman/listinfo.cgi/devel<br>Link to this post:<br></blockquote></blockquote><a href="http://www.open-mpi.org/community/lists/devel/2014/08/15764.php">http://www.open-mpi.org/community/lists/devel/2014/08/15764.php</a><br><blockquote type="cite"><br>- oshmem.i8.patch_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>Subscription:<br></blockquote><a href="http://www.open-mpi.org/mailman/listinfo.cgi/develSearchable">http://www.open-mpi.org/mailman/listinfo.cgi/develSearchable</a><span class="Apple-converted-space">&nbsp;</span>archives:<br><a href="http://www.open-mpi.org/community/lists/devel/2014/09/index.php">http://www.open-mpi.org/community/lists/devel/2014/09/index.php</a><br><br>_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>Subscription:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>Link to this post:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/community/lists/devel/2014/09/15838.php">http://www.open-mpi.org/community/lists/devel/2014/09/15838.php</a></div></blockquote></div><br></div></body></html>
