<div dir="ltr">Howard,<div><br></div><div>Unless there is some reason the settings must be global, you should be able to set the limits w/o root privs:</div><div><br></div><div>Bourne shells:</div><div><font face="monospace, monospace">    $ ulimit -l 64</font></div><div>C shells:<br></div><div><font face="monospace, monospace">    % limit -h memorylocked 64<br></font></div><div><br></div><div>I would have thought these lines might need to go in a .profile or .cshrc to affect the application processes, but perhaps mpirun propogates the rlimits.</div><div>So, on NERSC&#39;s Carver I can reproduce the problem (in my build of 1.8.5rc2) quite easily (below).</div><div>I have configured with --enable-debug, which probably explains why I see an assertion failure rather than the reported SEGV.</div><div><br></div><div>-Paul<br></div><div><br></div><div><div><font face="monospace, monospace">{hargrove@c1436 BLD}$ ulimit -l 64</font></div><div><font face="monospace, monospace">{hargrove@c1436 BLD}$ mpirun -np 2 examples/ring_c</font></div><div><font face="monospace, monospace">ring_c: /global/homes/h/hargrove/GSCRATCH/OMPI/openmpi-1.8.5rc2-linux-x86_64-static/openmpi-1.8.5rc2/ompi/mca/btl/openib/connect/btl_openib_connect_udcm.c:743: udcm_module_finalize: Assertion `((0xdeafbeedULL &lt;&lt; 32) + 0xdeafbeedULL) == ((opal_object_t *) (&amp;m-&gt;cm_recv_msg_queue))-&gt;obj_magic_id&#39; failed.</font></div><div><font face="monospace, monospace">[c1436:05774] *** Process received signal ***</font></div><div><font face="monospace, monospace">[c1436:05774] Signal: Aborted (6)</font></div><div><font face="monospace, monospace">[c1436:05774] Signal code:  (-6)</font></div><div><font face="monospace, monospace">[c1436:05774] [ 0] /lib64/libpthread.so.0[0x2b4107aabb10]</font></div><div><font face="monospace, monospace">[c1436:05774] [ 1] /lib64/libc.so.6(gsignal+0x35)[0x2b4107ce9265]</font></div><div><font face="monospace, monospace">[c1436:05774] [ 2] /lib64/libc.so.6(abort+0x110)[0x2b4107cead10]</font></div><div><font face="monospace, monospace">[c1436:05774] [ 3] /lib64/libc.so.6(__assert_fail+0xf6)[0x2b4107ce26e6]</font></div><div><font face="monospace, monospace">[c1436:05774] [ 4] examples/ring_c[0x44e8b3]</font></div><div><font face="monospace, monospace">[c1436:05774] [ 5] examples/ring_c[0x44d7e0]</font></div><div><font face="monospace, monospace">[c1436:05774] [ 6] examples/ring_c[0x4464c5]</font></div><div><font face="monospace, monospace">[c1436:05774] [ 7] examples/ring_c[0x442c5c]</font></div><div><font face="monospace, monospace">[c1436:05774] [ 8] examples/ring_c[0x433328]</font></div><div><font face="monospace, monospace">[c1436:05774] [ 9] examples/ring_c[0x43266c]</font></div><div><font face="monospace, monospace">[c1436:05774] [10] examples/ring_c[0x50e460]</font></div><div><font face="monospace, monospace">[c1436:05774] [11] examples/ring_c[0x4d9e09]</font></div><div><font face="monospace, monospace">[c1436:05774] [12] examples/ring_c[0x4d90b0]</font></div><div><font face="monospace, monospace">[c1436:05774] [13] examples/ring_c[0x423e2d]</font></div><div><font face="monospace, monospace">[c1436:05774] [14] examples/ring_c[0x42dceb]</font></div><div><font face="monospace, monospace">[c1436:05774] [15] examples/ring_c[0x407285]</font></div><div><font face="monospace, monospace">[c1436:05774] [16] /lib64/libc.so.6(__libc_start_main+0xf4)[0x2b4107cd6994]</font></div><div><font face="monospace, monospace">[c1436:05774] [17] examples/ring_c[0x407129]</font></div><div><font face="monospace, monospace">[c1436:05774] *** End of error message ***</font></div><div><font face="monospace, monospace">--------------------------------------------------------------------------</font></div><div><font face="monospace, monospace">mpirun noticed that process rank 0 with PID 5774 on node c1436 exited on signal 6 (Aborted).</font></div><div><font face="monospace, monospace">--------------------------------------------------------------------------</font></div></div><div><br></div><div><br></div></div><div class="gmail_extra"><br><div class="gmail_quote">On Wed, Apr 22, 2015 at 9:16 AM, Howard Pritchard <span dir="ltr">&lt;<a href="mailto:hppritcha@gmail.com" target="_blank">hppritcha@gmail.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Hi Raphael,<div><br></div><div>Thanks very much for the patches.  </div><div><br></div><div>Would one of the developers on the list have a system where they</div><div>can make these kernel limit changes and which have HCAs installed?</div><div><br></div><div>I don&#39;t have access to any system where I have such permissions.</div><div><br></div><div>Howard</div><div><br></div></div><div class="gmail_extra"><br><div class="gmail_quote">2015-04-22 8:55 GMT-06:00 Raphaël Fouassier <span dir="ltr">&lt;<a href="mailto:raphael.fouassier@atos.net" target="_blank">raphael.fouassier@atos.net</a>&gt;</span>:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">We are experiencing a bug in OpenMPI in 1.8.4 which happens also on<br>
master: if locked memory limits are too low, a segfault happens<br>
in openib/udcm because some memory is not correctly deallocated.<br>
<br>
To reproduce it, modify /etc/security/limits.conf with:<br>
* soft memlock 64<br>
* hard memlock 64<br>
and launch with mpirun (not in a slurm allocation).<br>
<br>
<br>
I propose 2 patches for 1.8.4 and master (because of the btl move to<br>
opal) which:<br>
- free all allocated ressources<br>
- print the limits error<br>
<br>
<br>_______________________________________________<br>
devel mailing list<br>
<a href="mailto:devel@open-mpi.org" target="_blank">devel@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2015/04/17305.php" target="_blank">http://www.open-mpi.org/community/lists/devel/2015/04/17305.php</a><br></blockquote></div><br></div>
<br>_______________________________________________<br>
devel mailing list<br>
<a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2015/04/17306.php" target="_blank">http://www.open-mpi.org/community/lists/devel/2015/04/17306.php</a><br></blockquote></div><br><br clear="all"><div><br></div>-- <br><div class="gmail_signature"><div dir="ltr"><div><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Computer Languages &amp; Systems Software (CLaSS) Group</div><div>Computer Science Department               Tel: +1-510-495-2352</div><div>Lawrence Berkeley National Laboratory     Fax: +1-510-486-6900</div></font></div></div></div>
</div>

