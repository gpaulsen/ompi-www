<div dir="ltr">Having seen problems with mtl:ofi with &quot;--enable-static --disable-shared&quot;, I tried mtl:psm and mtl:mxm with those options as well.<div><br></div><div>The good news is that mtl:psm was fine, but the bad news is when testing mtl:mxm I encountered a new problem involving coll:hcol.</div><div>Ralph probably wants to strangle me right now...</div><div><br></div><div><br></div><div>I am configuring the 1.10.0rc4 tarball with</div><div><font face="monospace, monospace">   --prefix=[...] --enable-debug --with-verbs --enable-openib-connectx-xrc \</font></div><div><font face="monospace, monospace">   --with-mxm=/opt/mellanox/mxm --with-hcoll=/opt/mellanox/hcoll \</font></div><div><font face="monospace, monospace">   --enable-static --disable-shared</font><br clear="all"><div><br></div><div>Everything was fine without those last two arguments.</div><div>When I add them the build is fine, and I can compile the examples.</div><div>However, I get a SEGV when running an example:</div><div><br></div><div><div><font face="monospace, monospace">$mpirun -np 2 examples/ring_c</font></div><div><font face="monospace, monospace">[mir13:12444:0] Caught signal 11 (Segmentation fault)</font></div><div><font face="monospace, monospace">[mir13:12445:0] Caught signal 11 (Segmentation fault)</font></div><div><font face="monospace, monospace">==== backtrace ====</font></div><div><font face="monospace, monospace">==== backtrace ====</font></div><div><font face="monospace, monospace"> 2 0x0000000000059d9c mxm_handle_error()  /hpc/local/benchmarks/hpc-stack-gcc-Saturday/src/install/mxm-master/</font></div><div><font face="monospace, monospace">src/mxm/util/debug/debug.c:641</font></div><div><font face="monospace, monospace"> 3 0x0000000000059f0c mxm_error_signal_handler()  /hpc/local/benchmarks/hpc-stack-gcc-Saturday/src/install/mxm</font></div><div><font face="monospace, monospace">-master/src/mxm/util/debug/debug.c:616</font></div><div><font face="monospace, monospace"> 4 0x0000003c2e0329a0 killpg()  ??:0</font></div><div><font face="monospace, monospace"> 5 0x0000000000528b51 opal_list_remove_last()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux</font></div><div><font face="monospace, monospace">-x86_64-mxm-static/openmpi-1.10.0rc4/opal/class/opal_list.h:721</font></div><div><font face="monospace, monospace"> 6 0x0000000000529872 base_bcol_basesmuma_setup_library_buffers()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/ope</font></div><div><font face="monospace, monospace">nmpi-1.10.0rc4-linux-x86_64-mxm-static/openmpi-1.10.0rc4/ompi/mca/bcol/basesmuma/bcol_basesmuma_setup.c:537</font></div><div><font face="monospace, monospace"> 7 0x000000000009e983 hmca_bcol_basesmuma_comm_query()  ??:0</font></div><div><font face="monospace, monospace"> 8 0x00000000000348e3 hmca_coll_ml_tree_hierarchy_discovery()  coll_ml_module.c:0</font></div><div><font face="monospace, monospace"> 9 0x00000000000317a2 hmca_coll_ml_comm_query()  ??:0</font></div><div><font face="monospace, monospace">10 0x000000000006c929 hcoll_create_context()  ??:0</font></div><div><font face="monospace, monospace">11 0x00000000004a248f mca_coll_hcoll_comm_query()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-l</font></div><div><font face="monospace, monospace">inux-x86_64-mxm-static/openmpi-1.10.0rc4/ompi/mca/coll/hcoll/coll_hcoll_module.c:290</font></div><div><font face="monospace, monospace">12 0x000000000047c82f query_2_0_0()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x86_64-mx</font></div><div><font face="monospace, monospace">m-static/openmpi-1.10.0rc4/ompi/mca/coll/base/coll_base_comm_select.c:392</font></div><div><font face="monospace, monospace">13 0x000000000047c7ee query()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x86_64-mxm-stat</font></div><div><font face="monospace, monospace">ic/openmpi-1.10.0rc4/ompi/mca/coll/base/coll_base_comm_select.c:375</font></div><div><font face="monospace, monospace">14 0x000000000047c704 check_one_component()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x</font></div><div><font face="monospace, monospace">86_64-mxm-static/openmpi-1.10.0rc4/ompi/mca/coll/base/coll_base_comm_select.c:337</font></div><div><font face="monospace, monospace">15 0x000000000047c567 check_components()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x86_</font></div><div><font face="monospace, monospace">64-mxm-static/openmpi-1.10.0rc4/ompi/mca/coll/base/coll_base_comm_select.c:301</font></div><div><font face="monospace, monospace">16 0x000000000047552a mca_coll_base_comm_select()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-l</font></div><div><font face="monospace, monospace">inux-x86_64-mxm-static/openmpi-1.10.0rc4/ompi/mca/coll/base/coll_base_comm_select.c:131</font></div><div><font face="monospace, monospace">17 0x0000000000428476 ompi_mpi_init()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x86_64-</font></div><div><font face="monospace, monospace">mxm-static/openmpi-1.10.0rc4/ompi/runtime/ompi_mpi_init.c:894</font></div><div><font face="monospace, monospace">18 0x0000000000431ba5 PMPI_Init()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x86_64-mxm-</font></div><div><font face="monospace, monospace">static/BLD/ompi/mpi/c/profile/pinit.c:84</font></div><div><font face="monospace, monospace">19 0x000000000040abce main()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x86_64-mxm-stati</font></div><div><font face="monospace, monospace">c/BLD/examples/ring_c.c:19</font></div><div><font face="monospace, monospace">20 0x0000003c2e01ed1d __libc_start_main()  ??:0</font></div><div><font face="monospace, monospace">21 0x000000000040aae9 _start()  ??:0</font></div></div><div><div><div><font face="monospace, monospace">===================</font></div><div><font face="monospace, monospace"> 2 0x0000000000059d9c mxm_handle_error()  /hpc/local/benchmarks/hpc-stack-gcc-Saturday/src/install/mxm-master/src/mxm/util/debug/debug.c:641</font></div><div><font face="monospace, monospace"> 3 0x0000000000059f0c mxm_error_signal_handler()  /hpc/local/benchmarks/hpc-stack-gcc-Saturday/src/install/mxm-master/src/mxm/util/debug/debug.c:616</font></div><div><font face="monospace, monospace"> 4 0x0000003c2e0329a0 killpg()  ??:0</font></div><div><font face="monospace, monospace"> 5 0x0000000000528b51 opal_list_remove_last()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x86_64-mxm-static/openmpi-1.10.0rc4/opal/class/opal_list.h:721</font></div><div><font face="monospace, monospace"> 6 0x0000000000529872 base_bcol_basesmuma_setup_library_buffers()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x86_64-mxm-static/openmpi-1.10.0rc4/ompi/mca/bcol/basesmuma/bcol_basesmuma_setup.c:537</font></div><div><font face="monospace, monospace"> 7 0x000000000009e983 hmca_bcol_basesmuma_comm_query()  ??:0</font></div><div><font face="monospace, monospace"> 8 0x00000000000348e3 hmca_coll_ml_tree_hierarchy_discovery()  coll_ml_module.c:0</font></div><div><font face="monospace, monospace"> 9 0x00000000000317a2 hmca_coll_ml_comm_query()  ??:0</font></div><div><font face="monospace, monospace">10 0x000000000006c929 hcoll_create_context()  ??:0</font></div><div><font face="monospace, monospace">11 0x00000000004a248f mca_coll_hcoll_comm_query()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x86_64-mxm-static/openmpi-1.10.0rc4/ompi/mca/coll/hcoll/coll_hcoll_module.c:290</font></div><div><font face="monospace, monospace">12 0x000000000047c82f query_2_0_0()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x86_64-mxm-static/openmpi-1.10.0rc4/ompi/mca/coll/base/coll_base_comm_select.c:392</font></div><div><font face="monospace, monospace">13 0x000000000047c7ee query()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x86_64-mxm-static/openmpi-1.10.0rc4/ompi/mca/coll/base/coll_base_comm_select.c:375</font></div><div><font face="monospace, monospace">14 0x000000000047c704 check_one_component()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x86_64-mxm-static/openmpi-1.10.0rc4/ompi/mca/coll/base/coll_base_comm_select.c:337</font></div><div><font face="monospace, monospace">15 0x000000000047c567 check_components()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x86_64-mxm-static/openmpi-1.10.0rc4/ompi/mca/coll/base/coll_base_comm_select.c:301</font></div><div><font face="monospace, monospace">16 0x000000000047552a mca_coll_base_comm_select()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x86_64-mxm-static/openmpi-1.10.0rc4/ompi/mca/coll/base/coll_base_comm_select.c:131</font></div><div><font face="monospace, monospace">17 0x0000000000428476 ompi_mpi_init()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x86_64-mxm-static/openmpi-1.10.0rc4/ompi/runtime/ompi_mpi_init.c:894</font></div><div><font face="monospace, monospace">18 0x0000000000431ba5 PMPI_Init()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x86_64-mxm-static/BLD/ompi/mpi/c/profile/pinit.c:84</font></div><div><font face="monospace, monospace">19 0x000000000040abce main()  /hpc/home/USERS/phhargrove/SCRATCH/OMPI/openmpi-1.10.0rc4-linux-x86_64-mxm-static/BLD/examples/ring_c.c:19</font></div><div><font face="monospace, monospace">20 0x0000003c2e01ed1d __libc_start_main()  ??:0</font></div><div><font face="monospace, monospace">21 0x000000000040aae9 _start()  ??:0</font></div><div><font face="monospace, monospace">===================</font></div><div><font face="monospace, monospace">--------------------------------------------------------------------------</font></div><div><font face="monospace, monospace">mpirun noticed that process rank 1 with PID 12445 on node mir13 exited on signal 13 (Broken pipe).</font></div><div><font face="monospace, monospace">--------------------------------------------------------------------------</font></div></div></div><div><br></div><div>This is reproducible.</div><div>A run with &quot;-np 1&quot; is fine.</div><div><br></div><div>-Paul</div><div><br></div>-- <br><div class="gmail_signature"><div dir="ltr"><div><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Computer Languages &amp; Systems Software (CLaSS) Group</div><div>Computer Science Department               Tel: +1-510-495-2352</div><div>Lawrence Berkeley National Laboratory     Fax: +1-510-486-6900</div></font></div></div></div>
</div></div>

