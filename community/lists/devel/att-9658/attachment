<html><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">Matthew,<div><br></div><div><div><div><div>orte_odls is a global variable defined in odls_base_open.c.</div><div><br></div><div>I used your configure options, but did not override the compiler or compiler flags options. &nbsp;configure used gcc. &nbsp;odls_base_open.c gets compiled and then the object gets inserted into&nbsp;libmca_odls.a. &nbsp;Later, it looks like it also gets inserted into&nbsp;libopen-rte.0.dylib. &nbsp;The link step to create orte-clean references&nbsp;libopen-rte.dylib:</div></div></div><div><br></div><div><blockquote type="cite"><div><font class="Apple-style-span" color="#000000">gcc:</font></div><div><font class="Apple-style-span" color="#000000"><br></font></div><div><font class="Apple-style-span" color="#000000">/bin/sh ../../../libtool --tag=CC &nbsp; --mode=link gcc &nbsp;-O3 -DNDEBUG -finline-functions -fno-strict-aliasing &nbsp;-fvisibility=hidden &nbsp;-export-dynamic &nbsp; -o orte-clean orte-clean.o ../../../orte/libopen-rte.la -lutil</font></div><div><font class="Apple-style-span" color="#000000"><br></font></div><div><font class="Apple-style-span" color="#000000">libtool: link: gcc -O3 -DNDEBUG -finline-functions -fno-strict-aliasing -fvisibility=hidden -o .libs/orte-clean orte-clean.o &nbsp;../../../orte/.libs/libopen-rte.dylib /Users/baker/Desktop/Software/OpenMPI/1.4.3/openmpi-1.4.3/opal/.libs/libopen-pal.dylib -lutil</font></div></blockquote></div><div><div><br></div></div><div>Your link step does not; it references a static version of&nbsp;libopen-rte:</div><div><br></div><div><blockquote type="cite"><div><font class="Apple-style-span" color="#000000">pgcc:</font></div><div><font class="Apple-style-span" color="#000000"><br></font></div><div><font class="Apple-style-span" color="#000000">/bin/sh ../../../libtool --tag=CC &nbsp; --mode=link /opt/pgi/osx86-64/10.9/bin/pgcc &nbsp;-DNDEBUG -O2 -Msignextend -V &nbsp; -export-dynamic &nbsp; -o orte-clean orte-clean.o ../../../orte/libopen-rte.la-lutil &nbsp;</font></div><div><font class="Apple-style-span" color="#000000"><br></font></div><div><font class="Apple-style-span" color="#000000">libtool: link: /opt/pgi/osx86-64/10.9/bin/pgcc -DNDEBUG -O2 -Msignextend -V -o orte-clean orte-clean.o &nbsp;../../../orte/.libs/libopen-rte.a /Users/matt/software/openmpi/openmpi-1.4.3/opal/.libs/libopen-pal.a -lutil</font></div><div><font class="Apple-style-span" color="#000000"><br></font></div><div><font class="Apple-style-span" color="#000000">Undefined symbols for architecture x86_64:</font></div><div><font class="Apple-style-span" color="#000000">&nbsp; "_orte_odls", referenced from:</font></div><div><font class="Apple-style-span" color="#000000">&nbsp; &nbsp; &nbsp; _orte_errmgr_base_error_abort in libopen-rte.a(errmgr_base_fns.o)</font></div><div><font class="Apple-style-span" color="#000000">ld: symbol(s) not found for architecture x86_64</font></div></blockquote></div><div><div><br></div></div><div>I will try to configure my setup to use static libraries and see what changes.</div><div><br></div><div>I think the experiment with -search_paths_first was a red herring. &nbsp;I think&nbsp;odls_base_open.o&nbsp;is not in&nbsp;libopen-rte.a for some reason. &nbsp;Or, the external name that gets defined in&nbsp;odls_base_open.c&nbsp;is not the same as the external name being referenced in&nbsp;errmgr_base_fns.c.</div><div><br></div><div apple-content-edited="true"> <div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div><div><div><div><div><div><div><div><div><div>Larry Baker</div><div>US Geological Survey</div><div>650-329-5608</div><div><a href="mailto:baker@usgs.gov">baker@usgs.gov</a></div></div></div></div></div></div></div></div></div></div></div> </div><br><div><div>On 16 Aug 2011, at 11:53 AM, Matthew Russell wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite">Hi Larry,<div><br></div><div>Thank you for your interest.</div><div><br></div><div>I believe your solution is the right one, however I think there's some other issues causing some problems too.</div><div><br></div><div> When I add the search_paths_first flag to my configure, the command that breaks in the Makefile is,</div><div><br></div><div><div></div> <div><span class="Apple-style-span" style="background-color: rgb(204, 204, 204); "><font class="Apple-style-span" color="#990000" face="'courier new', monospace">libtool: link: /opt/pgi/osx86-64/10.9/bin/pgcc -DNDEBUG -O2 -Msignextend -V -search_paths_first -o orte-clean orte-clean.o &nbsp;../../../orte/.libs/libopen-rte.a /Users/matt/software/openmpi/openmpi-1.4.3/opal/.libs/libopen-pal.a -lutil</font></span></div> <div><span class="Apple-style-span" style="background-color: rgb(204, 204, 204);"><font class="Apple-style-span" color="#990000" face="'courier new', monospace"><b>pgcc-Error-Unknown switch: -search_paths_first</b></font></span></div> <div><span class="Apple-style-span" style="background-color: rgb(204, 204, 204);"><font class="Apple-style-span" color="#990000" face="'courier new', monospace"><br></font></span></div><div><span class="Apple-style-span" style="background-color: rgb(204, 204, 204);"><font class="Apple-style-span" color="#990000" face="'courier new', monospace">pgcc 10.9-0 64-bit target on Apple OS/X -tp nehalem-64&nbsp;</font></span></div> <div><span class="Apple-style-span" style="background-color: rgb(204, 204, 204);"><font class="Apple-style-span" color="#990000" face="'courier new', monospace">Copyright 1989-2000, The Portland Group, Inc. &nbsp;All Rights Reserved.</font></span></div> <div><span class="Apple-style-span" style="background-color: rgb(204, 204, 204);"><font class="Apple-style-span" color="#990000" face="'courier new', monospace">Copyright 2000-2010, STMicroelectronics, Inc. &nbsp;All Rights Reserved.</font></span></div> <div><span class="Apple-style-span" style="background-color: rgb(204, 204, 204);"><font class="Apple-style-span" color="#990000" face="'courier new', monospace">make: *** [orte-clean] Error 1</font></span></div><div> <br></div><div>The problem there is that that libtool isn't passing the "-Wl," along with the search_path_first error, so it isn't getting to the linker. &nbsp;If I try to&nbsp;manually&nbsp;build it, I still have missing symbols:</div> <div><br></div><div><div><font class="Apple-style-span" style="background-color: rgb(204, 204, 204);" color="#990000" face="'courier new', monospace">matt@pontus:orte-clean$ pgcc -DNDEBUG -O2 -Msignextend -V <b>-Wl,-search_paths_first</b> -o orte-clean orte-clean.o &nbsp;../../../orte/.libs/libopen-rte.a /Users/matt/software/openmpi/openmpi-1.4.3/opal/.libs/libopen-pal.a -lutil</font></div> <div><font class="Apple-style-span" style="background-color: rgb(204, 204, 204);" color="#990000" face="'courier new', monospace"><br></font></div><div><font class="Apple-style-span" style="background-color: rgb(204, 204, 204);" color="#990000" face="'courier new', monospace">pgcc 10.9-0 64-bit target on Apple OS/X -tp nehalem-64&nbsp;</font></div> <div><font class="Apple-style-span" style="background-color: rgb(204, 204, 204);" color="#990000" face="'courier new', monospace">Copyright 1989-2000, The Portland Group, Inc. &nbsp;All Rights Reserved.</font></div><div> <font class="Apple-style-span" style="background-color: rgb(204, 204, 204);" color="#990000" face="'courier new', monospace">Copyright 2000-2010, STMicroelectronics, Inc. &nbsp;All Rights Reserved.</font></div><div><font class="Apple-style-span" style="background-color: rgb(204, 204, 204);" color="#990000" face="'courier new', monospace">Undefined symbols for architecture x86_64:</font></div> <div><font class="Apple-style-span" style="background-color: rgb(204, 204, 204);" color="#990000" face="'courier new', monospace">&nbsp; "_orte_odls", referenced from:</font></div><div><font class="Apple-style-span" style="background-color: rgb(204, 204, 204);" color="#990000" face="'courier new', monospace">&nbsp; &nbsp; &nbsp; _orte_errmgr_base_error_abort in libopen-rte.a(errmgr_base_fns.o)</font></div> <div><font class="Apple-style-span" style="background-color: rgb(204, 204, 204);" color="#990000" face="'courier new', monospace">ld: symbol(s) not found for architecture x86_64</font></div></div><div><br></div><div> <br></div><div><br></div><div class="gmail_quote">On Tue, Aug 16, 2011 at 2:46 PM, Larry Baker <span dir="ltr">&lt;<a href="mailto:baker@usgs.gov">baker@usgs.gov</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex;"> <div style="word-wrap:break-word"><div class="im">Matthew,<div><br></div><div>What configure options did you use?</div><div><br></div><div>I can try to replicate your findings, as best I can, using the Intel compiler on my desktop Mac (Leopard). &nbsp;One thing I want to investigate is which libutil is supposed to be linked. &nbsp;There is no -L in the failing link step. &nbsp;Is that possibly the error?</div> <div><br></div><div>I have PGI and about five other compilers on our cluster. &nbsp;I'll get to OpenMPI 1.4.3 with all those as soon as I fetch the latest versions and reinstall my cluster software (Rocks just came out with 5.4.3).</div> </div><div><br><div class="im"><div> <span style="border-collapse:separate;color:rgb(0, 0, 0);font-family:'Helvetica Neue';font-size:medium;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><div style="word-wrap:break-word"> <div><div><div><div><div><div><div><div><div><div>Larry Baker</div><div>US Geological Survey</div><div><a href="tel:650-329-5608" value="+16503295608" target="_blank">650-329-5608</a></div><div><a href="mailto:baker@usgs.gov" target="_blank">baker@usgs.gov</a></div> </div></div></div></div></div></div></div></div></div></div></span> </div><br></div><div><div class="im"><div>On 16 Aug 2011, at 9:44 AM, Matthew Russell wrote:</div><br></div><div><div></div><div class="h5"><blockquote type="cite"> Hmm, I tried the recommendation above, adding -Wl,-search_paths_first, and I still ran into the same issue. &nbsp;I suspect it is an issue with PGI.<div><br></div><div>Meanwhile, I've been able to get my applications (CMAQ) working with MPICH2, so for now at least I am going to continue with that.</div> <div><br></div><div>Thanks for the responses!<br><br><div class="gmail_quote">On Mon, Aug 15, 2011 at 8:43 PM, Ralph Castain <span dir="ltr">&lt;<a href="mailto:rhc@open-mpi.org" target="_blank">rhc@open-mpi.org</a>&gt;</span> wrote:<br> <blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div style="word-wrap:break-word">FWIW: I build OMPI on Mac OS-X (Snow Leopard) every day, without adding any extra flags, without problem. The citation below relates to something from a long time ago, I believe - haven't seen that problem in quite some time.<div> <br></div><div>I do not, however, use PGI. We regularly have problems with PGI on a variety of systems, and I suspect you are hitting one here - but can't confirm it as we don't have PGI licenses to use for testing.<div> <br></div><div>The Xgrid support is broken, but has nothing to do with the problem you describe. Just means you can't launch via Xgrid.<div><div></div><div><br><div><br></div><div><br><div><div>On Aug 15, 2011, at 2:53 PM, Larry Baker wrote:</div> <br><blockquote type="cite"><div style="word-wrap:break-word"><div>Matthew,</div><div><br></div><div>I have the same type of error on a completely different software package on Mac OS X. &nbsp;The error occurs because of the way that Mac OS X searches for -lutil. &nbsp;If the libutil.a ORTE needs is theirs, i.e., not the system libutil.dylib, then you have exactly the same problem I did.</div> <div><br></div><div>Here are my notes for the fix using gcc. &nbsp;You will have to find out the equivalent method to pass the&nbsp;-search_paths_first&nbsp;linker option using pgcc.</div><div><br></div><div></div><blockquote type="cite"> <div># Mac OS X searches for shared libraries before static libraries. &nbsp;Thus, -L&lt;ours&gt; -lutil finds the system libutil.dylib</div><div># before our libutil.a, which causes undefined references in the link step because it is using the wrong library. &nbsp;The</div> <div># ld -search_paths_first option forces ld to search each directory first for a matching library, instead of all directories</div><div># first for a shared library.</div><div># Note: this is the form to pass -search_paths_first to ld when $(CC) is the linker command in makefile.ux</div> <div>export LDFLAGS=-Wl,-search_paths_first</div></blockquote><div><br></div><div> <div style="word-wrap:break-word"><div><div><div><div><div><div><div><div><div><div>Larry Baker</div><div>US Geological Survey</div><div> <a href="tel:650-329-5608" value="+16503295608" target="_blank">650-329-5608</a></div> <div><a href="mailto:baker@usgs.gov" target="_blank">baker@usgs.gov</a></div></div></div></div></div></div></div></div></div></div></div> </div><br><div><div>On 15 Aug 2011, at 1:01 PM, Matthew Russell wrote:</div><br><blockquote type="cite"> <div class="gmail_quote"><br><br>I hope this problem merits being posted here.<div><br></div><div>On OS X (Snow Leopard, and Lion), I cannot seem to build Open MPI.</div> <div><br></div><div>After a lot of building, I get the error:</div> <div><br></div><div> <div>/bin/sh ../../../libtool --tag=CC &nbsp; --mode=link /opt/pgi/osx86-64/10.9/bin/pgcc &nbsp;-DNDEBUG -O2 -Msignextend -V &nbsp; -export-dynamic &nbsp; -o orte-clean orte-clean.o ../../../orte/libopen-rte.la-lutil &nbsp;</div> <div>libtool: link: /opt/pgi/osx86-64/10.9/bin/pgcc -DNDEBUG -O2 -Msignextend -V -o orte-clean orte-clean.o &nbsp;../../../orte/.libs/libopen-rte.a /Users/matt/software/openmpi/openmpi-1.4.3/opal/.libs/libopen-pal.a -lutil</div> <div>Undefined symbols for architecture x86_64:</div><div>&nbsp; "_orte_odls", referenced from:</div><div>&nbsp; &nbsp; &nbsp; _orte_errmgr_base_error_abort in libopen-rte.a(errmgr_base_fns.o)</div><div>ld: symbol(s) not found for architecture x86_64</div> </div><div><br></div><div>This is with the PGI 10.9 compiler, OpenMPI 1.4.3, platform is 86x64</div><div><br></div><div>The README does not list PGI as a compiler that OpenMPI was tested with, and there are notes about it's support for XGrid being broken (I'm not sure if this is related.)</div> <div><br></div><div>I seem to get the error regardless of which configure flags I'm using, just for completeness though, here are the flags I am using:</div><div>./configure --prefix=/usr/local/openmpi_pg --enable-mpi-f77 --enable-mpi-f90 --with-memory-manager=none</div> <div><br></div><div>Has anyone else got or fixed this error?</div><div><br></div><div>I looked at other postings in this list, such as&nbsp;<a href="http://www.open-mpi.org/community/lists/devel/2007/05/1590.php" target="_blank">http://www.open-mpi.org/community/lists/devel/2007/05/1590.php</a> , but they didn't help much.</div> </div><br> _______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org" target="_blank">devel@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a></blockquote> </div><br></div>_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org" target="_blank">devel@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a></blockquote> </div><br></div></div></div></div></div></div><br>_______________________________________________<br> devel mailing list<br> <a href="mailto:devel@open-mpi.org" target="_blank">devel@open-mpi.org</a><br> <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br> <br></blockquote></div><br></div> _______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org" target="_blank">devel@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a></blockquote> </div></div></div><br></div></div></blockquote></div><br></div></blockquote></div><br></div></body></html>
