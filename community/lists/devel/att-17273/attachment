<div dir="ltr">Hi guys,<div><br></div><div style>I faced with an issue on our cluster related to mapping &amp; binding policies on 1.8.5.</div><div style><br></div><div style>The matter is that --report-bindings output doesn&#39;t correspond to the locale. It looks like there is a mistake on the output itself, because it just puts serial core number while that core can be on another socket. For example,</div><div style><br></div><div style><div>mpirun -np 2 --display-devel-map --report-bindings --map-by <b>socket</b> hostname</div><div> Data for JOB [43064,1] offset 0</div><div><br></div><div> Mapper requested: NULL  Last mapper: round_robin  Mapping policy: BYSOCKET  Ranking policy: SOCKET</div><div> Binding policy: CORE  Cpu set: NULL  PPR: NULL  Cpus-per-rank: 1</div><div> <span class="" style="white-space:pre">	</span>Num new daemons: 0<span class="" style="white-space:pre">	</span>New daemon starting vpid INVALID</div><div> <span class="" style="white-space:pre">	</span>Num nodes: 1</div><div><br></div><div> Data for node: clx-orion-001<span class="" style="white-space:pre">	</span> <span class="" style="white-space:pre">	</span>Launch id: -1<span class="" style="white-space:pre">	</span>State: 2</div><div> <span class="" style="white-space:pre">	</span>Daemon: [[43064,0],0]<span class="" style="white-space:pre">	</span>Daemon launched: True</div><div> <span class="" style="white-space:pre">	</span>Num slots: 28<span class="" style="white-space:pre">	</span>Slots in use: 2<span class="" style="white-space:pre">	</span>Oversubscribed: FALSE</div><div> <span class="" style="white-space:pre">	</span>Num slots allocated: 28<span class="" style="white-space:pre">	</span>Max slots: 0</div><div> <span class="" style="white-space:pre">	</span>Username on node: NULL</div><div> <span class="" style="white-space:pre">	</span>Num procs: 2<span class="" style="white-space:pre">	</span>Next node_rank: 2</div><div> <span class="" style="white-space:pre">	</span>Data for proc: [[43064,1],0]</div><div> <span class="" style="white-space:pre">		</span>Pid: 0<span class="" style="white-space:pre">	</span>Local rank: 0<span class="" style="white-space:pre">	</span>Node rank: 0<span class="" style="white-space:pre">	</span>App rank: 0</div><div> <span class="" style="white-space:pre">		</span>State: INITIALIZED<span class="" style="white-space:pre">	</span>Restarts: 0<span class="" style="white-space:pre">	</span>App_context: 0<span class="" style="white-space:pre">	</span><b>Locale: 0-6,14-20</b><span class="" style="white-space:pre">	</span>Bind location: 0<span class="" style="white-space:pre">	</span>Binding: 0</div><div> <span class="" style="white-space:pre">	</span>Data for proc: [[43064,1],1]</div><div> <span class="" style="white-space:pre">		</span>Pid: 0<span class="" style="white-space:pre">	</span>Local rank: 1<span class="" style="white-space:pre">	</span>Node rank: 1<span class="" style="white-space:pre">	</span>App rank: 1</div><div> <span class="" style="white-space:pre">		</span>State: INITIALIZED<span class="" style="white-space:pre">	</span>Restarts: 0<span class="" style="white-space:pre">	</span>App_context: 0<span class="" style="white-space:pre">	</span><b>Locale: 7-13,21-27</b><span class="" style="white-space:pre">	</span>Bind location: 7<span class="" style="white-space:pre">	</span>Binding: 7</div><div>[clx-orion-001:26951] MCW rank 0 bound to socket 0[<b>core 0[</b>hwt 0]]: [B/././././././././././././.][./././././././././././././.]</div><div>[clx-orion-001:26951] MCW rank 1 bound to socket 1[<b>core 14</b>[hwt 0]]: [./././././././././././././.][B/././././././././././././.]</div><div><br></div><div style>The second process should be bound at core 7 (not core 14).</div><div style><br></div><div style><br></div><div style>Another example:</div><div style><div>mpirun -np 8 --display-devel-map --report-bindings --map-by core hostname</div><div> Data for JOB [43202,1] offset 0</div><div><br></div><div> Mapper requested: NULL  Last mapper: round_robin  Mapping policy: BYCORE  Ranking policy: CORE</div><div> Binding policy: CORE  Cpu set: NULL  PPR: NULL  Cpus-per-rank: 1</div><div> <span class="" style="white-space:pre">	</span>Num new daemons: 0<span class="" style="white-space:pre">	</span>New daemon starting vpid INVALID</div><div> <span class="" style="white-space:pre">	</span>Num nodes: 1</div><div><br></div><div> Data for node: clx-orion-001<span class="" style="white-space:pre">	</span> <span class="" style="white-space:pre">	</span>Launch id: -1<span class="" style="white-space:pre">	</span>State: 2</div><div> <span class="" style="white-space:pre">	</span>Daemon: [[43202,0],0]<span class="" style="white-space:pre">	</span>Daemon launched: True</div><div> <span class="" style="white-space:pre">	</span>Num slots: 28<span class="" style="white-space:pre">	</span>Slots in use: 8<span class="" style="white-space:pre">	</span>Oversubscribed: FALSE</div><div> <span class="" style="white-space:pre">	</span>Num slots allocated: 28<span class="" style="white-space:pre">	</span>Max slots: 0</div><div> <span class="" style="white-space:pre">	</span>Username on node: NULL</div><div> <span class="" style="white-space:pre">	</span>Num procs: 8<span class="" style="white-space:pre">	</span>Next node_rank: 8</div><div> <span class="" style="white-space:pre">	</span>Data for proc: [[43202,1],0]</div><div> <span class="" style="white-space:pre">		</span>Pid: 0<span class="" style="white-space:pre">	</span>Local rank: 0<span class="" style="white-space:pre">	</span>Node rank: 0<span class="" style="white-space:pre">	</span>App rank: 0</div><div> <span class="" style="white-space:pre">		</span>State: INITIALIZED<span class="" style="white-space:pre">	</span>Restarts: 0<span class="" style="white-space:pre">	</span>App_context: 0<span class="" style="white-space:pre">	</span>Locale: 0<span class="" style="white-space:pre">	</span>Bind location: 0<span class="" style="white-space:pre">	</span>Binding: 0</div><div> <span class="" style="white-space:pre">	</span>Data for proc: [[43202,1],1]</div><div> <span class="" style="white-space:pre">		</span>Pid: 0<span class="" style="white-space:pre">	</span>Local rank: 1<span class="" style="white-space:pre">	</span>Node rank: 1<span class="" style="white-space:pre">	</span>App rank: 1</div><div> <span class="" style="white-space:pre">		</span>State: INITIALIZED<span class="" style="white-space:pre">	</span>Restarts: 0<span class="" style="white-space:pre">	</span>App_context: 0<span class="" style="white-space:pre">	</span>Locale: 1<span class="" style="white-space:pre">	</span>Bind location: 1<span class="" style="white-space:pre">	</span>Binding: 1</div><div> <span class="" style="white-space:pre">	</span>Data for proc: [[43202,1],2]</div><div> <span class="" style="white-space:pre">		</span>Pid: 0<span class="" style="white-space:pre">	</span>Local rank: 2<span class="" style="white-space:pre">	</span>Node rank: 2<span class="" style="white-space:pre">	</span>App rank: 2</div><div> <span class="" style="white-space:pre">		</span>State: INITIALIZED<span class="" style="white-space:pre">	</span>Restarts: 0<span class="" style="white-space:pre">	</span>App_context: 0<span class="" style="white-space:pre">	</span>Locale: 2<span class="" style="white-space:pre">	</span>Bind location: 2<span class="" style="white-space:pre">	</span>Binding: 2</div><div> <span class="" style="white-space:pre">	</span>Data for proc: [[43202,1],3]</div><div> <span class="" style="white-space:pre">		</span>Pid: 0<span class="" style="white-space:pre">	</span>Local rank: 3<span class="" style="white-space:pre">	</span>Node rank: 3<span class="" style="white-space:pre">	</span>App rank: 3</div><div> <span class="" style="white-space:pre">		</span>State: INITIALIZED<span class="" style="white-space:pre">	</span>Restarts: 0<span class="" style="white-space:pre">	</span>App_context: 0<span class="" style="white-space:pre">	</span>Locale: 3<span class="" style="white-space:pre">	</span>Bind location: 3<span class="" style="white-space:pre">	</span>Binding: 3</div><div> <span class="" style="white-space:pre">	</span>Data for proc: [[43202,1],4]</div><div> <span class="" style="white-space:pre">		</span>Pid: 0<span class="" style="white-space:pre">	</span>Local rank: 4<span class="" style="white-space:pre">	</span>Node rank: 4<span class="" style="white-space:pre">	</span>App rank: 4</div><div> <span class="" style="white-space:pre">		</span>State: INITIALIZED<span class="" style="white-space:pre">	</span>Restarts: 0<span class="" style="white-space:pre">	</span>App_context: 0<span class="" style="white-space:pre">	</span>Locale: 4<span class="" style="white-space:pre">	</span>Bind location: 4<span class="" style="white-space:pre">	</span>Binding: 4</div><div> <span class="" style="white-space:pre">	</span>Data for proc: [[43202,1],5]</div><div> <span class="" style="white-space:pre">		</span>Pid: 0<span class="" style="white-space:pre">	</span>Local rank: 5<span class="" style="white-space:pre">	</span>Node rank: 5<span class="" style="white-space:pre">	</span>App rank: 5</div><div> <span class="" style="white-space:pre">		</span>State: INITIALIZED<span class="" style="white-space:pre">	</span>Restarts: 0<span class="" style="white-space:pre">	</span>App_context: 0<span class="" style="white-space:pre">	</span>Locale: 5<span class="" style="white-space:pre">	</span>Bind location: 5<span class="" style="white-space:pre">	</span>Binding: 5</div><div> <span class="" style="white-space:pre">	</span>Data for proc: [[43202,1],6]</div><div> <span class="" style="white-space:pre">		</span>Pid: 0<span class="" style="white-space:pre">	</span>Local rank: 6<span class="" style="white-space:pre">	</span>Node rank: 6<span class="" style="white-space:pre">	</span>App rank: 6</div><div> <span class="" style="white-space:pre">		</span>State: INITIALIZED<span class="" style="white-space:pre">	</span>Restarts: 0<span class="" style="white-space:pre">	</span>App_context: 0<span class="" style="white-space:pre">	</span>Locale: 6<span class="" style="white-space:pre">	</span>Bind location: 6<span class="" style="white-space:pre">	</span>Binding: 6</div><div> <span class="" style="white-space:pre">	</span>Data for proc: [[43202,1],7]</div><div> <span class="" style="white-space:pre">		</span>Pid: 0<span class="" style="white-space:pre">	</span>Local rank: 7<span class="" style="white-space:pre">	</span>Node rank: 7<span class="" style="white-space:pre">	</span>App rank: 7</div><div> <span class="" style="white-space:pre">		</span>State: INITIALIZED<span class="" style="white-space:pre">	</span>Restarts: 0<span class="" style="white-space:pre">	</span>App_context: 0<span class="" style="white-space:pre">	</span><b>Locale: 14</b><span class="" style="white-space:pre">	</span>Bind location: 14<span class="" style="white-space:pre">	</span>Binding: 14</div><div>[clx-orion-001:27069] MCW rank 0 bound to socket 0[core 0[hwt 0]]: [B/././././././././././././.][./././././././././././././.]</div><div>[clx-orion-001:27069] MCW rank 1 bound to socket 0[core 1[hwt 0]]: [./B/./././././././././././.][./././././././././././././.]</div><div>[clx-orion-001:27069] MCW rank 2 bound to socket 0[core 2[hwt 0]]: [././B/././././././././././.][./././././././././././././.]</div><div>[clx-orion-001:27069] MCW rank 3 bound to socket 0[core 3[hwt 0]]: [./././B/./././././././././.][./././././././././././././.]</div><div>[clx-orion-001:27069] MCW rank 4 bound to socket 0[core 4[hwt 0]]: [././././B/././././././././.][./././././././././././././.]</div><div>[clx-orion-001:27069] MCW rank 5 bound to socket 0[core 5[hwt 0]]: [./././././B/./././././././.][./././././././././././././.]</div><div>[clx-orion-001:27069] MCW rank 6 bound to socket 0[core 6[hwt 0]]: [././././././B/././././././.][./././././././././././././.]</div><div>[clx-orion-001:27069] MCW rank 7 bound to socket 0[<b>core 7</b>[hwt 0]]: [./././././././B/./././././.][./././././././././././././.]</div><div><br></div><div style>Rank 7 should be bound at core 14 instead of core 7 since core 7 is at another socket.</div><div style><br></div><div style>Best regards,</div><div style>Elena</div><div style><br></div><div style><br></div></div></div></div>

