<html><head><meta http-equiv="Content-Type" content="text/html charset=windows-1252"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><br><div><div>On Jul 30, 2014, at 5:25 PM, George Bosilca &lt;<a href="mailto:bosilca@icl.utk.edu">bosilca@icl.utk.edu</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div style="font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br>On Jul 30, 2014, at 18:00 , Jeff Squyres (jsquyres) &lt;<a href="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a>&gt; wrote:<br><br><blockquote type="cite">WHAT: Should we make the job size (i.e., initial number of procs) available in OPAL?<br><br>WHY: At least 2 BTLs are using this info (*more below)<br><br>WHERE: usnic and ugni<br><br>TIMEOUT: there's already been some inflammatory emails about this; let's discuss next Tuesday on the teleconf: Tue, 5 Aug 2014<br><br>MORE DETAIL:<br><br>This is an open question. &nbsp;We *have* the information at the time that the BTLs are initialized: do we allow that information to go down to OPAL?<br><br>Ralph added this info down in OPAL in r32355, but George reverted it in r32361.<br><br>Points for: YES, WE SHOULD<br>+++ 2 BTLs were using it (usinc, ugni)<br>+++ Other RTE job-related info are already in OPAL (num local ranks, local rank)<br><br>Points for: NO, WE SHOULD NOT<br>--- What exactly is this number (e.g., num currently-connected procs?), and when is it updated?<br>--- We need to precisely delineate what belongs in OPAL vs. above-OPAL<br></blockquote>--- Using this information to configure the communication environment limits the scope of communication substrate to a static application (in number of participants). Under this assumption, one can simply wait until the first add_proc to compute the number of processes, solution as “correct” as the current one.<br></div></blockquote><div><br></div>Not necessarily - it depends on how it is used, and how it is communicated. Some of us have explored other options for using this that aren't static, but where the info is of use.</div><div><br><blockquote type="cite"><div style="font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br><blockquote type="cite"><br></blockquote>The other “global” information that were made available in OPAL (num_local_peers and my_local_rank) are only used by local BTL (SM, SMCUDA and VADER). Moreover, my_local_rank is only used to decide who initialize the backend file, thing that can easily be done using an atomic operation. The number of local processes is used to prevent SM from activating itself if we don’t have at least 2 processes per node. So, their usage is minimally invasive, and can eventually be phased out with a little effort.<br></div></blockquote><div><br></div>FWIW: the new PMI abstraction is in OPAL because it is RTE-agnostic. So all the info being discussed will actually be captured originally in the OPAL layer, &nbsp;and stored in the OPAL dstore framework. In the current code, the RTE grabs the data and exposes it to the OMPI layer, which then pushes it back down to the OPAL proc.h struct.</div><div><br></div><div>&lt;shrug&gt; since anyone can freely query the info from opal/pmix or opal/dstore, it is really irrelevant in some ways. The info is there, in the OPAL layer, prior to BTL's being initialized. If you don't want it in a global storage, people can just get it from the appropriate OPAL API.</div><div><br></div><div>So what are we actually debating here? Global storage vs API call?</div><div><br><blockquote type="cite"><div style="font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br>&nbsp;George.<br><br><br><blockquote type="cite">FWIW: here's how ompi_process_info.num_procs was used before the BTL move down to OPAL:<br><br>- usnic: for a minor latency optimization / sizing of a shared receive buffer queue length, and for the initial size of a peer lookup hash<br>- ugni: to determine the size of the per-peer buffers used for send/recv communication<br><br>--<span class="Apple-converted-space">&nbsp;</span><br>Jeff Squyres<br><a href="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a><br>For corporate legal information go to: http://www.cisco.com/web/about/doing_business/legal/cri/<br><br>_______________________________________________<br>devel mailing list<br>devel@open-mpi.org<br>Subscription: http://www.open-mpi.org/mailman/listinfo.cgi/devel<br>Link to this post: http://www.open-mpi.org/community/lists/devel/2014/07/15373.php<br></blockquote><br>_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>Subscription:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>Link to this post:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/community/lists/devel/2014/07/15378.php">http://www.open-mpi.org/community/lists/devel/2014/07/15378.php</a></div></blockquote></div><br></body></html>
