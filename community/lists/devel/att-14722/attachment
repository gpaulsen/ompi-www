<html><head><meta http-equiv="Content-Type" content="text/html charset=windows-1252"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">Strange. The outcome and the timing of this issue seems to highlight a link with the other datatype-related issue you reported earlier, and as suggested by Ralph with Gilles scif+vader issue.<div><br></div><div>Generally speaking, the mechanism used to split the data in the case of multiple BTLs, is identical to the one used to split the data in fragments. So, if the culprit is in the splitting logic, one might see some weirdness as soon as we force the exclusive usage of the send protocol, with an unconventional fragment size.</div><div><br></div><div>In other words using the following flags “—mca btl tcp,self —mca btl_tcp_flags 3 —mca&nbsp;btl_tcp_rndv_eager_limit 23 —mca&nbsp;btl_tcp_eager_limit 23 —mca&nbsp;btl_tcp_max_send_size 23” should always transfer wrong data, even when only one single BTL is in play.</div><div><br></div><div>&nbsp; George.</div><div><br><div><div>On May 7, 2014, at 13:11 , Rolf vandeVaart &lt;<a href="mailto:rvandevaart@nvidia.com">rvandevaart@nvidia.com</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div lang="EN-US" link="blue" vlink="purple" style="font-family: CourierNewPSMT; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div class="WordSection1" style="page: WordSection1;"><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125);">OK.&nbsp; So, I investigated a little more.&nbsp; I only see the issue when I am running with multiple ports enabled such that I have two openib BTLs instantiated.&nbsp; In addition, large message RDMA has to be enabled.&nbsp; If those conditions are not met, then I do not see the problem.&nbsp; For example:<o:p></o:p></span></div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125);">FAILS:<o:p></o:p></span></div><div style="margin: 0in 0in 0.0001pt 0.5in; font-size: 12pt; font-family: 'Times New Roman', serif; text-indent: -0.25in;"><span style="font-size: 11pt; font-family: Wingdings; color: rgb(31, 73, 125);"><span>Ø<span style="font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-family: 'Times New Roman';">&nbsp;<span class="Apple-converted-space">&nbsp;</span></span></span></span><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125);">mpirun –np 2 –host host1,host2 –mca btl_openib_if_include mlx5_0:1,mlx5_0:2 –mca btl_openib_flags 3 MPI_Isend_ator_c<o:p></o:p></span></div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125);">PASS:<o:p></o:p></span></div><div style="margin: 0in 0in 0.0001pt 0.5in; font-size: 12pt; font-family: 'Times New Roman', serif; text-indent: -0.25in;"><span style="font-size: 11pt; font-family: Wingdings; color: rgb(31, 73, 125);"><span>Ø<span style="font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-family: 'Times New Roman';">&nbsp;<span class="Apple-converted-space">&nbsp;</span></span></span></span><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125);">mpirun –np 2 –host host1,host2 –mca btl_openib_if_include mlx5_0:1 –mca btl_openib_flags 3 MPI_Isend_ator_c<o:p></o:p></span></div><div style="margin: 0in 0in 0.0001pt 0.5in; font-size: 12pt; font-family: 'Times New Roman', serif; text-indent: -0.25in;"><span style="font-size: 11pt; font-family: Wingdings; color: rgb(31, 73, 125);"><span>Ø<span style="font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-family: 'Times New Roman';">&nbsp;<span class="Apple-converted-space">&nbsp;</span></span></span></span><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125);">mpirun –np 2 –host host1,host2 –mca btl_openib_if_include_mlx5:0:1,mlx5_0:2 –mca btl_openib_flags 1 MPI_Isend_ator_c<o:p></o:p></span></div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125);">&nbsp;</span></div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125);">So we must have some type of issue when we break up the message between the two openib BTLs.&nbsp; Maybe someone else can confirm my observations?<o:p></o:p></span></div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125);">I was testing against the latest trunk.<o:p></o:p></span></div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125);">&nbsp;</span></div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125);">Rolf<o:p></o:p></span></div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 11pt; font-family: Calibri, sans-serif; color: rgb(31, 73, 125);">&nbsp;</span></div><div style="border-style: none none none solid; border-left-color: blue; border-left-width: 1.5pt; padding: 0in 0in 0in 4pt;"><div><div style="border-style: solid none none; border-top-color: rgb(181, 196, 223); border-top-width: 1pt; padding: 3pt 0in 0in;"><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><b><span style="font-size: 10pt; font-family: Tahoma, sans-serif;">From:</span></b><span style="font-size: 10pt; font-family: Tahoma, sans-serif;"><span class="Apple-converted-space">&nbsp;</span>devel [<a href="mailto:devel-bounces@open-mpi.org" style="color: purple; text-decoration: underline;">mailto:devel-bounces@open-mpi.org</a>]<span class="Apple-converted-space">&nbsp;</span><b>On Behalf Of<span class="Apple-converted-space">&nbsp;</span></b>Joshua Ladd<br><b>Sent:</b><span class="Apple-converted-space">&nbsp;</span>Wednesday, May 07, 2014 10:48 AM<br><b>To:</b><span class="Apple-converted-space">&nbsp;</span>Open MPI Developers<br><b>Subject:</b><span class="Apple-converted-space">&nbsp;</span>Re: [OMPI devel] regression with derived datatypes<o:p></o:p></span></div></div></div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><o:p>&nbsp;</o:p></div><div><div><div><p class="MsoNormal" style="margin: 0in 0in 12pt; font-size: 12pt; font-family: 'Times New Roman', serif;">Rolf,<o:p></o:p></p></div><p class="MsoNormal" style="margin: 0in 0in 12pt; font-size: 12pt; font-family: 'Times New Roman', serif;">This was run on a Sandy Bridge system with ConnectX-3 cards.<o:p></o:p></p></div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;">Josh<o:p></o:p></div></div><div><p class="MsoNormal" style="margin: 0in 0in 12pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><o:p>&nbsp;</o:p></p><div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;">On Wed, May 7, 2014 at 10:46 AM, Joshua Ladd &lt;<a href="mailto:jladd.mlnx@gmail.com" target="_blank" style="color: purple; text-decoration: underline;">jladd.mlnx@gmail.com</a>&gt; wrote:<o:p></o:p></div><div><div><p class="MsoNormal" style="margin: 0in 0in 12pt; font-size: 12pt; font-family: 'Times New Roman', serif;">Elena, can you run your reproducer on the trunk, please, and see if the problem persists?<o:p></o:p></p></div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;">Josh<o:p></o:p></div></div><div><p class="MsoNormal" style="margin: 0in 0in 12pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><o:p>&nbsp;</o:p></p><div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;">On Wed, May 7, 2014 at 10:26 AM, Jeff Squyres (jsquyres) &lt;<a href="mailto:jsquyres@cisco.com" target="_blank" style="color: purple; text-decoration: underline;">jsquyres@cisco.com</a>&gt; wrote:<o:p></o:p></div><div><p class="MsoNormal" style="margin: 0in 0in 12pt; font-size: 12pt; font-family: 'Times New Roman', serif;">On May 7, 2014, at 10:03 AM, Elena Elkina &lt;<a href="mailto:elena.elkina@itseez.com" target="_blank" style="color: purple; text-decoration: underline;">elena.elkina@itseez.com</a>&gt; wrote:<br><br>&gt; Yes, this commit is also in the trunk.<o:p></o:p></p></div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;">Yes, I understand that -- my question is: is this same *behavior* happening on the trunk. &nbsp;I.e., is there some other effect on the trunk that is causing the bad behavior to not occur?<o:p></o:p></div><div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><br>&gt; Best,<br>&gt; Elena<br>&gt;<br>&gt;<br>&gt; On Wed, May 7, 2014 at 5:45 PM, Jeff Squyres (jsquyres) &lt;<a href="mailto:jsquyres@cisco.com" target="_blank" style="color: purple; text-decoration: underline;">jsquyres@cisco.com</a>&gt; wrote:<br>&gt; Is this also happening on the trunk?<br>&gt;<br>&gt;<br>&gt; Sent from my phone. No type good.<br>&gt;<br>&gt; On May 7, 2014, at 9:44 AM, "Elena Elkina" &lt;<a href="mailto:elena.elkina@itseez.com" target="_blank" style="color: purple; text-decoration: underline;">elena.elkina@itseez.com</a>&gt; wrote:<br>&gt;<br>&gt;&gt; Sorry,<br>&gt;&gt;<br>&gt;&gt; Fixes #4501: Datatype unpack code produces incorrect results in some case<br>&gt;&gt;<br>&gt;&gt; ---svn-pre-commit-ignore-below---<br>&gt;&gt;<br>&gt;&gt; r31370 [[BR]]<br>&gt;&gt; Reshape all the packing/unpacking functions to use the same skeleton. Rewrite the<br>&gt;&gt; generic_unpacking to take advantage of the same capabilitites.<br>&gt;&gt;<br>&gt;&gt; r31380 [[BR]]<br>&gt;&gt; Remove a non-necessary label.<br>&gt;&gt;<br>&gt;&gt; r31387 [[BR]]<br>&gt;&gt; Correctly save the displacement for the case where the convertor is not<br>&gt;&gt; completed. As we need to have the right displacement at the beginning<br>&gt;&gt; of the next call, we should save the position relative to the beginning<br>&gt;&gt; of the buffer and not to the last loop.<br>&gt;&gt;<br>&gt;&gt; Best regards,<br>&gt;&gt; Elena<br>&gt;&gt;<br>&gt;&gt;<br>&gt;&gt; On Wed, May 7, 2014 at 5:43 PM, Jeff Squyres (jsquyres) &lt;<a href="mailto:jsquyres@cisco.com" target="_blank" style="color: purple; text-decoration: underline;">jsquyres@cisco.com</a>&gt; wrote:<br>&gt;&gt; Can you cite the branch and SVN r number?<br>&gt;&gt;<br>&gt;&gt; Sent from my phone. No type good.<br>&gt;&gt;<br>&gt;&gt; &gt; On May 7, 2014, at 9:24 AM, "Elena Elkina" &lt;<a href="mailto:elena.elkina@itseez.com" target="_blank" style="color: purple; text-decoration: underline;">elena.elkina@itseez.com</a>&gt; wrote:<br>&gt;&gt; &gt;<br>&gt;&gt; &gt; b531973419a056696e6f88d813769aa4f1f1aee6<br>&gt;&gt; _______________________________________________<br>&gt;&gt; devel mailing list<br>&gt;&gt;<span class="Apple-converted-space">&nbsp;</span><a href="mailto:devel@open-mpi.org" target="_blank" style="color: purple; text-decoration: underline;">devel@open-mpi.org</a><br>&gt;&gt; Subscription:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank" style="color: purple; text-decoration: underline;">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>&gt;&gt; Link to this post:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/community/lists/devel/2014/05/14701.php" target="_blank" style="color: purple; text-decoration: underline;">http://www.open-mpi.org/community/lists/devel/2014/05/14701.php</a><br>&gt;&gt;<br>&gt;&gt; _______________________________________________<br>&gt;&gt; devel mailing list<br>&gt;&gt;<span class="Apple-converted-space">&nbsp;</span><a href="mailto:devel@open-mpi.org" target="_blank" style="color: purple; text-decoration: underline;">devel@open-mpi.org</a><br>&gt;&gt; Subscription:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank" style="color: purple; text-decoration: underline;">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>&gt;&gt; Link to this post:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/community/lists/devel/2014/05/14702.php" target="_blank" style="color: purple; text-decoration: underline;">http://www.open-mpi.org/community/lists/devel/2014/05/14702.php</a><br>&gt;<br>&gt; _______________________________________________<br>&gt; devel mailing list<br>&gt;<span class="Apple-converted-space">&nbsp;</span><a href="mailto:devel@open-mpi.org" target="_blank" style="color: purple; text-decoration: underline;">devel@open-mpi.org</a><br>&gt; Subscription:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank" style="color: purple; text-decoration: underline;">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>&gt; Link to this post:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/community/lists/devel/2014/05/14703.php" target="_blank" style="color: purple; text-decoration: underline;">http://www.open-mpi.org/community/lists/devel/2014/05/14703.php</a><br>&gt;<br>&gt; _______________________________________________<br>&gt; devel mailing list<br>&gt;<span class="Apple-converted-space">&nbsp;</span><a href="mailto:devel@open-mpi.org" target="_blank" style="color: purple; text-decoration: underline;">devel@open-mpi.org</a><br>&gt; Subscription:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank" style="color: purple; text-decoration: underline;">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><o:p></o:p></div></div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;">&gt; Link to this post:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/community/lists/devel/2014/05/14704.php" target="_blank" style="color: purple; text-decoration: underline;">http://www.open-mpi.org/community/lists/devel/2014/05/14704.php</a><br><br><br>--<br>Jeff Squyres<br><a href="mailto:jsquyres@cisco.com" target="_blank" style="color: purple; text-decoration: underline;">jsquyres@cisco.com</a><br>For corporate legal information go to:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.cisco.com/web/about/doing_business/legal/cri/" target="_blank" style="color: purple; text-decoration: underline;">http://www.cisco.com/web/about/doing_business/legal/cri/</a><o:p></o:p></div><div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><br>_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org" target="_blank" style="color: purple; text-decoration: underline;">devel@open-mpi.org</a><br>Subscription:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank" style="color: purple; text-decoration: underline;">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><o:p></o:p></div></div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;">Link to this post:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/community/lists/devel/2014/05/14706.php" target="_blank" style="color: purple; text-decoration: underline;">http://www.open-mpi.org/community/lists/devel/2014/05/14706.php</a><o:p></o:p></div></div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><o:p>&nbsp;</o:p></div></div></div><div style="margin: 0in 0in 0.0001pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><o:p>&nbsp;</o:p></div></div></div></div><div><hr></div><div>This email message is for the sole use of the intended recipient(s) and may contain confidential information.&nbsp; Any unauthorized review, use, disclosure or distribution is prohibited.&nbsp; If you are not the intended recipient, please contact the sender by reply email and destroy all copies of the original message.</div><div><hr></div>_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org" style="color: purple; text-decoration: underline;">devel@open-mpi.org</a><br>Subscription:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" style="color: purple; text-decoration: underline;">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>Link to this post:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/community/lists/devel/2014/05/14720.php" style="color: purple; text-decoration: underline;">http://www.open-mpi.org/community/lists/devel/2014/05/14720.php</a></div></blockquote></div><br></div></body></html>
