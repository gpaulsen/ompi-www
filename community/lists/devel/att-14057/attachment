<div dir="ltr"><div>Testing the current v1.7 tarball (1.7.5a1r30634), I get a failure when building the oshmem examples.</div><div>I&#39;ve confirmed that the same problem exists on trunk (so not a problem with the CMR).</div>
<div><br></div><div><div><font face="courier new, monospace">[...]</font></div><div><font face="courier new, monospace">mpifort -g ring_usempi.f90 -o ring_usempi</font></div><div><font face="courier new, monospace">** ring   === End of Compilation 1 ===</font></div>
<div><font face="courier new, monospace">1501-510  Compilation successful for file ring_usempi.f90.</font></div><div><font face="courier new, monospace">make[2]: Leaving directory `/gpfs-biou/phh1/OMPI/openmpi-1.7-latest-linux-ppc32-xlc-11.1/BLD/examples&#39;</font></div>
<div><font face="courier new, monospace">make[1]: Leaving directory `/gpfs-biou/phh1/OMPI/openmpi-1.7-latest-linux-ppc32-xlc-11.1/BLD/examples&#39;</font></div><div><font face="courier new, monospace">make[1]: Entering directory `/gpfs-biou/phh1/OMPI/openmpi-1.7-latest-linux-ppc32-xlc-11.1/BLD/examples&#39;</font></div>
<div><font face="courier new, monospace">make[2]: Entering directory `/gpfs-biou/phh1/OMPI/openmpi-1.7-latest-linux-ppc32-xlc-11.1/BLD/examples&#39;</font></div><div><font face="courier new, monospace">shmemcc -g hello_oshmem_c.c -o hello_oshmem</font></div>
<div><font face="courier new, monospace">make[2]: Leaving directory `/gpfs-biou/phh1/OMPI/openmpi-1.7-latest-linux-ppc32-xlc-11.1/BLD/examples&#39;</font></div><div><font face="courier new, monospace">make[2]: Entering directory `/gpfs-biou/phh1/OMPI/openmpi-1.7-latest-linux-ppc32-xlc-11.1/BLD/examples&#39;</font></div>
<div><font face="courier new, monospace">shmemcc -g ring_oshmem_c.c -o ring_oshmem</font></div><div><font face="courier new, monospace">make[2]: Leaving directory `/gpfs-biou/phh1/OMPI/openmpi-1.7-latest-linux-ppc32-xlc-11.1/BLD/examples&#39;</font></div>
<div><font face="courier new, monospace">make[2]: Entering directory `/gpfs-biou/phh1/OMPI/openmpi-1.7-latest-linux-ppc32-xlc-11.1/BLD/examples&#39;</font></div><div><font face="courier new, monospace">shmemfort -g hello_oshmemfh.f90 -o hello_oshmemfh</font></div>
<div><font face="courier new, monospace">** hello_oshmem   === End of Compilation 1 ===</font></div><div><font face="courier new, monospace">1501-510  Compilation successful for file hello_oshmemfh.f90.</font></div><div><font face="courier new, monospace">make[2]: Leaving directory `/gpfs-biou/phh1/OMPI/openmpi-1.7-latest-linux-ppc32-xlc-11.1/BLD/examples&#39;</font></div>
<div><font face="courier new, monospace">make[2]: Entering directory `/gpfs-biou/phh1/OMPI/openmpi-1.7-latest-linux-ppc32-xlc-11.1/BLD/examples&#39;</font></div><div><font face="courier new, monospace">shmemfort -g ring_oshmemfh.f90 -o ring_oshmemfh</font></div>
<div><font face="courier new, monospace">** ring_oshmem   === End of Compilation 1 ===</font></div><div><font face="courier new, monospace">1501-510  Compilation successful for file ring_oshmemfh.f90.</font></div><div><font face="courier new, monospace">ring_oshmemfh.o: In function `ring_oshmem&#39;:</font></div>
<div><font face="courier new, monospace">/gpfs-biou/phh1/OMPI/openmpi-1.7-latest-linux-ppc32-xlc-11.1/BLD/examples/ring_oshmemfh.f90:33: undefined reference to `shmem_put8&#39;</font></div><div><font face="courier new, monospace">/gpfs-biou/phh1/OMPI/openmpi-1.7-latest-linux-ppc32-xlc-11.1/BLD/examples/ring_oshmemfh.f90:46: undefined reference to `shmem_int8_wait_until&#39;</font></div>
<div><font face="courier new, monospace">/gpfs-biou/phh1/OMPI/openmpi-1.7-latest-linux-ppc32-xlc-11.1/BLD/examples/ring_oshmemfh.f90:55: undefined reference to `shmem_put8&#39;</font></div><div><font face="courier new, monospace">make[2]: *** [ring_oshmemfh] Error 1</font></div>
<div><font face="courier new, monospace">make[2]: Leaving directory `/gpfs-biou/phh1/OMPI/openmpi-1.7-latest-linux-ppc32-xlc-11.1/BLD/examples&#39;</font></div><div><font face="courier new, monospace">make[1]: *** [oshmem] Error 2</font></div>
<div><font face="courier new, monospace">make[1]: Leaving directory `/gpfs-biou/phh1/OMPI/openmpi-1.7-latest-linux-ppc32-xlc-11.1/BLD/examples&#39;</font></div><div><font face="courier new, monospace">make: *** [all] Error 2</font></div>
</div><div><br></div><div>The link of ring_oshmemfh is failing with undefined references to shmem_put8 and shmem_int8_wait_until.</div><div>The relevant portion of &quot;make&quot; output in the example dir is shown above.</div>
<div>Note that ring_usempi linked fine, indicating that F90 MPI bindings are fine.</div><div>Additionally, ring_oshmem linked file, indicating that C language OSHMEM bindings are fine, too.</div><div><br></div><div>In case it is relevant: this build is configured with</div>
<div>  --enable-static --enable-shared --enable-mpi-fortran=usempi --disable-vt</div><div><br></div><div><div>The &quot;--enable-static --enable-shared&quot; flags are just to make for a more thorough test.</div><div>However, retesting without --enable-static did not resolve the problem.</div>
</div><div><br></div><div>The --enable-mpi-fortran flag is necessary because the F08 bindings don&#39;t build with this compiler (<a href="http://www.open-mpi.org/community/lists/devel/2014/01/13802.php">http://www.open-mpi.org/community/lists/devel/2014/01/13802.php</a>).</div>
<div><br></div><div>The --disable-vt flag is necessary because the compiler crashes building VT.</div><div><br></div><div>Some misc bits of info:</div><div><br></div><div><div><font face="courier new, monospace">$ shmemfort -g ring_oshmemfh.f90 -o ring_oshmemfh --show</font></div>
<div><font face="courier new, monospace">xlf -g ring_oshmemfh.f90 -o ring_oshmemfh -I/home/phh1/SCRATCH/OMPI/openmpi-trunk-linux-ppc32-xlc-11.1/INST/include -I/home/phh1/SCRATCH/OMPI/openmpi-trunk-linux-ppc32-xlc-11.1/INST/lib -Wl,-rpath -Wl,/home/phh1/SCRATCH/OMPI/openmpi-trunk-linux-ppc32-xlc-11.1/INST/lib -Wl,--enable-new-dtags -L/home/phh1/SCRATCH/OMPI/openmpi-trunk-linux-ppc32-xlc-11.1/INST/lib -loshmem -lmpi_mpifh -lmpi -lm -lnuma -ldl -lrt -lnsl -lutil -lpthread</font></div>
</div><div><br></div><div><div><font face="courier new, monospace">$ nm INST/lib/liboshmem.so | grep shmem_put8</font></div><div><font face="courier new, monospace">0009eab0 t 00000000.plt_pic32.shmem_put8_f</font></div><div>
<font face="courier new, monospace">00063f20 T shmem_put8_</font></div><div><font face="courier new, monospace">00063fa0 T shmem_put8__</font></div><div><font face="courier new, monospace">00063e00 T shmem_put8_f</font></div>
<div><font face="courier new, monospace">$ nm INST/lib/liboshmem.a | grep shmem_put8</font></div><div><font face="courier new, monospace">shmem_put8_f.o:</font></div><div><font face="courier new, monospace">00000120 T shmem_put8_</font></div>
<div><font face="courier new, monospace">000001a0 T shmem_put8__</font></div><div><font face="courier new, monospace">00000000 T shmem_put8_f</font></div></div><div><br></div><div>-Paul</div><div><br></div>-- <br><font face="courier new, monospace"><div>
Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Future Technologies Group</div><div>Computer and Data Sciences Department     Tel: +1-510-495-2352</div>
<div>Lawrence Berkeley National Laboratory     Fax: +1-510-486-6900</div></font>
</div>

