<html><head><style type="text/css"><!-- DIV {margin:0px;} --></style></head><body><div style="font-family:times new roman, new york, times, serif;font-size:10pt"><div style="font-family: times new roman,new york,times,serif; font-size: 10pt;">Thanks for the detailed reply. <br><br>Just one question, I am a bit confused with this comment, or perhaps i phrased the question in a bad way and you miss understood me. I will rephrase my question and scenario. I hope I can make is terrible scenario easier to understand with less confusion.<br><br>&gt;&gt; related question is what if I want to run 8 process job (on 2x4<br>&gt;&gt; cluster) and want to pin a process to an network interface. OpenMPI to<br>&gt;&gt; my understanding does not give any control of allocating IP to a<br>&gt;&gt; process (like MPICH)<br><br>&gt;You could just say btl_if_include=ethX, thus giving you the right<br>&gt;network interface. Obviously, this requires separate
 networks.<br><br><br>I want to pin each process to a distinct ethernet interface. My understanding of&nbsp; btl_if_include = ethX,ethY is that it would let every process to use&nbsp; ethX and ethY in roundrobin fashion. What I want is that if my application is a.out (a modified OSU bandwidth benchmark) and can have 4
 processes. rank 0 and rank 2 will run on machineA whereas rank 1 and rank 3 on machineB.&nbsp; Rank 0 will&nbsp; communicate with rank 1, and rank 2 will communicate with rank 3. I want rank 0 to use eth1, rank 1 to use eth2 (for machine B it will be rank 2 to use eth1 and rank 3 uses eth2).&nbsp; In normal case, OMPI send packets in roundrobin through both the intefaces. Therefore rank 0 uses eth1 and eth2, and my requirement is otherwise. <br>To my mind this can be done through routing tables. When I add routes, the OMPI just sits there waiting for something to happen, whereas MPICH gives me results with same routing table configuration.&nbsp; Initially I had eth1, and eth2 on same subnet, but even with different subnets I am facing the same issue. MPICH works with both subnet configurations.<br><div>&nbsp;<br><br>Another related issue and different configuration is the case of Xen. Here eth0 is connected to default shared memory sort of a thing of
 xen&nbsp; (in another case it will be my very own Xensocket btl for OMPI) and is very fast as compared to normal GigE. Eth0 will only be fast, if the machines (and hence the processes)&nbsp; are on same "physical hardware". In case the two machines (and therefore the processes) are on "different physical hardware", then eth0 will route the packets through a physical switch and will be a touch slower than eth1 (i know its kinda hard to follow, but I am sorry) .&nbsp; Eth1 here is normal GigE interface and both eth0 and eth1 are on different subnets. While running NAS benchmarks etc I want that if the two machines can use eth0, they should only use eth0 and even if btl sends a messages through eth1, it should get routed through eth0. For this I setup routing tables and see the same issue as above i.e. OMPI sits there (especially for LU and IS benchmarks), whereas MPICH gives me the results the way I want. <br><br>Is there something related to routing
 tables that I am overlooking in case of OMPI? Why would MPICH give me the results as I am expecting whereas OMPI sits there waiting for me to kill the job. <br><br><br></div>Best Regards,<br>Muhammad Atif<div style="font-family: times new roman,new york,times,serif; font-size: 10pt;"><br>PS: I think I did a terrible job in explaining the scenario again :)<br><br><div style="font-family: times new roman,new york,times,serif; font-size: 12pt;">----- Original Message ----<br>From: Adrian Knoth &lt;adi@drcomp.erfurt.thur.de&gt;<br>To: Open MPI Developers &lt;devel@open-mpi.org&gt;<br>Sent: Monday, June 23, 2008 10:15:53 PM<br>Subject: Re: [OMPI devel] multiple GigE interfaces...<br><br>
On Wed, Jun 18, 2008 at 05:13:28PM -0700, Muhammad Atif wrote:<br><br>&gt;&nbsp; Hi again... I was on a break from Xensocket stuff.... This time some<br>&gt;&nbsp; general questions...<br><br>Hi.<br><br>&gt; question. What if I have multiple Ethernet cards (say 5) on two of my<br>&gt; quad core machines.&nbsp; The IP addresses (and the subnets of course) are <br>&gt; Machine A&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  Machine B<br>&gt; eth0 is y.y.1.a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  y.y.1.z&nbsp; &nbsp;  <br>&gt; eth1 is y.y.4.b&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y.y.4.y<br>&gt; eth2 is y.y.4.c&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...<br>&gt; eth3 is y.y.4.d&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...<br>&gt; <br>&gt;&nbsp; ...<br><br>This sounds pretty weird. And I guess your netmasks don't allow to<br>separate the NICs, do they?<br><br>&gt; from the FAQ's/Some emails in user lists&nbsp; it is clear that if I want<br>&gt; to run a job on multiple ethernets, I can use --mca btl_tcp_if_include<br>&gt; eth0,eth1. This<br><br>You can, but you don't have to. If you don't specify something, OMPI<br>will choose "something right".<br><br>&gt; will run the job on two of the subnets utilizing both the Ethernet<br>&gt; cards. Is it doing some sort of load balancing? or some round robin<br>&gt; mechanism? What part of code is responsible for this work?<br><br>As far as I know, it's handled by OB1 (PML), which does striping across<br>several BTL instances.<br><br>So in other words, as long as both segments are equally fast, the load<br>balancing should do fine. If they differ in performance, the OB1 doesn't<br>find an
 optimal solution. If you're hitting this case, ask htor, he has<br>an auto-tuning replacement, but that's not going to be part of OMPI.<br><br>&gt; eth1,eth2,eth3,eth4. Notice that all of these ethNs are on same subnet.<br>&gt; Even in the FAQ's (which mostly answers our lame questions)&nbsp; its not<br>&gt; entirely clear how communication will be done.&nbsp; Each process will have<br>&gt; tcp_num_btls equal to interfaces, but then what? Is it some sort of<br>&gt; load balancing or similar stuff which is not clear in tcpdump?<br><br>I feel you could end up with communication stalls, the typical hang<br>situation. One problem that might occur: the TCP component looks for<br>remote addresses on the "same" network, so the component might be unable<br>to decide whether your IP is on the same physical network or uses<br>the wrong link. Then, you won't gain anything.<br><br>Another problem: at least the Linux kernel (without tweaking) decides<br>which
 interface and address to use for outgoing communication. If you<br>have multiple subnets, then the kernel would go for the closest match<br>between local and remote addresses, but in your case, it might be some<br>kind of lottery.<br><br><br>&gt; related question is what if I want to run 8 process job (on 2x4<br>&gt; cluster) and want to pin a process to an network interface. OpenMPI to<br>&gt; my understanding does not give any control of allocating IP to a<br>&gt; process (like MPICH)<br><br>You could just say btl_if_include=ethX, thus giving you the right<br>network interface. Obviously, this requires separate networks.<br><br><br>&gt; or is there some magical --mca thingie. I think only way to go is<br>&gt; adding routing tables... am i thinking in right direction? If yes, then<br>&gt; the performance of my boxes decrease when i trying to force the routing<br><br>Routing should be fast, since it's done at kernel level. I cannot speak<br>for
 Xen-based virtual interfaces.<br><br><br>-- <br>Cluster and Metacomputing Working Group<br>Friedrich-Schiller-Universität Jena, Germany<br><br>private: <a rel="nofollow" target="_blank" href="http://adi.thur.de">http://adi.thur.de</a><br>_______________________________________________<br>devel mailing list<br><a rel="nofollow" ymailto="mailto:devel@open-mpi.org" target="_blank" href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br><a rel="nofollow" target="_blank" href="http://www.open-mpi.org/mailman/listinfo.cgi/devel">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br></div></div></div></div><br>

      </body></html>
