<div dir="ltr">Gilles,<div><br></div><div>I checked your patch and it doesn&#39;t solve the problem I observe. I think the reason is somewhere else.</div></div><div class="gmail_extra"><br><div class="gmail_quote">2014-10-17 19:13 GMT+07:00 Gilles Gouaillardet <span dir="ltr">&lt;<a href="mailto:gilles.gouaillardet@gmail.com" target="_blank">gilles.gouaillardet@gmail.com</a>&gt;</span>:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">Artem,<br><br>There is a known issue #235 with modex and i made PR #238 with a tentative fix.<br><br>Could you please give it a try and reports if it solves your problem ?<br><br>Cheers<span class="HOEnZb"><font color="#888888"><br><br>Gilles</font></span><div class="HOEnZb"><div class="h5"><br><br>Artem Polyakov &lt;<a href="mailto:artpol84@gmail.com" target="_blank">artpol84@gmail.com</a>&gt; wrote:<br><div dir="ltr"><div><div>Hello, I have troubles with latest trunk if I use PMI1.</div><div><br></div><div>For example, if I use 2 nodes the application hangs. See backtraces from both nodes below. From them I can see that second (non launching) node hangs in bcol component selection. Here is the default setting of bcol_base_string parameter:</div><div>bcol_base_string=&quot;basesmuma,basesmuma,iboffload,ptpcoll,ugni&quot;</div><div>according to ompi_info. I don&#39;t know if it is correct that basesmuma is duplicated or not.</div><div><br></div><div>Experiments with this parameter showed that it directly influences the bug:</div><div>export OMPI_MCA_bcol_base_string=&quot;&quot; #  [SEGFAULT]</div><div>export OMPI_MCA_bcol_base_string=&quot;ptpcoll&quot; #  [OK]</div><div>export OMPI_MCA_bcol_base_string=&quot;basesmuma,ptpcoll&quot; #  [OK]</div><div>export OMPI_MCA_bcol_base_string=&quot;basesmuma,ptpcoll,iboffload&quot; #  [OK]</div><div>export OMPI_MCA_bcol_base_string=&quot;basesmuma,ptpcoll,iboffload,ugni&quot; #  [OK]</div><div>export OMPI_MCA_bcol_base_string=&quot;basesmuma,basesmuma,ptpcoll,iboffload,ugni&quot; #  [HANG]</div><div>export OMPI_MCA_bcol_base_string=&quot;basesmuma,basesmuma,iboffload,ptpcoll&quot; # [HANG]</div><div>export OMPI_MCA_bcol_base_string=&quot;basesmuma,basesmuma,iboffload&quot; # [OK]</div><div>export OMPI_MCA_bcol_base_string=&quot;basesmuma,basesmuma,iboffload,ugni&quot; # [OK]</div><div>export OMPI_MCA_bcol_base_string=&quot;basesmuma,basesmuma,ptpcoll&quot; #  [HANG]</div><div>export OMPI_MCA_bcol_base_string=&quot;ptpcoll,basesmuma&quot; #  [OK]</div><div>export OMPI_MCA_bcol_base_string=&quot;ptpcoll,basesmuma,basesmuma&quot; #  [HANG]</div><div><br></div><div>I can provide other information if nessesary.</div><div><br></div><div>cn1:</div><div>(gdb) bt</div><div>0  0x00007fdebd30ac6d in poll () from /lib/x86_64-linux-gnu/libc.so.6</div><div>1  0x00007fdebcca64e0 in poll_dispatch (base=0x1d466b0, tv=0x7fff71aab880) at poll.c:165</div><div>2  0x00007fdebcc9b041 in opal_libevent2021_event_base_loop (base=0x1d466b0, flags=2) at event.c:1631</div><div>3  0x00007fdebcc35891 in opal_progress () at runtime/opal_progress.c:169</div><div>4  0x00007fdeb32f78cb in opal_condition_wait (c=0x7fdebdb51bc0 &lt;ompi_request_cond&gt;, m=0x7fdebdb51cc0 &lt;ompi_request_lock&gt;) at ../../../../opal/threads/condition.h:78</div><div>5  0x00007fdeb32f79b8 in ompi_request_wait_completion (req=0x7fff71aab920) at ../../../../ompi/request/request.h:381</div><div>6  0x00007fdeb32f84b8 in mca_pml_ob1_recv (addr=0x7fff71aabd80, count=1, datatype=0x6026c0 &lt;ompi_mpi_int&gt;, src=1, tag=0, comm=0x6020a0 &lt;ompi_mpi_comm_world&gt;, </div><div>    status=0x7fff71aabd90) at pml_ob1_irecv.c:109</div><div>7  0x00007fdebd88f54d in PMPI_Recv (buf=0x7fff71aabd80, count=1, type=0x6026c0 &lt;ompi_mpi_int&gt;, source=1, tag=0, comm=0x6020a0 &lt;ompi_mpi_comm_world&gt;, </div><div>    status=0x7fff71aabd90) at precv.c:78</div><div>8  0x0000000000400c44 in main (argc=1, argv=0x7fff71aabe98) at hellompi.c:33</div><div><br></div><div>cn2:</div><div>(gdb) bt</div><div>0  0x00007fa65aa78c6d in poll () from /lib/x86_64-linux-gnu/libc.so.6</div><div>1  0x00007fa65a4144e0 in poll_dispatch (base=0x20e96b0, tv=0x7fff46f44a80) at poll.c:165</div><div>2  0x00007fa65a409041 in opal_libevent2021_event_base_loop (base=0x20e96b0, flags=2) at event.c:1631</div><div>3  0x00007fa65a3a3891 in opal_progress () at runtime/opal_progress.c:169</div><div>4  0x00007fa65afbbc25 in opal_condition_wait (c=0x7fa65b2bfbc0 &lt;ompi_request_cond&gt;, m=0x7fa65b2bfcc0 &lt;ompi_request_lock&gt;) at ../opal/threads/condition.h:78</div><div>5  0x00007fa65afbc1b5 in ompi_request_default_wait_all (count=2, requests=0x7fff46f44c70, statuses=0x0) at request/req_wait.c:287</div><div>6  0x00007fa65afc7906 in comm_allgather_pml (src_buf=0x7fff46f44da0, dest_buf=0x233dac0, count=288, dtype=0x7fa65b29fee0 &lt;ompi_mpi_char&gt;, my_rank_in_group=1, </div><div>    n_peers=2, ranks_in_comm=0x210a760, comm=0x6020a0 &lt;ompi_mpi_comm_world&gt;) at patterns/comm/allgather.c:250</div><div>7  0x00007fa64f14ba08 in bcol_basesmuma_smcm_allgather_connection (sm_bcol_module=0x7fa64e64d010, module=0x232c800, </div><div>    peer_list=0x7fa64f3513e8 &lt;mca_bcol_basesmuma_component+456&gt;, back_files=0x7fa64eae2690, comm=0x6020a0 &lt;ompi_mpi_comm_world&gt;, input=..., </div><div>    base_fname=0x7fa64f14ca8c &quot;sm_ctl_mem_&quot;, map_all=false) at bcol_basesmuma_smcm.c:205</div><div>8  0x00007fa64f146525 in base_bcol_basesmuma_setup_ctl (sm_bcol_module=0x7fa64e64d010, cs=0x7fa64f351220 &lt;mca_bcol_basesmuma_component&gt;) at bcol_basesmuma_setup.c:344</div><div>9  0x00007fa64f146cbb in base_bcol_basesmuma_setup_library_buffers (sm_bcol_module=0x7fa64e64d010, cs=0x7fa64f351220 &lt;mca_bcol_basesmuma_component&gt;)</div><div>    at bcol_basesmuma_setup.c:550</div><div>10 0x00007fa64f1418d0 in mca_bcol_basesmuma_comm_query (module=0x232c800, num_modules=0x232e570) at bcol_basesmuma_module.c:532</div><div>11 0x00007fa64fd9e5f2 in mca_coll_ml_tree_hierarchy_discovery (ml_module=0x232fbe0, topo=0x232fd98, n_hierarchies=3, exclude_sbgp_name=0x0, include_sbgp_name=0x0)</div><div>    at coll_ml_module.c:1964</div><div>12 0x00007fa64fd9f3a3 in mca_coll_ml_fulltree_hierarchy_discovery (ml_module=0x232fbe0, n_hierarchies=3) at coll_ml_module.c:2211</div><div>13 0x00007fa64fd9cbe4 in ml_discover_hierarchy (ml_module=0x232fbe0) at coll_ml_module.c:1518</div><div>14 0x00007fa64fda164f in mca_coll_ml_comm_query (comm=0x6020a0 &lt;ompi_mpi_comm_world&gt;, priority=0x7fff46f45358) at coll_ml_module.c:2970</div><div>15 0x00007fa65b02f6aa in query_2_0_0 (component=0x7fa64fffe4e0 &lt;mca_coll_ml_component&gt;, comm=0x6020a0 &lt;ompi_mpi_comm_world&gt;, priority=0x7fff46f45358, </div><div>    module=0x7fff46f45390) at base/coll_base_comm_select.c:374</div><div>16 0x00007fa65b02f66e in query (component=0x7fa64fffe4e0 &lt;mca_coll_ml_component&gt;, comm=0x6020a0 &lt;ompi_mpi_comm_world&gt;, priority=0x7fff46f45358, module=0x7fff46f45390)</div><div>    at base/coll_base_comm_select.c:357</div><div>17 0x00007fa65b02f581 in check_one_component (comm=0x6020a0 &lt;ompi_mpi_comm_world&gt;, component=0x7fa64fffe4e0 &lt;mca_coll_ml_component&gt;, module=0x7fff46f45390)</div><div>    at base/coll_base_comm_select.c:319</div><div>18 0x00007fa65b02f3c7 in check_components (components=0x7fa65b2a9530 &lt;ompi_coll_base_framework+80&gt;, comm=0x6020a0 &lt;ompi_mpi_comm_world&gt;)</div><div>    at base/coll_base_comm_select.c:283</div><div>19 0x00007fa65b027d45 in mca_coll_base_comm_select (comm=0x6020a0 &lt;ompi_mpi_comm_world&gt;) at base/coll_base_comm_select.c:119</div><div>20 0x00007fa65afbdb2c in ompi_mpi_init (argc=1, argv=0x7fff46f45a78, requested=0, provided=0x7fff46f4590c) at runtime/ompi_mpi_init.c:858</div><div>21 0x00007fa65aff20ef in PMPI_Init (argc=0x7fff46f4594c, argv=0x7fff46f45940) at pinit.c:84</div><div>22 0x0000000000400b66 in main (argc=1, argv=0x7fff46f45a78) at hellompi.c:11</div><div><br></div><div><br></div><div><br></div>-- <br>С Уважением, Поляков Артем Юрьевич<br>Best regards, Artem Y. Polyakov
</div></div>
</div></div><br>_______________________________________________<br>
devel mailing list<br>
<a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2014/10/16055.php" target="_blank">http://www.open-mpi.org/community/lists/devel/2014/10/16055.php</a><br></blockquote></div><br><br clear="all"><div><br></div>-- <br>С Уважением, Поляков Артем Юрьевич<br>Best regards, Artem Y. Polyakov
</div>

