Hi Jeff,<span class="gmail_quote"></span>&nbsp;<div><br><blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">1. The logic for if_exclude was not correct.&nbsp;&nbsp;I committed a fix for
<br>it.&nbsp;&nbsp;<a href="https://svn.open-mpi.org/trac/ompi/changeset/14748" target="_blank" onclick="return top.js.OpenExtLink(window,event,this)">https://svn.open-mpi.org/trac/ompi/changeset/14748</a></blockquote><div><br>Thanks
<br></div><br><blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">
2. I&#39;m a bit confused on a) how the new MCA params mca_num_hcas and<br>map_num_procs_per_hca are supposed to be used and b) what their<br>default values shoulant code)d be.</blockquote><div><br>Probably these params(and relevant code) should be removed now, since there is a plan for generic Socket/Core to HCA mapping scheme. mca_num_hcas is the maximum number of HCAs a task can use. Eg. If mpa_num_procs_per_hca is 3 and max_num_hcas is 2. On any node, task 1/2/3 are mapped to hca1 &amp; hca2, task 4/5/6 are mapped to hca3 &amp; hca4 .... 
<br>Default values were set as 1(thats what we needed at that point in time).It needs to be modified so that ompi&#39;s default behaviour remains unchanged (ie. use all hcas)<br></div><br><blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">

2a. I don&#39;t quite understand the logic of is_hca_allowed(); I could<br>not get it to work properly.&nbsp;&nbsp;Specifically, I have 2 machines each<br>with 2 HCAs (mthca0 has 1 port, mthca1 has 2 ports).&nbsp;&nbsp;If I ran 2<br>procs (regardless of byslot or bynode), is_hca_allowed() would always
<br>return false for the 2nd proc.&nbsp;&nbsp;So I put a temporary override in<br>is_hca_allowed() to simply always return true.&nbsp;&nbsp;Can you explain how<br>the logic is supposed to work in that function?</blockquote><div><br>Explained above 
<br></div><br><blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">2b. The default values of max_num_hcas and map_num_procs_per_hca are
<br>both 1.&nbsp;&nbsp;Based on my (potentially flawed) understanding of how these<br>MCA params are meant to be used, this is different than the current<br>default behavior.&nbsp;&nbsp;The current default is that all procs use all<br>ACTIVE ports on all HCAs.&nbsp;&nbsp;I *think* your new default param values
<br>will set each proc to use the ACTIVE ports on exactly one HCA,<br>regardless how many there are in the host.&nbsp;&nbsp;Did you mean to do that?<br>Also: both values must currently be &gt;=1; should we allow -1 for both<br>of these values, meaning that they can be &quot;infinite&quot; (
i.e., based on<br>the number of HCAs in the host)?</blockquote><div><br>Yes,&nbsp; the defaults need to be changed. I&#39;ll also make the selection logic more granular (eg. -mca mca_btl_openib_if_include mthca0:1,mthca1:1)<br>
</div></div><br>--Nysal

