<div dir="ltr">OK, I am now on the openmpi-1.9a1r27954 tarball.<div>In order to build OMPI and compile apps on this machine I must </div><div><br></div><div>1) edit the xe6 platform to --disable-shared/--enable-static (site-specific)</div>
<div><br></div><div style>2) edit the xe6 platform file to provide a full path to the alps headers because the logic in orte_check_alps.m4 for default values is wrong</div><div style><br></div><div>3) edit the xe6 platform file to remove with_devel_headers=yes because --with-devel-headers breaks &quot;make install&quot;</div>
<div><br></div><div>4) edit configure (!!!) to allow ras_alps_CPPFLAGS (and other vars) to get set at configure time</div><div><br></div><div>5) edit orte/mca/ras/alps/ras_alps_component.c and/or orte/mca/ras/alps/ras-alps-command.sh with the proper path to apstat (perhaps only one needs to be edited?)</div>
<div><br></div><div>Item (1) is due to site differences, and is not an OMPI bug.</div><div>The other 4 have all been reported in one form or another on this list.</div><div><br></div><div style>Now, the *next* bug is the following:</div>
<div style><div><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex">$ ./INSTALL/bin/mpirun -mca ras_base_verbose 1 -mca orte_debug_verbose 1 -np 2 ./ring_c 2&gt;&amp;1 | tee -a log<br>
[nid00704:21984] ras:alps:allocate: Trying ALPS configuration file: &quot;/etc/sysconfig/alps&quot;<br>[nid00704:21984] ras:alps:allocate: parser_ini<br>[nid00704:21984] ras:alps:allocate: Trying ALPS configuration file: &quot;/etc/alps.conf&quot;<br>
[nid00704:21984] ras:alps:allocate: Skipping ALPS configuration file: &quot;/etc/alps.conf&quot; (No such file or directory).<br>[nid00704:21984] ras:alps:allocate: Could not locate ALPS scheduler file.<br>[nid00704:21984] [[8668,0],0] ORTE_ERROR_LOG: Not found in file ../../../../orte/mca/ras/base/ras_base_allocate.c at line 178</blockquote>
</div><div><br></div><div><br></div></div><div style>My best guess is that this is related to something Ralph said in <a href="http://www.open-mpi.org/community/lists/devel/2013/01/11989.php">http://www.open-mpi.org/community/lists/devel/2013/01/11989.php</a></div>
<div style><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex">I&#39;m currently tracking down a problem on the Cray XE6 - it appears that recent OS release changed the way alps stores allocation info :-(</blockquote>
<div><br></div><div style>Looking at the debug output prior to the error, and examining the system, I made the following 1-line addition:</div></div><div style><div>--- openmpi-1.9a1r27954/orte/mca/ras/alps/ras_alps_module.c~    2013-01-28 23:54:31.443749000 -0800</div>
<div>+++ openmpi-1.9a1r27954/orte/mca/ras/alps/ras_alps_module.c     2013-01-28 23:54:34.770766635 -0800</div><div>@@ -74,6 +74,7 @@ static int parser_separated_columns(char</div><div> static const orte_ras_alps_sysconfig_t sysconfigs[] = {</div>
<div>     {&quot;/etc/sysconfig/alps&quot;, &quot;ALPS_SHARED_DIR_PATH&quot;, parser_ini},</div><div>     {&quot;/etc/alps.conf&quot;     , &quot;sharedDir&quot;           , parser_separated_columns},</div><div>+    {&quot;/etc/opt/cray/alps/alps.conf&quot;, &quot;sharedDir&quot;  , parser_separated_columns},</div>
<div>     /* must be last element */</div><div>     {NULL                 , NULL                  , NULL}</div><div> };</div></div><div style><br></div><div style>That appears to work for locating the allocation:</div><div style>
<blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex">$ ./INSTALL/bin/mpirun -mca ras_base_verbose 1 -mca orte_debug_verbose 1 -np 2 ./ring_c 2&gt;&amp;1 | tee -a log<br>
[nid00320:22990] ras:alps:allocate: Trying ALPS configuration file: &quot;/etc/sysconfig/alps&quot;<br>[nid00320:22990] ras:alps:allocate: parser_ini<br>[nid00320:22990] ras:alps:allocate: Trying ALPS configuration file: &quot;/etc/alps.conf&quot;<br>
[nid00320:22990] ras:alps:allocate: Skipping ALPS configuration file: &quot;/etc/alps.conf&quot; (No such file or directory).<br>[nid00320:22990] ras:alps:allocate: Trying ALPS configuration file: &quot;/etc/opt/cray/alps/alps.conf&quot;<br>
[nid00320:22990] ras:alps:allocate: parser_separated_columns<br>[nid00320:22990] ras:alps:allocate: Located ALPS scheduler file: &quot;/ufs/alps_shared/appinfo&quot;<br>[nid00320:22990] ras:alps:allocate: begin processing appinfo file<br>
[nid00320:22990] ras:alps:allocate: file /ufs/alps_shared/appinfo read<br>[nid00320:22990] ras:alps:allocate: 3 entries in file<br>[nid00320:22990] ras:alps:allocate: read data for resId 26 - myId 41<br>[nid00320:22990] ras:alps:allocate: read data for resId 26 - myId 41<br>
[nid00320:22990] ras:alps:allocate: read data for resId 41 - myId 41<br>[nid00320:22990] ras:alps:allocate: success</blockquote><div><br></div></div><div style>But wait, where is the application output?</div><div style>Did anything even run?</div>
<div style>I honestly don&#39;t know where to go from here.</div><div style><br></div><div style><div>Please let me know what I can do to help move forward on any of these issues.</div><div><br></div></div><div>-Paul<br clear="all">
<div><br></div>-- <br><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Future Technologies Group</div>
<div>Computer and Data Sciences Department     Tel: +1-510-495-2352</div><div>Lawrence Berkeley National Laboratory     Fax: +1-510-486-6900</div></font>
</div></div>

