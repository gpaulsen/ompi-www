iirc, hwloc can read input from an xml file.<div>if not already the case, should we provide a simple mechanism to tell hwloc not to detect the topology from the os but from a config file.</div><div>for example, if working on a new os and/or hardware, then manually generate the hwloc xml file on each node and do something like</div><div>mpirun --mca hwloc_file /etc/hwloc.xml ...</div><div><br></div><div>makes sense ?</div><div><br><div><div>On Friday, September 4, 2015, Ralph Castain &lt;<a href="mailto:rhc@open-mpi.org">rhc@open-mpi.org</a>&gt; wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div style="word-wrap:break-word">It sounds, then, like removing —without-hwloc will do no harm. At worst, hwloc might report inaccurate info, but that won’t stop us from running with appropriate cmd line options (e.g., to set the #slots and bind-to none).<div><br></div><div>Unless there are any further concerns, I’ll prep the PR</div><div><br></div><div><br><div><blockquote type="cite"><div>On Sep 4, 2015, at 1:08 AM, Kawashima, Takahiro &lt;<a href="javascript:_e(%7B%7D,&#39;cvml&#39;,&#39;t-kawashima@jp.fujitsu.com&#39;);" target="_blank">t-kawashima@jp.fujitsu.com</a>&gt; wrote:</div><br><div><span style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;display:inline!important">Brice,</span><br style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><br style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><span style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;display:inline!important">I&#39;m a developer of Fujitsu MPI for K computer and Fujitsu</span><br style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><span style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;display:inline!important">PRIMEHPC FX10/FX100 (SPARC-based CPU).</span><br style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><br style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><span style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;display:inline!important">Though I&#39;m not familiar with the hwloc code and didn&#39;t know</span><br style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><span style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;display:inline!important">the issue reported by Gilles, I also would be able to help</span><br style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><span style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;display:inline!important">you to fix the issue.</span><br style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><br style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><span style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;display:inline!important">Takahiro Kawashima,</span><br style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><span style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;display:inline!important">MPI development team,</span><br style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><span style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;display:inline!important">Fujitsu</span><br style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><br style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><blockquote type="cite" style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px">Thanks Brice,<br><br>bottom line, even if hwloc is not fully ported, it should build and ompi<span> </span><br>should get something usable.<br>in this case, i have no objection removing the --without-hwloc configure<span> </span><br>option.<br><br>you can contact me off-list regarding the FX10 specific issue<br><br>Cheers,<br><br>Gilles<br><br>On 9/4/2015 2:31 PM, Brice Goglin wrote:<br><blockquote type="cite">Le 04/09/2015 00:36, Gilles Gouaillardet a écrit :<br><blockquote type="cite">Ralph,<br><br>just to be clear, your proposal is to abort if openmpi is configured<span> </span><br>with --without-hwloc, right ?<br>( the --with-hwloc option is not removed because we want to keep the<span> </span><br>option of using an external hwloc library )<br><br>if I understand correctly, Paul&#39;s point is that if openmpi is ported<span> </span><br>to a new architecture for which hwloc has not been ported yet<span> </span><br>(embedded hwloc or external hwloc), then the very first step is to<span> </span><br>port hwloc before ompi can be built.<br><br>did I get it right Paul ?<br><br>Brice, what would happen in such a case ?<br>embedded hwloc cannot be built ?<br>hwloc returns little or no information ?<br></blockquote><br>If it&#39;s a new operating system and it supports at least things like<span> </span><br>sysconf, you will get a Machine object with one PUs per logical processor.<br><br>If it&#39;s a new platform running Linux, they are supposed to tell Linux<span> </span><br>at least package/core/thread information. That&#39;s what we have for ARM<span> </span><br>for instance.<br><br>Missing topology detection can be worked around easily (with XML and<span> </span><br>synthetic description, what we did for BlueGene/Q before adding manual<span> </span><br>support for that specific processor). Binding support can&#39;t.<br>And once you get binding, you get x86-topology even if the operating<span> </span><br>system isn&#39;t supported (using cpuid).<br><br><blockquote type="cite">for example, on Fujitsu FX10 node (single socket, 16 cores), hwloc<span> </span><br>reports 16 sockets with one core each and no cache. though this is<span> </span><br>not correct, that can be seen as equivalent to the real config by<span> </span><br>ompi, so this is not really an issue for ompi.<br></blockquote><br>Can you help fixing this?<br><br>The issue is indeed with supercomputers with uncommon architectures<span> </span><br>like this one.<br></blockquote></blockquote><span style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;display:inline!important">_______________________________________________</span><br style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><span style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;display:inline!important">devel mailing list</span><br style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><a href="javascript:_e(%7B%7D,&#39;cvml&#39;,&#39;devel@open-mpi.org&#39;);" style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px" target="_blank">devel@open-mpi.org</a><br style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><span style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;display:inline!important">Subscription:<span> </span></span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><span style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;display:inline!important">Link to this post:<span> </span></span><a href="http://www.open-mpi.org/community/lists/devel/2015/09/17961.php" style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px" target="_blank">http://www.open-mpi.org/community/lists/devel/2015/09/17961.php</a></div></blockquote></div><br></div></div></blockquote></div></div></div>

