<html><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div>Jeff,</div><div><br></div><div>I get the following warning from "make" using the Intel 2011.3.174 compilers on OpenMPI 1.4.3:</div><div><br></div><div></div><blockquote type="cite"><div>libtool: compile: &nbsp;icc -DHAVE_CONFIG_H -I. -I../../opal/include -I../../orte/include -I../../ompi/include -I../../opal/mca/paffinity/linux/plpa/src/libplpa -I../.. -DNDEBUG -g -O3 -finline-functions -fno-strict-aliasing -restrict -pthread -fvisibility=hidden -MT dt_module.lo -MD -MP -MF .deps/dt_module.Tpo -c dt_module.c &nbsp;-fPIC -DPIC -o .libs/dt_module.o</div><div>dt_module.c(709): warning #1224: #warning directive: "No proper C type found for COMPLEX32"</div><div>&nbsp;&nbsp;# &nbsp; warning "No proper C type found for COMPLEX32"</div><div>&nbsp;&nbsp; &nbsp; &nbsp;^</div></blockquote><div><br></div><div>The code in ompi/datatype/dt_module.c (lines 705-713; exactly the same in 1.4.4rc2) is:</div><div><br></div><div><blockquote type="cite"><div><font class="Apple-style-span" color="#000000">#if OMPI_HAVE_FORTRAN_COMPLEX32</font></div><div><font class="Apple-style-span" color="#000000">#if OMPI_REAL16_MATCHES_C &amp;&amp; (OMPI_SIZEOF_FORTRAN_COMPLEX32 == 2*SIZEOF_LONG_DOUBLE)</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp;DECLARE_MPI_SYNONYM_DDT( &amp;ompi_mpi_complex32.dt, "MPI_COMPLEX32", &amp;ompi_mpi_ldblcplex.dt );</font></div><div><font class="Apple-style-span" color="#000000">#else</font></div><div><font class="Apple-style-span" color="#000000"># &nbsp; warning "No proper C type found for COMPLEX32"</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp;DECLARE_MPI_SYNONYM_DDT( &amp;ompi_mpi_complex32.dt, "MPI_COMPLEX32", &amp;ompi_mpi_unavailable.dt );</font></div><div><font class="Apple-style-span" color="#000000">#endif</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp;ompi_mpi_complex32.dt.flags |= DT_FLAG_DATA_FORTRAN | DT_FLAG_DATA_COMPLEX;</font></div><div><font class="Apple-style-span" color="#000000">#endif /* OMPI_HAVE_FORTRAN_COMPLEX32 */</font></div></blockquote></div><div><div><br></div></div><div>I see from configure, that the Intel compilers support REAL*16 and COMPLEX*32, but the representations are different between the C and Fortran compilers:</div><div><br></div><div><div></div></div><blockquote type="cite"><div><div>checking if REAL*16 matches bit representation of long double... no</div><div>configure: WARNING: MPI_REAL16 and MPI_COMPLEX32 support have been disabled</div></div></blockquote><div><br></div><div>I have two observations:</div><div><br></div><div>1) Despite the message saying so, configure does not in fact disable MPI_REAL16 and MPI_COMPLEX32 support; the code in ompi/datatype/dt_module.c happens to catch the error. &nbsp;From&nbsp;opal/include/opal_config.h:</div><div><br></div><div><blockquote type="cite"><div>#define OMPI_ALIGNMENT_FORTRAN_COMPLEX32 1</div></blockquote></div><div><div><blockquote type="cite"><div><font class="Apple-style-span" color="#000000">#define OMPI_ALIGNMENT_FORTRAN_REAL16 1</font></div><div><font class="Apple-style-span" color="#000000">#define OMPI_HAVE_F90_COMPLEX32 1</font></div><div><font class="Apple-style-span" color="#000000">#define OMPI_HAVE_F90_REAL16 1</font></div><div><font class="Apple-style-span" color="#000000">#define OMPI_HAVE_FORTRAN_COMPLEX32 1</font></div><div><font class="Apple-style-span" color="#000000">#define OMPI_HAVE_FORTRAN_REAL16 1</font></div><div><font class="Apple-style-span" color="#000000">#define OMPI_REAL16_MATCHES_C 0</font></div><div><font class="Apple-style-span" color="#000000">#define OMPI_SIZEOF_FORTRAN_COMPLEX32 32</font></div><div><font class="Apple-style-span" color="#000000">#define OMPI_SIZEOF_FORTRAN_REAL16 16</font></div></blockquote></div></div><div><div><br></div></div><div>2)&nbsp;ompi/datatype/dt_module.c does not catch the same error for the incompatible REAL*16 datatype&nbsp;(lines 609-617):</div><div><br></div><div><blockquote type="cite"><div><font class="Apple-style-span" color="#000000">#if OMPI_HAVE_FORTRAN_REAL16</font></div><div><font class="Apple-style-span" color="#000000">#if (OMPI_SIZEOF_FORTRAN_REAL16 == SIZEOF_LONG_DOUBLE) &lt;-- should be&nbsp;</font>#if&nbsp;OMPI_REAL16_MATCHES_C &amp;&amp;&nbsp;(OMPI_SIZEOF_FORTRAN_REAL16 == SIZEOF_LONG_DOUBLE)</div></blockquote><blockquote type="cite"><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp;DECLARE_MPI_SYNONYM_DDT( &amp;ompi_mpi_real16.dt, "MPI_REAL16", &amp;ompi_mpi_long_double.dt );</font></div><div><font class="Apple-style-span" color="#000000">#else</font></div><div><font class="Apple-style-span" color="#000000"># &nbsp; warning "No proper C type found for REAL16"</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp;DECLARE_MPI_SYNONYM_DDT( &amp;ompi_mpi_real16.dt, "MPI_REAL16", &amp;ompi_mpi_unavailable.dt );</font></div><div><font class="Apple-style-span" color="#000000">#endif</font></div><div><font class="Apple-style-span" color="#000000">&nbsp;&nbsp; &nbsp;ompi_mpi_real16.dt.flags |= DT_FLAG_DATA_FORTRAN | DT_FLAG_DATA_FLOAT;</font></div><div><font class="Apple-style-span" color="#000000">#endif /* OMPI_HAVE_FORTRAN_REAL16 */</font></div></blockquote></div><div><div><br></div></div><div>I do not like make warnings. &nbsp;configure determines that the REAL*16 and COMPLEX*32 datatypes are incompatible, but then does not actually disable them, despite saying it did. &nbsp;I like defensive code. &nbsp;The COMPLEX*32 datatype protection needs to be applied to the REAL*16 datatype as well in&nbsp;ompi/datatype/dt_module.c.</div><div><br></div><div apple-content-edited="true"> <div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div><div><div><div><div><div><div><div><div><div>Larry Baker</div><div>US Geological Survey</div><div>650-329-5608</div><div><a href="mailto:baker@usgs.gov">baker@usgs.gov</a></div></div></div></div></div></div></div></div></div></div></div> </div><br><div><div>On 5 May 2011, at 7:15 AM, Jeff Squyres wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div>Fixed the ROMIO attribute problem properly this time -- it's in the usual place:<br><br> &nbsp;&nbsp;&nbsp;<a href="http://www.open-mpi.org/software/ompi/v1.4/">http://www.open-mpi.org/software/ompi/v1.4/</a><br><br>-- <br>Jeff Squyres<br><a href="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a><br>For corporate legal information go to:<br>http://www.cisco.com/web/about/doing_business/legal/cri/<br><br><br>_______________________________________________<br>devel mailing list<br>devel@open-mpi.org<br>http://www.open-mpi.org/mailman/listinfo.cgi/devel<br></div></blockquote></div><br></body></html>
