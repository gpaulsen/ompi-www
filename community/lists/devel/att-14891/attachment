<html><head><meta http-equiv="Content-Type" content="text/html charset=us-ascii"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><br><div><div>On May 28, 2014, at 6:41 AM, Gilles Gouaillardet &lt;<a href="mailto:gilles.gouaillardet@gmail.com">gilles.gouaillardet@gmail.com</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div dir="ltr">Ralph,<br><div class="gmail_extra"><br><br><div class="gmail_quote">On Wed, May 28, 2014 at 9:33 PM, Ralph Castain <span dir="ltr">&lt;<a href="mailto:rhc@open-mpi.org" target="_blank">rhc@open-mpi.org</a>&gt;</span> wrote:<br>
<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div style="word-wrap:break-word"><div><div class=""><blockquote type="cite"><div dir="ltr"><div class="gmail_extra"><div class="gmail_quote">
<div>This is definetly what happens : only some tasks call MPI_Comm_free()</div></div></div></div></blockquote><div><br></div></div>Really? I don't see how that can happen in loop_spawn - every process is clearly calling comm_free. Or are you referring to the intercomm_create test?</div>
<div><div class=""><br></div></div></div></blockquote><div>yes, i am referring intercomm_create test</div></div></div></div></blockquote><div><br></div>kewl - thanks</div><div><br><blockquote type="cite"><div dir="ltr"><div class="gmail_extra"><div class="gmail_quote"><div><br></div><div>about loop_spawn, i could not get any error on my single host single socket VM.</div><div>(i tried --mca btl tcp,sm,self and --mca btl tcp,self)</div>
<div><br></div><div>MPI_Finalize will end up calling ompi_dpm_dyn_finalize which causes the error message on the parent of intercomm_create.</div><div>a necessary condition is ompi_comm_num_dyncomm &gt; 1</div><div>/* which by the way sounds odd to me, should it be 0 ? */</div></div></div></div></blockquote><div><br></div>That does sound odd</div><div><br><blockquote type="cite"><div dir="ltr"><div class="gmail_extra"><div class="gmail_quote">
<div>which imho cannot happen if all communicators have been freed</div><div><br></div><div>can you detail your full mpirun command line, the number of servers you are using, the btl involved and the ompi release that can be used to reproduce the issue ?</div></div></div></div></blockquote><div><br></div>Running on only one server, using the current head of the svn repo. My cluster only has Ethernet, and I let it freely choose the BTLs (so I imagine the candidates are sm,self,tcp,vader). The cmd line is really trivial:</div><div><br></div><div>mpirun -n 1 ./loop_spawn</div><div><br></div><div>I modified loop_spawn to only run 100 iterations as I am not patient enough to wait for 1000, and the number of iters isn't a factor so long as it is greater than 1. When the parent calls finalize, I get one of the following emitted for every iteration that was done:</div><div><br></div><div><div style="margin: 0px; font-size: 11px; font-family: Menlo; background-color: rgb(254, 244, 156);">dpm_base_disconnect_init: error -12 in isend to process 0</div><div><br></div></div><div>So in other words, the parent is attempting to isend to every child that was spawned during the test - it thinks that every comm_spawn'd process remains connected to it.</div><div><br></div><div>I'm wondering if the issue is that the parent and child are calling comm_free, but neither side called comm_disconnect. So unless comm_free is calling disconnect under-the-covers, it might explain why the parent thinks all the children are still present.</div><div><br></div><div><br><blockquote type="cite"><div dir="ltr"><div class="gmail_extra"><div class="gmail_quote">
<div><br></div><div>i will try to reproduce this myself</div><div><br></div><div>Cheers,</div><div><br></div><div>Gilles</div><div><br></div><div><br></div></div></div></div>
_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>Subscription: http://www.open-mpi.org/mailman/listinfo.cgi/devel<br>Link to this post: http://www.open-mpi.org/community/lists/devel/2014/05/14890.php</blockquote></div><br></body></html>
