<div dir="ltr">Did someone pick this up to merge into master &amp; v2.x?<div><br></div><div>I can confirm that Paul&#39;s patch fixes the issue for XL compilers. I didn&#39;t see a PR for it, but can file one if no one has yet.</div></div><div class="gmail_extra"><br><div class="gmail_quote">On Mon, May 2, 2016 at 6:55 PM, Paul Hargrove <span dir="ltr">&lt;<a href="mailto:phhargrove@lbl.gov" target="_blank">phhargrove@lbl.gov</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">It appears that xlc&#39;s support for gcc-style inline asm does not allow an empty clobbers list.<div>The failure I see is</div><div><br></div><div><div><div><font face="monospace, monospace" size="1">libtool: compile:  xlc -DHAVE_CONFIG_H -I. -I/home/hargrove/SCRATCH/OMPI/openmpi-2.0.0rc2-linux-ppc64-xlc-12.1/openmpi-2.0.0rc2/opal/asm -I../../opal/include -I../../ompi/include -I../../oshmem/include -I../../opal/mca/hwloc/hwloc1112/hwloc/include/private/autogen -I../../opal/mca/hwloc/hwloc1112/hwloc/include/hwloc/autogen -I../../ompi/mpiext/cuda/c -I/home/hargrove/SCRATCH/OMPI/openmpi-2.0.0rc2-linux-ppc64-xlc-12.1/openmpi-2.0.0rc2 -I../.. -I/home/hargrove/SCRATCH/OMPI/openmpi-2.0.0rc2-linux-ppc64-xlc-12.1/openmpi-2.0.0rc2/opal/include -I/home/hargrove/SCRATCH/OMPI/openmpi-2.0.0rc2-linux-ppc64-xlc-12.1/openmpi-2.0.0rc2/orte/include -I../../orte/include -I/home/hargrove/SCRATCH/OMPI/openmpi-2.0.0rc2-linux-ppc64-xlc-12.1/openmpi-2.0.0rc2/ompi/include -I/home/hargrove/SCRATCH/OMPI/openmpi-2.0.0rc2-linux-ppc64-xlc-12.1/openmpi-2.0.0rc2/oshmem/include -D_REENTRANT -I/home/hargrove/SCRATCH/OMPI/openmpi-2.0.0rc2-linux-ppc64-xlc-12.1/openmpi-2.0.0rc2/opal/mca/hwloc/hwloc1112/hwloc/include -I/home/hargrove/SCRATCH/OMPI/openmpi-2.0.0rc2-linux-ppc64-xlc-12.1/BLD/opal/mca/hwloc/hwloc1112/hwloc/include -I/home/hargrove/SCRATCH/OMPI/openmpi-2.0.0rc2-linux-ppc64-xlc-12.1/openmpi-2.0.0rc2/opal/mca/event/libevent2022/libevent -I/home/hargrove/SCRATCH/OMPI/openmpi-2.0.0rc2-linux-ppc64-xlc-12.1/openmpi-2.0.0rc2/opal/mca/event/libevent2022/libevent/include -I/home/hargrove/SCRATCH/OMPI/openmpi-2.0.0rc2-linux-ppc64-xlc-12.1/BLD/opal/mca/event/libevent2022/libevent/include -q64 -g -c /home/hargrove/SCRATCH/OMPI/openmpi-2.0.0rc2-linux-ppc64-xlc-12.1/openmpi-2.0.0rc2/opal/asm/asm.c -Wp,-qmakedep=gcc,-MF.deps/asm.TPlo  -qpic -DPIC -o .libs/asm.o</font></div><div><font face="monospace, monospace" size="1">&quot;/home/hargrove/SCRATCH/OMPI/openmpi-2.0.0rc2-linux-ppc64-xlc-12.1/openmpi-2.0.0rc2/opal/include/opal/sys/powerpc/atomic.h&quot;, line 150.27: 1506-276 (S) Syntax error: possible missing string literal?</font></div><div><font face="monospace, monospace" size="1">&quot;/home/hargrove/SCRATCH/OMPI/openmpi-2.0.0rc2-linux-ppc64-xlc-12.1/openmpi-2.0.0rc2/opal/include/opal/sys/powerpc/atomic.h&quot;, line 239.27: 1506-276 (S) Syntax error: possible missing string literal?</font></div><div><font face="monospace, monospace" size="1">make[2]: *** [asm.lo] Error 1</font></div></div><div><br></div><div><br></div><div>The code corresponding to the first error message is</div></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><div><div><font face="monospace, monospace">   143  static inline int32_t opal_atomic_ll_32 (volatile int32_t *addr)</font></div></div></div><div><div><div><font face="monospace, monospace">   144  {</font></div></div></div><div><div><div><font face="monospace, monospace">   145     int32_t ret;</font></div></div></div><div><div><div><font face="monospace, monospace">   146</font></div></div></div><div><div><div><font face="monospace, monospace">   147     __asm__ __volatile__ (&quot;lwarx   %0, 0, %1  \n\t&quot;</font></div></div></div><div><div><div><font face="monospace, monospace">   148                           : &quot;=&amp;r&quot; (ret)</font></div></div></div><div><div><div><font face="monospace, monospace">   149                           : &quot;r&quot; (addr)</font></div></div></div><div><div><div><span style="background-color:rgb(255,255,0)"><font face="monospace, monospace">   150                           :);</font></span></div></div></div><div><div><div><font face="monospace, monospace">   151     return ret;</font></div></div></div><div><div><div><font face="monospace, monospace">   152  }</font></div></div></div></blockquote><div><div>And the second error is the identical line as it appears in opal_atomic_ll_64().</div><div><br></div><div>The following patch to remove the &quot;trailing&quot; colons was sufficient to fix this problem.</div><div><br></div><div><div><div><font face="monospace, monospace">--- openmpi-2.0.0rc2/opal/include/opal/sys/powerpc/atomic.h~    2016-05-02 23:37:13.597782000 +0000</font></div><div><font face="monospace, monospace">+++ openmpi-2.0.0rc2/opal/include/opal/sys/powerpc/atomic.h     2016-05-02 23:36:11.615404378 +0000</font></div><div><font face="monospace, monospace">@@ -147,7 +147,7 @@</font></div><div><font face="monospace, monospace">    __asm__ __volatile__ (&quot;lwarx   %0, 0, %1  \n\t&quot;</font></div><div><font face="monospace, monospace">                          : &quot;=&amp;r&quot; (ret)</font></div><div><font face="monospace, monospace">                          : &quot;r&quot; (addr)</font></div><div><font face="monospace, monospace">-                         :);</font></div><div><font face="monospace, monospace">+                          );</font></div><div><font face="monospace, monospace">    return ret;</font></div><div><font face="monospace, monospace"> }</font></div><div><font face="monospace, monospace"><br></font></div><div><font face="monospace, monospace">@@ -236,7 +236,7 @@</font></div><div><font face="monospace, monospace">    __asm__ __volatile__ (&quot;ldarx   %0, 0, %1  \n\t&quot;</font></div><div><font face="monospace, monospace">                          : &quot;=&amp;r&quot; (ret)</font></div><div><font face="monospace, monospace">                          : &quot;r&quot; (addr)</font></div><div><font face="monospace, monospace">-                         :);</font></div><div><font face="monospace, monospace">+                          );</font></div><div><font face="monospace, monospace">    return ret;</font></div><div><font face="monospace, monospace"> }</font></div><span class="HOEnZb"><font color="#888888"><div><br></div></font></span></div></div><span class="HOEnZb"><font color="#888888"><div><br></div><div><br></div><div>-Paul</div><div><br></div>-- <br><div><div dir="ltr"><div><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Computer Languages &amp; Systems Software (CLaSS) Group</div><div>Computer Science Department               Tel: <a href="tel:%2B1-510-495-2352" value="+15104952352" target="_blank">+1-510-495-2352</a></div><div>Lawrence Berkeley National Laboratory     Fax: <a href="tel:%2B1-510-486-6900" value="+15104866900" target="_blank">+1-510-486-6900</a></div></font></div></div></div>
</font></span></div></div>
<br>_______________________________________________<br>
devel mailing list<br>
<a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
Subscription: <a href="https://www.open-mpi.org/mailman/listinfo.cgi/devel" rel="noreferrer" target="_blank">https://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2016/05/18886.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/devel/2016/05/18886.php</a><br></blockquote></div><br></div>

