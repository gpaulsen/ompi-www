<html><head><meta http-equiv="Content-Type" content="text/html charset=iso-8859-1"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;" class="">Forwarding this for Paul until his email address gets updated on the User list:<br class=""><div><br class=""><blockquote type="cite" class=""><div class="">Begin forwarded message:</div><br class="Apple-interchange-newline"><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;" class=""><span style="font-family: -webkit-system-font, Helvetica Neue, Helvetica, sans-serif; color:rgba(0, 0, 0, 1.0);" class=""><b class="">Date: </b></span><span style="font-family: -webkit-system-font, Helvetica Neue, Helvetica, sans-serif;" class="">October 17, 2014 at 6:35:31 AM PDT<br class=""></span></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;" class=""><span style="font-family: -webkit-system-font, Helvetica Neue, Helvetica, sans-serif; color:rgba(0, 0, 0, 1.0);" class=""><b class="">From: </b></span><span style="font-family: -webkit-system-font, Helvetica Neue, Helvetica, sans-serif;" class="">Paul Kapinos &lt;<a href="mailto:kapinos@itc.rwth-aachen.de" class="">kapinos@itc.rwth-aachen.de</a>&gt;<br class=""></span></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;" class=""><span style="font-family: -webkit-system-font, Helvetica Neue, Helvetica, sans-serif; color:rgba(0, 0, 0, 1.0);" class=""><b class="">To: </b></span><span style="font-family: -webkit-system-font, Helvetica Neue, Helvetica, sans-serif;" class="">Open MPI Users &lt;<a href="mailto:users@open-mpi.org" class="">users@open-mpi.org</a>&gt;<br class=""></span></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;" class=""><span style="font-family: -webkit-system-font, Helvetica Neue, Helvetica, sans-serif; color:rgba(0, 0, 0, 1.0);" class=""><b class="">Cc: </b></span><span style="font-family: -webkit-system-font, Helvetica Neue, Helvetica, sans-serif;" class="">"Kapinos, Paul" &lt;<a href="mailto:kapinos@itc.rwth-aachen.de" class="">kapinos@itc.rwth-aachen.de</a>&gt;, &lt;<a href="mailto:frings@cats.rwth-aachen.de" class="">frings@cats.rwth-aachen.de</a>&gt;<br class=""></span></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;" class=""><span style="font-family: -webkit-system-font, Helvetica Neue, Helvetica, sans-serif; color:rgba(0, 0, 0, 1.0);" class=""><b class="">Subject: </b></span><span style="font-family: -webkit-system-font, Helvetica Neue, Helvetica, sans-serif;" class=""><b class="">Open MPI 1.8: link problem when Fortran+C+Platform LSF</b><br class=""></span></div><br class=""><div class="">Dear Open MPI developer,<br class=""><br class="">we have both Open MPI 1.6(.5) and 1.8(.3) in our cluster, configured to be used with Platform LSF.<br class=""><br class="">One of our users run into an issue when trying to link his code (combination of lex/C and Fortran) with v.1.8, whereby with OpenMPI/1.6er the code can be linked OK.<br class=""><br class=""> &gt; $ make<br class=""> &gt; mpif90 -c main.f90<br class=""> &gt; yacc -d example4.y<br class=""> &gt; mpicc -c y.tab.c<br class=""> &gt; mpicc -c mymain.c<br class=""> &gt; lex example4.l<br class=""> &gt; mpicc -c lex.yy.c<br class=""> &gt; mpif90 -o example main.o y.tab.o mymain.o lex.yy.o<br class=""> &gt; ld: y.tab.o(.text+0xd9): unresolvable R_X86_64_PC32 relocation against symbol `yylval'<br class=""> &gt; ld: y.tab.o(.text+0x16f): unresolvable R_X86_64_PC32 relocation against symbol `yyval'<br class=""> &gt; .......<br class=""><br class="">looking into "mpif90 --show-me" let us see that the link line and possibly the philosophy behind it has been changed, there is also a note on it:<br class=""><br class=""># Note that per <a href="https://svn.open-mpi.org/trac/ompi/ticket/3422" class="">https://svn.open-mpi.org/trac/ompi/ticket/3422</a>, we<br class=""># intentionally only link in the MPI libraries (ORTE, OPAL, etc. are<br class=""># pulled in implicitly) because we intend MPI applications to only use<br class=""># the MPI API.<br class=""><br class=""><br class=""><br class=""><br class="">Well, by now we know two workarounds:<br class="">a) add "-lbat -llsf" to the link line<br class="">b) add " -Wl,--as-needed" to the link line<br class=""><br class="">What would be better? Maybe one of this should be added to linker_flags=..." in the .../share/openmpi/mpif90-wrapper-data.txt file? As of the note above, (b) would be better?<br class=""><br class="">Best<br class=""><br class="">Paul Kapinos<br class=""><br class="">P.S. $ mpif90 --show-me<br class=""><br class="">1.6.5<br class="">ifort -nofor-main -I/opt/MPI/openmpi-1.6.5/linux/intel/include -fexceptions -I/opt/MPI/openmpi-1.6.5/linux/intel/lib -L/opt/lsf/9.1/linux2.6-glibc2.3-x86_64/lib -L/opt/MPI/openmpi-1.6.5/linux/intel/lib -lmpi_f90 -lmpi_f77 -lmpi -losmcomp -lrdmacm -libverbs -lrt -lnsl -lutil -lpsm_infinipath -lbat -llsf -ldl -lm -lnuma -lrt -lnsl -lutil<br class=""><br class="">1.8.3<br class="">ifort &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-I/opt/MPI/openmpi-1.8.3/linux/intel/include -fexceptions -I/opt/MPI/openmpi-1.8.3/linux/intel/lib -L/opt/lsf/9.1/linux2.6-glibc2.3-x86_64/lib -Wl,-rpath -Wl,/opt/lsf/9.1/linux2.6-glibc2.3-x86_64/lib -Wl,-rpath -Wl,/opt/MPI/openmpi-1.8.3/linux/intel/lib -Wl,--enable-new-dtags -L/opt/MPI/openmpi-1.8.3/linux/intel/lib -lmpi_usempif08 -lmpi_usempi_ignore_tkr -lmpi_mpifh -lmpi<br class=""><br class="">P.S.2 $ man ld<br class="">....<br class=""> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--as-needed<br class=""> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--no-as-needed<br class=""> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This option affects ELF DT_NEEDED tags for dynamic libraries<br class=""> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mentioned on the command line after the --as-needed option.<br class=""> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Normally the linker will add a DT_NEEDED tag for each dynamic<br class=""> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;library mentioned on the command line, regardless of whether the<br class=""> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;library is actually needed or not. &nbsp;--as-needed causes a DT_NEEDED<br class=""> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tag to only be emitted for a library that satisfies an undefined<br class=""> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;symbol reference from a regular object file or, if the library is<br class=""> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not found in the DT_NEEDED lists of other libraries linked up to<br class=""> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that point, an undefined symbol reference from another dynamic<br class=""> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;library. &nbsp;--no-as-needed restores the default behaviour.<br class=""><br class="">....<br class=""><br class="">-- <br class="">Dipl.-Inform. Paul Kapinos &nbsp;&nbsp;- &nbsp;&nbsp;High Performance Computing,<br class="">RWTH Aachen University, IT Center<br class="">Seffenter Weg 23, &nbsp;D 52074 &nbsp;Aachen (Germany)<br class="">Tel: +49 241/80-24915<br class=""><br class=""></div></blockquote></div></body></html>
