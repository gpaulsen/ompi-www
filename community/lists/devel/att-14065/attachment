<div dir="ltr"><div>I found the source of the problem, and a solution.</div><div><br></div><div>The following is r30612, in which Jeff thought he had fixed the problem:</div><div><br></div><div><div><font face="courier new, monospace" size="1">--- opal/util/path.c    (revision 30611)</font></div>
<div><font face="courier new, monospace" size="1">+++ opal/util/path.c    (revision 30612)</font></div><div><font face="courier new, monospace" size="1">@@ -515,12 +515,17 @@</font></div><div><font face="courier new, monospace" size="1">     } while (-1 == vfsrc &amp;&amp; ESTALE == errno &amp;&amp; (0 &lt; --trials));</font></div>
<div><font face="courier new, monospace" size="1"> #endif</font></div><div><font face="courier new, monospace" size="1"><br></font></div><div><font face="courier new, monospace" size="1">-    /* In case some error with the current filename, try the directory */</font></div>
<div><font face="courier new, monospace" size="1">+    /* In case some error with the current filename, try the parent</font></div><div><font face="courier new, monospace" size="1">+       directory */</font></div><div><font face="courier new, monospace" size="1">     if (-1 == fsrc &amp;&amp; -1 == vfsrc) {</font></div>
<div><font face="courier new, monospace" size="1">         char * last_sep;</font></div><div><font face="courier new, monospace" size="1"><br></font></div><div><font face="courier new, monospace" size="1">         OPAL_OUTPUT_VERBOSE((10, 0, &quot;opal_path_nfs: stat(v)fs on file:%s failed errno:%d directory:%s\n&quot;,</font></div>
<div><font face="courier new, monospace" size="1">                              fname, errno, file));</font></div><div><font face="courier new, monospace" size="1">+        if (EPERM == errno) {</font></div><div><font face="courier new, monospace" size="1">+            free(file);</font></div>
<div><font face="courier new, monospace" size="1">+            return false;</font></div><div><font face="courier new, monospace" size="1">+        }</font></div><div><font face="courier new, monospace" size="1"><br></font></div>
<div><font face="courier new, monospace" size="1">         last_sep = strrchr(file, OPAL_PATH_SEP[0]);</font></div><div><font face="courier new, monospace" size="1">         /* Stop the search, when we have searched past root &#39;/&#39; */</font></div>
</div><div><br></div><div><br></div><div>The new code to handle EPERM isn&#39;t reachable in general because fsrc and vfsrc aren&#39;t initialized and thus won&#39;t both be -1 unless both calls have run and failed.  However, on many/most systems only one of the two calls exist.  If I weren&#39;t passing --enable-debug to all my builds, I suspect I&#39;d have seen an used-uninitialized warning for the &quot;if&quot; (which is a product of other recent fixes in this function, r30198 on trunk).</div>
<div><br></div>The following fixes the problem for me:<div><br></div><div><div><font face="courier new, monospace" size="1">--- opal/util/path.c~   2014-02-09 23:52:37.764571000 +0100</font></div><div><font face="courier new, monospace" size="1">+++ opal/util/path.c    2014-02-09 23:53:21.800383233 +0100</font></div>
<div><font face="courier new, monospace" size="1">@@ -471,7 +471,8 @@</font></div><div><font face="courier new, monospace" size="1"> {</font></div><div><font face="courier new, monospace" size="1"> #if !defined(__WINDOWS__)</font></div>
<div><font face="courier new, monospace" size="1">     int i;</font></div><div><font face="courier new, monospace" size="1">-    int fsrc, vfsrc;</font></div><div><font face="courier new, monospace" size="1">+    int fsrc = -1;</font></div>
<div><font face="courier new, monospace" size="1">+    int vfsrc = -1;</font></div><div><font face="courier new, monospace" size="1">     int trials;</font></div><div><font face="courier new, monospace" size="1">     char * file = strdup (fname);</font></div>
<div><font face="courier new, monospace" size="1"> #if defined(USE_STATFS)</font></div><div><br></div><div>-Paul</div><div class="gmail_extra"><br><br><div class="gmail_quote">On Sat, Feb 8, 2014 at 10:00 AM, Ralph Castain <span dir="ltr">&lt;<a href="mailto:rhc@open-mpi.org" target="_blank">rhc@open-mpi.org</a>&gt;</span> wrote:<br>
<blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex"><div style="word-wrap:break-word">Sounds like it - I&#39;ll take a peek and see if I can spot it, otherwise will have to wait for Jeff next week<div>
<br><div><div>On Feb 8, 2014, at 9:56 AM, Paul Hargrove &lt;<a href="mailto:phhargrove@lbl.gov" target="_blank">phhargrove@lbl.gov</a>&gt; wrote:</div><br><blockquote type="cite"><div style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px">
<div dir="ltr">A test of Friday night&#39;s trunk tarball is failing in the same manner.<div>So, the CMR isn&#39;t the issue - the problem was never (fully?) fixed in trunk.</div><div><br></div><div>-Paul</div></div><div class="gmail_extra">
<br><br><div class="gmail_quote">On Fri, Feb 7, 2014 at 9:06 PM, Paul Hargrove<span> </span><span dir="ltr">&lt;<a href="mailto:phhargrove@lbl.gov" target="_blank">phhargrove@lbl.gov</a>&gt;</span><span> </span>wrote:<br>
<blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex"><div dir="ltr">I tested the 1.7 tarball tonight.<div>Jeff had indicated (<a href="http://www.open-mpi.org/community/lists/devel/2014/01/13785.php" target="_blank">http://www.open-mpi.org/community/lists/devel/2014/01/13785.php</a>) that the problem I had reported w/ opal_path_nfs() and EPERM had been fixed in the trunk.</div>
<div>Trac ticket #4125 indicated the fix was CMRed to v1.7</div><div><br></div><div>However, I still see the problem:</div><div><div><font face="courier new, monospace"> Failure : Mismatch: input &quot;/users/course13/.gvfs&quot;, expected:0 got:1</font></div>
<div><font face="courier new, monospace"><br></font></div><div><font face="courier new, monospace"> Failure : Mismatch: input &quot;/users/steineju/.gvfs&quot;, expected:0 got:1</font></div><div><font face="courier new, monospace"><br>
</font></div><div><font face="courier new, monospace">SUPPORT: OMPI Test failed: opal_path_nfs() (2 of 20 failed)</font></div><div><font face="courier new, monospace">FAIL: opal_path_nfs</font></div></div><div><br></div><div>
<br></div><div>I don&#39;t currently know if the problem was every fixed on the trunk, but should know by morning.<span><font color="#888888"><br clear="all"><div><br></div><div>-Paul</div><span class=""><font color="#888888"><div>
<br></div>--<span> </span><br><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Future Technologies Group</div>
<div>Computer and Data Sciences Department     Tel:<span> </span><a href="tel:%2B1-510-495-2352" value="+15104952352" target="_blank">+1-510-495-2352</a></div><div>Lawrence Berkeley National Laboratory     Fax:<span> </span><a href="tel:%2B1-510-486-6900" value="+15104866900" target="_blank">+1-510-486-6900</a></div>
</font></font></span></font></span></div></div></blockquote></div><span class=""><font color="#888888"><br><br clear="all"><div><br></div>--<span> </span><br><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div>
<div>Future Technologies Group</div><div>Computer and Data Sciences Department     Tel: <a href="tel:%2B1-510-495-2352" value="+15104952352" target="_blank">+1-510-495-2352</a></div><div>Lawrence Berkeley National Laboratory     Fax: <a href="tel:%2B1-510-486-6900" value="+15104866900" target="_blank">+1-510-486-6900</a></div>
</font></font></span></div><span class=""><font color="#888888">_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org" target="_blank">devel@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a></font></span></div>
</blockquote></div><br></div></div><br>_______________________________________________<br>
devel mailing list<br>
<a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
<a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br></blockquote></div><br><br clear="all"><div><br></div>-- <br><font face="courier new, monospace"><div>
Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Future Technologies Group</div><div>Computer and Data Sciences Department     Tel: +1-510-495-2352</div>
<div>Lawrence Berkeley National Laboratory     Fax: +1-510-486-6900</div></font>
</div></div></div>

