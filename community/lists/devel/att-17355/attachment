<div dir="ltr"><div>Yeah, I remember this one. Its a bug in that specific version of the compiler. I had reported it to the compiler team a couple of years back. <br><br>Quoting from the email I sent them:<br>The &quot;stw     r0,0(r31)&quot; probably overwrites the previous stack pointer ?<br></div><br>static inline int opal_atomic_cmpset_32(volatile int32_t *addr,<br>10000580:       94 21 ff c0     stwu    r1,-64(r1)<br>10000584:       93 e1 00 3c     stw     r31,60(r1)<br>10000588:       7c 3f 0b 78     mr      r31,r1<br>1000058c:       90 7f 00 24     stw     r3,36(r31)<br>10000590:       90 9f 00 28     stw     r4,40(r31)<br>10000594:       90 bf 00 2c     stw     r5,44(r31)<br>                                        int32_t oldval, int32_t newval)<br>{<br>   int32_t ret;<br><br>   __asm__ __volatile__ (<br>10000598:       80 9f 00 28     lwz     r4,40(r31)<br>1000059c:       80 7f 00 2c     lwz     r3,44(r31)<br>100005a0:       80 1f 00 24     lwz     r0,36(r31)<br><b>100005a4:       90 1f 00 00     stw     r0,0(r31)</b><br>100005a8:       90 1f 00 04     stw     r0,4(r31)<br>100005ac:       90 9f 00 08     stw     r4,8(r31)<br>100005b0:       90 7f 00 0c     stw     r3,12(r31)<br>100005b4:       90 1f 00 10     stw     r0,16(r31)<br>100005b8:       80 7f 00 04     lwz     r3,4(r31)<br>100005bc:       7c 80 18 28     lwarx   r4,0,r3<br>100005c0:       80 1f 00 08     lwz     r0,8(r31)<br>100005c4:       7c 04 00 00     cmpw    r4,r0<br>100005c8:       90 9f 00 14     stw     r4,20(r31)<br>100005cc:       90 7f 00 04     stw     r3,4(r31)<br>100005d0:       90 1f 00 08     stw     r0,8(r31)<br>100005d4:       40 82 00 1c     bne-    100005f0 &lt;opal_atomic_cmpset_32+0x70&gt;<br>100005d8:       80 1f 00 0c     lwz     r0,12(r31)<br>100005dc:       80 7f 00 04     lwz     r3,4(r31)<br>100005e0:       7c 00 19 2d     stwcx.  r0,0,r3<br><div><br></div><div>Regards<br></div><div>--Nysal</div></div><div class="gmail_extra"><br><div class="gmail_quote">On Fri, Apr 24, 2015 at 5:06 AM, Paul Hargrove <span dir="ltr">&lt;<a href="mailto:phhargrove@lbl.gov" target="_blank">phhargrove@lbl.gov</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Exhibit 1: the smoking gun<div><br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><div><font face="monospace, monospace">Program terminated with signal 11, Segmentation fault.</font></div></div><div><div><font face="monospace, monospace">#0  0x00000fffa4d6f184 in opal_atomic_cmpset_acq_32 (addr=Cannot access memory at address 0xd8</font></div></div><div><div><font face="monospace, monospace">)</font></div></div><div><div><font face="monospace, monospace">    at /home/hargrov1/OMPI/openmpi-1.8.5rc3-linux-ppc64-xlc-11.1/openmpi-1.8.5rc3/opal/include/opal/sys/powerpc/atomic.h:158</font></div></div></blockquote><font face="monospace, monospace"><br></font><div><font face="arial, helvetica, sans-serif">So, this is a new symptom of the known inability of this compiler to get the inline asm right.</font></div><div><font face="arial, helvetica, sans-serif"><br></font></div><div><font face="arial, helvetica, sans-serif">Sorry for the false alarm,</font></div><div><font face="arial, helvetica, sans-serif">-Paul</font></div></div><div class="HOEnZb"><div class="h5"><div class="gmail_extra"><br><div class="gmail_quote">On Thu, Apr 23, 2015 at 4:09 PM, Paul Hargrove <span dir="ltr">&lt;<a href="mailto:phhargrove@lbl.gov" target="_blank">phhargrove@lbl.gov</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">I have a system w/ xlc-11.1.<div>It has essentially always failed &quot;make check&quot; in a LP64 build due to xlc botching the atomics.</div><div>So, when it failed with 1.8.5.rc2 I didn&#39;t look closely.</div><div><br></div><div>Today it has failed with rc3 and I *did* look closely and here is what I see:</div><div><br></div><div><div>PASS: predefined_gap_test</div><div>/bin/sh: line 5: 39766 Segmentation fault      ${dir}$tst</div><div>FAIL: dlopen_test</div><div>========================================================</div><div>1 of 2 tests failed</div><div>Please report to <a href="http://www.open-mpi.org/community/help/" target="_blank">http://www.open-mpi.org/community/help/</a></div><div>========================================================</div><div><br></div><div>I also see the same in the rc2 results I hadn&#39;t examined closely before.</div><div>Meanwhile the rc1 failure was the known atomics-related one.</div><div><br></div><div>So, UNLESS I find that the dlopen_test failure is related to the atomics or some other problem specific to xlc, this may be a new issue related to the elimination of the built-in libltdl.  Note that this system.</div><div><br></div><div>Here&#39;s hoping this is a new symptom, and not a new problem.</div><span><font color="#888888"><div><br></div><div>-Paul</div><div><br></div>-- <br><div><div dir="ltr"><div><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Computer Languages &amp; Systems Software (CLaSS) Group</div><div>Computer Science Department               Tel: <a href="tel:%2B1-510-495-2352" value="+15104952352" target="_blank">+1-510-495-2352</a></div><div>Lawrence Berkeley National Laboratory     Fax: <a href="tel:%2B1-510-486-6900" value="+15104866900" target="_blank">+1-510-486-6900</a></div></font></div></div></div>
</font></span></div></div>
</blockquote></div><br><br clear="all"><div><br></div>-- <br><div><div dir="ltr"><div><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Computer Languages &amp; Systems Software (CLaSS) Group</div><div>Computer Science Department               Tel: <a href="tel:%2B1-510-495-2352" value="+15104952352" target="_blank">+1-510-495-2352</a></div><div>Lawrence Berkeley National Laboratory     Fax: <a href="tel:%2B1-510-486-6900" value="+15104866900" target="_blank">+1-510-486-6900</a></div></font></div></div></div>
</div>
</div></div><br>_______________________________________________<br>
devel mailing list<br>
<a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2015/04/17352.php" target="_blank">http://www.open-mpi.org/community/lists/devel/2015/04/17352.php</a><br></blockquote></div><br></div>

