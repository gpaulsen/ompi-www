<html><head><meta http-equiv="Content-Type" content="text/html charset=us-ascii"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><br><div><div>On May 28, 2014, at 4:45 AM, Gilles Gouaillardet &lt;<a href="mailto:gilles.gouaillardet@gmail.com">gilles.gouaillardet@gmail.com</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div dir="ltr">Jeff,<br><div class="gmail_extra"><br></div><div class="gmail_extra"><div class="gmail_quote">On Wed, May 28, 2014 at 8:31 PM, Jeff Squyres (jsquyres)&nbsp;</div><div class="gmail_quote">&gt; To be totally clear: MPI says it is erroneous for only some (not all) processes in a communicator to call MPI_COMM_FREE. &nbsp;So if that's the real problem, then the discussion about why the parent(s) is(are) trying to contact the children is moot -- the test is erroneous, and erroneous application behavior is undefined.<div>
<br></div><div>This is definetly what happens : only some tasks call MPI_Comm_free()</div></div></div></div></blockquote><div><br></div>Really? I don't see how that can happen in loop_spawn - every process is clearly calling comm_free. Or are you referring to the intercomm_create test?</div><div><br><blockquote type="cite"><div dir="ltr"><div class="gmail_extra"><div class="gmail_quote"><div>i will commit my changes and the initially reported issue is solved :-)</div><div><br></div><div><br></div><div><br></div><div>
about the "bonus points" :</div><div><br></div><div>v1.8 does not have this issue</div><div><br></div><div>i digged it and bottom line, the parent (who did not call MPI_Comm_free unlike the children)</div></div></div></div></blockquote><div><br></div>I see the parent doing it in every loop:</div><div><br></div><div><div>&nbsp; &nbsp; MPI_Init( &amp;argc, &amp;argv);</div><div><br></div><div>&nbsp; &nbsp; for (iter = 0; iter &lt; 1000; ++iter) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; MPI_Comm_spawn(EXE_TEST, NULL, 1, MPI_INFO_NULL,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0, MPI_COMM_WORLD, &amp;comm, &amp;err);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; printf("parent: MPI_Comm_spawn #%d return : %d\n", iter, err);</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp; MPI_Intercomm_merge(comm, 0, &amp;merged);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; MPI_Comm_rank(merged, &amp;rank);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; MPI_Comm_size(merged, &amp;size);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; printf("parent: MPI_Comm_spawn #%d rank %d, size %d\n",&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iter, rank, size);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; MPI_Comm_free(&amp;merged);</div><div>&nbsp; &nbsp; }</div><div><br></div><div>&nbsp; &nbsp; MPI_Finalize();</div><div><br></div><div>I suspect that you are talking about intercomm_create, hence my confusion.</div><div><br></div><div><br></div><blockquote type="cite"><div dir="ltr"><div class="gmail_extra"><div class="gmail_quote"><div> calls ompi_dpm_base_dyn_finalize, which tries to isend the already exited tasks.</div>
<div><br></div><span style="font-size:13px;font-family:arial,sans-serif"><div class="gmail_quote"><span style="font-size:13px;font-family:arial,sans-serif"><br></span></div>bottom line, in pml_ob1_sendreq.h line 450</span><br style="font-size:13px;font-family:arial,sans-serif">
<br>with v1,8<br style="font-size:13px;font-family:arial,sans-serif"><span style="font-size:13px;font-family:arial,sans-serif">mca_bml_base_btl_array_get_</span><span style="font-size:13px;font-family:arial,sans-serif">size(&amp;endpoint-&gt;btl_eager) = 0</span></div>
<div class="gmail_quote">nothing is sent but isend is reported successful</div><div class="gmail_quote"><br></div><div class="gmail_quote">with trunk<br><span style="font-size:13px;font-family:arial,sans-serif">mca_bml_base_btl_array_get_</span><span style="font-size:13px;font-family:arial,sans-serif">size(&amp;endpoint-&gt;btl_eager) = 1</span></div>
<div class="gmail_quote"><font face="arial, sans-serif">and then try to send the message =&gt;</font>&nbsp;BOUM</div><div class="gmail_quote"><br></div><div class="gmail_quote">i found various things that seem counter intuitive to me and will summarize all this tomorrow.</div>
<div class="gmail_quote"><br></div><div class="gmail_quote">Cheers,</div><div class="gmail_quote"><br></div><div class="gmail_quote">Gilles</div></div></div>
_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>Subscription: http://www.open-mpi.org/mailman/listinfo.cgi/devel<br>Link to this post: http://www.open-mpi.org/community/lists/devel/2014/05/14884.php</blockquote></div><br></body></html>
