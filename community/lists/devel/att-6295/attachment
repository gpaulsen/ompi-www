<html><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">Had a chance to think about how this might be done, and looked at it for awhile after getting home. I -think- I found a way to do it, but there are a couple of caveats:<div><br></div><div>1. Len's point about oversubscribing without warning would definitely hold true - this would positively be a "user beware" option</div><div><br></div><div>2. there could be no RM-provided allocation, hostfile, or -host options specified. Basically, I would be adding the "read rankfile" option to the end of the current allocation determination procedure</div><div><br></div><div>I&nbsp;would&nbsp;still&nbsp;allow more procs than shown in the rankfile (mapping the rest bynode on the nodes specified in the rankfile - can't do byslot because I don't know how many slots are on each node), which means the only change in behavior would be the forced bynode mapping of unspecified procs.</div><div><br></div><div>So use of this option will entail some risks and a slight difference in behavior, but would relieve you from the burden of having to provide a hostfile. I'm not personally convinced it is worth the risk and probable user complaints of "it didn't work", but since we don't use this option, I don't have a strong opinion on the matter.</div><div><br></div><div>Let's&nbsp;just&nbsp;avoid&nbsp;going back-and-forth over wanting it, or how it should be implemented - let's get it all ironed out, and then implement it once, like we finally did at the end with the whole hostfile thing.</div><div><br></div><div>Let me know if you want me to do this - it obviously isn't at the top of my priority list, but still could be done in the next few weeks.</div><div><br></div><div>Ralph</div><div><br></div><div><br><div><div>On Jun 21, 2009, at 9:00 AM, Lenny Verkhovsky wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div dir="ltr"><div>Sorry for the delay in response,&nbsp;<br></div><div>I totally agree with Ralph that it's not as easy as it seems,&nbsp;</div><div>1. rankfile mapper uses already allocated machines ( by scheduler or hostfile ), by using rankfile as a hostfile we can run into problem where trying to use unallocated nodes, what can hang the run.</div> <div>2. we can't define in rankfile number of slots on each machine, which means oversubscribing can take place without any warning.</div><div>3. I personally dont see any problem using hostfile, even if it has redundant info, hostfile and rankfile belong to different layers in the system and solve different problems. The original hostfile ( if I recall correctly ) could bind rank to the node, but the syntax wasn't very flexible and clear.</div> <div></div><div>Lenny.</div><div></div><br><div class="gmail_quote">On Sun, Jun 21, 2009 at 5:15 PM, Ralph Castain <span dir="ltr">&lt;<a href="mailto:rhc@open-mpi.org">rhc@open-mpi.org</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex;"> Let me suggest a two-step process, then:<div><br></div><div>1. let's change the error message as this is easily done and thus can be done now</div><div><br></div><div>2. I can look at how to eat the rankfile as a hostfile. This may not even be possible - the problem is that the entire system is predicated on certain ordering due to our framework architecture. So we get an allocation, and then do a mapping against that allocation, filtering the allocation through hostfiles, -host, and other options.</div> <div><br></div><div>By the time we reach the rankfile mapper, we have already determined that we don't have an allocation and have to abort. It is the rankfile mapper itself that looks for the -rankfile option, so the system can have no knowledge that someone has specified that option before that point - and thus, even if I could parse the rankfile, I don't know it was given!</div> <div><br></div><div>What will take time is to figure out a way to either:</div><div><br></div><div>(a) allow us to run the mapper even though we don't have any nodes we know about, and allow the mapper to insert the nodes itself - without causing non-rankfile uses to break (which could be a major feat); or</div> <div><br></div><div>(b) have the overall system check for the rankfile option and pass it as a hostfile as well, assuming that a hostfile wasn't also given, no RM-based allocation exists, etc. - which breaks our abstraction rules and also opens a possible can of worms.</div> <div><br></div><div>Either way, I also then have to teach the hostfile parser how to realize it is a rankfile format and convert the info in it into what we expected to receive from a hostfile - another non-trivial problem.</div> <div><br></div><div>I'm willing to give it a try - just trying to make clear why my response was negative. It isn't as simple as it sounds...which is why Len and I didn't pursue it when this was originally developed.</div> <div><br></div><font color="#888888"><div>Ralph</div></font><div><div class="h5"><div><br><br><div class="gmail_quote">On Sun, Jun 21, 2009 at 5:28 AM, Terry Dontje <span dir="ltr">&lt;<a href="mailto:Terry.Dontje@sun.com" target="_blank">Terry.Dontje@sun.com</a>&gt;</span> wrote:<br> <blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"> Being a part of these discussions I can understand your reticence to reopen this discussion. &nbsp;However, I think this is a major usability issue with this feature which actually is fairly important in order to get things to run performant. Which IMO is important.<br> <br> That being said I think there are one of two things that could be done to mitigate the issue.<br> <br> 1. &nbsp;To eliminate the element of surprise by changing mpirun to eat rankfile without the hostfile.<br> 2. &nbsp;To change the error message to something understandable by the user such that they<br> know they might be missing the hostfile option.<br> <br> Again I understand this topic is frustrating and there are some boundaries with the design that make these two option orthogonal to each other but I really believe we need to make the rankfile option something that is easily usable by our users.<br> <br> <br> --td<br> <br> Ralph Castain wrote:<br> <blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div> Having gone around in circles on hostfile-related issues for over five years now, I honestly have little motivation to re-open the entire discussion again. It doesn't seem to be that daunting a requirement for those who are using it, so I'm inclined to just leave well enough alone.<br> <br> :-)<br> <br> <br></div><div><div> On Fri, Jun 19, 2009 at 2:21 PM, Eugene Loh &lt;<a href="mailto:Eugene.Loh@sun.com" target="_blank">Eugene.Loh@sun.com</a> &lt;mailto:<a href="mailto:Eugene.Loh@sun.com" target="_blank">Eugene.Loh@sun.com</a>&gt;&gt; wrote:<br> <br> &nbsp; &nbsp;Ralph Castain wrote:<br> <blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"> &nbsp; &nbsp;The two files have a slightly different format<br> </blockquote> &nbsp; &nbsp;Agreed.<br> <blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"> &nbsp; &nbsp;and completely different meaning.<br> </blockquote> &nbsp; &nbsp;Somewhat agreed. &nbsp;They're both related to mapping processes onto a<br> &nbsp; &nbsp;cluster.<br> <br> <blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"> &nbsp; &nbsp;The hostfile specifies how many slots are on a node. The rankfile<br> &nbsp; &nbsp;specifies a rank and what node/slot it is to be mapped onto.<br> </blockquote> &nbsp; &nbsp;Agreed.<br> <br> <blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"> &nbsp; &nbsp;Rankfiles can use relative node indexing and refer to nodes<br> &nbsp; &nbsp;received from a resource manager - i.e., without any hostfile.<br> </blockquote> &nbsp; &nbsp;This is the main part I'm concerned about. &nbsp;E.g.,<br> <br> &nbsp; &nbsp;% cat rankfile<br> &nbsp; &nbsp;rank 0=node0 slot=0<br> &nbsp; &nbsp;rank 1=node1 slot=0<br> &nbsp; &nbsp;% mpirun -np 2 -rf rankfile ./a.out<br> &nbsp; &nbsp;--------------------------------------------------------------------------<br> &nbsp; &nbsp;Rankfile claimed host node1 that was not allocated or<br> &nbsp; &nbsp;oversubscribed it's slots:<br> <br> &nbsp; &nbsp;--------------------------------------------------------------------------<br> &nbsp; &nbsp;[node0:14611] [[61560,0],0] ORTE_ERROR_LOG: Bad parameter in file<br> &nbsp; &nbsp;rmaps_rank_file.c at line 107<br> &nbsp; &nbsp;[node0:14611] [[61560,0],0] ORTE_ERROR_LOG: Bad parameter in file<br> &nbsp; &nbsp;base/rmaps_base_map_job.c at line 86<br> &nbsp; &nbsp;[node0:14611] [[61560,0],0] ORTE_ERROR_LOG: Bad parameter in file<br> &nbsp; &nbsp;base/plm_base_launch_support.c at line 86<br> &nbsp; &nbsp;[node0:14611] [[61560,0],0] ORTE_ERROR_LOG: Bad parameter in file<br> &nbsp; &nbsp;plm_rsh_module.c at line 1016<br> &nbsp; &nbsp;% mpirun -np 2 -host node0,node1 -rf rankfile ./a.out<br> &nbsp; &nbsp;0 on node0<br> &nbsp; &nbsp;1 on node1<br> &nbsp; &nbsp;done<br> <br> &nbsp; &nbsp;It seems to me that the rankfile has sufficient information to<br> &nbsp; &nbsp;express what I want it to do. &nbsp;But mpirun won't accept this. &nbsp;To<br> &nbsp; &nbsp;fix this, I have to, e.g., supply/maintain/specify redundant<br> &nbsp; &nbsp;information in a hostfile or host list.<br> <br> <blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"> &nbsp; &nbsp;So the files are intentionally quite different. Trying to combine<br> &nbsp; &nbsp;them would be rather ugly.<br> </blockquote> &nbsp; &nbsp;Right. &nbsp;And my issue is that I'm forced to use both when I only<br> &nbsp; &nbsp;want rankfile functionality.<br> <br> </div></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div> &nbsp; &nbsp;On Thu, Jun 18, 2009 at 1:52 PM, Eugene Loh &lt;<a href="mailto:Eugene.Loh@sun.com" target="_blank">Eugene.Loh@sun.com</a><br></div></div><div> &nbsp; &nbsp;&lt;mailto:<a href="mailto:Eugene.Loh@sun.com" target="_blank">Eugene.Loh@sun.com</a>&gt;&gt; wrote:<br> <br> &nbsp; &nbsp; &nbsp; &nbsp;In order to use "mpirun --rankfile", I also need to specify<br> &nbsp; &nbsp; &nbsp; &nbsp;hosts/hostlist. &nbsp;But that information is redundant with what<br> &nbsp; &nbsp; &nbsp; &nbsp;I provide in the rankfile. &nbsp;So, from a user's point of view,<br> &nbsp; &nbsp; &nbsp; &nbsp;this strikes me as broken. &nbsp;Yes? &nbsp;Should I file a ticket, or<br> &nbsp; &nbsp; &nbsp; &nbsp;am I missing something here about this functionality?<br> <br> </div></blockquote> <br> &nbsp; &nbsp;_______________________________________________<br> &nbsp; &nbsp;devel mailing list<br> &nbsp; &nbsp;<a href="mailto:devel@open-mpi.org" target="_blank">devel@open-mpi.org</a> &lt;mailto:<a href="mailto:devel@open-mpi.org" target="_blank">devel@open-mpi.org</a>&gt;<div><br> &nbsp; &nbsp;<a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br> <br> <br></div> ------------------------------------------------------------------------<div><br> <br> _______________________________________________<br> devel mailing list<br> <a href="mailto:devel@open-mpi.org" target="_blank">devel@open-mpi.org</a><br> <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br> &nbsp;<br> </div></blockquote><div><div> <br> _______________________________________________<br> devel mailing list<br> <a href="mailto:devel@open-mpi.org" target="_blank">devel@open-mpi.org</a><br> <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br> </div></div></blockquote></div><br></div> </div></div><br>_______________________________________________<br> devel mailing list<br> <a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br> <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br></blockquote></div><br></div> _______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>http://www.open-mpi.org/mailman/listinfo.cgi/devel</blockquote></div><br></div></body></html>
