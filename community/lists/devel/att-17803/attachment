<div dir="ltr"><div>I regret to say that in my endless search for perfection (which is a journey, not a destination) I believe I found another issue:</div><div><br></div>I had mx2g sources sitting around, which I compiled and installed on two systems (x86 and x86-64).<div>These provide only compile/link tests, since my systems lack the hardware (actually do have some in a box somewhere).<div><br></div><div>Things worked fine on both systems when configure with --with-mx=[path].</div><div>However, on both systems adding &quot;--enable-static --disable-shared&quot; results in failure from &quot;make check&quot;:</div><div><br></div><div><div><font face="monospace, monospace">make[3]: Entering directory `/home/phargrov/OMPI/openmpi-1.10.0rc5-linux-x86-mx-static/BLD/ompi/debuggers&#39;</font></div><div><font face="monospace, monospace">  CC       predefined_gap_test.o</font></div><div><font face="monospace, monospace">  CCLD     predefined_gap_test</font></div><div><font face="monospace, monospace">  CC       dlopen_test.o</font></div><div><font face="monospace, monospace">  CCLD     dlopen_test</font></div><div><font face="monospace, monospace">make[3]: Leaving directory `/home/phargrov/OMPI/openmpi-1.10.0rc5-linux-x86-mx-static/BLD/ompi/debuggers&#39;</font></div><div><font face="monospace, monospace">make  check-TESTS</font></div><div><font face="monospace, monospace">make[3]: Entering directory `/home/phargrov/OMPI/openmpi-1.10.0rc5-linux-x86-mx-static/BLD/ompi/debuggers&#39;</font></div><div><font face="monospace, monospace">./predefined_gap_test: error while loading shared libraries: libmyriexpress.so: cannot open shared object file: No such file or directory</font></div><div><font face="monospace, monospace">FAIL: predefined_gap_test</font></div><div><font face="monospace, monospace">./dlopen_test: error while loading shared libraries: libmyriexpress.so: cannot open shared object file: No such file or directory</font></div><div><font face="monospace, monospace">FAIL: dlopen_test</font></div></div><div><br></div><div><br></div><div>The following *does* show  mpicc using a correct  rpath argument for the mx library:</div><div><br></div><div><div><font face="monospace, monospace">$ ./INST/bin/mpicc --show openmpi-1.10.0rc5/examples/ring_c.c</font></div><div><font face="monospace, monospace">gcc openmpi-1.10.0rc5/examples/ring_c.c -I/home/phargrov/OMPI/openmpi-1.10.0rc5-linux-x86-mx-static/INST/include -pthread -L/opt/mx2g/lib -Wl,-rpath -Wl,/opt/mx2g/lib -Wl,-rpath -Wl,/home/phargrov/OMPI/openmpi-1.10.0rc5-linux-x86-mx-static/INST/lib -Wl,--enable-new-dtags -L/home/phargrov/OMPI/openmpi-1.10.0rc5-linux-x86-mx-static/INST/lib -lmpi -lopen-rte -lopen-pal -lm -ldl -lrt -lmyriexpress -libverbs -lutil</font></div><div><font face="monospace, monospace">$ ls /opt/mx2g/lib</font></div><div><font face="monospace, monospace">debug  libmyriexpress.a  libmyriexpress.so</font></div></div><div><br></div><div><br></div><div>However, the *test* is built without an rpath:</div><div><br></div><div><div><font face="monospace, monospace">/bin/sh ../../libtool  --tag=CC   --mode=link gcc -std=gnu99  -fno-strict-aliasing -pthread -g   -o dlopen_test dlopen_test.o ../../ompi/<a href="http://libmpi.la">libmpi.la</a> ../../opal/<a href="http://libopen-pal.la">libopen-pal.la</a> -lrt -lm -lutil  </font></div><div><font face="monospace, monospace">libtool: link: gcc -std=gnu99 -fno-strict-aliasing -pthread -g -o dlopen_test dlopen_test.o  ../../ompi/.libs/libmpi.a -L/opt/mx2g/lib -libverbs -lmyriexpress /home/phargrov/OMPI/openmpi-1.10.0rc5-linux-x86-mx-static/BLD/orte/.libs/libopen-rte.a /home/phargrov/OMPI/openmpi-1.10.0rc5-linux-x86-mx-static/BLD/opal/.libs/libopen-pal.a ../../opal/.libs/libopen-pal.a -ldl -lrt -lm -lutil -pthread</font></div></div><div><br></div><div><br></div><div>I have no reason to suspect this is not also present in 1.8.x, but have not checked.</div><div>Sometime after 1.10.0 is out to door, I expect to test the v1.8 nightly tarball.</div><div><br></div><div>-Paul [who enjoyed breaking his toys as a child and now breaks software with the same enthusiasm]</div><div><br clear="all"><div><br></div>-- <br><div class="gmail_signature"><div dir="ltr"><div><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Computer Languages &amp; Systems Software (CLaSS) Group</div><div>Computer Science Department               Tel: +1-510-495-2352</div><div>Lawrence Berkeley National Laboratory     Fax: +1-510-486-6900</div></font></div></div></div>
</div></div></div>

