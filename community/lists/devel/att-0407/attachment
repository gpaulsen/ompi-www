<HTML><BODY style="word-wrap: break-word; -khtml-nbsp-mode: space; -khtml-line-break: after-white-space; ">Well, after adding a bunch of debugging  output, I have found the following. <DIV><BR class="khtml-block-placeholder"></DIV><DIV>With both leave_pinned and use_mem_hook enabled on a linpack run we get the assertion error on the memory callback in linpack. That is to say, there is a free occurring in the middle of a registration. </DIV><DIV> </DIV><DIV>At the point of assert we have NOT resized any registrations. </DIV><DIV>The existing registrations in the tree are: </DIV><DIV><BR><TABLE border="0" cellpadding="0" cellspacing="0" width="232" style=""><COL width="82" style="mso-width-source:userset;mso-width-alt:2998"><COL width="75" span="2"><TBODY><TR height="13"><TD height="13" colspan="2" width="157"><SPAN class="Apple-style-span" style="border-collapse: collapse;">Existing registrations: </SPAN></TD><TD width="75"></TD></TR><TR height="13"><TD height="13"><SPAN class="Apple-style-span" style="border-collapse: collapse;">Base</SPAN></TD><TD><SPAN class="Apple-style-span" style="border-collapse: collapse;">Bound</SPAN></TD><TD><SPAN class="Apple-style-span" style="border-collapse: collapse;">Length</SPAN></TD></TR><TR height="13"><TD height="13" align="right" x:num="2.4161536E8"><SPAN class="Apple-style-span" style="border-collapse: collapse;">241615360</SPAN></TD><TD align="right" x:num="2.44841607E8"><SPAN class="Apple-style-span" style="border-collapse: collapse;">244841607</SPAN></TD><TD align="right" x:num="3.226248E6"><SPAN class="Apple-style-span" style="border-collapse: collapse;">3226248</SPAN></TD></TR><TR height="13"><TD height="13" align="right" x:num="2.44841608E8"><SPAN class="Apple-style-span" style="border-collapse: collapse;">244841608</SPAN></TD><TD align="right" x:num="2.46428807E8"><SPAN class="Apple-style-span" style="border-collapse: collapse;">246428807</SPAN></TD><TD align="right" x:num="1.5872E6"><SPAN class="Apple-style-span" style="border-collapse: collapse;">1587200</SPAN></TD></TR><TR height="13"><TD height="13" align="right" x:num="2.46428808E8"><SPAN class="Apple-style-span" style="border-collapse: collapse;">246428808</SPAN></TD><TD align="right" x:num="2.48016007E8"><SPAN class="Apple-style-span" style="border-collapse: collapse;">248016007</SPAN></TD><TD align="right" x:num="1.5872E6"><SPAN class="Apple-style-span" style="border-collapse: collapse;">1587200</SPAN></TD></TR><TR height="13"><TD height="13" align="right" x:num="2.48019648E8"><SPAN class="Apple-style-span" style="border-collapse: collapse;">248019648</SPAN></TD><TD align="right" x:num="2.51245895E8"><SPAN class="Apple-style-span" style="border-collapse: collapse;">251245895</SPAN></TD><TD align="right" x:num="3.226248E6"><SPAN class="Apple-style-span" style="border-collapse: collapse;">3226248</SPAN></TD></TR><TR height="13"><TD height="13"></TD><TD></TD><TD></TD></TR><TR height="13"><TD height="13"><SPAN class="Apple-style-span" style="border-collapse: collapse;">Tyring to free</SPAN></TD><TD></TD><TD></TD></TR><TR height="13"><TD height="13" align="right" x:num="2.47917216E8"><SPAN class="Apple-style-span" style="border-collapse: collapse;">247917216</SPAN></TD><TD></TD><TD></TD></TR><TR height="13"><TD height="13"><SPAN class="Apple-style-span" style="border-collapse: collapse;">From</SPAN></TD><TD></TD><TD></TD></TR><TR height="13"><TD height="13"><SPAN class="Apple-style-span" style="border-collapse: collapse;">Base</SPAN></TD><TD><SPAN class="Apple-style-span" style="border-collapse: collapse;">Bound</SPAN></TD><TD></TD></TR><TR height="13"><TD height="13" align="right" x:num="2.46428808E8"><SPAN class="Apple-style-span" style="border-collapse: collapse;">246428808</SPAN></TD><TD align="right" x:num="2.48016007E8"><SPAN class="Apple-style-span" style="border-collapse: collapse;">248016007</SPAN></TD><TD></TD></TR></TBODY></TABLE><DIV><BR class="khtml-block-placeholder"></DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>When we get the assert, we are trying to free: 247917216, which is in the middle of the registration. Note we have NOT resized any registrations so I am confident there is not an issue with either the tree or the resize at least as far as linpack is concerned. </DIV><DIV>Here is the callstack: </DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>#0  0x0000002a95f079c9 in raise () from /lib/libc.so.6</DIV><DIV>#1  0x0000002a95f08e6e in abort () from /lib/libc.so.6</DIV><DIV>#2  0x0000002a95f01690 in __assert_fail () from /lib/libc.so.6</DIV><DIV>#3  0x0000002a9571b200 in mca_mpool_base_mem_cb (base=0xec6eaa0, size=31624, </DIV><DIV>    cbdata=0x0) at mpool_base_mem_cb.c:53</DIV><DIV>#4  0x0000002a9587fe0d in opal_mem_free_release_hook (buf=0xec6eaa0, </DIV><DIV>    length=31624) at memory.c:121</DIV><DIV>#5  0x0000002a9588bd12 in opal_mem_free_free_hook (ptr=0xec6eaa0, </DIV><DIV>    caller=0x42b052) at memory_malloc_hooks.c:66</DIV><DIV>#6  0x000000000042b052 in ATL_dmmIJK ()</DIV><DIV>#7  0x000000000064f9b1 in ATL_dgemmNN ()</DIV><DIV>#8  0x000000000057722b in ATL_dgemmNN_RB ()</DIV><DIV>#9  0x0000000000577fc3 in ATL_rtrsmRUN ()</DIV><DIV>#10 0x000000000042c63c in ATL_dtrsm ()</DIV><DIV>#11 0x0000000000423c1e in atl_f77wrap_dtrsm__ ()</DIV><DIV>#12 0x0000000000423a94 in dtrsm_ ()</DIV><DIV>#13 0x0000000000411192 in HPL_dtrsm (ORDER=17933, SIDE=17933, UPLO=8, </DIV><DIV>    TRANS=4294967295, DIAG=0, M=23458672, N=0, ALPHA=1, A=0x7fbfffefa0, LDA=0, </DIV><DIV>    B=0x202, LDB=0) at HPL_dtrsm.c:949</DIV><DIV>#14 0x000000000040cfb6 in HPL_pdupdateTT (PBCST=0x0, IFLAG=0x0, </DIV><DIV>    PANEL=0x165f040, NN=-1) at HPL_pdupdateTT.c:362</DIV><DIV>#15 0x000000000041936f in HPL_pdgesvK2 (GRID=0x7fbffff4a0, ALGO=0x7fbffff460, </DIV><DIV>    A=0x7fbffff260) at HPL_pdgesvK2.c:178</DIV><DIV>#16 0x000000000040d6f7 in HPL_pdgesv (GRID=0x7fbffff4a0, ALGO=0x460d, </DIV><DIV>    A=0x7fbffff260) at HPL_pdgesv.c:107</DIV><DIV>#17 0x0000000000405b10 in HPL_pdtest (TEST=0x7fbffff430, GRID=0x7fbffff4a0, </DIV><DIV>    ALGO=0x7fbffff460, N=10000, NB=80) at HPL_pdtest.c:193</DIV><DIV>#18 0x0000000000401840 in main (ARGC=1, ARGV=0x7fbffff928)</DIV><DIV>    at HPL_pddriver.c:223</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>Note that the free occurs in the ATLAS libraries, I will look into re-building linpack with another BLAS library to see what happens. Any other suggestions? </DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>Thanks, </DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>Galen </DIV><DIV><BR class="khtml-block-placeholder"></DIV></DIV></BODY></HTML>
