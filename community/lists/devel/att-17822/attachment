<html><head><meta http-equiv="Content-Type" content="text/html charset=utf-8"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;" class="">You know, if it wren’t for the impact it would have on our users, I’d almost say that if Mellanox doesn’t care enough to ensure this works, then maybe we should just release and see if someone actually does care?<div class=""><br class=""></div><div class="">I’ll try again later today if/when I have time. Otherwise, I’ll raise it at tomorrow’s telecon and see if anyone cares enough to fix it. At the moment, it appears only you and I do - and I’m not sure I care enough to keep poking it :-)</div><div class=""><br class=""></div><div class="">Thanks Paul!</div><div class="">Ralph</div><div class=""><br class=""><div><blockquote type="cite" class=""><div class="">On Aug 24, 2015, at 10:19 AM, Paul Hargrove &lt;<a href="mailto:phhargrove@lbl.gov" class="">phhargrove@lbl.gov</a>&gt; wrote:</div><br class="Apple-interchange-newline"><div class=""><div dir="ltr" class=""><div class="">Sorry to yet again be the bearer of bad news.</div><div class=""><br class=""></div><div class="">I am now configuring with</div><div class=""><blockquote style="margin:0 0 0 40px;border:none;padding:0px" class=""><div class=""><font face="monospace, monospace" size="1" class="">--prefix=[...]&nbsp;--enable-debug --with-libfabric=/opt/libfabric-1.0.0 --with-mx=/opt/mx2g --disable-dlopen</font></div></blockquote></div><div class="">This is like the previous configuration that caused problems, but with "--disable-dlopen" instead of "--enable-static --disable-shared".</div><div class=""><div class="">I seems that each time I try something new, something else breaks.</div></div><div class=""><br class=""></div><div class="">The build finishes fine.</div><div class="">I can compile the examples fine.</div><div class="">But I once again see a failure to run an example:</div><div class=""><br class=""></div><div class=""><font face="monospace, monospace" size="1" class="">$ mpirun -mca btl sm,self -np 2 examples/ring_c'</font><div class=""><font face="monospace, monospace" size="1" class="">-------------------------------------------------------</font></div><div class=""><font face="monospace, monospace" size="1" class="">Primary job &nbsp;terminated normally, but 1 process returned</font></div><div class=""><font face="monospace, monospace" size="1" class="">a non-zero exit code.. Per user-direction, the job has been aborted.</font></div><div class=""><font face="monospace, monospace" size="1" class="">-------------------------------------------------------</font></div><div class=""><font face="monospace, monospace" size="1" class="">examples/ring_c: error while loading shared libraries: libmyriexpress.so: cannot open shared object file: No such file or directory</font></div><div class=""><br class=""></div><div class="">ldd agrees:</div><div class=""><br class=""></div><div class=""><div class=""><font size="1" face="monospace, monospace" class="">$ ldd examples/ring_c</font></div><div class=""><font size="1" face="monospace, monospace" class="">&nbsp; &nbsp; &nbsp; &nbsp; linux-vdso.so.1 =&gt; &nbsp;(0x00007fff332f0000)</font></div><div class=""><font size="1" face="monospace, monospace" class="">&nbsp; &nbsp; &nbsp; &nbsp; libmpi.so.12 =&gt; /scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib/libmpi.so.12 (0x00007f1879305000)</font></div><div class=""><font size="1" face="monospace, monospace" class="">&nbsp; &nbsp; &nbsp; &nbsp; libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f18790d2000)</font></div><div class=""><font size="1" face="monospace, monospace" class="">&nbsp; &nbsp; &nbsp; &nbsp; libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f1878d3e000)</font></div><div class=""><font size="1" face="monospace, monospace" class="">&nbsp; &nbsp; &nbsp; &nbsp; libibverbs.so.1 =&gt; /usr/lib64/libibverbs.so.1 (0x00007f1878b2c000)</font></div><div class=""><font size="1" face="monospace, monospace" class="">&nbsp; &nbsp; &nbsp; &nbsp; <span style="background-color:rgb(255,255,0)" class="">libmyriexpress.so =&gt; not found</span></font></div><div class=""><font size="1" face="monospace, monospace" class="">&nbsp; &nbsp; &nbsp; &nbsp; libfabric.so.1 =&gt; /opt/libfabric-1.0.0/lib/libfabric.so.1 (0x00007f18788fe000)</font></div><div class=""><font size="1" face="monospace, monospace" class="">&nbsp; &nbsp; &nbsp; &nbsp; libopen-rte.so.12 =&gt; /scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib/libopen-rte.so.12 (0x00007f1878565000)</font></div><div class=""><font size="1" face="monospace, monospace" class="">&nbsp; &nbsp; &nbsp; &nbsp; libopen-pal.so.13 =&gt; /scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib/libopen-pal.so.13 (0x00007f1878241000)</font></div><div class=""><font size="1" face="monospace, monospace" class="">&nbsp; &nbsp; &nbsp; &nbsp; libnuma.so.1 =&gt; /usr/lib64/libnuma.so.1 (0x00007f1878036000)</font></div><div class=""><font size="1" face="monospace, monospace" class="">&nbsp; &nbsp; &nbsp; &nbsp; libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f1877e32000)</font></div><div class=""><font size="1" face="monospace, monospace" class="">&nbsp; &nbsp; &nbsp; &nbsp; librt.so.1 =&gt; /lib64/librt.so.1 (0x00007f1877c29000)</font></div><div class=""><font size="1" face="monospace, monospace" class="">&nbsp; &nbsp; &nbsp; &nbsp; libm.so.6 =&gt; /lib64/libm.so.6 (0x00007f18779a5000)</font></div><div class=""><font size="1" face="monospace, monospace" class="">&nbsp; &nbsp; &nbsp; &nbsp; libutil.so.1 =&gt; /lib64/libutil.so.1 (0x00007f18777a2000)</font></div><div class=""><font size="1" face="monospace, monospace" class="">&nbsp; &nbsp; &nbsp; &nbsp; /lib64/ld-linux-x86-64.so.2 (0x00007f1879a2a000)</font></div><div class=""><font size="1" face="monospace, monospace" class="">&nbsp; &nbsp; &nbsp; &nbsp; libnl.so.1 =&gt; /lib64/libnl.so.1 (0x00007f187754f000)</font></div></div><div class=""><br class=""></div><div class="">However, this time it looks like everything is linked correctly:</div><div class=""><br class=""></div><div class=""><div class=""><font face="monospace, monospace" size="1" class="">$ mpicc --show examples/ring_c.c</font></div><div class=""><font face="monospace, monospace" size="1" class="">gcc examples/ring_c.c -I/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/include -pthread <span style="background-color:rgb(255,255,0)" class="">-L/opt/mx2g/lib</span> -L/opt/libfabric-1.0.0/lib <span style="background-color:rgb(255,255,0)" class="">-Wl,-rpath -Wl,/opt/mx2g/lib</span> -Wl,-rpath -Wl,/opt/libfabric-1.0.0/lib -Wl,-rpath -Wl,/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib -Wl,--enable-new-dtags -L/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib -lmpi</font></div></div><div class=""><br class=""></div><div class=""><font face="monospace, monospace" size="1" class="">$ chrpath --list examples/ring_c</font></div><div class=""><font face="monospace, monospace" size="1" class="">examples/ring_c: RPATH=<span style="background-color:rgb(255,255,0)" class="">/opt/mx2g/lib</span>:/opt/libfabric-1.0.0/lib:/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib</font></div><div class=""><br class=""></div><div class=""><br class=""></div><div class="">Looking a bit further I find that none of the MPI, OPAL or ORTE libs was built with the MX libdir in its rpath, though MPI and OPAL have libfabric:</div><div class=""><br class=""></div><div class=""><div class=""><font face="monospace, monospace" size="1" class="">$ chrpath --list INST/lib/libmpi.so &nbsp; &nbsp; &nbsp;</font></div><div class=""><font face="monospace, monospace" size="1" class="">INST/lib/libmpi.so: RPATH=/opt/libfabric-1.0.0/lib:/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib</font></div></div><div class=""><div class=""><font face="monospace, monospace" size="1" class="">$ chrpath --list INST/lib/libopen-pal.so&nbsp;</font></div><div class=""><font face="monospace, monospace" size="1" class="">INST/lib/libopen-pal.so: RPATH=::/opt/libfabric-1.1.0/lib</font></div><div class=""><font face="monospace, monospace" size="1" class="">$ chrpath --list INST/lib/libopen-rte.so &nbsp;</font></div><div class=""><font face="monospace, monospace" size="1" class="">INST/lib/libopen-rte.so: RPATH=/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib</font></div></div><div class=""><br class=""></div><div class=""><br class=""></div><div class="">Extracted from the "make V=1" output, here are the (shortened) link commands for libmpi.so:</div><div class=""><br class=""></div><div class=""><div class=""><font face="monospace, monospace" size="1" class="">/bin/sh ../libtool &nbsp;--tag=CC &nbsp; --mode=link gcc -std=gnu99 &nbsp;-g -finline-functions -fno-strict-aliasing -pthread -version-info 12:0:0 &nbsp; -o <a href="http://libmpi.la/" class="">libmpi.la</a> -rpath /scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib &nbsp;[.lo and .la files] -lrt -lm -lutil</font></div><div class=""><font face="monospace, monospace" size="1" class=""><br class=""></font></div><div class=""><font face="monospace, monospace" size="1" class="">libtool: link: gcc -std=gnu99 -shared &nbsp;-fPIC -DPIC &nbsp;[.o and .a files] -Wl,--no-whole-archive &nbsp;-Wl,-rpath -Wl,/opt/libfabric-1.0.0/lib -Wl,-rpath -Wl,/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/BLD/orte/.libs -Wl,-rpath -Wl,/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/BLD/opal/.libs <span style="background-color:rgb(0,255,0)" class="">-Wl,-rpath -Wl,/opt/libfabric-1.0.0/lib</span> -Wl,-rpath -Wl,/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/INST/lib -L/scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/BLD/opal/.libs <span style="background-color:rgb(255,255,0)" class="">-L/opt/mx2g/lib</span> -libverbs <span style="background-color:rgb(255,255,0)" class="">-lmyriexpress</span> <span style="background-color:rgb(0,255,0)" class="">-L/opt/libfabric-1.0.0/lib /opt/libfabric-1.0.0/lib/libfabric.so</span> -lpthread /scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/BLD/orte/.libs/libopen-rte.so /scratch/phargrov/OMPI/openmpi-1.10.0rc6-linux-x86_64-no-dlopen/BLD/opal/.libs/libopen-pal.so -lnuma -ldl -lrt -lm -lutil &nbsp;-pthread &nbsp; -pthread -Wl,-soname -Wl,libmpi.so.12 -o .libs/libmpi.so.12.0.0</font></div></div><div class=""><br class=""></div><div class="">The appropriate "-L" and "-l" options are present for libmryiexpress, but there is no corresponding "-Wl,-rpath, -Wl,...".</div><div class=""><br class=""></div><div class="">In contrast, libfabric gets &nbsp;"-L" and "-Wl,-rpath, -Wl,...".</div><div class="">Curiously, libfabric.so gets linked by full path, instead of "-lfabric".</div><div class="">I am not sure if that difference is meaningful or not, but thought I would mention it just in case it is.</div><div class=""><br class=""></div><div class="">-Paul</div><div class=""><br class=""></div>-- <br class=""><div class="gmail_signature"><div dir="ltr" class=""><div class=""><font face="courier new, monospace" class=""><div class="">Paul H. Hargrove &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<a href="mailto:PHHargrove@lbl.gov" target="_blank" class="">PHHargrove@lbl.gov</a></div><div class="">Computer Languages &amp; Systems Software (CLaSS) Group</div><div class="">Computer Science Department &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Tel: +1-510-495-2352</div><div class="">Lawrence Berkeley National Laboratory &nbsp; &nbsp; Fax: +1-510-486-6900</div></font></div></div></div>
</div></div>
_______________________________________________<br class="">devel mailing list<br class=""><a href="mailto:devel@open-mpi.org" class="">devel@open-mpi.org</a><br class="">Subscription: http://www.open-mpi.org/mailman/listinfo.cgi/devel<br class="">Link to this post: http://www.open-mpi.org/community/lists/devel/2015/08/17821.php</div></blockquote></div><br class=""></div></body></html>
