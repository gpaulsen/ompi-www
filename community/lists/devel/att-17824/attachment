<div dir="ltr"><div><br></div><div>This is from testing the Studio compilers on a Solaris-11.1/amd64 platform, in a configuration that passed my testing of rc5.</div><div>I have configured with</div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><font size="1" face="monospace, monospace">--prefix=[...] --enable-debug CC=cc CXX=CC FC=f90 --with-verbs \</font></div><div><font size="1" face="monospace, monospace">CXXFLAGS=&#39;-library=stlport4&#39; --with-wrapper-cxxflags=&#39;-library=stlport4&#39;</font></div></blockquote><div><br></div><div>Note that there is nothing but TCP and Verbs on this platform.</div><div>This is not yet another problem with mx or ofi.</div><div><br></div><div>My &quot;make check&quot; step fails as shown below, apparently choking on the $(OMPI_WRAPPER_EXTRA_LDFLAGS) that Ralph had to add to resolve the problems I saw in rc5:<br></div><div><br></div><div><div><font face="monospace, monospace">gmake[3]: Entering directory `/shared/OMPI/openmpi-1.10.0rc6-solaris11-x86-ib-ss12u3/BLD/ompi/debuggers&#39;</font></div><div><font face="monospace, monospace">source=&#39;/shared/OMPI/openmpi-1.10.0rc6-solaris11-x86-ib-ss12u3/openmpi-1.10.0rc6/ompi/debuggers/predefined_gap_test.c&#39; object=&#39;predefined_gap_test.o&#39; libtool=no \</font></div><div><font face="monospace, monospace">        DEPDIR=.deps depmode=none /bin/sh /shared/OMPI/openmpi-1.10.0rc6-solaris11-x86-ib-ss12u3/openmpi-1.10.0rc6/config/depcomp \</font></div><div><font face="monospace, monospace">        cc -DHAVE_CONFIG_H -I. -I/shared/OMPI/openmpi-1.10.0rc6-solaris11-x86-ib-ss12u3/openmpi-1.10.0rc6/ompi/debuggers -I../../opal/include -I../../orte/include -I../../ompi/include -I../../oshmem/include -I../../opal/mca/hwloc/hwloc191/hwloc/include/private/autogen -I../../opal/mca/hwloc/hwloc191/hwloc/include/hwloc/autogen   -I/shared/OMPI/openmpi-1.10.0rc6-solaris11-x86-ib-ss12u3/openmpi-1.10.0rc6 -I../.. -I/shared/OMPI/openmpi-1.10.0rc6-solaris11-x86-ib-ss12u3/openmpi-1.10.0rc6/opal/include -I/shared/OMPI/openmpi-1.10.0rc6-solaris11-x86-ib-ss12u3/openmpi-1.10.0rc6/orte/include -I/shared/OMPI/openmpi-1.10.0rc6-solaris11-x86-ib-ss12u3/openmpi-1.10.0rc6/ompi/include -I/shared/OMPI/openmpi-1.10.0rc6-solaris11-x86-ib-ss12u3/openmpi-1.10.0rc6/oshmem/include  -D_REENTRANT  -I/shared/OMPI/openmpi-1.10.0rc6-solaris11-x86-ib-ss12u3/openmpi-1.10.0rc6/opal/mca/hwloc/hwloc191/hwloc/include -I/shared/OMPI/openmpi-1.10.0rc6-solaris11-x86-ib-ss12u3/BLD/opal/mca/hwloc/hwloc191/hwloc/include -I/shared/OMPI/openmpi-1.10.0rc6-solaris11-x86-ib-ss12u3/openmpi-1.10.0rc6/opal/mca/event/libevent2021/libevent -I/shared/OMPI/openmpi-1.10.0rc6-solaris11-x86-ib-ss12u3/openmpi-1.10.0rc6/opal/mca/event/libevent2021/libevent/include -I/shared/OMPI/openmpi-1.10.0rc6-solaris11-x86-ib-ss12u3/BLD/opal/mca/event/libevent2021/libevent/include  -D_REENTRANT -g -c -o predefined_gap_test.o /shared/OMPI/openmpi-1.10.0rc6-solaris11-x86-ib-ss12u3/openmpi-1.10.0rc6/ompi/debuggers/predefined_gap_test.c</font></div><div><font face="monospace, monospace">&quot;/shared/OMPI/openmpi-1.10.0rc6-solaris11-x86-ib-ss12u3/openmpi-1.10.0rc6/opal/include/opal/sys/ia32/atomic.h&quot;, line 173: warning: parameter in inline asm statement unused: %3</font></div><div><font face="monospace, monospace">/bin/sh ../../libtool  --tag=CC   --mode=link cc  -D_REENTRANT -g <span style="background-color:rgb(255,255,0)">-R@{libdir}</span>   -o predefined_gap_test predefined_gap_test.o ../../ompi/<a href="http://libmpi.la">libmpi.la</a> -lm -lsocket -lnsl  </font></div><div><font face="monospace, monospace">libtool: link: only absolute run-paths are allowed</font></div><div><br></div><div>I am going to venture a guess that libtool is complaining about &quot;-R@{libdir}&quot;.</div><div>Looking at config/opal_setup_wrappers.m4 I find:</div></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><div><div><font face="monospace, monospace" size="1"># Called to find all -L arguments in the LDFLAGS and add in RPATH args</font></div></div></div><div><div><div><font face="monospace, monospace" size="1"># for each of them.  Then also add in an RPATH for @{libdir} (which</font></div></div></div><div><div><div><font face="monospace, monospace" size="1"># will be replaced by the wrapper compile to the installdir libdir at</font></div></div></div><div><div><div><font face="monospace, monospace" size="1"># runtime), and the RUNPATH args, if we have them.</font></div></div></div></blockquote><div><div><br></div><div>So, since it sounds like the wrapper compiler (not autoconf, automake or libtool) is expected to perform the expansion, it sounds to me like the $(*_WRAPPER_EXTRA_LDFLAGS) are *not* suitable for linking the tests.</div><div>This means that Ralph and I wasted our Sunday iterating to the wrong fix for the mx+static problem I encountered in rc5.</div><div><br></div><div>The good news (I hope) is the following comment in the same .m4 file:</div><div><div><font face="monospace, monospace" size="1">    # Note that we have to setup &lt;package&gt;_PKG_CONFIG_LDFLAGS for the</font></div><div><font face="monospace, monospace" size="1">    # pkg-config files to parallel the</font></div><div><font face="monospace, monospace" size="1">    # &lt;package&gt;_WRAPPER_EXTRA_LDFLAGS.  This is because pkg-config</font></div><div><font face="monospace, monospace" size="1">    # will not understand the @{libdir} notation in</font></div><div><font face="monospace, monospace" size="1">    # *_WRAPPER_EXTRA_LDFLAGS; we have to translate it to ${libdir}.</font></div></div><div><br></div><div>So, Ralph, I suspect that use of {OMPI,OPAL}_PKG_CONFIG_LDFLAGS is the proper replacement for WRAPPER_LD_FLAGS.</div><div>I tried manually making this change in the three affected generated Makefiles and was able to pass my testing on this platform.</div><div><br></div><div>-Paul</div><div><br></div>-- <br><div class="gmail_signature"><div dir="ltr"><div><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Computer Languages &amp; Systems Software (CLaSS) Group</div><div>Computer Science Department               Tel: +1-510-495-2352</div><div>Lawrence Berkeley National Laboratory     Fax: +1-510-486-6900</div></font></div></div></div>
</div></div>

