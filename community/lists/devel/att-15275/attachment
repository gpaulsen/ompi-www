<html><head><meta http-equiv="Content-Type" content="text/html charset=windows-1252"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">All,<div><br></div><div>I take advantage of this thread to clarify what is missing to have a perfectly MPI agnostic BTL interface. Some of these issues are pretty straightforward (getting rid of RTE and OMPI vestiges), some others will require some thinking from their developers in order to cope with a not conformant design (such as using MPI_COMM_WORLD in the BTL). So, here is an exhaustive list:</div><div><br></div><div>- Open IB uses quite a few ORTE internals: orte_proc_is_bound<br>- also it makes usage of some functions/define that I can’t find anywhere in the code base&nbsp;ompi_progress_threads<br><br>- UGNI uses MPI_COMM_WORLD for internal management<br>- USNIC uses num_procs for internal management. It also directly calls ompi_rte_abort<br>- common OFACM uses the num_procs to hash table allocation<br><br></div><div>Two items are of general interest as they affect our compatibility with past installations/usages:</div><div>- MPOOL alloc uses MPI level info keys …&nbsp;<br>- most of the BTL MCA parameters have not been renamed (!!!). Personally, I would be in favor of creating synonyms for now and then deprecate the OMPI version in 2.0, but I don’t want to enforce this on everybody. So, the discussion is open on this topic.</div><div><br></div><div>Ralph and Jeff (I think you added the seq interface to TCP), please take a look at the following:</div><div>- the implementation of the TCP seq interface seems to be wrong: it used the my_node_rank to&nbsp;compute the sequence number instead of the my_local_rank (I changed this to my_local_rank)<br></div><div><br></div><div>If you have any issue with the move, I’ll be happy to help and/or support you on your last move toward a completely generic BTL. To facilitate your work I exposed a minimalistic set of OMPI information at the OPAL level. Take a look at opal/util/proc.h for more info, but please try not to expose more.</div><div><br></div><div>&nbsp; Thanks,</div><div>&nbsp; &nbsp; George.</div><div><br></div><div><br><div><div>On Jul 26, 2014, at 02:22 , Ralph Castain &lt;<a href="mailto:rhc@open-mpi.org">rhc@open-mpi.org</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><meta http-equiv="Content-Type" content="text/html charset=us-ascii"><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">That's because you folks didn't completely cleanup the open fabrics stuff prior to the move - something that we warned about, but folks said they would resolve later :-)<div><br><div><div><div>On Jul 25, 2014, at 11:19 PM, Mike Dubman &lt;<a href="mailto:miked@dev.mellanox.co.il">miked@dev.mellanox.co.il</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div dir="ltr"><div>Making all in mca/common/ofacm</div><div>make[2]: Entering directory `/hpc/local/benchmarks/hpc-stack-gcc/src/install/ompi-master/opal/mca/common/ofacm'</div><div>&nbsp; CC &nbsp; &nbsp; &nbsp; libmca_common_ofacm_la-common_ofacm_base.lo</div>
<div>&nbsp; CC &nbsp; &nbsp; &nbsp; libmca_common_ofacm_la-common_ofacm_oob.lo</div><div>&nbsp; CC &nbsp; &nbsp; &nbsp; libmca_common_ofacm_la-common_ofacm_empty.lo</div><div>&nbsp; LN_S &nbsp; &nbsp; <a href="http://libmca_common_ofacm.la/">libmca_common_ofacm.la</a></div><div>
common_ofacm_oob.c: In function 'oob_component_query':</div><div>common_ofacm_oob.c:178: warning: passing argument 4 of 'orte_rml.recv_buffer_nb' from incompatible pointer type</div><div>common_ofacm_oob.c:178: note: expected 'orte_rml_buffer_callback_fn_t' but argument is of type 'void (*)(int, &nbsp;opal_process_name_t *, struct opal_buffer_t *, ompi_rml_tag_t, &nbsp;void *)'</div>
<div>common_ofacm_xoob.c: In function 'xoob_context_init':</div><div>common_ofacm_xoob.c:354: error: request for member 'jobid' in something not a structure or union</div><div>common_ofacm_xoob.c: In function 'xoob_endpoint_fina</div>
<div>common_ofacm_oob.c:728: warning: passing argument 4 of 'orte_rml.send_buffer_nb' from incompatible pointer type</div><div>common_ofacm_oob.c:728: note: expected 'orte_rml_buffer_callback_fn_t' but argument is of type 'void (*)(int, &nbsp;opal_process_name_t *, struct opal_buffer_t *, ompi_rml_tag_t, &nbsp;void *)'</div>
<div>common_ofacm_xoob.c: In function 'xoob_send_connect_data':</div><div>common_ofacm_xoob.c:791: warning: passing argument 1 of 'orte_rml.send_buffer_nb' from incompatible pointer type</div><div>common_ofacm_xoob.c:791: note: expected 'struct orte_process_name_t *' but argument is of type 'opal_process_name_t *'</div>
<div>common_ofacm_xoob.c:791: warning: passing argument 4 of 'orte_rml.send_buffer_nb' from incompatible pointer type</div><div>common_ofacm_xoob.c:791: note: expected 'orte_rml_buffer_callback_fn_t' but argument is of type 'void (*)(int, &nbsp;opal_process_name_t *, struct opal_buffer_t *, ompi_rml_tag_t, &nbsp;void *)'</div>
<div>common_ofacm_xoob.c: In function 'xoob_recv_qp_create':</div><div>common_ofacm_xoob.c:963: warning: 'ibv_create_xrc_rcv_qp' is deprecated (declared at /usr/include/infiniband/ofa_verbs.h:126)</div><div>
common_ofacm_xoob.c:983: warning: 'ibv_modify_xrc_rcv_qp' is deprecated (declared at /usr/include/infiniband/ofa_verbs.h:152)</div><div>common_ofacm_xoob.c:1011: warning: 'ibv_modify_xrc_rcv_qp' is deprecated (declared at /usr/include/infiniband/ofa_verbs.h:152)</div>
<div>common_ofacm_xoob.c: In function 'xoob_recv_qp_connect':</div><div>common_ofacm_xoob.c:1032: warning: 'ibv_reg_xrc_rcv_qp' is deprecated (declared at /usr/include/infiniband/ofa_verbs.h:185)</div><div>
common_ofacm_xoob.c: In function 'xoob_component_query':</div><div>common_ofacm_xoob.c:1407: warning: passing argument 4 of 'orte_rml.recv_buffer_nb' from incompatible pointer type</div><div>common_ofacm_xoob.c:1407: note: expected 'orte_rml_buffer_callback_fn_t' but argument is of type 'void (*)(int, &nbsp;opal_process_name_t *, struct opal_buffer_t *, ompi_rml_tag_t, &nbsp;void *)'</div>
<div>make[2]: *** [libmca_common_ofacm_la-common_ofacm_xoob.lo] Error 1</div><div>make[2]: *** Waiting for unfinished jobs....</div><div>make[2]: Leaving directory `/hpc/local/benchmarks/hpc-stack-gcc/src/install/ompi-master/opal/mca/common/ofacm'</div>
<div><br></div></div>
_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2014/07/15271.php">http://www.open-mpi.org/community/lists/devel/2014/07/15271.php</a></blockquote></div><br></div></div></div>_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>Subscription: http://www.open-mpi.org/mailman/listinfo.cgi/devel<br>Link to this post: http://www.open-mpi.org/community/lists/devel/2014/07/15272.php</blockquote></div><br></div></body></html>
