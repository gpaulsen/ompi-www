<html><head><meta http-equiv="Content-Type" content="text/html charset=us-ascii"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><br><div><div>On Jan 10, 2014, at 12:45 PM, Adrian Reber &lt;<a href="mailto:adrian@lisas.de">adrian@lisas.de</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div style="font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">On Fri, Jan 10, 2014 at 09:48:14AM -0800, Ralph Castain wrote:<br><blockquote type="cite"><br>On Jan 10, 2014, at 8:02 AM, Adrian Reber &lt;<a href="mailto:adrian@lisas.de">adrian@lisas.de</a>&gt; wrote:<br><br><blockquote type="cite">I am currently trying to understand how callbacks are working. Right now<br>I am looking at orte/mca/rml/base/rml_base_receive.c<br>orte_rml_base_comm_start() which does<span class="Apple-converted-space">&nbsp;</span><br><br>&nbsp;&nbsp;orte_rml.recv_buffer_nb(ORTE_NAME_WILDCARD,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ORTE_RML_TAG_RML_INFO_UPDATE,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ORTE_RML_PERSISTENT,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orte_rml_base_recv,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL);<br><br>As far as I understand it orte_rml_base_recv() is the callback function.<br>At which point should this function run? When the data is actually<br>received?<br></blockquote><br>Not precisely. When data is received by the OOB, it pushes the data into an event. When that event gets serviced, it calls the orte_rml_base_receive function which processes the data to find the matching tag, and then uses that to execute the callback to the user code.<br><br><blockquote type="cite"><br>The same for send_buffer_nb() functions. I do not see the callback<br>functions actually running. How can I verify that the callback functions<br>are running. Especially for the send case it sounds pretty obvious how<br>it should work but I never see the callback function running. At least<br>in my setup.<br></blockquote><br>The data is not immediately sent. It gets pushed into an event. When that event gets serviced, it calls the orte_oob_base_send function which then passes the data to each active OOB component until one of them says it can send it. The data is then pushed into another event to get it into the event base for that component's active module - when that event gets serviced, the data is sent. Once the data is sent, an event is created that, when serviced, executes the callback to the user code.<br><br>If you aren't seeing callbacks, the most likely cause is that the orte progress thread isn't running. Without it, none of this will work.<br></blockquote><br>Thanks. Running configure without '--with-ft=cr' I can run a program and<br>use orte-top. In orterun I can see that the callback is running and<br>orte-top displays the retrieved information. I can also see in orte-top<br>that the callbacks are working. </div></blockquote><div><br></div>Actually, I'm rather impressed - I hadn't tested orte-top and didn't honestly know if it would work any more! Glad to hear it does :-)</div><div><br><blockquote type="cite"><div style="font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Doing the same with '--with-ft=cr'<br>enabled orte-top crashes as well as orte-checkpoint and both (-top and<br>-checkpoint) seem to no longer have working callbacks and that is why<br>they are probably crashing. So some code which is enabled by '--with-ft=cr'<br>seems to break callbacks in orte-top as well as in orte-checkpoint.<br>orterun handles callbacks no matter if configured with or without<br>'--with-ft=cr'.<br></div></blockquote><div><br></div>I can take a look this weekend - probably something silly</div><div><br><blockquote type="cite"><div style="font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br><span class="Apple-tab-span" style="white-space: pre;">	</span><span class="Apple-tab-span" style="white-space: pre;">	</span>Adrian<br>_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a></div></blockquote></div><br></body></html>
