<html><head></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><font class="Apple-style-span" size="3"><span class="Apple-style-span" style="font-size: 12px;">BTW: just to be clear. You don't have to write any code to compute these values, or to reset the job structures prior to restarting a process. This has already been done.</span></font><div><font class="Apple-style-span" size="3"><span class="Apple-style-span" style="font-size: 12px;"><br></span></font></div><div><font class="Apple-style-span" size="3"><span class="Apple-style-span" style="font-size: 12px;">Recomputing local and node ranks is done in orte/mca/rmaps/base/rmaps_base_support_fns.c in a function called&nbsp;orte_rmaps_base_update_local_ranks.</span></font></div><div><font class="Apple-style-span" size="3"><span class="Apple-style-span" style="font-size: 12px;"><br></span></font></div><div><font class="Apple-style-span" size="3"><span class="Apple-style-span" style="font-size: 12px;">Resetting the job and proc structures for restarting a process is done in orte/mca/plm/base/plm_base_rsh_support.c in a function called orte_plm_base_reset_job.</span></font></div><div><font class="Apple-style-span" size="3"><span class="Apple-style-span" style="font-size: 12px;"><br></span></font></div><div>The restart logic was in the orte/mca/errmgr/orcm module, but I moved that out of the devel trunk recently as we needed to do some orcm-specific things in it. However, I can (and probably should) restore it under a different name if that would help.</div><div><br></div><div>Ralph</div><div><br></div><div><font class="Apple-style-span" face="Menlo" size="3"><span class="Apple-style-span" style="font-size: 11px;"><br></span></font><div><div>On Apr 7, 2010, at 10:15 PM, Ralph Castain wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">The local rank of a process is computed by looking at all processes on a node from that job. The lowest MPI rank process on that node from that job is given local-rank=0. All processes on the node are given local-ranks in ascending order according to their MPI rank.<div><br></div><div>The node rank is computed the same way, except that we look at all processes on the node, spanning all MPI jobs.</div><div><br></div><div>Consider this example. Suppose we have an MPI application that launches 3 processes on each of two nodes, with ranks assigned on a bynode round-robin basis. Thus, the MPI rank mapping looks like this:</div><div><br></div><div>node0: &nbsp;rank 0, 2, 4</div><div>node1: rank 1, 3, 5</div><div><br></div><div>The local ranks would look like this:</div><div><br></div><div>Node &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MPI Rank &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Local Rank</div><div>node0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</div><div>node0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</div><div>node0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2</div><div><br></div><div>node1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</div><div>node1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</div><div>node1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2</div><div><br></div><div>Since we only have one job, the node rank of each process would be identical to its local rank. &nbsp;Now suppose that application does a comm_spawn that launches two processes on node0. The local ranks of the new processes would be 0,1 reflecting their relative position within that job. However, their node ranks would be 3,4 because of the processes already on the node.</div><div><br></div><div>We use these values when assigning static ports and processor affinity. Other than that, they have no meaning.</div><div><br></div><div>HTH</div><div>Ralph</div><div><br></div><div><br></div><div><br></div><div><div><div>On Apr 7, 2010, at 7:16 PM, luyang dong wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td valign="top" style="font: inherit;"><div>dear teachers:</div>
<div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; In orte_globals.h, there is a data structure.</div>
<div>typedef struct {<br>&nbsp;&nbsp;&nbsp; /* index to node */<br>&nbsp;&nbsp;&nbsp; int32_t node;<br>&nbsp;&nbsp;&nbsp; /* local rank */<br>&nbsp;&nbsp;&nbsp; orte_local_rank_t local_rank;<br>&nbsp;&nbsp;&nbsp; /* node rank */<br>&nbsp;&nbsp;&nbsp; orte_node_rank_t node_rank;<br>} orte_pmap_t;</div>
<div>And I do not understand what both&nbsp;local_rank and node_rank&nbsp;exactly mean.&nbsp;Is local_rank similar to the rank of MPI Specification.&nbsp;Can you help me? My motivation is to achieve process migration in openmpi, I urgently want to the procedure of launching process.</div></td></tr></tbody></table><br>






      &nbsp;_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a></blockquote></div><br></div></div></blockquote></div><br></div></body></html>
