<div dir="ltr">I had an opportunity to try the 1.8.5rc2 tarball on a little-endian POWER8 (aka ppc64el or powerpc64le).<div><div>The good news is that things &quot;just worked&quot; as they did when I tried ARMv8 (aka aarch64).</div><div><br></div><div>However, I see a little room for improvement with almost no work at all.</div><div><br></div><div>I noticed:</div></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><div><div><font face="monospace, monospace">checking for __sync builtin atomics... yes</font></div></div></div><div><div><div><font face="monospace, monospace">checking for assembly architecture... UNSUPPORTED</font></div></div></div><div><div><div><font face="monospace, monospace">checking for builtin atomics... BUILTIN_SYNC</font></div></div></div><div><div><div><font face="monospace, monospace">checking for atomic assembly filename... none</font></div></div></div></blockquote><div><div>and I confirmed the same behavior on master.</div><div><br></div><div>The existing powerpc64 inline asm should work.</div><div>So, I made a one-line change (at bottom of this email) to recognize the architecture and now get &quot;native&quot; atomics.</div><div><br></div></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><div><div><font face="monospace, monospace">checking if PowerPC registers have r prefix... no</font></div></div></div><div><div><div><font face="monospace, monospace">checking if powerpc64le-linux-gnu-gcc-4.9 -std=gnu99 supports GCC inline assembly... yes</font></div></div></div><div><div><div><font face="monospace, monospace">checking if powerpc64le-linux-gnu-gcc-4.9 -std=gnu99 supports DEC inline assembly... no</font></div></div></div><div><div><div><font face="monospace, monospace">checking if powerpc64le-linux-gnu-gcc-4.9 -std=gnu99 supports XLC inline assembly... no</font></div></div></div><div><div><div><font face="monospace, monospace">checking for assembly format... default-.text-.globl-:--.L-@-1-1-0-1-1</font></div></div></div><div><div><div><font face="monospace, monospace">checking for assembly architecture... POWERPC64</font></div></div></div><div><div><div><font face="monospace, monospace">checking for builtin atomics... BUILTIN_NO</font></div></div></div><div><div><div><font face="monospace, monospace">checking for perl... (cached) perl</font></div></div></div><div><div><div><font face="monospace, monospace">checking for pre-built assembly file... no (not in asm-data)</font></div></div></div><div><div><div><font face="monospace, monospace">checking whether possible to generate assembly file... yes</font></div></div></div><div><div><div><font face="monospace, monospace">checking for atomic assembly filename... atomic-local.s</font></div></div></div></blockquote><div><div><br></div><div>and</div><div><br></div></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><div><font face="monospace, monospace">phargrov@ppc64el:~/OMPI/ompi-master/BLD$ make -C test/asm check</font></div></div><div><div><font face="monospace, monospace">[...]</font></div></div><div><div><div><font face="monospace, monospace" color="#00ff00">============================================================================</font></div></div></div><div><div><div><font face="monospace, monospace" color="#00ff00">Testsuite summary for Open MPI gitclone</font></div></div></div><div><div><div><font face="monospace, monospace" color="#00ff00">============================================================================</font></div></div></div><div><div><div><font face="monospace, monospace"># TOTAL: 8</font></div></div></div><div><div><div><font face="monospace, monospace" color="#00ff00"># PASS:  8</font></div></div></div><div><div><div><font face="monospace, monospace"># SKIP:  0</font></div></div></div><div><div><div><font face="monospace, monospace"># XFAIL: 0</font></div></div></div><div><div><div><font face="monospace, monospace"># FAIL:  0</font></div></div></div><div><div><div><font face="monospace, monospace"># XPASS: 0</font></div></div></div><div><div><div><font face="monospace, monospace"># ERROR: 0</font></div></div></div><div><div><div><font face="monospace, monospace">============================================================================</font></div></div></div></blockquote><div><div><br></div><div><br></div><div>In addition to the one-line patch below, I needed to run <a href="http://autogen.pl">autogen.pl</a> with a new enough config/config.{guess,sub}.</div><div>Along the way I noticed</div><div><div>        opal/mca/common/libfabric/libfabric/config/config.guess</div><div>        opal/mca/common/libfabric/libfabric/config/config.sub</div><div>        opal/mca/hwloc/hwloc191/hwloc/config/config.guess</div><div>        opal/mca/hwloc/hwloc191/hwloc/config/config.sub</div></div><div>which appear to be too old to recognize powerpc64le and are *not* updated when <a href="http://autogen.pl">autogen.pl</a> is run.</div><div>I manually updated them, but somebody may want to either commit newer versions to git or teach <a href="http://autogen.pl">autogen.pl</a> to update them.<br></div><div>FWIW, it appears that tarballs *are* generated with up-to-date versions.  Go figure.</div><div><br></div><div><br></div><div>-Paul</div><div><br></div><div><div><font face="monospace, monospace">diff --git a/config/opal_config_asm.m4 b/config/opal_config_asm.m4</font></div><div><font face="monospace, monospace">index 7ceadfc..c5f72c5 100644</font></div><div><font face="monospace, monospace">--- a/config/opal_config_asm.m4</font></div><div><font face="monospace, monospace">+++ b/config/opal_config_asm.m4</font></div><div><font face="monospace, monospace">@@ -988,7 +988,7 @@ AC_DEFUN([OPAL_CONFIG_ASM],[</font></div><div><font face="monospace, monospace">             OPAL_GCC_INLINE_ASSIGN=&#39;&quot;or %0,[$]0,[$]0&quot; : &quot;=&amp;r&quot;(ret)&#39;</font></div><div><font face="monospace, monospace">             ;;</font></div><div><font face="monospace, monospace"> </font></div><div><font face="monospace, monospace">-        powerpc-*|powerpc64-*|rs6000-*|ppc-*)</font></div><div><font face="monospace, monospace">+        powerpc-*|powerpc64-*|powerpc64le-*|rs6000-*|ppc-*)</font></div><div><font face="monospace, monospace">             OPAL_CHECK_POWERPC_REG</font></div><div><font face="monospace, monospace">             if test &quot;$ac_cv_sizeof_long&quot; = &quot;4&quot; ; then</font></div><div><font face="monospace, monospace">                 opal_cv_asm_arch=&quot;POWERPC32&quot;</font></div></div><div><br></div><div><br>-- <br><div class="gmail_signature"><div dir="ltr"><div><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Computer Languages &amp; Systems Software (CLaSS) Group</div><div>Computer Science Department               Tel: +1-510-495-2352</div><div>Lawrence Berkeley National Laboratory     Fax: +1-510-486-6900</div></font></div></div></div>
</div></div></div>

