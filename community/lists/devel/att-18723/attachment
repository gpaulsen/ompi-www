<div dir="ltr">Ok, I&#39;ve investigated further today, it seems &quot;--map-by hwthread&quot; does not remove the problem. However, if I specified in the hostfile &quot;node0 slots=32&quot; it runs really slower than specifying only &quot;node0&quot;. In both cases I run mpirun with -np 32. So I&#39;m quite sure I didn&#39;t understand what slots are.  </div><div class="gmail_extra"><br clear="all"><div><div class="gmail_signature"><div dir="ltr"><div><div dir="ltr"><div><div dir="ltr"><div>__</div><div><span style="font-size:12.8px">Federico Reghenzani</span></div><div><font size="1">M.Eng. Student @ Politecnico di Milano</font></div><div><span style="font-size:x-small">Computer Science and Engineering</span></div><div><br></div><div><br></div></div></div></div></div></div></div></div>
<br><div class="gmail_quote">2016-03-22 18:56 GMT+01:00 Federico Reghenzani <span dir="ltr">&lt;<a href="mailto:federico1.reghenzani@mail.polimi.it" target="_blank">federico1.reghenzani@mail.polimi.it</a>&gt;</span>:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Hi guys,<div><br></div><div>I&#39;m really confused about <i>slots</i> in resource allocation: I thought that slots are the number of processes spawnable in a certain node, so it should correspond to the number of Processing Elements of the node. For example, on each of my nodes I have 2 processors, total 16 cores with hyperthreading, so a total of 32 processing elements per node (i.e. 32 hw threads). However, considering a single node, passing in the hostfile 32 slots and requesting &quot;-np 32&quot; results is a performance degradation of 20x slower than using only &quot;-np 16&quot;. The problem disappears specifing --map-by hwthread.</div><div><br></div><div>Investigating on the problem I found these counterintuitive things:</div><div>- <a href="https://www.open-mpi.org/faq/?category=running#slots-without-hostfiles" target="_blank">here</a> is stated &quot;<em style="color:rgb(0,0,0);font-family:verdana,arial,helvetica;font-size:12px">slots</em><span style="color:rgb(0,0,0);font-family:verdana,arial,helvetica;font-size:12px"> are Open MPI&#39;s representation of how many processors are available</span>&quot;</div><div>- <a href="https://www.open-mpi.org/doc/v1.10/man1/mpirun.1.php#sect6" target="_blank">here</a> is stated &quot;<span style="color:rgb(0,0,0);font-family:verdana,arial,helvetica;font-size:12px">Slots indicate how many processes can potentially execute on a node. For best performance, the number of slots may be chosen to be the number of cores on the node or the number of processor sockets</span>&quot; </div><div>- I tried to remove the slots information from the hostfile, so according to <a href="https://www.open-mpi.org/faq/?category=running#slots-without-hostfiles" target="_blank">this</a> should be interpreted as &quot;1&quot;, but it spawns anyway 32 processes</div><div>- I&#39;m not sure what --map-by and --rank-by do </div><div><br></div><div>In custom RAS we are developing, what we have to send to mpirun? The number of processor sockets, the number of cores or the number of hwthread available? How --map-by and --rank-by affect the spawn policy?</div><div><br></div><div><br></div><div>Thank you!</div><div><br></div><div><br></div><div>OFFTOPIC: is someone going to EuroMPI 2016 in September? We will be there to present our migration technique.</div><div><br></div><div><br></div><div>Cheers,</div><div>Federico</div><div><br clear="all"><div><div><div dir="ltr"><div><div dir="ltr"><div><div dir="ltr"><div>__</div><span class="HOEnZb"><font color="#888888"><div><span style="font-size:12.8px">Federico Reghenzani</span></div><div><font size="1">M.Eng. Student @ Politecnico di Milano</font></div><div><span style="font-size:x-small">Computer Science and Engineering</span></div><div><br></div><div><br></div></font></span></div></div></div></div></div></div></div>
</div></div>
</blockquote></div><br></div>

