<html><head><meta http-equiv="Content-Type" content="text/html charset=us-ascii"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><br><div><div>On Nov 14, 2013, at 12:21 PM, Barrett, Brian W &lt;<a href="mailto:bwbarre@sandia.gov">bwbarre@sandia.gov</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div style="font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">On 11/14/13 1:13 PM, "Joshua Ladd" &lt;<a href="mailto:joshual@mellanox.com">joshual@mellanox.com</a>&gt; wrote:<br><br><blockquote type="cite">Let me try to summarize my understanding of the situation:<br><br>1. Ralph made the OOB asynchronous.<br><br>2. OOB cpcs don't work as a result of 1, and are thereby "deprecated",<br>meaning: won't fix.<br><br>3. Pasha moved the openib/connect to common/ofacm but excluded the rdmacm<br>in that move. &nbsp;Never changed openib to use ofacm/common.<br><br>4. UDCM is "functional" in the trunk, still sitting in openib/connect.<br>But no one is entirely sure if it really works which is why it was<br>disabled in 1.7. Nathan - is there a design doc you can share on this<br>beyond the comments in the code?<br><br>5. In order to satisfy the "grand plan":<br><span class="Apple-tab-span" style="white-space: pre;">	</span>a. UDCM still needs to be moved to common/ofacm.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b. OpenIB still needs to be changed to use common/ofacm.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c. &nbsp;RDMACM still needs to migrate to common/ofacm.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d. XRC support needs to be added to UDCM and put into<br>common/ofacm.<br><br>6. The "grand plan" being: &nbsp;move the BTLs into Opal - hence the need to<br>scuttle the OOB cpcs thereby justifying the deprecation and not fixing<br>cpcs after #1.<br><br>So, that's a quick roundup of how we ended up here (as I understand it.)<br>What needs to be done is:<br></blockquote><br>That's my understanding as well.<br><br><blockquote type="cite">1. Somebody needs to certify/review/ that what Nathan has done is sound.<br>From my perspective, this is a BIG change and needs a comprehensive<br>architecture review. We've been using it in the trunk, and we've been<br>testing it under MTT for some time - but have not deployed or tested at<br>large-scale out in the field. Would be nice to see something on paper in<br>terms of a design doc.<br><br>2. Somebody then needs to move UDCM into common/ofacm.<br><br>3. Somebody needs to change openib to use common/ofacm cpcs instead of<br>openib/connect cpcs.<br><br>4. Somebody needs to move RDMACM into common/ofacm and make sure RoCEE<br>works.<br><br>5. Somebody needs to add XRC support to UDCM - whatever that might mean.<br>Given Nathan added UDCM back in 2011 and nobody is really sure it's ready<br>for prime-time, and given Pasha's comments regarding the difference in<br>state machine requirements &nbsp;between the two connection schemes, this<br>doesn't seem like a trivial task.<br><br>Given Nathan's comments a second ago about ORNL not supporting the IB<br>Offload component, it barely makes sense to keep common/ofacm. And it<br>sounds like the two cpcs presently contained therein are now unusable.<br><br>All of this work is a result of the Grand Plan to move the BTLs into the<br>Opal layer - which I have no idea what the motive is (I was not involved<br>with OMPI when this was decided or debated.)<br><br>Basically, without these five changes OpenIB is dead in 1.7.4 and beyond<br>for RC, XRC, and RoCEE. These are blockers to 1.7.4 and I don't believe<br>that the onus falls squarely on Mellanox to fix these. These were<br>community decisions and, as such, it must be a community effort to<br>resolve. We are happy to lend a hand, but we are not fixing all of this<br>mess.<br></blockquote><br>I think that the 5 steps above sound correct and I agree that 1) this<br>means 1.7.4 is on hold until we fix this and 2) that Mellanox shouldn't be<br>the only one to fix this for 1.7.4, given the amount of work involved.<br><br>Ralph, what, specifically, broke about the oob/xoob cpc mechanisms by<br>making the oob asynchronous?</div></blockquote><div><br></div>Hard for me to say as I don't really have access to an IB machine any more. Odin is my sole reference point, and someone has had that fully locked up for more than a week (and I can't complain as I am totally a guest there). Even then, I can only test on a few nodes.</div><div><br></div><div>I have no objection to helping, but we need someone who cares about IB and has access to such a machine to take the lead. Otherwise, we're just spinning our wheels.</div><div><br></div><div>As for the work issue: note that this has been "under development" now for more than a year. We've talked at length about how "somebody" needs to fix the openib/ofacm issue, but everyone keeps pushing it down the road as "not mine". Like I said, I can help - but (a) my boss couldn't care less about this issue, and (b) I have no way to test the results.</div><div><br></div><div><br></div><div><br><blockquote type="cite"><div style="font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"> &nbsp;That is, 1-5 are a huge amount of work; have<br>we done the analysis to say that updating the oob / xoob cpc to work with<br>the new oob is actually more work than doing 1-5? &nbsp;Obviously, there's long<br>term plans that make oob/xoob problematic. &nbsp;But those aren't 1.7 / 1.8<br>plans. &nbsp;Unfortunately, the cpcs were always out of my area of interest, so<br>I'm flying a bit more blind than I'd like here.<br><br>Brian<br><br>--<br>&nbsp;Brian W. Barrett<br>&nbsp;Scalable System Software Group<br>&nbsp;Sandia National Laboratories<br><br><br><br><br>_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a></div></blockquote></div><br></body></html>
