<html><head></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><br><div><div>On Mar 21, 2011, at 2:51 PM, Hugo Meyer wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div><div class="gmail_quote">Thanks Ralph for your reply.</div><div class="gmail_quote"><br></div><div class="gmail_quote">2011/3/21 Ralph Castain <span dir="ltr">&lt;<a href="mailto:rhc@open-mpi.org">rhc@open-mpi.org</a>&gt;</span><br>
<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex;"><div style="word-wrap:break-word">You should never access a pointer array's data area that way (i.e., by index against the raw data). You really should do:<div>
<br></div><div>if (NULL == (proc = (orte_proc_t*)opal_pointer_array_get_item(jdata-&gt;procs, vpid))) {</div><div>&nbsp;&nbsp; &nbsp; &nbsp;/* error report */</div><div>}</div><div><br></div></div></blockquote><div><br></div><div><div>
About this, i've changed this in my code but i'm getting the same result. Null when asking about a dead process.<br></div></div><div>&nbsp;</div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex;">
<div style="word-wrap:break-word"><div></div><div>The errmgr generally doesn't remove a process object upon failure - it just sets its state to some appropriate value. However, depending upon where you are trying to do this, and the history that got you down this code path, it is possible.</div>
</div></blockquote><div><br></div><div>I'm writing this code into the errmgr_orted.c, and it is executed when a process fails.&nbsp;</div><div>&nbsp;</div></div></div></blockquote><div><br></div>There's your problem - that module is run in the daemon, where the orte_job_data pointer array isn't used. You have to use the orte_local_jobdata and orte_local_children lists instead. So once the HNP replies with the jobid, you look up the orte_odls_job_t for that job from the orte_local_jobdata list.</div><div><br></div><div>If you want to find a particular proc, though, you would look under orte_local_children - search the list for a child whose jobid and vpid both match.</div><div><br></div><div>Note that you will not find that child process -unless- the child is under that daemon.</div><div><br></div><div>I'm not sure what you are trying to accomplish, so I can't give further advice. Note that daemons have limited knowledge of application processes that are not their own immediate children. What little they know regarding processes other than their own is stored in the nidmap/pidmap arrays - limited to location, local rank, and node rank. They have no storage currently allocated for things like the state of a non-local process.</div><div><br></div><div><br><blockquote type="cite"><div><div class="gmail_quote"><blockquote class="gmail_quote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0.8ex; border-left-width: 1px; border-left-color: rgb(204, 204, 204); border-left-style: solid; padding-left: 1ex; position: static; z-index: auto; ">
<div style="word-wrap:break-word"><div><br></div><div>Also, remember that if you are in a daemon, then the jdata objects are not populated. The daemons work exclusively from the orte_local_jobdata and orte_local_children lists, so you would have to find your process there.</div>
</div></blockquote><div><br></div><div>That's why i'm asking to the hnp about the jdata using&nbsp;<span class="Apple-style-span" style="border-collapse: collapse; font-family: arial, sans-serif; font-size: 13px; "><b>ORTE_DAEMON_REPORT_JOB_INFO_CMD</b>, i assume that he has the information about the dead process.</span></div></div></div></blockquote><div><br></div>Only after the daemon reports it.</div><div><br><blockquote type="cite"><div><div class="gmail_quote">
<div><span class="Apple-style-span" style="border-collapse: collapse; font-family: arial, sans-serif; font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="border-collapse: collapse; font-family: arial, sans-serif; font-size: 13px; ">Any idea?</span></div>
<div><font class="Apple-style-span" face="arial, sans-serif"><span class="Apple-style-span" style="border-collapse: collapse;"><br></span></font></div><div><font class="Apple-style-span" face="arial, sans-serif"><span class="Apple-style-span" style="border-collapse: collapse;">Best regards.</span></font></div>
<div><font class="Apple-style-span" face="arial, sans-serif"><span class="Apple-style-span" style="border-collapse: collapse;"><br></span></font></div><div><font class="Apple-style-span" face="arial, sans-serif"><span class="Apple-style-span" style="border-collapse: collapse;">Hugo Meyer</span></font></div>
</div></div>
_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a></blockquote></div><br></body></html>
