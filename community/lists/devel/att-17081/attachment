<div dir="ltr">I answered to the PR but I&#39;ll bring my comment here as well. In addition to the performance implication, there might be a correctness implication here. del_procs does not have to be called globally by all participating processes in same time, and can be called with a subset of processes. As an example, a correct implementation of MPI_Comm_disconnect could call del_procs with all the processes that are becoming disconnected. Thus, a global pmix_fence, by it&#39;s conceptual implication of a global synchronization (due to the NULL parameter) might be the wrong thing to do.<div><br></div><div>  George.</div><div><br></div></div><div class="gmail_extra"><br><div class="gmail_quote">On Mon, Mar 2, 2015 at 10:05 AM, Ralph Castain <span dir="ltr">&lt;<a href="mailto:rhc@open-mpi.org" target="_blank">rhc@open-mpi.org</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">It’s your code, so you are welcome to do this if you want. I’ll just point out that his is a really big hit in total execution time at scale as it will be done in addition to the barrier already performed in MPI_Finalize<br>
<br>
So you are going to do _two_ barriers during shutdown.<br>
<div><div class="h5"><br>
<br>
&gt; On Mar 2, 2015, at 5:43 AM, <a href="mailto:gitdub@crest.iu.edu">gitdub@crest.iu.edu</a> wrote:<br>
&gt;<br>
&gt; This is an automated email from the git hooks/post-receive script. It was<br>
&gt; generated because a ref change was pushed to the repository containing<br>
&gt; the project &quot;open-mpi/ompi&quot;.<br>
&gt;<br>
&gt; The branch, master has been updated<br>
&gt;       via  fbb7c80312cbcd823346e89a56f5d83e8620c57c (commit)<br>
&gt;       via  168c83ed9592120fd2199e8280b517ab0060e136 (commit)<br>
&gt;      from  42f5a36ee3f1e400aa251804725b86192c9df9fa (commit)<br>
&gt;<br>
&gt; Those revisions listed above that are new to this repository have<br>
&gt; not appeared on any other notification email; so we list those<br>
&gt; revisions in full, below.<br>
&gt;<br>
&gt; - Log -----------------------------------------------------------------<br>
&gt; <a href="https://github.com/open-mpi/ompi/commit/fbb7c80312cbcd823346e89a56f5d83e8620c57c" target="_blank">https://github.com/open-mpi/ompi/commit/fbb7c80312cbcd823346e89a56f5d83e8620c57c</a><br>
&gt;<br>
&gt; commit fbb7c80312cbcd823346e89a56f5d83e8620c57c<br>
&gt; Merge: 42f5a36 168c83e<br>
&gt; Author: Mike Dubman &lt;<a href="mailto:miked@mellanox.com">miked@mellanox.com</a>&gt;<br>
&gt; Date:   Mon Mar 2 15:43:32 2015 +0200<br>
&gt;<br>
&gt;    Merge pull request #439 from alex-mikheev/topic/mxm_finalize_fix<br>
&gt;<br>
&gt;    OMPI/MXM: add out of band barrier at the end of del_procs<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt; <a href="https://github.com/open-mpi/ompi/commit/168c83ed9592120fd2199e8280b517ab0060e136" target="_blank">https://github.com/open-mpi/ompi/commit/168c83ed9592120fd2199e8280b517ab0060e136</a><br>
&gt;<br>
&gt; commit 168c83ed9592120fd2199e8280b517ab0060e136<br>
&gt; Author: Alex Mikheev &lt;<a href="mailto:alexm@mellanox.com">alexm@mellanox.com</a>&gt;<br>
&gt; Date:   Mon Mar 2 12:56:02 2015 +0200<br>
&gt;<br>
&gt;    OMPI/MXM: add out of band barrier at the end of del_procs<br>
&gt;<br>
&gt;    mxm shutdown requires out of band barrier<br>
&gt;<br>
&gt; diff --git a/ompi/mca/mtl/mxm/mtl_mxm.c b/ompi/mca/mtl/mxm/mtl_mxm.c<br>
&gt; index 1a4e21a..ed4089a 100644<br>
&gt; --- a/ompi/mca/mtl/mxm/mtl_mxm.c<br>
&gt; +++ b/ompi/mca/mtl/mxm/mtl_mxm.c<br>
&gt; @@ -617,6 +617,7 @@ int ompi_mtl_mxm_del_procs(struct mca_mtl_base_module_t *mtl, size_t nprocs,<br>
&gt;             OBJ_RELEASE(endpoint);<br>
&gt;         }<br>
&gt;     }<br>
&gt; +    opal_pmix.fence(NULL, 0);<br>
&gt;     return OMPI_SUCCESS;<br>
&gt; }<br>
&gt;<br>
&gt; diff --git a/ompi/mca/pml/yalla/pml_yalla.c b/ompi/mca/pml/yalla/pml_yalla.c<br>
&gt; index 2cfa6ca..d53cb7c 100644<br>
&gt; --- a/ompi/mca/pml/yalla/pml_yalla.c<br>
&gt; +++ b/ompi/mca/pml/yalla/pml_yalla.c<br>
&gt; @@ -240,6 +240,7 @@ int mca_pml_yalla_del_procs(struct ompi_proc_t **procs, size_t nprocs)<br>
&gt;         PML_YALLA_VERBOSE(2, &quot;disconnected from rank %ld&quot;, procs[i]-&gt;super.proc_name);<br>
&gt;         procs[i]-&gt;proc_endpoints[OMPI_PROC_ENDPOINT_TAG_PML] = NULL;<br>
&gt;     }<br>
&gt; +    opal_pmix.fence(NULL, 0);<br>
&gt;     return OMPI_SUCCESS;<br>
&gt; }<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt; -----------------------------------------------------------------------<br>
&gt;<br>
&gt; Summary of changes:<br>
&gt; ompi/mca/mtl/mxm/mtl_mxm.c     | 1 +<br>
&gt; ompi/mca/pml/yalla/pml_yalla.c | 1 +<br>
&gt; 2 files changed, 2 insertions(+)<br>
&gt;<br>
&gt;<br>
&gt; hooks/post-receive<br>
&gt; --<br>
&gt; open-mpi/ompi<br>
&gt; _______________________________________________<br>
&gt; ompi-commits mailing list<br>
&gt; <a href="mailto:ompi-commits@open-mpi.org">ompi-commits@open-mpi.org</a><br>
&gt; <a href="http://www.open-mpi.org/mailman/listinfo.cgi/ompi-commits" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/ompi-commits</a><br>
<br>
</div></div>_______________________________________________<br>
devel mailing list<br>
<a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
Searchable archives: <a href="http://www.open-mpi.org/community/lists/devel/2015/03/index.php" target="_blank">http://www.open-mpi.org/community/lists/devel/2015/03/index.php</a></blockquote></div><br></div>

