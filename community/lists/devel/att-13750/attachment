<div dir="ltr">Digging through my emails I found an issue (in the email quoted below) that I had forgotten about.<div>The basic issue is that NetBSD puts aio support in librt rather than libc, but this is only visible when linking statically.</div>
<div><br></div><div>Fortunately, NetBSD is one of the very few platforms on which I have sufficiently new autotools to run <a href="http://autogen.pl">autogen.pl</a>.</div><div>The patch below resolves the problem for me.</div>
<div>However, I am not certain if/how this fits with OMPI&#39;s standard practices with regards to configure tests.</div><div><br></div><div>-Paul</div><div><br></div><div><div><font face="courier new, monospace" size="1">--- openmpi-1.9a1r30255/ompi/mca/fbtl/posix/configure.m4~       2014-01-11 15:53:19.000000000 -0800</font></div>
<div><font face="courier new, monospace" size="1">+++ openmpi-1.9a1r30255/ompi/mca/fbtl/posix/configure.m4        2014-01-11 16:25:53.000000000 -0800</font></div><div><font face="courier new, monospace" size="1">@@ -25,9 +25,11 @@</font></div>
<div><font face="courier new, monospace" size="1"> AC_DEFUN([MCA_ompi_fbtl_posix_CONFIG],[</font></div><div><font face="courier new, monospace" size="1">     AC_CONFIG_FILES([ompi/mca/fbtl/posix/Makefile])</font></div><div>
<font face="courier new, monospace" size="1"> </font></div><div><font face="courier new, monospace" size="1">+    fbtl_posix_happy=&quot;no&quot;</font></div><div><font face="courier new, monospace" size="1">     AC_CHECK_HEADER([aio.h],</font></div>
<div><font face="courier new, monospace" size="1">-                    [fbtl_posix_happy=&quot;yes&quot;],</font></div><div><font face="courier new, monospace" size="1">-                    [fbtl_posix_happy=&quot;no&quot;])</font></div>
<div><font face="courier new, monospace" size="1">+        [dnl NetBSD has aio_* in -lrt, usually in libc</font></div><div><font face="courier new, monospace" size="1">+         OMPI_CHECK_FUNC_LIB([aio_write], [rt],</font></div>
<div><font face="courier new, monospace" size="1">+             [fbtl_posix_happy=&quot;yes&quot;])])</font></div><div><font face="courier new, monospace" size="1"> </font></div><div><font face="courier new, monospace" size="1">     AS_IF([test &quot;$fbtl_posix_happy&quot; = &quot;yes&quot;],</font></div>
<div><font face="courier new, monospace" size="1">           [$1],</font></div></div><div><br></div><div class="gmail_extra"><br><br><div class="gmail_quote">On Wed, Jan 8, 2014 at 11:22 AM, Paul Hargrove <span dir="ltr">&lt;<a href="mailto:phhargrove@lbl.gov" target="_blank">phhargrove@lbl.gov</a>&gt;</span> wrote:<br>
<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">When I compile the current 1.7.4rc on NetBSD with no configure arguments, I still get the &quot;make install&quot; failure that I have detailed in previous emails.<div>
<br></div><div>HOWEVER, if I configure with &quot;--enable-static --disable-shared&quot; then I get an earlier failure at build time (partial &quot;make V=1&quot; output shown below).</div>
<div><br></div><div>When linking otfmerge-mpi, the aio_* symbols from libmpi.a(ompi/mca/fbtl/posix/fbtl_posix_ipwritev.o) are not resolved.  According to the man pages on this system, those symbols reside in librt, but there is no occurrence of &quot;-lrt&quot; in either the libtool command line or the gcc command line generated by libtool.</div>

<div><br></div><div>NOTE, however, that this problem does NOT occur when building a default shared library version despite ALSO lacking any explicit &quot;-lrt&quot; in the link command.</div><div><br></div><div>-Paul</div>

<div><br></div><div><br></div><div><div><font face="courier new, monospace" size="1">/bin/ksh ../../../libtool  --tag=CC    --mode=link gcc -DOTFMERGE_MPI    -g -finline-functions -fno-strict-aliasing -pthread  -L/home/phargrov/OMPI/openmpi-1.7-latest-netbsd6-amd64/BLD/ompi/contrib/vt/vt/../../../.libs -o otfmerge-mpi otfmerge_mpi-handler.o  otfmerge_mpi-otfmerge.o ../../../otflib/<a href="http://libopen-trace-format.la" target="_blank">libopen-trace-format.la</a>  ../../../otfauxlib/<a href="http://libotfaux.la" target="_blank">libotfaux.la</a> -lmpi</font></div>

<div><font face="courier new, monospace" size="1">libtool: link: gcc -DOTFMERGE_MPI -g -finline-functions -fno-strict-aliasing -pthread -o otfmerge-mpi otfmerge_mpi-handler.o otfmerge_mpi-otfmerge.o  -L/home/phargrov/OMPI/openmpi-1.7-latest-netbsd6-amd64/BLD/ompi/contrib/vt/vt/../../../.libs ../../../otflib/.libs/libopen-trace-format.a -lz ../../../otfauxlib/.libs/libotfaux.a /home/phargrov/OMPI/openmpi-1.7-latest-netbsd6-amd64/BLD/ompi/contrib/vt/vt/../../../.libs/libmpi.a /home/phargrov/OMPI/openmpi-1.7-latest-netbsd6-amd64/BLD/orte/.libs/libopen-rte.a /home/phargrov/OMPI/openmpi-1.7-latest-netbsd6-amd64/BLD/opal/.libs/libopen-pal.a -lutil -lm -lpthread -pthread</font></div>

<div><font face="courier new, monospace" size="1">/home/phargrov/OMPI/openmpi-1.7-latest-netbsd6-amd64/BLD/ompi/contrib/vt/vt/../../../.libs/libmpi.a(fbtl_posix_ipwritev.o): In function `mca_fbtl_posix_ipwritev&#39;:</font></div>

<div><font face="courier new, monospace" size="1">/home/phargrov/OMPI/openmpi-1.7-latest-netbsd6-amd64/openmpi-1.7-latest/ompi/mca/fbtl/posix/fbtl_posix_ipwritev.c:90: undefined reference to `aio_write&#39;</font></div><div>

<font face="courier new, monospace" size="1">/home/phargrov/OMPI/openmpi-1.7-latest-netbsd6-amd64/openmpi-1.7-latest/ompi/mca/fbtl/posix/fbtl_posix_ipwritev.c:112: undefined reference to `aio_write&#39;</font></div><div>
<font face="courier new, monospace" size="1">/home/phargrov/OMPI/openmpi-1.7-latest-netbsd6-amd64/openmpi-1.7-latest/ompi/mca/fbtl/posix/fbtl_posix_ipwritev.c:159: undefined reference to `aio_write&#39;</font></div>
<div><font face="courier new, monospace" size="1">/home/phargrov/OMPI/openmpi-1.7-latest-netbsd6-amd64/openmpi-1.7-latest/ompi/mca/fbtl/posix/fbtl_posix_ipwritev.c:180: undefined reference to `aio_write&#39;</font></div>
<div>
<font face="courier new, monospace" size="1">*** Error code 1</font></div><div><font face="courier new, monospace" size="1"><br></font></div><div><font face="courier new, monospace" size="1">Stop.</font></div><div><font face="courier new, monospace" size="1">make: stopped in /home/phargrov/OMPI/openmpi-1.7-latest-netbsd6-amd64/BLD/ompi/contrib/vt/vt/extlib/otf/tools/otfmerge/mpi</font></div>
<span class="HOEnZb"><font color="#888888">
<div><br></div>-- <br><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Future Technologies Group</div>

<div>Computer and Data Sciences Department     Tel: <a href="tel:%2B1-510-495-2352" value="+15104952352" target="_blank">+1-510-495-2352</a></div><div>Lawrence Berkeley National Laboratory     Fax: <a href="tel:%2B1-510-486-6900" value="+15104866900" target="_blank">+1-510-486-6900</a></div>
</font>
</font></span></div></div>
</blockquote></div><br><br clear="all"><div><br></div>-- <br><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div>
<div>Future Technologies Group</div><div>Computer and Data Sciences Department     Tel: +1-510-495-2352</div><div>Lawrence Berkeley National Laboratory     Fax: +1-510-486-6900</div></font>
</div></div>

