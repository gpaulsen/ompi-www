<div dir="ltr">I had reason to look at the linux timer code today and noticed what I believe to be a subtle error.<div>This is in both &#39;master&#39; and v1.8.5rc2<br><div><br></div><div>Since casts bind tighter than multiplication in C, I believe that the 1-line patch below is required to produce the desired result of conversion to an integer *after* the multiplication.<br></div><div>While I don&#39;t see how to exercise the code, I can see that cpu_f=2692.841 will yield opal_timer_linux_freq=2,692,000,000 rather than 2,692,841,000.</div><div><br></div><div><div>-Paul</div><div><br></div><div><br></div><div><div>diff --git a/opal/mca/timer/linux/timer_linux_component.c b/opal/mca/timer/linux/timer_linux_component.c</div><div>index b130826..7abe578 100644</div><div>--- a/opal/mca/timer/linux/timer_linux_component.c</div><div>+++ b/opal/mca/timer/linux/timer_linux_component.c</div><div>@@ -128,7 +128,7 @@ static int opal_timer_linux_find_freq(void)</div><div>             ret = sscanf(loc, &quot;%f&quot;, &amp;cpu_f);</div><div>             if (1 == ret) {</div><div>                 /* numer is in MHz - convert to Hz and make an integer */</div><div>-                opal_timer_linux_freq = (opal_timer_t) cpu_f * 1000000;</div><div>+                opal_timer_linux_freq = (opal_timer_t) (cpu_f * 1000000);</div><div>             }</div><div>         }</div><div>     }</div><div><br></div>-- <br><div class="gmail_signature"><div dir="ltr"><div><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Computer Languages &amp; Systems Software (CLaSS) Group</div><div>Computer Science Department               Tel: +1-510-495-2352</div><div>Lawrence Berkeley National Laboratory     Fax: +1-510-486-6900</div></font></div></div></div>
</div></div></div></div>

