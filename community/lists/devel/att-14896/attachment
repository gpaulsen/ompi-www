<div dir="ltr"><div class="gmail_extra"><div class="gmail_quote"><div>Ralph,</div><div><br></div><div>what if ?</div><div><br></div><div>the parent :</div><div>MPI_Comm_free(&amp;merged);</div><div>MPI_Comm_disconnect(&amp;comm);</div>
<div><br></div><div>and the child</div><div>MPI_Comm_free(&amp;merged);</div><div>MPI_Comm_disconnect(&amp;parent);</div><div><br></div><div>Gilles</div><div> </div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
<div style="word-wrap:break-word"><div><div class=""><div></div></div>Good point - however, that doesn&#39;t fix it. Changing the Comm_free calls to Comm_disconnect results in the same error messages when the parent finalizes:</div>
<div><br></div><div>Parent:</div><div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">    MPI_Init( &amp;argc, &amp;argv);</div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156);min-height:13px">
<br></div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">    for (iter = 0; iter &lt; 100; ++iter) {</div><div class=""><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">
        MPI_Comm_spawn(EXE_TEST, NULL, 1, MPI_INFO_NULL,</div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">                       0, MPI_COMM_WORLD, &amp;comm, &amp;err);</div>
<div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">        printf(&quot;parent: MPI_Comm_spawn #%d return : %d\n&quot;, iter, err);</div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156);min-height:13px">
<br></div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">        MPI_Intercomm_merge(comm, 0, &amp;merged);</div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">
        MPI_Comm_rank(merged, &amp;rank);</div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">        MPI_Comm_size(merged, &amp;size);</div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">
        printf(&quot;parent: MPI_Comm_spawn #%d rank %d, size %d\n&quot;, </div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">               iter, rank, size);</div></div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">
        MPI_Comm_disconnect(&amp;merged);</div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">    }</div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156);min-height:13px">
<br></div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">    MPI_Finalize();</div><div><br></div><div><br></div><div>Child:</div><div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">
    MPI_Init(&amp;argc, &amp;argv);   </div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">    printf(&quot;Child: launch\n&quot;);</div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">
    MPI_Comm_get_parent(&amp;parent);   </div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">    MPI_Intercomm_merge(parent, 1, &amp;merged);</div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">
    MPI_Comm_rank(merged, &amp;rank);</div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">    MPI_Comm_size(merged, &amp;size);</div><div class=""><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">
    printf(&quot;Child merged rank = %d, size = %d\n&quot;, rank, size);</div><p style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156);min-height:13px">   <br></p></div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">
    MPI_Comm_disconnect(&amp;merged);</div><div style="margin:0px;font-size:11px;font-family:Menlo;background-color:rgb(254,244,156)">    MPI_Finalize();</div></div><div><br></div><div><br></div></div></div></blockquote></div>
<br></div></div>

