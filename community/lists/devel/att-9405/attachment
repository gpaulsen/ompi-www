<html><head></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">Ummm...just to clarify. There are no threads in ORTE, so it wasn't a problem of "not giving up the thread". The problem was that Josh's test never called progress. It would have been equally okay to simply call "opal_event_dispatch" while waiting for the callback.<div><br></div><div>All applications have to cycle the progress engine.</div><div><br></div><div><br><div><div>On Jun 23, 2011, at 1:18 PM, Wesley Bland wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div>
            <div><span>Josh,</span></div><div><span><br></span></div><div><span>There were a couple of bugs that I cleared up in my most recent checkin, but I also needed to modify your test. The callback for the application layer errmgr actually occurs in the application layer. Your test was never giving up the thread to the ORTE application event loop to receive its message from the ORTED. I changed your while loop to an ORTE_PROGRESSED_WAIT and that fixed the problem.</span></div><div><span><br></span></div><div><span>Try running the attached code with the modifications and see if that clears up the problem. It did for me.</span></div><div><span><br></span></div><div><span>Thanks,</span></div><div><span>Wesley<br>
                </span>
                <span></span><p style="color: #a0a0a0;">On Thursday, June 23, 2011 at 10:16 AM, Josh Hursey wrote:</p>
                <blockquote type="cite" style="border-left-style:solid;border-width:1px;margin-left:0px;padding-left:10px;">
                    <span><div><div>So I finally got a chance to test the branch this morning. I cannot<br>get it to work. Maybe I'm doing some wrong, missing some MCA<br>parameter?<br><br>-------------------------<br>[jjhursey@smoky-login1 resilient-orte] hg summary<br>parent: 2:c550cf6ed6a2 tip<br> Newest version. Synced with trunk r24785.<br>branch: default<br>commit: 1 modified, 8097 unknown<br>update: (current)<br>-------------------------<br>(the 1 modified was the test program attached)<br><br>Attached is a modified version of the orte_abort.c program found in<br>${top}/orte/test/system. This program is ORTE only, and registers the<br>errmgr callback to trigger correct termination. You will need to<br>configure Open MPI with '--with-devel-headers' to build this. But then<br>you can compile with:<br>  ortecc -g    orte_abort.c   -o orte_abort<br><br>These are the configure options that I used:<br> --with-devel-headers --enable-binaries --disable-io-romio<br>--enable-contrib-no-build=vt --enable-debug CC=gcc CXX=g++<br>F77=gfortran FC=gfortran<br><br><br>If the HNP has no processes on it - I get a hang:<br>-------------------------------<br>mpirun -np 4 --nolocal orte_abort<br>orte_abort: Name [[60121,1],0,0] Host: smoky13 Pid 3688 -- Initalized<br>orte_abort: Name [[60121,1],1,0] Host: smoky13 Pid 3689 -- Initalized<br>orte_abort: Name [[60121,1],2,0] Host: smoky13 Pid 3690 -- Initalized<br>orte_abort: Name [[60121,1],3,0] Host: smoky13 Pid 3691 -- Initalized<br>orte_abort: Name [[60121,1],3,0] Host: smoky13 Pid 3691 -- Calling Abort<br>mpirun: killing job...<br><br>[smoky14:04002] [[60121,0],0,0] ORTE_ERROR_LOG: Data unpack would read<br>past end of buffer in file errmgr_hnp.c at line 824<br>[smoky14:04002] [[60121,0],0,0] ORTE_ERROR_LOG: Data unpack would read<br>past end of buffer in file orted/orted_comm.c at line 1341<br>mpirun: abort is already in progress...hit ctrl-c again to forcibly terminate<br><br>[jjhursey@smoky14 system] echo $?<br>1<br>-------------------------------<br><br>If the HNP has processes on it, but not the one that aborted - I get a hang:<br>-------------------------------<br>[jjhursey@smoky14 system] mpirun -np 4 --npernode 2 orte_abort<br>orte_abort: Name [[60302,1],0,0] Host: smoky14 Pid 3830 -- Initalized<br>orte_abort: Name [[60302,1],1,0] Host: smoky14 Pid 3831 -- Initalized<br>orte_abort: Name [[60302,1],2,0] Host: smoky13 Pid 3484 -- Initalized<br>orte_abort: Name [[60302,1],3,0] Host: smoky13 Pid 3485 -- Initalized<br>orte_abort: Name [[60302,1],3,0] Host: smoky13 Pid 3485 -- Calling Abort<br>mpirun: killing job...<br><br>[smoky14:03829] [[60302,0],0,0]-[[60302,1],1,0] mca_oob_tcp_msg_recv:<br>readv failed: Connection reset by peer (104)<br>[smoky14:03829] [[60302,0],0,0]-[[60302,1],0,0] mca_oob_tcp_msg_recv:<br>readv failed: Connection reset by peer (104)<br>[smoky14:03829] [[60302,0],0,0] ORTE_ERROR_LOG: Data unpack would read<br>past end of buffer in file errmgr_hnp.c at line 824<br>[smoky14:03829] [[60302,0],0,0] ORTE_ERROR_LOG: Data unpack would read<br>past end of buffer in file orted/orted_comm.c at line 1341<br>mpirun: abort is already in progress...hit ctrl-c again to forcibly terminate<br><br>[jjhursey@smoky14 system] echo $?<br>1<br>--------------------------------<br><br>If the HNP has processes on it, and it is the one that aborted - I get<br>immediate return, but no callback:<br>--------------------------------<br>[jjhursey@smoky14 system] mpirun -np 4 --npernode 4 orte_abort<br>orte_abort: Name [[60292,1],0,0] Host: smoky14 Pid 3840 -- Initalized<br>orte_abort: Name [[60292,1],1,0] Host: smoky14 Pid 3841 -- Initalized<br>orte_abort: Name [[60292,1],2,0] Host: smoky14 Pid 3842 -- Initalized<br>orte_abort: Name [[60292,1],3,0] Host: smoky14 Pid 3843 -- Initalized<br>orte_abort: Name [[60292,1],3,0] Host: smoky14 Pid 3843 -- Calling Abort<br>[jjhursey@smoky14 system] echo $?<br>3<br>--------------------------------<br><br>Any ideas on what I might be doing wrong?<br><br>I tried with both calling 'orte_errmgr.abort(ORTE_PROC_MY_NAME-&gt;vpid,<br>NULL);' and 'kill(getpid(), SIGKILL);' and got the same behavior.<br><br>-- Josh<br><br><br><br>On Thu, Jun 23, 2011 at 9:58 AM, Wesley Bland &lt;<a href="mailto:wbland@eecs.utk.edu">wbland@eecs.utk.edu</a>&gt; wrote:<br><blockquote type="cite"><div>Last reminder (I hope). RFC goes in a COB today.<br>Wesley<br>_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br></div></blockquote><br><br><br>-- <br>Joshua Hursey<br>Postdoctoral Research Associate<br>Oak Ridge National Laboratory<br><a href="http://users.nccs.gov/~jjhursey">http://users.nccs.gov/~jjhursey</a><br></div><div>_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br></div></div></span>
                
                
                <div style="border-bottom: 1px solid #f0f0f0; height: 10px;">
                </div>
                <br>
                
                <div style="font-weight: bold; font-size: 14px; margin-bottom: 5px;">Attachments:</div>
                
                
                
                
                
                
                
                <div>
                    
                    <div style="">- orte_abort.c</div>
                    
                </div>
                
                
                
                </blockquote>
                
                <div>
                    <br>
                </div>
            </div>
        </div><span>&lt;orte_abort.c&gt;</span>_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>http://www.open-mpi.org/mailman/listinfo.cgi/devel</blockquote></div><br></div></body></html>
