<html><head></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">Be careful what you wish for.<div><br></div><div>I remember looking at this issue a while ago, but I can't remember why or how I ran into it. &nbsp;I do remember convincing myself that the MPI standard was correct in restricting SIZEOF to numeric types. &nbsp;For one thing, a character variable type is a string container in Fortran, while in C it is a single character. &nbsp;What would be the correct interpretation for SIZEOF in Fortran? &nbsp;The maximum length? &nbsp;The TRIM'd length? &nbsp;What would be the correct interpretation in C? &nbsp;1? &nbsp;strlen()? &nbsp;strlen()+1? &nbsp;The size of a character itself may not be the same on either end of an MPI connection if, for example, one program is compiled using 8-bit characters and the other is compiled using uses 16-bit characters. &nbsp;Interchanging strings opens up a can of worms. &nbsp;As far as logical, there is no C logical type. &nbsp;In Fortran, while the size of a logical variable is specified as a "storage unit" (the same as an integer), the representation of true and false is unspecified, and, thus, is processor dependent. &nbsp;On VAXes, only a single bit matters; the instruction set supports this logical data type. &nbsp;(In C, thought there is no logical data type, the C standard does specify 0=false and 1=true for the result of relational and logical operators and 0=false and not 0=true for logical operator operands.)&nbsp;&nbsp;This means it is problematic to exchange logical data between Fortran programs (C makes no sense, since there is no logical data type) when different compilers (part of what Fortran calls a processor) are used.</div><div><br></div><div>Better to find out what discussions took place in the MPI standards committee before adding extensions to SIZEOF. &nbsp;They may very well have good reasons to avoid character and logical data, as I concluded.&nbsp;</div><div><br><div>
<span class="Apple-style-span" style="border-collapse: separate; color: rgb(0, 0, 0); font-family: 'Helvetica Neue'; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; font-size: medium; ">Larry Baker<br>US Geological Survey<br>650-329-5608<br><a href="mailto:baker@usgs.gov">baker@usgs.gov</a><br><br><br></span>
</div>
<br><div><div>On 15 Apr 2016, at 5:34 AM, Jeff Squyres (jsquyres) wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div>Nadia --<br><br>I believe that the character and logical types are not in this script already because the description of MPI_SIZEOF in MPI-3.1 says that the input choice buffer parameter is:<br><br>IN x &nbsp;&nbsp;&nbsp;&nbsp;a Fortran variable of numeric intrinsic type (choice)<br><br>As I understand it (and my usual disclaimer here: I am *not* a Fortran expert), CHARACTER and LOGICAL types are not numeric in Fortran.<br><br>However, we could add such interfaces as an extension.<br><br>I just checked MPICH 3.2, and they *do* include MPI_SIZEOF interfaces for CHARACTER and LOGICAL, but they are missing many of the other MPI_SIZEOF interfaces that we have in OMPI. &nbsp;Meaning: OMPI and MPICH already diverge wildly on MPI_SIZEOF. &nbsp;:-\<br><br>I guess I don't have a strong opinion here. &nbsp;If you file a PR for this patch, I won't object. &nbsp;:-)<br><br><br><blockquote type="cite">On Apr 15, 2016, at 3:22 AM, DERBEY, NADIA &lt;<a href="mailto:nadia.derbey@atos.net">nadia.derbey@atos.net</a>&gt; wrote:<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">Hi,<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">The following trivial example doesn't compile because of 2 missing types <br></blockquote><blockquote type="cite">in the MPI_SIZEOF subroutines (in mpi_sizeof.f90).<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">[derbeyn@btp0 test]$ cat mpi_sizeof.f90<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;program main<br></blockquote><blockquote type="cite">! &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use mpi<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;include 'mpif.h'<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;integer ierr, sz, mpisize<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;real r1<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;integer i1<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;character ch1<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logical l1<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call MPI_INIT(ierr)<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call MPI_SIZEOF(r1, sz, ierr)<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call MPI_SIZEOF(i1, sz, ierr)<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call MPI_SIZEOF(l1, sz, ierr)<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call MPI_SIZEOF(ch1, sz, ierr)<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call MPI_FINALIZE(ierr)<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br></blockquote><blockquote type="cite">[derbeyn@btp0 test]$ mpif90 -o mpi_sizeof mpi_sizeof.f90<br></blockquote><blockquote type="cite">mpi_sizeof.f90(14): error #6285: There is no matching specific <br></blockquote><blockquote type="cite">subroutine for this generic subroutine call. &nbsp;&nbsp;[MPI_SIZEOF]<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call MPI_SIZEOF(ch1, sz, ierr)<br></blockquote><blockquote type="cite">-------------^<br></blockquote><blockquote type="cite">mpi_sizeof.f90(15): error #6285: There is no matching specific<br></blockquote><blockquote type="cite">subroutine for this generic subroutine call. &nbsp;&nbsp;[MPI_SIZEOF]<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call MPI_SIZEOF(l1, sz, ierr)<br></blockquote><blockquote type="cite">-------------^<br></blockquote><blockquote type="cite">compilation aborted for mpi_sizeof.f90 (code 1)<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">This problem happens both on master and v2.x. The following patch seems<br></blockquote><blockquote type="cite">to solve the issue:<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">diff --git a/ompi/mpi/fortran/base/gen-mpi-sizeof.pl<br></blockquote><blockquote type="cite">b/ompi/mpi/fortran/base/gen-mpi-sizeof.pl<br></blockquote><blockquote type="cite">index 5ea3dca3..a2a99924 100755<br></blockquote><blockquote type="cite">--- a/ompi/mpi/fortran/base/gen-mpi-sizeof.pl<br></blockquote><blockquote type="cite">+++ b/ompi/mpi/fortran/base/gen-mpi-sizeof.pl<br></blockquote><blockquote type="cite">@@ -145,6 +145,9 @@ sub generate {<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;# Main<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">#############################################################################<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">+queue_sub("character", "char", "character_kinds");<br></blockquote><blockquote type="cite">+queue_sub("logical", "logical", "logical_kinds");<br></blockquote><blockquote type="cite">+<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;for my $size (qw/8 16 32 64/) {<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queue_sub("integer(int${size})", "int${size}", "int${size}");<br></blockquote><blockquote type="cite"> &nbsp;&nbsp;}<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">Regards,<br></blockquote><blockquote type="cite">Nadia<br></blockquote><blockquote type="cite"><br></blockquote><blockquote type="cite">-- <br></blockquote><blockquote type="cite">Nadia Derbey - B1-387<br></blockquote><blockquote type="cite">HPC R&amp;D - MPI<br></blockquote><blockquote type="cite">Tel: +33 4 76 29 77 62<br></blockquote><blockquote type="cite"><a href="mailto:nadia.derbey@atos.net">nadia.derbey@atos.net</a><br></blockquote><blockquote type="cite">1 Rue de Provence BP 208<br></blockquote><blockquote type="cite">38130 Echirolles Cedex, France<br></blockquote><blockquote type="cite"><a href="http://www.atos.com">www.atos.com</a><br></blockquote><blockquote type="cite">_______________________________________________<br></blockquote><blockquote type="cite">devel mailing list<br></blockquote><blockquote type="cite"><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br></blockquote><blockquote type="cite">Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br></blockquote><blockquote type="cite">Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2016/04/18765.php">http://www.open-mpi.org/community/lists/devel/2016/04/18765.php</a><br></blockquote><br><br>-- <br>Jeff Squyres<br><a href="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a><br>For corporate legal information go to: http://www.cisco.com/web/about/doing_business/legal/cri/<br><br>_______________________________________________<br>devel mailing list<br>devel@open-mpi.org<br>Subscription: http://www.open-mpi.org/mailman/listinfo.cgi/devel<br>Link to this post: http://www.open-mpi.org/community/lists/devel/2016/04/18766.php<br></div></blockquote></div><br></div></body></html>
