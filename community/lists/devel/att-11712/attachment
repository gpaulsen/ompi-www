<html><head><meta http-equiv="Content-Type" content="text/html charset=iso-8859-1"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">Understood - I also do my development on a Mac. You missed my point entirely - the concern was raised by a member from Sandia based on not generating warnings for their users. Those users are NOT on a Mac - they are building on the head node of the HPC cluster.<div><br></div><div>If we want to raise the issue of what is best for developers, then I tend to err on the side of generating warnings. However, those warnings must not appear for users when the code is in fact valid.</div><div><br></div><div>The fact that some compilers do that is irrelevant - we are talking about what we want OMPI to do.</div><div><br></div><div><br><div><div>On Oct 31, 2012, at 12:11 PM, Paul Hargrove &lt;<a href="mailto:phhargrove@lbl.gov">phhargrove@lbl.gov</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite">Ralph,<div><br></div><div>I work at a National Lab, and like many of my peers I develop/prototype codes on my desktop and/or laptop. &nbsp;So, I think the default behavior of mpicc on a Clang-based Mac is entirely&nbsp;relevant.</div>
<div><br></div><div>FWIW:</div><div>I agree w/ Jeff that these datatype checking warnings "feel" like a&nbsp;candidate&nbsp;for "-Wall" (or "-Wextra"), rather than enabled by default.</div><div><br></div>
<div>-Paul</div><div class="gmail_extra"><br><br><div class="gmail_quote">On Wed, Oct 31, 2012 at 12:04 PM, Ralph Castain <span dir="ltr">&lt;<a href="mailto:rhc@open-mpi.org" target="_blank">rhc@open-mpi.org</a>&gt;</span> wrote:<br>
<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div style="word-wrap:break-word">Understood, but also remember that the national labs don't have Mac clusters - and so they couldn't care less about Clang. The concerns over these changes were from the national labs, so my point was that this discussion may all be irrelevant.<div>
<br></div><div><br><div><div>On Oct 31, 2012, at 11:47 AM, Paul Hargrove &lt;<a href="mailto:phhargrove@lbl.gov" target="_blank">phhargrove@lbl.gov</a>&gt; wrote:</div><br><blockquote type="cite">Note that with Apple's latest versions of Xcode (4.2 and higher, IIRC) Clang is now the default C compiler. &nbsp;I am told that Clang is the ONLY bundled compiler for OSX 10.8 (Mountain Lion) unless you take extra steps to install gcc (which is actually llvm-gcc and cross-compiles for OSX 10.7).<div>

<br></div><div>So, Clang *is* gaining some "market share", though not yet in major HPC systems.</div><div><br></div><div>-Paul</div><div class="gmail_extra"><br><br><div class="gmail_quote">On Wed, Oct 31, 2012 at 11:40 AM, Ralph Castain <span dir="ltr">&lt;<a href="mailto:rhc@open-mpi.org" target="_blank">rhc@open-mpi.org</a>&gt;</span> wrote:<br>

<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">If it's only on for Clang, I very much doubt anyone will care - I'm unaware of any of our users that currently utilize that compiler, and certainly not on the clusters in the national labs (gcc, Intel, etc. - but I've never seen them use Clang).<br>


<br>
Not saying anything negative about Clang - just noting it isn't much used in our current community that I've heard.<br>
<br>
<br>
On Oct 31, 2012, at 11:19 AM, Dmitri Gribenko &lt;<a href="mailto:gribozavr@gmail.com" target="_blank">gribozavr@gmail.com</a>&gt; wrote:<br>
<br>
&gt; On Wed, Oct 31, 2012 at 5:04 PM, Jeff Squyres &lt;<a href="mailto:jsquyres@cisco.com" target="_blank">jsquyres@cisco.com</a>&gt; wrote:<br>
&gt;&gt; On Oct 31, 2012, at 9:38 AM, Dmitri Gribenko wrote:<br>
&gt;&gt;<br>
&gt;&gt;&gt;&gt; The rationale here is that correct MPI applications should not need to add any extra compiler files to compile without warnings.<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; I would disagree with this. &nbsp;Compiler warnings are most useful when<br>
&gt;&gt;&gt; they are on by default. &nbsp;Only a few developers will turn on a warning<br>
&gt;&gt;&gt; because warnings are hard to discover and enabling a warning requires<br>
&gt;&gt;&gt; an explicit action from the developer.<br>
&gt;&gt;<br>
&gt;&gt; Understood, but:<br>
&gt;&gt;<br>
&gt;&gt; a) MPI explicitly allows this kind of deliberate mismatch. &nbsp;It does not make sense to warn for things that are correct in MPI.<br>
&gt;<br>
&gt; I don't think it is MPI. &nbsp;It is the C standard that allows one to<br>
&gt; store any pointer in void* and char*. &nbsp;But C standard also considers<br>
&gt; lots of other weird things to be valid, see below.<br>
&gt;<br>
&gt;&gt; b) Warnings are significantly less useful if the user looks at them and says, "the compiler is wrong; I know that MPI says that this deliberate mismatch in my code is ok."<br>
&gt;<br>
&gt; Well, one can also argue that since the following is valid C, the<br>
&gt; warning in question should not be implemented at all:<br>
&gt;<br>
&gt; long *b = malloc(sizeof(int));<br>
&gt; MPI_Recv(b, 1, MPI_INT, ...);<br>
&gt;<br>
&gt; But this code is clearly badly written, so we are left with a question<br>
&gt; about where to draw the line.<br>
&gt;<br>
&gt;&gt; c) as such, these warnings are really only useful for the application where type/MPI_Datatype matching is expected/desired.<br>
&gt;<br>
&gt; Compilers already warn about valid C code. &nbsp;Silencing many warnings<br>
&gt; relies on conventions that are derived from best practices of being<br>
&gt; explicit about something unusual. &nbsp;For example:<br>
&gt;<br>
&gt; $ cat /tmp/aaa.c<br>
&gt; void foo(void *a) {<br>
&gt; &nbsp;for(int i = a; i &lt; 10; i++)<br>
&gt; &nbsp;{<br>
&gt; &nbsp; &nbsp;if(i = 5)<br>
&gt; &nbsp; &nbsp; &nbsp;return;<br>
&gt; &nbsp;}<br>
&gt; }<br>
&gt; $ clang -fsyntax-only -std=c99 /tmp/aaa.c<br>
&gt; /tmp/aaa.c:2:11: warning: incompatible pointer to integer conversion<br>
&gt; initializing 'int' with an expression of type 'void *'<br>
&gt; [-Wint-conversion]<br>
&gt; &nbsp;for(int i = a; i &lt; 10; i++)<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^ &nbsp; ~<br>
&gt; /tmp/aaa.c:4:10: warning: using the result of an assignment as a<br>
&gt; condition without parentheses [-Wparentheses]<br>
&gt; &nbsp; &nbsp;if(i = 5)<br>
&gt; &nbsp; &nbsp; &nbsp; ~~^~~<br>
&gt; /tmp/aaa.c:4:10: note: place parentheses around the assignment to<br>
&gt; silence this warning<br>
&gt; &nbsp; &nbsp;if(i = 5)<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; ^<br>
&gt; &nbsp; &nbsp; &nbsp; ( &nbsp; &nbsp;)<br>
&gt; /tmp/aaa.c:4:10: note: use '==' to turn this assignment into an<br>
&gt; equality comparison<br>
&gt; &nbsp; &nbsp;if(i = 5)<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; ^<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; ==<br>
&gt; 2 warnings generated.<br>
&gt;<br>
&gt; According to C standard this is valid C code, but clang emits two<br>
&gt; warnings on this.<br>
&gt;<br>
&gt;&gt; Can these warnings be enabled as part of the warnings rollup -Wall option? &nbsp;That would be an easy way to find/enable these warnings.<br>
&gt;<br>
&gt; IIRC, -Wall warning set is frozen in clang. &nbsp;-Wall is misleading in<br>
&gt; that it does not turn on all warnings implemented in the compiler.<br>
&gt; Clang has -Weverything to really turn on all warnings. &nbsp;But<br>
&gt; -Weverything is very noisy (by design, not to be fixed) unless one<br>
&gt; also turns off all warnings that are not interesting for the project<br>
&gt; with -Wno-foo.<br>
&gt;<br>
&gt; I don't think it is possible to disable this warning by default<br>
&gt; because off-by-default warnings are discouraged in Clang. &nbsp;There is no<br>
&gt; formal policy, but the rule of thumb is: either make the warning good<br>
&gt; enough for everyone or don't implement it; if some particular app does<br>
&gt; something strange, it can disable this warning.<br>
&gt;<br>
&gt;&gt;&gt; The pattern you described is an important one, but most MPI<br>
&gt;&gt;&gt; applications will have matching buffer types/type tags.<br>
&gt;&gt;<br>
&gt;&gt; I agree that most applications *probably* don't do this. &nbsp;But significant developer in this community (i.e., Sandia) has at least multiple applications that *do* do it. &nbsp;I can't ignore that. &nbsp;:-(<br>
&gt;<br>
&gt; Here are a few approaches to solving this in order of preference:<br>
&gt;<br>
&gt; 0. Is this really a concern for Sandia? &nbsp;(I.e., do they target Clang?)<br>
&gt;<br>
&gt; 1. Ask the developer to silence the warning with a cast to 'void *' or<br>
&gt; -Wno-type-safety. &nbsp;Rationale: compilers already do warn about valid<br>
&gt; but suspicious code.<br>
&gt;<br>
&gt; 2. Turn off checking for char* just like for void*. &nbsp;Rationale: C<br>
&gt; standard allows char* to alias a pointer of any type. &nbsp;Note that char*<br>
&gt; is special in this regard (strict aliasing rules).<br>
&gt;<br>
&gt; 3. Turn off annotations by default in mpi.h.<br>
&gt;<br>
&gt; Dmitri<br>
&gt;<br>
&gt; --<br>
&gt; main(i,j){for(i=2;;i++){for(j=2;j&lt;i;j++){if(!(i%j)){j=0;break;}}if<br>
&gt; (j){printf("%d\n",i);}}} /*Dmitri Gribenko &lt;<a href="mailto:gribozavr@gmail.com" target="_blank">gribozavr@gmail.com</a>&gt;*/<br>
&gt; _______________________________________________<br>
&gt; devel mailing list<br>
&gt; <a href="mailto:devel@open-mpi.org" target="_blank">devel@open-mpi.org</a><br>
&gt; <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
<br>
<br>
_______________________________________________<br>
devel mailing list<br>
<a href="mailto:devel@open-mpi.org" target="_blank">devel@open-mpi.org</a><br>
<a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
</blockquote></div><br><br clear="all"><span class="HOEnZb"><font color="#888888"><div><br></div>-- <br><font face="courier new, monospace"><div>Paul H. Hargrove &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div>

<div>Future Technologies Group</div><div>Computer and Data Sciences Department &nbsp; &nbsp; Tel: <a href="tel:%2B1-510-495-2352" value="+15104952352" target="_blank">+1-510-495-2352</a></div><div>Lawrence Berkeley National Laboratory &nbsp; &nbsp; Fax: <a href="tel:%2B1-510-486-6900" value="+15104866900" target="_blank">+1-510-486-6900</a></div>
</font><br>
</font></span></div><span class="HOEnZb"><font color="#888888">
_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org" target="_blank">devel@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a></font></span></blockquote>
</div><br></div></div><br>_______________________________________________<br>
devel mailing list<br>
<a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
<a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br></blockquote></div><br><br clear="all"><div><br></div>-- <br><font face="courier new, monospace"><div>
Paul H. Hargrove &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Future Technologies Group</div><div>Computer and Data Sciences Department &nbsp; &nbsp; Tel: +1-510-495-2352</div>
<div>Lawrence Berkeley National Laboratory &nbsp; &nbsp; Fax: +1-510-486-6900</div></font><br>
</div>
_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>http://www.open-mpi.org/mailman/listinfo.cgi/devel</blockquote></div><br></div></body></html>
