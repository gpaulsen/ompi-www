<div dir="ltr">I vote for Ralph&#39;s proposal.</div><div class="gmail_extra"><br><div class="gmail_quote">2015-09-03 10:05 GMT-06:00 Ralph Castain <span dir="ltr">&lt;<a href="mailto:rhc@open-mpi.org" target="_blank">rhc@open-mpi.org</a>&gt;</span>:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">As we discussed on the phone, I prefer the bullet #3 approach - ask RedHat to build/distribute 1.10.0 without PSM2 support, and let Intel provide a PSM2-enabled variant via their current proprietary distribution channel until they can provide a “clean” solution to the community.<br>
<br>
If that hasn’t happened prior to a 1.10.1 release, we can then remove PSM2 at that time. I’m hoping the solution will appear prior to that point :-)<br>
<br>
<br>
&gt; On Sep 3, 2015, at 8:46 AM, Jeff Squyres (jsquyres) &lt;<a href="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a>&gt; wrote:<br>
&gt;<br>
&gt; Ralph and I just chatted about this on the phone.  I think I understand his position better now.<br>
&gt;<br>
&gt; Just to be clear/put some context in this conversation:<br>
&gt;<br>
&gt; 1. PSM (aka &quot;PSM1&quot;) supports TrueScale Intel networks<br>
&gt; 2. PSM2 supports OmniScale Intel networks<br>
&gt;<br>
&gt; ------<br>
&gt;<br>
&gt; The following three solutions are more-or-less equivalent:<br>
&gt;<br>
&gt; a. add &quot;mtl=^psm2&quot; in the mca-params.conf file (George&#39;s proposal)<br>
&gt; b. configure --without-psm2 (similar to George&#39;s proposal)<br>
&gt; c. we release 10.0.1 with no PSM2 MTL (Ralph&#39;s proposal)<br>
&gt;<br>
&gt; In all 3 cases, the OmniScale end user will not have support for their network (and will likely fall back to TCP?).  TrueScale users are unaffected.<br>
&gt;<br>
&gt; Technically, there&#39;s a 4th solution (proposed by Red Hat): the distro provides 2 different Open MPI installations -- one for (everything+PSM1), another for (everything+PSM2).  I agree that this is (very) undesirable.  In this case, *all* users are penalized -- not just TrueScale/OmniScale users -- because all users will now wonder &quot;Which Open MPI should I use?&quot; (even if they&#39;re not TS/OS users, and it doesn&#39;t matter which one they use, they still have to expend unnecessary mental energy trying to understand why there are two, and which they should use).  Meh.<br>
&gt;<br>
&gt; Hence, we&#39;re back to the three possible &quot;more-or-less equivalent&quot; solutions: a, b, or c.  I say &quot;more-or-less&quot; because there *is* a semantic difference between a/b and c:<br>
&gt;<br>
&gt; 1. For a/b: packagers are responsible for the solution, and also responsible for *documenting* the solution (so that Omniscale users can figure out why they are getting lousy performance).<br>
&gt; 2. For c: Open MPI is responsible for the solution; we&#39;ll likely note in NEWS that PSM2 support was removed.<br>
&gt;<br>
&gt; Hence, for the &quot;let&#39;s release 1.10.1 without PSM2&quot; solution, users have a (potentially) easier way of figuring out why they&#39;re not getting good performance.<br>
&gt;<br>
&gt; That being said:<br>
&gt;<br>
&gt; 1. I&#39;m not 100% convinced that users will go to the NEWS file to figure out why they&#39;re not getting good performance.  True, it&#39;s our officially-sanctioned method for publishing information to users, but I don&#39;t think that it&#39;s the first place that comes to mind when you&#39;re diagnosing a performance problem.<br>
&gt;<br>
&gt; 2. It seems like we have handled this kind of situation differently in the past.<br>
&gt;<br>
&gt; 2a. E.g., when we had the hcol/ml conflict, we asked Mellanox for a solution.  They promised to release a new libhcol that fixed the problem, and in the meantime, told their customers to get Mellanox Open MPI from <a href="http://mellanox.com" rel="noreferrer" target="_blank">mellanox.com</a> that immediately fixed the problem.<br>
&gt;<br>
&gt; 2b. Similarly, Cisco distributed its own Cisco Open MPI when we wanted to have libfabric support in the Open MPI v1.8.x series.<br>
&gt;<br>
&gt; 2c. This case is not entirely the same as the above two examples, but I think it&#39;s similar in spirit: a distro is trying to be all-inclusive with other freely-distributed software in that distro (i.e., both PSM1 and PSM2), and a vendor-specific issue is causing a problem with that plan.<br>
&gt;<br>
&gt; 3. I therefore think we should take the same approach that we have taken with other vendors in the past:<br>
&gt;<br>
&gt; 3a. Red Hat (and other packagers) can do whatever they need to do to package Open MPI 1.10.0.  In this case, Red Hat is asking our advice as to how to package it (because they include both PSM1 and PSM2 support in their distro, and this creates a conflict in Open MPI).<br>
&gt;<br>
&gt; ==&gt; My $0.02: we should tell Red Hat to build --without-psm2, because then users can see that &quot;ompi_info | grep psm2&quot; will be empty.  That&#39;s a dead giveaway that that Open MPI installation has no PSM2 support.<br>
&gt;<br>
&gt; 3b. Intel can support its customers by having an &quot;Intel Open MPI&quot; distribution (or whatever they want to name it, just as long as it is not named plan/vanilla &quot;Open MPI&quot;) that is configured/built to support both PSM1/PSM2 via their normal software distribution mechanism.<br>
&gt;<br>
&gt; 3c. If there&#39;s some solution Intel would like to push upstream to the Open MPI community, great -- it can go through the normal review process and be accepted upstream (i.e., just like we work every day).  That solution can then be included in future releases.<br>
&gt;<br>
&gt; How does that sound?<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt;&gt; On Sep 3, 2015, at 10:48 AM, Gilles Gouaillardet &lt;<a href="mailto:gilles.gouaillardet@gmail.com">gilles.gouaillardet@gmail.com</a>&gt; wrote:<br>
&gt;&gt;<br>
&gt;&gt; Ralph,<br>
&gt;&gt;<br>
&gt;&gt; if I correctly read between the lines of your second point, omnipath (PSM2) is working out of the box. I am not sure this is the case, and/or my extrapolation might be incorrect.<br>
&gt;&gt;<br>
&gt;&gt; if I understood correctly, psm2 is a new feature.<br>
&gt;&gt; from a distro point of view, that could be a new package (known not to support PSM), or a mpirun-psm2 wrapper, or a release note (e.g. use --mca mtl ^psm or a psm2 param file)<br>
&gt;&gt;<br>
&gt;&gt; I still do not get how removing PSM2 makes things better<br>
&gt;&gt; (and the same result can be achieved by configuring with --without-psm2)<br>
&gt;&gt;<br>
&gt;&gt; Cheers,<br>
&gt;&gt;<br>
&gt;&gt; Gilles<br>
&gt;&gt;<br>
&gt;&gt; On Thursday, September 3, 2015, Ralph Castain &lt;<a href="mailto:rhc@open-mpi.org">rhc@open-mpi.org</a>&gt; wrote:<br>
&gt;&gt; I guess I didn’t make it clear in my prior comment, so let me try again. I understand about dlopen and the fix that George proposed - we had internally discussed this as well. However, the questions that raises are:<br>
&gt;&gt;<br>
&gt;&gt; 1. how does the distro (Michal) decide which PSM module to disable by default in their package?<br>
&gt;&gt;<br>
&gt;&gt; 2. how does the user “discover” that their fabric has automatically been disabled, especially since this has never been the case before?<br>
&gt;&gt;<br>
&gt;&gt; I’ll raise the procedural question at our next telecon. I certainly take no pleasure out of generating releases, so if we have a better solution, I’m all for it!<br>
&gt;&gt;<br>
&gt;&gt;<br>
&gt;&gt;&gt; On Sep 3, 2015, at 5:55 AM, Jeff Squyres (jsquyres) &lt;<a href="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a>&gt; wrote:<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; I agree with what George says.<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; AFAIK, Red Hat builds Open MPI support for dlopen, so the config file option is probably suitable.<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; However, I have to admit that I resent the fact that PSM&#39;s poor upgrade path design is forcing both the Open MPI and libfabric communities to have similar confusing conversations (e.g., see <a href="https://github.com/ofiwg/libfabric/issues/1258#issuecomment-137426271" rel="noreferrer" target="_blank">https://github.com/ofiwg/libfabric/issues/1258#issuecomment-137426271</a>).<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; Specifically: because of the design of PSM1/PSM2, both Open MPI and libfabric will have to adjust their configury and use dlopen/function pointer indirection to &quot;solve&quot; the problem of supporting both PSM1 and PSM2.<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; Does that seem weird to anyone else?<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; IMNSHO, if you have to have extremely confusing conversations in multiple software communities explaining your configury, function-pointer-indirection code (i.e., PR <a href="https://github.com/ofiwg/libfabric/pull/1259" rel="noreferrer" target="_blank">https://github.com/ofiwg/libfabric/pull/1259</a>), compilation, and linking scheme to upgrade to a new library, you&#39;re doing it wrong.<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; On Sep 3, 2015, at 7:19 AM, George Bosilca &lt;<a href="mailto:bosilca@icl.utk.edu">bosilca@icl.utk.edu</a>&gt; wrote:<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; Hi Michael,<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; I might have missed some context when proposing this solution. As Gilles suggested if you build Open MPI without support for dlopen (configure option --disable-dlopen) this simple solution will not work because the symbol conflict issue is generated deep inside the constructors of the 2 libraries.<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; Yes, the &quot;mtl = ^psm&quot; (or ^psm2 depending on which one you want to disable) should go in the openmpi-mca-params.conf that gets installed in the $(sysconfigdir).<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; Thanks,<br>
&gt;&gt;&gt;&gt; George.<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; On Thu, Sep 3, 2015 at 5:14 AM, Michal Schmidt &lt;<a href="mailto:mschmidt@redhat.com">mschmidt@redhat.com</a>&gt; wrote:<br>
&gt;&gt;&gt;&gt; [I apologize for not threading the email properly. I was not subscribed<br>
&gt;&gt;&gt;&gt; before and found the conversation in the web archive.]<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; Hello,<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; I am the one who discovered the PSM vs. PSM2 library conflict and<br>
&gt;&gt;&gt;&gt; proposed the temporary workaround of having two builds of the openmpi<br>
&gt;&gt;&gt;&gt; package.<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; George Bosilca wrote:<br>
&gt;&gt;&gt;&gt;&gt; 3. Except if the distro builds OMPI statically, I see no reason to<br>
&gt;&gt;&gt;&gt;&gt; have 2 build of OMPI due to conflicting symbols between two shared<br>
&gt;&gt;&gt;&gt;&gt; libraries that OMPI MCA load willingly. Why a simple &quot;mtl = ^psm&quot; in<br>
&gt;&gt;&gt;&gt;&gt; the OMPI system wide configuration file is not enough to solve the<br>
&gt;&gt;&gt;&gt;&gt; issue?<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; Thank you for this suggestion. It would go into openmpi-mca-params.conf,<br>
&gt;&gt;&gt;&gt; right? I will try it.<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; Regards,<br>
&gt;&gt;&gt;&gt; Michal<br>
&gt;&gt;&gt;&gt; _______________________________________________<br>
&gt;&gt;&gt;&gt; devel mailing list<br>
&gt;&gt;&gt;&gt; <a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
&gt;&gt;&gt;&gt; Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
&gt;&gt;&gt;&gt; Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2015/09/17927.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/devel/2015/09/17927.php</a><br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; _______________________________________________<br>
&gt;&gt;&gt;&gt; devel mailing list<br>
&gt;&gt;&gt;&gt; <a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
&gt;&gt;&gt;&gt; Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
&gt;&gt;&gt;&gt; Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2015/09/17928.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/devel/2015/09/17928.php</a><br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; --<br>
&gt;&gt;&gt; Jeff Squyres<br>
&gt;&gt;&gt; <a href="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a><br>
&gt;&gt;&gt; For corporate legal information go to: <a href="http://www.cisco.com/web/about/doing_business/legal/cri/" rel="noreferrer" target="_blank">http://www.cisco.com/web/about/doing_business/legal/cri/</a><br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; _______________________________________________<br>
&gt;&gt;&gt; devel mailing list<br>
&gt;&gt;&gt; <a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
&gt;&gt;&gt; Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
&gt;&gt;&gt; Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2015/09/17931.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/devel/2015/09/17931.php</a><br>
&gt;&gt;<br>
&gt;&gt; _______________________________________________<br>
&gt;&gt; devel mailing list<br>
&gt;&gt; <a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
&gt;&gt; Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
&gt;&gt; Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2015/09/17933.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/devel/2015/09/17933.php</a><br>
&gt;&gt; _______________________________________________<br>
&gt;&gt; devel mailing list<br>
&gt;&gt; <a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
&gt;&gt; Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
&gt;&gt; Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2015/09/17937.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/devel/2015/09/17937.php</a><br>
&gt;<br>
&gt;<br>
&gt; --<br>
&gt; Jeff Squyres<br>
&gt; <a href="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a><br>
&gt; For corporate legal information go to: <a href="http://www.cisco.com/web/about/doing_business/legal/cri/" rel="noreferrer" target="_blank">http://www.cisco.com/web/about/doing_business/legal/cri/</a><br>
&gt;<br>
&gt; _______________________________________________<br>
&gt; devel mailing list<br>
&gt; <a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
&gt; Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
&gt; Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2015/09/17939.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/devel/2015/09/17939.php</a><br>
<br>
_______________________________________________<br>
devel mailing list<br>
<a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" rel="noreferrer" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2015/09/17940.php" rel="noreferrer" target="_blank">http://www.open-mpi.org/community/lists/devel/2015/09/17940.php</a></blockquote></div><br></div>

