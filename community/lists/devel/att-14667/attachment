<html><head><meta http-equiv="Content-Type" content="text/html charset=us-ascii"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">George makes a fair point - I was unaware they were hashing down to the opal_identifier_t. Only real requirement is that there be some way to reduce to 64-bits when accessing the common data.<div><br></div><div>I think the usnic BTL may have an issue with that approach, so maybe some way of "unhashing" will be required?</div><div><br></div><div><br><div><div>On Apr 30, 2014, at 3:42 PM, Jeff Squyres (jsquyres) &lt;<a href="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div style="font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">On Apr 30, 2014, at 6:35 PM, George Bosilca &lt;<a href="mailto:bosilca@icl.utk.edu">bosilca@icl.utk.edu</a>&gt; wrote:<br><br><blockquote type="cite">Puzzling. We survived so far without such a requirement.<br></blockquote><br>Ralph tells me that this is a requirement. &nbsp;So I figured we should check for it.<br><br><blockquote type="cite">In the BTLs where we needed a 64 bits entity corresponding to the ompi_process_name_t we took advantage of the ompi_rte_hash_name function. This function is supposed to convert from an ompi_process_name_t to a uint64_t (in fact an opal_identifier_t) which can be then used to handle hash tables.<br></blockquote><br>...I don't really care, either way. &nbsp;I'll do whatever you guys tell me to do here. &nbsp;:-)<br><br>I put that assert there because Ralph told me it was a requirement, and I now have code in the usnic BTL that is doing a memcpy from a union uint64_t member to an ompi_process_name_t, and it assumes that the sizes are guaranteed to be the same.<br><br>If we want to do it some other way, that's fine with me, too.<br><br><br><blockquote type="cite">George.<br><br><br>On Apr 30, 2014, at 18:12 , <a href="mailto:svn-commit-mailer@open-mpi.org">svn-commit-mailer@open-mpi.org</a> wrote:<br><br><blockquote type="cite">Author: jsquyres (Jeff Squyres)<br>Date: 2014-04-30 18:12:54 EDT (Wed, 30 Apr 2014)<br>New Revision: 31577<br>URL: <a href="https://svn.open-mpi.org/trac/ompi/changeset/31577">https://svn.open-mpi.org/trac/ompi/changeset/31577</a><br><br>Log:<br>rte_base_frame.c: add sanity check to ensure proper sizes<br><br>There's a requirement in several places (e.g., opal dstore) that<br>sizeof(ompi_process_name_t) -- which comes from the compile-time<br>selected ompi/mca/rte component -- is equal to sizeof(uint64_t). &nbsp;If<br>it's not, Bad Things will happen.<br><br>So put an assert here to catch that case.<br><br>Text files modified:<span class="Apple-converted-space">&nbsp;</span><br>trunk/ompi/mca/rte/base/rte_base_frame.c | &nbsp;&nbsp;&nbsp;10 +++++++++- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>1 files changed, 9 insertions(+), 1 deletions(-)<br><br>Modified: trunk/ompi/mca/rte/base/rte_base_frame.c<br>==============================================================================<br>--- trunk/ompi/mca/rte/base/rte_base_frame.c<span class="Apple-tab-span" style="white-space: pre;">	</span>Wed Apr 30 18:10:30 2014<span class="Apple-tab-span" style="white-space: pre;">	</span>(r31576)<br>+++ trunk/ompi/mca/rte/base/rte_base_frame.c<span class="Apple-tab-span" style="white-space: pre;">	</span>2014-04-30 18:12:54 EDT (Wed, 30 Apr 2014)<span class="Apple-tab-span" style="white-space: pre;">	</span>(r31577)<br>@@ -1,6 +1,7 @@<br>/*<br>* Copyright (c) 2012-2013 Los Alamos National Security, LLC.<br>* &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;All rights reserved.<br>+ * Copyright (c) 2014 Cisco Systems, Inc. &nbsp;All rights reserved.<br>* $COPYRIGHT$<br>*<span class="Apple-converted-space">&nbsp;</span><br>* Additional copyrights may follow<br>@@ -12,6 +13,7 @@<br>#include "ompi_config.h"<br>#include "ompi/constants.h"<br><br>+#include "opal_stdint.h"<br>#include "opal/util/output.h"<br>#include "opal/mca/mca.h"<br>#include "opal/mca/base/base.h"<br>@@ -36,7 +38,13 @@<br>static int ompi_rte_base_open(mca_base_open_flag_t flags)<br>{<br>&nbsp;&nbsp;/* Open up all available components */<br>- &nbsp;&nbsp;&nbsp;return mca_base_framework_components_open(&amp;ompi_rte_base_framework, flags);<br>+ &nbsp;&nbsp;&nbsp;int ret = mca_base_framework_components_open(&amp;ompi_rte_base_framework, flags);<br>+<br>+ &nbsp;&nbsp;&nbsp;/* Sanity check. &nbsp;Many things will break if this is not true<br>+ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(e.g., opal dstore needs this to be true). */<br>+ &nbsp;&nbsp;&nbsp;assert(sizeof(ompi_process_name_t) == sizeof(uint64_t));<br>+<br>+ &nbsp;&nbsp;&nbsp;return ret;<br>}<br><br>MCA_BASE_FRAMEWORK_DECLARE(ompi, rte, "OMPI Run-Time Environment Interface", NULL,<br>_______________________________________________<br>svn mailing list<br><a href="mailto:svn@open-mpi.org">svn@open-mpi.org</a><br>http://www.open-mpi.org/mailman/listinfo.cgi/svn<br></blockquote><br>_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>Subscription: http://www.open-mpi.org/mailman/listinfo.cgi/devel<br>Link to this post: http://www.open-mpi.org/community/lists/devel/2014/04/14663.php<br></blockquote><br><br>--<span class="Apple-converted-space">&nbsp;</span><br>Jeff Squyres<br><a href="mailto:jsquyres@cisco.com">jsquyres@cisco.com</a><br>For corporate legal information go to:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.cisco.com/web/about/doing_business/legal/cri/">http://www.cisco.com/web/about/doing_business/legal/cri/</a><br><br>_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>Subscription:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>Link to this post:<span class="Apple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/community/lists/devel/2014/04/14664.php">http://www.open-mpi.org/community/lists/devel/2014/04/14664.php</a></div></blockquote></div><br></div></body></html>
