<html><head><meta http-equiv="Content-Type" content="text/html charset=us-ascii"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">I'm not sure that was created by the commit you cite, but it may have been exposed by it. Either way, the patch is correct - the TCP component will NULL the entry in the hash table, but that doesn't remove the key and so the hash_table lookup request will return "success" with a NULL pointer.<div><br></div><div><br><div><div>On Jun 8, 2014, at 10:24 PM, Gilles Gouaillardet &lt;<a href="mailto:gilles.gouaillardet@gmail.com">gilles.gouaillardet@gmail.com</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div dir="ltr"><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div>Folks,<br><br></div>several mtt tests (ompi-trunk r31963) failed (SIGSEGV in mpirun) with a similar stack trace.<br><br>For example, you can refer to :<br>

<a href="http://mtt.open-mpi.org/index.php?do_redir=2199" target="_blank">http://mtt.open-mpi.org/index.php?do_redir=2199</a><br><br></div>the issue is not related whatsoever to the init_thread_serialized test<br></div>(other tests failed with similar symptoms)<br>

<br>so far i could find that :<br></div>- the issue is intermittent and can be hard to reproduce (1 failure over 1000 runs)<br></div>- per the mtt logs, it seems this is quite a recent failure<br></div>- a necessary condition is that MPI tasks exit with a non zero status after having called MPI_Finalize()<br>

</div>- the crash occurs is in orte/mca/oob/base/oob_base_frame.c at line 89 when invoking<br></div>OBJ_RELEASE(value) ;<br></div>in some rare cases, value is NULL which causes the crash.<br></div>- though i cannot incriminate one changeset in particular, i highly suspect the changes that were made in order to address the issue(s) discussed at <a href="http://www.open-mpi.org/community/lists/devel/2014/05/14908.php" target="_blank">http://www.open-mpi.org/community/lists/devel/2014/05/14908.php</a><br>

<br></div>the attached a patch that works around this issue.<br></div>i did not commit it because i consider this as a work around and not as a fix :<br></div>the root cause might be a tricky race condition ("abort" after MPI_Finalize).<br>
<br><br></div>
as a side note, here is the definition of OBJ_RELEASE (opal/class/opal_object.h)<br>#if OPAL_ENABLE_DEBUG<br>#define OBJ_RELEASE(object)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \<br>&nbsp;&nbsp;&nbsp; do {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; assert(NULL != ((opal_object_t *) (object))-&gt;obj_class);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; assert(OPAL_OBJ_MAGIC_ID == ((opal_object_t *) (object))-&gt;obj_magic_id); \<br>&nbsp;&nbsp;&nbsp; } while (0)<br>...<br>#else<br>...<br><br></div>
should we add the following assert at the beginning ?<br>assert(NULL != object);<br><br><br></div>Thanks in advance for your comments,<br><br></div>Gilles<br></div>
<span>&lt;oob.patch&gt;</span>_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>Subscription: http://www.open-mpi.org/mailman/listinfo.cgi/devel<br>Link to this post: http://www.open-mpi.org/community/lists/devel/2014/06/14994.php</blockquote></div><br></div></body></html>
