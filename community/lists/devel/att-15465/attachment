<div dir="ltr">I have confirmed that George&#39;s latest version works on both SPARC ABIs.<div><br></div><div>ARMv7 and three MIPS ABIs still pending...</div><div><br></div><div>-Paul<br><div class="gmail_extra"><br><br><div class="gmail_quote">
On Fri, Aug 1, 2014 at 9:40 AM, George Bosilca <span dir="ltr">&lt;<a href="mailto:bosilca@icl.utk.edu" target="_blank">bosilca@icl.utk.edu</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
Another version of the atomic patch. Paul has tested it on a bunch of platforms. At this point we have confirmation from all architectures except SPARC (v8+ and v9).<br>
<span class="HOEnZb"><font color="#888888"><br>
&nbsp; George.<br>
<br>
</font></span><br><br>
On Jul 31, 2014, at 19:13 , George Bosilca &lt;<a href="mailto:bosilca@icl.utk.edu">bosilca@icl.utk.edu</a>&gt; wrote:<br>
<br>
&gt; All,<br>
&gt;<br>
&gt; Here is the patch that change the meaning of the atomics to make them always return the previous value (similar to sync_fetch_and_&lt;*&gt;). I tested this with the following atomics: OS X, gcc style intrinsics and AMD64.<br>

&gt;<br>
&gt; I did not change the base assembly files used when GCC style assembly operations are not supported. If someone feels like fixing them, feel free.<br>
&gt;<br>
&gt; Paul, I know you have a pretty diverse range computers. Can you try to compile and run a &ldquo;make check&rdquo; with the following patch?<br>
&gt;<br>
&gt; &nbsp;George.<br>
&gt;<br>
&gt; &lt;atomics.patch&gt;<br>
&gt;<br>
&gt; On Jul 30, 2014, at 15:21 , Nathan Hjelm &lt;<a href="mailto:hjelmn@lanl.gov">hjelmn@lanl.gov</a>&gt; wrote:<br>
&gt;<br>
&gt;&gt;<br>
&gt;&gt; That is what I would prefer. I was trying to not disturb things too<br>
&gt;&gt; much :). Please bring the changes over!<br>
&gt;&gt;<br>
&gt;&gt; -Nathan<br>
&gt;&gt;<br>
&gt;&gt; On Wed, Jul 30, 2014 at 03:18:44PM -0400, George Bosilca wrote:<br>
&gt;&gt;&gt; &nbsp;Why do you want to add new versions? This will lead to having two, almost<br>
&gt;&gt;&gt; &nbsp;identical, sets of atomics that are conceptually equivalent but different<br>
&gt;&gt;&gt; &nbsp;in terms of code. And we will have to maintained both!<br>
&gt;&gt;&gt; &nbsp;I did a similar change in a fork of OPAL in another project but instead of<br>
&gt;&gt;&gt; &nbsp;adding another flavor of atomics, I completely replaced the available ones<br>
&gt;&gt;&gt; &nbsp;with a set returning the old value. I can bring the code over.<br>
&gt;&gt;&gt; &nbsp; &nbsp;George.<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; &nbsp;On Tue, Jul 29, 2014 at 5:29 PM, Paul Hargrove &lt;<a href="mailto:phhargrove@lbl.gov">phhargrove@lbl.gov</a>&gt; wrote:<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; &nbsp; &nbsp;On Tue, Jul 29, 2014 at 2:10 PM, Nathan Hjelm &lt;<a href="mailto:hjelmn@lanl.gov">hjelmn@lanl.gov</a>&gt; wrote:<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; &nbsp; &nbsp; &nbsp;Is there a reason why the<br>
&gt;&gt;&gt; &nbsp; &nbsp; &nbsp;current implementations of opal atomics (add, cmpset) do not return<br>
&gt;&gt;&gt; &nbsp; &nbsp; &nbsp;the<br>
&gt;&gt;&gt; &nbsp; &nbsp; &nbsp;old value?<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; &nbsp; &nbsp;Because some CPUs don&#39;t implement such an atomic instruction?<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; &nbsp; &nbsp;On any CPU one *can* certainly synthesize the desired operation with an<br>
&gt;&gt;&gt; &nbsp; &nbsp;added read before the compare-and-swap to return a value that was<br>
&gt;&gt;&gt; &nbsp; &nbsp;present at some time before a failed cmpset. &nbsp;That is almost certainly<br>
&gt;&gt;&gt; &nbsp; &nbsp;sufficient for your purposes. &nbsp;However, the added load makes it<br>
&gt;&gt;&gt; &nbsp; &nbsp;(marginally) more expensive on some CPUs that only have the native<br>
&gt;&gt;&gt; &nbsp; &nbsp;equivalent of gcc&#39;s __sync_bool_compare_and_swap().<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; &nbsp; &nbsp;-Paul<br>
&gt;&gt;&gt; &nbsp; &nbsp;--<br>
&gt;&gt;&gt; &nbsp; &nbsp;Paul H. Hargrove &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<a href="mailto:PHHargrove@lbl.gov">PHHargrove@lbl.gov</a><br>
&gt;&gt;&gt; &nbsp; &nbsp;Future Technologies Group<br>
&gt;&gt;&gt; &nbsp; &nbsp;Computer and Data Sciences Department &nbsp; &nbsp; Tel: <a href="tel:%2B1-510-495-2352" value="+15104952352">+1-510-495-2352</a><br>
&gt;&gt;&gt; &nbsp; &nbsp;Lawrence Berkeley National Laboratory &nbsp; &nbsp; Fax: <a href="tel:%2B1-510-486-6900" value="+15104866900">+1-510-486-6900</a><br>
&gt;&gt;&gt; &nbsp; &nbsp;_______________________________________________<br>
&gt;&gt;&gt; &nbsp; &nbsp;devel mailing list<br>
&gt;&gt;&gt; &nbsp; &nbsp;<a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
&gt;&gt;&gt; &nbsp; &nbsp;Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
&gt;&gt;&gt; &nbsp; &nbsp;Link to this post:<br>
&gt;&gt;&gt; &nbsp; &nbsp;<a href="http://www.open-mpi.org/community/lists/devel/2014/07/15328.php" target="_blank">http://www.open-mpi.org/community/lists/devel/2014/07/15328.php</a><br>
&gt;&gt;<br>
&gt;&gt;&gt; _______________________________________________<br>
&gt;&gt;&gt; devel mailing list<br>
&gt;&gt;&gt; <a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
&gt;&gt;&gt; Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
&gt;&gt;&gt; Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2014/07/15369.php" target="_blank">http://www.open-mpi.org/community/lists/devel/2014/07/15369.php</a><br>
&gt;&gt;<br>
&gt;&gt; _______________________________________________<br>
&gt;&gt; devel mailing list<br>
&gt;&gt; <a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
&gt;&gt; Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
&gt;&gt; Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2014/07/15370.php" target="_blank">http://www.open-mpi.org/community/lists/devel/2014/07/15370.php</a><br>
&gt;<br>
<br>
<br>_______________________________________________<br>
devel mailing list<br>
<a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>
Subscription: <a href="http://www.open-mpi.org/mailman/listinfo.cgi/devel" target="_blank">http://www.open-mpi.org/mailman/listinfo.cgi/devel</a><br>
Link to this post: <a href="http://www.open-mpi.org/community/lists/devel/2014/08/15462.php" target="_blank">http://www.open-mpi.org/community/lists/devel/2014/08/15462.php</a><br></blockquote></div><br><br clear="all"><div>
<br></div>-- <br><font face="courier new, monospace"><div>Paul H. Hargrove &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Future Technologies Group</div><div>
Computer and Data Sciences Department &nbsp; &nbsp; Tel: +1-510-495-2352</div><div>Lawrence Berkeley National Laboratory &nbsp; &nbsp; Fax: +1-510-486-6900</div></font>
</div></div></div>

