<div dir="ltr">I have tried the 1.8.8, 1.10.2rc3 and nightly master tarballs with the NAG Fortran compiler.<div>Both versions 6.0 and 5.3 are unable to build and/or link Open MPI&#39;s Fortran bindings (MPI and SHMEM) w/o some extra work.</div><div><div>A google search turned up a blog entry dealing with the exact issues I encountered:</div></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><div><a href="http://baradi09.blogspot.com/2014/08/compiling-openmpi-with-nag-fortran.html">http://baradi09.blogspot.com/2014/08/compiling-openmpi-with-nag-fortran.html</a></div></div></blockquote><div><div><br></div><div>It suggests the following</div><div>  + Adding FCFLAGS=&quot;-mismatch&quot; to disable some type checking.</div><div>  + Building only static libs to avoid issues with libtool and nagfor (see <a href="http://www.open-mpi.org/community/lists/devel/2011/07/9497.php">http://www.open-mpi.org/community/lists/devel/2011/07/9497.php</a>)</div><div>  + Patching the *fort*-wrapper.data files (same problem as with libtool)</div><div><br></div><div>Together those are sufficient to get 1.10.2rc3 built with both 6.0 and 5.3 version of NAG Fortran.</div><div>However, the patching of the *fort*-wrapper.data files is necessary but not sufficient to fix the linking problems:</div></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><div><div><font face="monospace, monospace">$ mpifort -g ring_mpifh.f -o ring_mpifh</font></div></div></div><div><div><div><font face="monospace, monospace">NAG Fortran Compiler Release 6.0(Hibiya) Build 1028</font></div></div></div><div><div><div><font face="monospace, monospace">Warning: ring_mpifh.f, line 80: Unused external reference MPI_WTICK</font></div></div></div><div><div><div><font face="monospace, monospace">Warning: ring_mpifh.f, line 80: Unused external reference MPI_WTIME</font></div></div></div><div><div><div><font face="monospace, monospace">Warning: ring_mpifh.f, line 80: Unused external reference PMPI_WTICK</font></div></div></div><div><div><div><font face="monospace, monospace">Warning: ring_mpifh.f, line 80: Unused external reference PMPI_WTIME</font></div></div></div><div><div><div><font face="monospace, monospace">Obsolescent: ring_mpifh.f, line 10: Fixed source form</font></div></div></div><div><div><div><font face="monospace, monospace">[NAG Fortran Compiler normal termination, 5 warnings]</font></div></div></div><div><div><div><font face="monospace, monospace">/sandbox/hargrove/OMPI/openmpi-1.10.2rc3-linux-x86_64-nagfor-6/INST/lib/libmpi.a(ompi_mpi_init.o): In function `ompi_warn_fork&#39;:</font></div></div></div><div><div><div><font face="monospace, monospace">/sandbox/hargrove/OMPI/openmpi-1.10.2rc3-linux-x86_64-nagfor-6/openmpi-1.10.2rc3/ompi/runtime/ompi_mpi_init.c:193: undefined reference to `pthread_atfork&#39;</font></div></div></div><div><div><div><font face="monospace, monospace">/sandbox/hargrove/OMPI/openmpi-1.10.2rc3-linux-x86_64-nagfor-6/INST/lib/libopen-pal.a(lt1-malloc.o): In function `ptmalloc_init&#39;:</font></div></div></div><div><div><div><font face="monospace, monospace">/sandbox/hargrove/OMPI/openmpi-1.10.2rc3-linux-x86_64-nagfor-6/openmpi-1.10.2rc3/opal/mca/memory/linux/arena.c:387: undefined reference to `pthread_atfork&#39;</font></div></div></div></blockquote><div><div><br></div><div>I needed to manually append &quot;-lpthreads&quot; to libs_static in the *fort*-wrapper.data files to resolve that problem.</div><div>I suspect configure should have taken care of that, based on the following:</div></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><div><div><font face="monospace, monospace">checking if Fortran compiler and POSIX threads work as is... no</font></div></div></div><div><div><div><font face="monospace, monospace">[...C++ checks...]</font></div></div></div><div><div><div><font face="monospace, monospace">checking if Fortran compiler and POSIX threads work with -Kthread... no</font></div></div></div><div><div><div><font face="monospace, monospace">checking if Fortran compiler and POSIX threads work with -kthread... no</font></div></div></div><div><div><div><font face="monospace, monospace">checking if Fortran compiler and POSIX threads work with -pthread... no</font></div></div></div><div><div><div><font face="monospace, monospace">checking if Fortran compiler and POSIX threads work with -pthreads... no</font></div></div></div><div><div><div><font face="monospace, monospace">checking if Fortran compiler and POSIX threads work with -mt... no</font></div></div></div><div><div><div><font face="monospace, monospace">checking if Fortran compiler and POSIX threads work with -mthreads... no</font></div></div></div><div><div><div><font face="monospace, monospace">checking if Fortran compiler and POSIX threads work with -lpthreads... no</font></div></div></div><div><div><div><font face="monospace, monospace">checking if Fortran compiler and POSIX threads work with -llthread... no</font></div></div></div><div><div><div><font face="monospace, monospace">checking if Fortran compiler and POSIX threads work with -lpthread... yes</font></div></div></div></blockquote><div><div><br></div><div>If there is no interest in support for the NAG Fortran compiler, just say so and I&#39;ll drop the subject.</div><div>However, if you want more info or need me to test possible fixes, let me know.</div><div><br></div><div>-Paul</div><div><br><div><br></div>-- <br><div><div dir="ltr"><div><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Computer Languages &amp; Systems Software (CLaSS) Group</div><div>Computer Science Department               Tel: <a href="tel:%2B1-510-495-2352" value="+15104952352" target="_blank">+1-510-495-2352</a></div><div>Lawrence Berkeley National Laboratory     Fax: <a href="tel:%2B1-510-486-6900" value="+15104866900" target="_blank">+1-510-486-6900</a></div></font></div></div></div>
</div></div></div>

