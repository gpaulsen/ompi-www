<html><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">The test for the __may_alias_ attribute uses the following short code snippet:<div><br></div><div><blockquote type="cite"><div><font class="Apple-style-span" color="#000000">int * p_value __attribute__ ((__may_alias__));</font></div><div><font class="Apple-style-span" color="#000000">int</font></div><div><font class="Apple-style-span" color="#000000">main ()</font></div><div><font class="Apple-style-span" color="#000000">{</font></div><div><font class="Apple-style-span" color="#000000"><br></font></div><div><font class="Apple-style-span" color="#000000">&nbsp; ;</font></div><div><font class="Apple-style-span" color="#000000">&nbsp; return 0;</font></div><div><font class="Apple-style-span" color="#000000">}</font></div></blockquote><div><div><br></div></div><div>Indeed, for Intel 2011 compilers prior to 2011.6.233, this results in a warning:</div><div><br></div><div><blockquote type="cite"><div><font class="Apple-style-span" color="#000000">root@hydra openmpi-1.4.3]# module load compilers/intel/2011.5.220</font></div><div><font class="Apple-style-span" color="#000000">[root@hydra openmpi-1.4.3]# icc -c may_alias_test.c&nbsp;</font></div><div><font class="Apple-style-span" color="#000000">may_alias_test.c(123): warning #1292: attribute "__may_alias__" ignored</font></div><div><font class="Apple-style-span" color="#000000">&nbsp; int * p_value __attribute__ ((__may_alias__));</font></div><div><font class="Apple-style-span" color="#000000">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font class="Apple-style-span" color="#000000"><br></font></div><div><font class="Apple-style-span" color="#000000">[root@hydra openmpi-1.4.3]# module unload compilers/intel/2011.5.220</font></div><div></div><div></div></blockquote><br><blockquote type="cite"><div><font class="Apple-style-span" color="#000000">[root@hydra openmpi-1.4.3]# module load compilers/intel/2011.6.233</font></div><div><font class="Apple-style-span" color="#000000">[root@hydra openmpi-1.4.3]# icc -c may_alias_test.c&nbsp;</font></div></blockquote></div><div><div><br></div></div><div>I modified ./configure to force</div><div><br></div><div><blockquote type="cite"><div><font class="Apple-style-span" color="#000000">ompi_cv___attribute__may_alias=0</font></div></blockquote></div><div><div><br></div></div><div>Then I compiled and tested the library. &nbsp;Unfortunately, the results were exactly the same:</div><div><br></div><div><blockquote type="cite"><div><font class="Apple-style-span" color="#000000">make &nbsp;check-TESTS</font></div><div><font class="Apple-style-span" color="#000000">make[3]: Entering directory `/state/partition1/root/src/openmpi-1.4.3/test/datatype'</font></div><div><font class="Apple-style-span" color="#000000">/bin/sh: line 4: 26326 Segmentation fault &nbsp; &nbsp; &nbsp;${dir}$tst</font></div><div><font class="Apple-style-span" color="#000000">FAIL: checksum</font></div><div><font class="Apple-style-span" color="#000000">/bin/sh: line 4: 26359 Segmentation fault &nbsp; &nbsp; &nbsp;${dir}$tst</font></div><div><font class="Apple-style-span" color="#000000">FAIL: position</font></div><div><font class="Apple-style-span" color="#000000">========================================================</font></div><div><font class="Apple-style-span" color="#000000">2 of 2 tests failed</font></div><div><font class="Apple-style-span" color="#000000">Please report to <a href="http://www.open-mpi.org/community/help/">http://www.open-mpi.org/community/help/</a></font></div><div><font class="Apple-style-span" color="#000000">========================================================</font></div></blockquote></div><div><div><br></div></div><div>I could not find any use of the may_alias attribute, other than in a #define in&nbsp;opal/include/opal_config_bottom.h. &nbsp;Is&nbsp;OMPI_HAVE_ATTRIBUTE_MAY_ALIAS just cruft that can be removed?</div><div><br></div><div apple-content-edited="true"> <div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div><div><div><div><div><div><div><div><div><div>Larry Baker</div><div>US Geological Survey</div><div>650-329-5608</div><div><a href="mailto:baker@usgs.gov">baker@usgs.gov</a></div></div></div></div></div></div></div></div></div></div></div> </div><br><div><div>On 7 Oct 2011, at 11:08 AM, Larry Baker wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">I ran into a problem this past week trying to upgrade our OpenMPI 1.4.3 for the latest Intel 2011 compiler, 2011.6.233.<div><br></div><div>make check fails with Segmentation Fault errors:<div><br></div><div><blockquote type="cite"><div><font class="Apple-style-span" color="#000000">[root@hydra openmpi-1.4.3]# tail -20 ../openmpi-1.4.3-check-intel.6.233.log</font></div><div><font class="Apple-style-span" color="#000000">/bin/sh ../../libtool --tag=CC &nbsp; --mode=link icc &nbsp;-DNDEBUG -g -O3 -finline-functions -fno-strict-aliasing -restrict -pthread -fvisibility=hidden -shared-intel -export-dynamic -shared-intel &nbsp;-o ddt_pack ddt_pack.o ../../ompi/libmpi.la -lnsl -lutil &nbsp;</font></div><div><font class="Apple-style-span" color="#000000">libtool: link: icc -DNDEBUG -g -O3 -finline-functions -fno-strict-aliasing -restrict -pthread -fvisibility=hidden -shared-intel -shared-intel -o .libs/ddt_pack ddt_pack.o -Wl,--export-dynamic &nbsp;../../ompi/.libs/libmpi.so /usr/local/src/openmpi-1.4.3/orte/.libs/libopen-rte.so /usr/local/src/openmpi-1.4.3/opal/.libs/libopen-pal.so -ldl -lnsl -lutil -pthread -Wl,-rpath -Wl,/usr/local/lib</font></div><div><font class="Apple-style-span" color="#000000">make[3]: Leaving directory `/state/partition1/root/src/openmpi-1.4.3/test/datatype'</font></div><div><font class="Apple-style-span" color="#000000">make &nbsp;check-TESTS</font></div><div><font class="Apple-style-span" color="#000000">make[3]: Entering directory `/state/partition1/root/src/openmpi-1.4.3/test/datatype'</font></div><div><font class="Apple-style-span" color="#000000">/bin/sh: line 4: &nbsp;6322 Segmentation fault &nbsp; &nbsp; &nbsp;${dir}$tst</font></div><div><font class="Apple-style-span" color="#000000">FAIL: checksum</font></div><div><font class="Apple-style-span" color="#000000">/bin/sh: line 4: &nbsp;6355 Segmentation fault &nbsp; &nbsp; &nbsp;${dir}$tst</font></div><div><font class="Apple-style-span" color="#000000">FAIL: position</font></div><div><font class="Apple-style-span" color="#000000">========================================================</font></div><div><font class="Apple-style-span" color="#000000">2 of 2 tests failed</font></div><div><font class="Apple-style-span" color="#000000">Please report to <a href="http://www.open-mpi.org/community/help/">http://www.open-mpi.org/community/help/</a></font></div><div><font class="Apple-style-span" color="#000000">========================================================</font></div><div><font class="Apple-style-span" color="#000000">make[3]: *** [check-TESTS] Error 1</font></div><div><font class="Apple-style-span" color="#000000">make[3]: Leaving directory `/state/partition1/root/src/openmpi-1.4.3/test/datatype'</font></div><div><font class="Apple-style-span" color="#000000">make[2]: *** [check-am] Error 2</font></div><div><font class="Apple-style-span" color="#000000">make[2]: Leaving directory `/state/partition1/root/src/openmpi-1.4.3/test/datatype'</font></div><div><font class="Apple-style-span" color="#000000">make[1]: *** [check-recursive] Error 1</font></div><div><font class="Apple-style-span" color="#000000">make[1]: Leaving directory `/state/partition1/root/src/openmpi-1.4.3/test'</font></div><div><font class="Apple-style-span" color="#000000">make: *** [check-recursive] Error 1</font></div></blockquote></div><div><br></div><div>Before trying to track down the problem, I thought I'd describe what I see here in case someone recognizes what might be happening.<div><br></div><div>We have been using OpenMPI 1.4.3 compiled with the Intel 2011.3.174 compiler. &nbsp;I've updated the Intel 2011 compilers as they have come out with new versions: 2011.4.191, 2011.5.220, and now 2011.6.233. &nbsp;However, I've not recompiled OpenMPI 1.4.3 until now.</div><div><br></div><div>Since the original compilation of OpenMPI 1.4.3 with the Intel 2011.3.174 compilers, I have installed libnuma and libnuma-devel RPMs on our cluster front end. &nbsp;I noticed that changed the OpenMPI 1.4.3 ./configure output. &nbsp;To test that this was not the cause of the problem, I recompiled OpenMPI 1.4.3 using both the CentOS/Rocks GNU compilers and the Intel 2011.3.174 compilers. &nbsp;They both passed all the make check tests.</div><div><br></div><div>To find out when this problem first occurs,&nbsp;I systematically configured, compiled, and checked OpenMPI 1.4.3 with all four versions of the Intel 2011 compilers we have. &nbsp;We use the modules package to load the compiler environment:</div><div><br></div><div><blockquote type="cite"><div><font class="Apple-style-span" color="#000000">[root@hydra openmpi-1.4.3]# env | grep /opt/intel</font></div></blockquote><blockquote type="cite"><div><font class="Apple-style-span" color="#000000">LD_LIBRARY_PATH=/opt/intel/composer_xe_2011_sp1.6.233/compiler/lib/intel64:/opt/intel/composer_xe_2011_sp1.6.233/mkl/lib/intel64</font></div><div><font class="Apple-style-span" color="#000000">PATH=/opt/intel/composer_xe_2011_sp1.6.233/bin/intel64:/usr/kerberos/sbin:/usr/kerberos/bin:/usr/java/latest/bin:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/opt/eclipse:/opt/ganglia/bin:/opt/ganglia/sbin:/opt/maui/bin:/opt/torque/bin:/opt/torque/sbin:/opt/rocks/bin:/opt/rocks/sbin:/root/bin</font></div></blockquote></div><div><div><br></div></div><div>Here's the steps I use to make and test OpenMPI 1.4.3 (I use a patched version to accommodate the six compilers we have; I've submitted those patches here in the past):</div><div><br></div><div></div><blockquote type="cite"><div>#&nbsp;cd /usr/local/src</div><div><div># tar -xjf openmpi-1.4.3-patched.tar.bz2</div><div># cd openmpi-1.4.3</div><div># module load compilers/intel/2011.6.233</div><div># ./configure &gt;../openmpi-1.4.3-configure-intel.6.233.log 2&gt;&amp;1 --with-tm --with-openib --without-valgrind --without-udapl --enable-contrib-no-build=vt --with-wrapper-ldflags="-shared-intel" CC="icc" CFLAGS="-g -O3" CXX="icpc" CXXFLAGS="-g -O3" FC="ifort" FCFLAGS="-g -O3" F77="ifort" FFLAGS="-g -O3" LDFLAGS="-shared-intel"</div><div># make &gt;../openmpi-1.4.3-make-intel.6.233.log 2&gt;&amp;1</div><div># make check &gt;../openmpi-1.4.3-check-intel.6.233.log 2&gt;&amp;1</div></div></blockquote><div><div><br></div></div><div>(When I generate the OpenMPI 1.4.3 library we actually use, I also add a --prefix. &nbsp;But, that complicates diff's of the stdout files for these steps, so it is not used here. &nbsp;Thus, I do NOT proceed to make install any of these libraries.)</div><div><br></div><div>The three earlier versions of the Intel 2011 compilers all pass the make check tests. &nbsp;When I compare the ./configure stdout files, they are all identical. &nbsp;However, the ./configure stdout file for the Intel 2011.6.233 compilers has one difference:</div><div><br></div><div><blockquote type="cite"><div><font class="Apple-style-span" color="#000000">[root@hydra openmpi-1.4.3]# diff ../openmpi-1.4.3-configure-intel.{5.220,6.233}.log</font></div><div><font class="Apple-style-span" color="#000000">178c178</font></div><div><font class="Apple-style-span" color="#000000">&lt; checking for __attribute__(may_alias)... no</font></div><div><font class="Apple-style-span" color="#000000">---</font></div><div><font class="Apple-style-span" color="#000000">&gt; checking for __attribute__(may_alias)... yes</font></div></blockquote><div><div><br></div></div><div>That is obviously where I will start looking for the source of the problem.</div><div><br></div><div>Maybe someone reading this list knows what the purpose of that test is, whether the Intel 2011 compilers are expected to have this feature enabled, and whether the code this enables can cause this problem if the Intel 2011.6.233 compilers do not fully support whatever this test is intended to discern.</div><div apple-content-edited="true"> <div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div><div><div><div><div><div><div><div><div><div><br></div><div>Larry Baker</div><div>US Geological Survey</div><div>650-329-5608</div><div><a href="mailto:baker@usgs.gov">baker@usgs.gov</a></div></div></div></div></div></div></div></div></div></div></div> </div><br></div></div></div></div>_______________________________________________<br>devel mailing list<br><a href="mailto:devel@open-mpi.org">devel@open-mpi.org</a><br>http://www.open-mpi.org/mailman/listinfo.cgi/devel</blockquote></div><br></div></body></html>
