<div dir="ltr"><div class="gmail_extra"><br><div class="gmail_quote">On Sun, Dec 14, 2014 at 10:52 PM, Paul Hargrove <span dir="ltr">&lt;<a href="mailto:phhargrove@lbl.gov" target="_blank">phhargrove@lbl.gov</a>&gt;</span> wrote:<blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex"><div>Solaris-10/SPARC and &quot;--enable-static --disable-shared&quot; appears broken for C++ apps (but OK for C).</div><div>I will report in more details when I have more information.</div><div><div></div></div></blockquote></div><div class="gmail_extra"><br></div>First the good news:</div><div class="gmail_extra"><br>The problem I was experiencing (with the Solaris Studio compilers) turned out to be &quot;pilot error&quot;.</div><div class="gmail_extra">I had added &quot;-library=stlport4&quot; to CXXFLAGS but neglected to add the same in --with-wrapper-cxxflags.</div><div class="gmail_extra">Adding to both has always sort of bothered me, and this time it bit me.</div><div class="gmail_extra">Oddly, the problem didn&#39;t appear until I forced static libs.</div><div class="gmail_extra"><br></div><div class="gmail_extra">Now the bad news:</div><div class="gmail_extra"><br></div><div class="gmail_extra">By trying more variants on my Solaris platforms I was able to get TWO new failure modes.</div><div class="gmail_extra">However, I have a fix for one.</div><div class="gmail_extra"><br></div><div class="gmail_extra">1)</div><div class="gmail_extra">Still Solaris-10/SPARC and &quot;--enable-static --disable-shared&quot;  but this time with gcc-3.4.6.</div><div class="gmail_extra">With this configuration I get Bus Errors from &quot;make check&quot; that do not occur without these configure options:</div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div class="gmail_extra"><div class="gmail_extra"><font face="monospace">bash: line 5:  3141 Bus Error               (core dumped) ${dir}$tst</font></div></div><div class="gmail_extra"><div class="gmail_extra"><font face="monospace">FAIL: position</font></div></div><div class="gmail_extra"><div class="gmail_extra"><font face="monospace">bash: line 5:  3221 Bus Error               (core dumped) ${dir}$tst</font></div></div><div class="gmail_extra"><div class="gmail_extra"><font face="monospace">FAIL: position_noncontig</font></div></div></blockquote><div class="gmail_extra"><div><br></div><div>Examining the core from the second failure:</div></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div class="gmail_extra"><div><div><font face="monospace">t@1 (l@1) program terminated by signal BUS (invalid address alignment)</font></div></div></div><div class="gmail_extra"><div><div><font face="monospace">Current function is main</font></div></div></div><div class="gmail_extra"><div><div><font face="monospace">  208       opal_pack_debug     = 0;</font></div></div></div><div class="gmail_extra"><div><div><font face="monospace">(dbx) print &amp;opal_pack_debug</font></div></div></div><div class="gmail_extra"><div><div><font face="monospace">&amp;opal_pack_debug = 0x10092e169</font></div></div></div></blockquote><div class="gmail_extra"><div><br></div><div>The problem seems to be that the tests declare this (and others) as an int, but the opal headers say bool:</div></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div class="gmail_extra"><div><font face="monospace">$ gegrep  -r &#39;^extern .* opal_(pack|unpack|position)_debug&#39; .</font></div><div><font face="monospace">./test/datatype/position.c:extern int opal_unpack_debug;</font></div><div><font face="monospace">./test/datatype/position.c:extern int opal_pack_debug;</font></div><div><font face="monospace">./test/datatype/position.c:extern int opal_position_debug ;</font></div><div><font face="monospace">./test/datatype/position_noncontig.c:extern int opal_unpack_debug;</font></div><div><font face="monospace">./test/datatype/position_noncontig.c:extern int opal_pack_debug;</font></div><div><font face="monospace">./test/datatype/position_noncontig.c:extern int opal_position_debug ;</font></div><div><font face="monospace">./opal/datatype/opal_convertor_internal.h:extern bool opal_pack_debug;</font></div><div><font face="monospace">./opal/datatype/opal_datatype_position.c:extern bool opal_position_debug;</font></div></div></blockquote><font face="arial, helvetica, sans-serif">Defn of opal_unpack_debug is well hidden, but is also &quot;bool&quot;.<br></font><div><font face="arial, helvetica, sans-serif"><br></font></div><font face="arial, helvetica, sans-serif">Correcting &quot;int&quot; to &quot;bool&quot; for those 3 vars in the two tests resolved this problem for me.</font><div><div class="gmail_extra"><div><br></div><div><br></div><div><br></div></div><div class="gmail_extra">2)</div><div class="gmail_extra">Now on my Solaris-11/x86-64 system with both GigE and IPoIB interfaces.</div><div class="gmail_extra">I am seeing the following when using the Solaris Studio compilers (Gnu compilers were fine):</div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div class="gmail_extra"><div class="gmail_extra"><font face="monospace">$ mpirun -mca btl sm,self,openib -np 2 -host pcp-j-19,pcp-j-20 examples/ring_c&#39;</font></div></div><div class="gmail_extra"><div class="gmail_extra"><font face="monospace">[pcp-j-20:16239] mca_oob_tcp_accept: accept() failed: Error 0 (0).</font></div></div><div class="gmail_extra"><div class="gmail_extra"><font face="monospace">------------------------------------------------------------</font></div></div><div class="gmail_extra"><div class="gmail_extra"><font face="monospace">A process or daemon was unable to complete a TCP connection</font></div></div><div class="gmail_extra"><div class="gmail_extra"><font face="monospace">to another process:</font></div></div><div class="gmail_extra"><div class="gmail_extra"><font face="monospace">  Local host:    pcp-j-20</font></div></div><div class="gmail_extra"><div class="gmail_extra"><font face="monospace">  Remote host:   172.18.0.120</font></div></div><div class="gmail_extra"><div class="gmail_extra"><font face="monospace">This is usually caused by a firewall on the remote host. Please</font></div></div><div class="gmail_extra"><div class="gmail_extra"><font face="monospace">check that any firewall (e.g., iptables) has been disabled and</font></div></div><div class="gmail_extra"><div class="gmail_extra"><font face="monospace">try again.</font></div></div><div class="gmail_extra"><div class="gmail_extra"><font face="monospace">------------------------------------------------------------</font></div></div></blockquote><div class="gmail_extra"><br></div><div class="gmail_extra">Notice the &quot;Error 0 (0)&quot; which means errno=0 and suggests that we&#39;ve not properly linked the thread-safe C libraries (recall that there is one thread per interface and these hosts have two).</div><div class="gmail_extra">I see &quot;-D_REENTRANT&quot; in the output of &quot;make&quot;.</div><div class="gmail_extra">However, the man pages suggest that one also needs &quot;-mt=yes&quot; in *both* the compile and link steps (it defines _REENTRANT and links the proper libs).</div><div class="gmail_extra"><br></div><div class="gmail_extra">I hoped that I could resolve this failure by adding LDFLAGS=-mt=yes to the configure command.</div><div class="gmail_extra">However, that didn&#39;t work.</div><div class="gmail_extra"><br></div><div class="gmail_extra"><br></div><div class="gmail_extra">-Paul<br><br clear="all"><div><br></div>-- <br><div class="gmail_signature"><div dir="ltr"><div><font face="courier new, monospace"><div>Paul H. Hargrove                          <a href="mailto:PHHargrove@lbl.gov" target="_blank">PHHargrove@lbl.gov</a></div><div>Computer Languages &amp; Systems Software (CLaSS) Group</div><div>Computer Science Department               Tel: +1-510-495-2352</div><div>Lawrence Berkeley National Laboratory     Fax: +1-510-486-6900</div></font></div></div></div>
</div></div></div>

